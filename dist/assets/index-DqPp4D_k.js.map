{"version":3,"file":"index-DqPp4D_k.js","sources":["../../src/gpu/context.ts","../../src/gpu/shaders.ts","../../src/gpu/math.ts","../../src/types/index.ts","../../src/gpu/spectral-volume.ts","../../src/gpu/reading-path.ts","../../src/gpu/renderer.ts","../../src/ui/preset-manager.ts","../../src/ui/ui-elements.ts","../../src/ui/controls.ts","../../src/ui/spectrogram-webgl.ts","../../src/ui/scope-webgl.ts","../../src/audio/audio-engine.ts","../../src/audio/audio-analyzer.ts","../../src/audio/midi-handler.ts","../../src/ui/envelope-editor.ts","../../src/ui/piano.ts","../../src/modulators/lfo.ts","../../src/main.ts"],"sourcesContent":["// WebGL2 context manager with extension validation\n\nexport class WebGLContext {\n    public readonly gl: WebGL2RenderingContext;\n    private canvas: HTMLCanvasElement;\n\n    constructor(canvas: HTMLCanvasElement) {\n        this.canvas = canvas;\n\n        const gl = canvas.getContext('webgl2', {\n            alpha: false,\n            antialias: true,\n            depth: true,\n        });\n\n        if (!gl) {\n            throw new Error('WebGL2 not supported');\n        }\n\n        this.gl = gl;\n        this.validateExtensions();\n        this.logInfo();\n    }\n\n    private validateExtensions(): void {\n        const required = ['EXT_color_buffer_float'];\n\n        for (const ext of required) {\n            if (!this.gl.getExtension(ext)) {\n                throw new Error(`Required WebGL extension not available: ${ext}`);\n            }\n        }\n    }\n\n    private logInfo(): void {\n        const gl = this.gl;\n        console.log('✓ WebGL2 Context Created');\n        console.log('  Vendor:', gl.getParameter(gl.VENDOR));\n        console.log('  Renderer:', gl.getParameter(gl.RENDERER));\n        console.log('  Version:', gl.getParameter(gl.VERSION));\n        console.log('  GLSL Version:', gl.getParameter(gl.SHADING_LANGUAGE_VERSION));\n    }\n\n    public resize(width: number, height: number): void {\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.gl.viewport(0, 0, width, height);\n    }\n\n    public clear(r: number, g: number, b: number): void {\n        this.gl.clearColor(r, g, b, 1.0);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n    }\n}\n","// Shader source code for rendering\n\n// ====== Wireframe Cube Shaders ======\n\nexport const wireframeVertexShader = `#version 300 es\nprecision highp float;\n\nin vec3 aPosition;\nuniform mat4 uModelViewProjection;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aPosition, 1.0);\n}\n`;\n\nexport const wireframeFragmentShader = `#version 300 es\nprecision highp float;\n\nuniform vec3 uColor;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(uColor, 1.0);\n}\n`;\n\n// ====== Point Cloud Shaders (for spectral volume visualization) ======\n\nexport const pointVertexShader = `#version 300 es\nprecision highp float;\nprecision highp sampler3D;\n\nin vec3 aPosition;\nuniform mat4 uModelViewProjection;\nuniform float uPointSize;\nuniform sampler3D uVolume;\nuniform vec3 uVolumeRes; // Volume resolution (x, y, z) for density calculation\n\nout vec4 vColor;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aPosition, 1.0);\n  \n  // Sample volume data\n  vec3 texCoord = (aPosition + 1.0) * 0.5;\n  vec4 data = texture(uVolume, texCoord);\n  \n  // R = Magnitude, G = Phase, B = Custom1, A = Custom2\n  float magnitude = data.r;\n  float phase = data.g;\n  \n  // Calculate maximum point size based on grid density\n  // Points should not be larger than the grid cell spacing\n  float minRes = min(min(uVolumeRes.x, uVolumeRes.y), uVolumeRes.z);\n  float maxPointSize = (2.0 / minRes) * 100.0; // Grid cell size in screen space (approximate)\n  \n  // Size based on magnitude with logarithmic scaling\n  // Logarithmic scale makes low magnitudes more visible while preserving dynamics\n  float size = uPointSize;\n  if (magnitude > 0.001) {\n      // log(1 + x*k) gives gentle compression, making dim points visible\n      size = uPointSize * (1.0 + log(1.0 + magnitude * 20.0) * 1.5);\n  }\n  \n  // Clamp to max size based on density\n  size = min(size, maxPointSize);\n  \n  gl_PointSize = size;\n  \n  // Pass color to fragment shader\n  // R channel = Magnitude (Red)\n  // G channel = Phase (Green)\n  // Mix them for visualization\n  vColor = vec4(magnitude, phase, 0.2, magnitude); \n}\n`;\n\nexport const pointFragmentShader = `#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nuniform float uAlpha;\nout vec4 fragColor;\n\nvoid main() {\n  // Make points circular (not square)\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n  \n  // Use color from vertex shader, modulate alpha\n  // If magnitude is low, make it very transparent\n  float alpha = uAlpha;\n  if (vColor.r > 0.01) {\n      alpha = uAlpha + vColor.r * 0.5; // More opacity for higher magnitude\n  }\n  \n  fragColor = vec4(vColor.rgb, alpha);\n}\n`;\n\n// ====== Plane Shaders (for reading path visualization) ======\n\nexport const planeVertexShader = `#version 300 es\nprecision highp float;\nprecision highp sampler3D;\n\nin vec3 aPosition;\nuniform mat4 uModelViewProjection;\nuniform mat4 uModelMatrix; // To transform position to world space for sampling\nuniform sampler3D uVolume;\n\nout vec4 vColor;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aPosition, 1.0);\n  \n  // Transform position to world space (which matches volume space [-1, 1])\n  // Note: The plane is transformed by uModelMatrix (rotation/translation)\n  // We need to sample the volume at this transformed position.\n  // However, uModelViewProjection includes View and Projection.\n  // We need a separate uModelMatrix to get world coordinates.\n  // BUT, wait. The plane vertices are local to the plane.\n  // The plane moves through the volume.\n  // So we need to apply the plane's transformation to get volume coordinates.\n  \n  vec4 worldPos = uModelMatrix * vec4(aPosition, 1.0);\n  vec3 texCoord = (worldPos.xyz + 1.0) * 0.5;\n  \n  // Sample volume\n  // Use trilinear filtering (hardware or manual if needed, but hardware linear is usually fine)\n  vec4 data = texture(uVolume, texCoord);\n  \n  // Visualize data\n  // R = Magnitude -> Red/Intensity\n  // G = Phase -> Green/Variation\n  float mag = data.r;\n  float phase = data.g;\n  \n  // Base color (teal) mixed with data\n  vec3 baseColor = vec3(0.0, 1.0, 0.5);\n  vec3 activeColor = vec3(1.0, 0.2, 0.2); // Reddish for high magnitude\n  \n  // Mix based on magnitude\n  vec3 finalColor = mix(baseColor, activeColor, mag);\n  \n  // Add phase influence to green channel\n  finalColor.g += phase * 0.3;\n  \n  vColor = vec4(finalColor, 1.0);\n}\n`;\n\nexport const planeFragmentShader = `#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nuniform float uAlpha;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(vColor.rgb, uAlpha);\n}\n`;\n","// Simple 4x4 matrix operations for MVP transforms\n// Carmack-style: simple, direct, no abstraction\n\nexport type Mat4 = Float32Array; // 16 elements, column-major\n\nexport function mat4Identity(): Mat4 {\n    const m = new Float32Array(16);\n    m[0] = m[5] = m[10] = m[15] = 1.0;\n    return m;\n}\n\nexport function mat4Perspective(fov: number, aspect: number, near: number, far: number): Mat4 {\n    const f = 1.0 / Math.tan(fov / 2.0);\n    const nf = 1.0 / (near - far);\n\n    const m = new Float32Array(16);\n    m[0] = f / aspect;\n    m[5] = f;\n    m[10] = (far + near) * nf;\n    m[11] = -1.0;\n    m[14] = 2.0 * far * near * nf;\n    return m;\n}\n\nexport function mat4LookAt(eye: [number, number, number], center: [number, number, number], up: [number, number, number]): Mat4 {\n    const z0 = eye[0] - center[0];\n    const z1 = eye[1] - center[1];\n    const z2 = eye[2] - center[2];\n\n    let len = 1.0 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n    const zx = z0 * len;\n    const zy = z1 * len;\n    const zz = z2 * len;\n\n    const x0 = up[1] * zz - up[2] * zy;\n    const x1 = up[2] * zx - up[0] * zz;\n    const x2 = up[0] * zy - up[1] * zx;\n\n    len = 1.0 / Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n    const xx = x0 * len;\n    const xy = x1 * len;\n    const xz = x2 * len;\n\n    const yx = zy * xz - zz * xy;\n    const yy = zz * xx - zx * xz;\n    const yz = zx * xy - zy * xx;\n\n    const m = new Float32Array(16);\n    m[0] = xx;\n    m[1] = yx;\n    m[2] = zx;\n    m[4] = xy;\n    m[5] = yy;\n    m[6] = zy;\n    m[8] = xz;\n    m[9] = yz;\n    m[10] = zz;\n    m[12] = -(xx * eye[0] + xy * eye[1] + xz * eye[2]);\n    m[13] = -(yx * eye[0] + yy * eye[1] + yz * eye[2]);\n    m[14] = -(zx * eye[0] + zy * eye[1] + zz * eye[2]);\n    m[15] = 1.0;\n    return m;\n}\n\nexport function mat4RotateX(angle: number): Mat4 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    const m = mat4Identity();\n    m[5] = c;\n    m[6] = s;\n    m[9] = -s;\n    m[10] = c;\n    return m;\n}\n\nexport function mat4RotateY(angle: number): Mat4 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    const m = mat4Identity();\n    m[0] = c;\n    m[2] = -s;\n    m[8] = s;\n    m[10] = c;\n    return m;\n}\n\nexport function mat4RotateZ(angle: number): Mat4 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    const m = mat4Identity();\n    m[0] = c;\n    m[1] = s;\n    m[4] = -s;\n    m[5] = c;\n    return m;\n}\n\nexport function mat4Translate(x: number, y: number, z: number): Mat4 {\n    const m = mat4Identity();\n    m[12] = x;\n    m[13] = y;\n    m[14] = z;\n    return m;\n}\n\nexport function mat4Multiply(a: Mat4, b: Mat4): Mat4 {\n    const out = new Float32Array(16);\n\n    for (let i = 0; i < 4; i++) {\n        for (let j = 0; j < 4; j++) {\n            out[j * 4 + i] =\n                a[0 * 4 + i] * b[j * 4 + 0] +\n                a[1 * 4 + i] * b[j * 4 + 1] +\n                a[2 * 4 + i] * b[j * 4 + 2] +\n                a[3 * 4 + i] * b[j * 4 + 3];\n        }\n    }\n\n    return out;\n}\n\nexport function vec3TransformMat4(v: [number, number, number], m: Mat4): [number, number, number] {\n    const x = v[0], y = v[1], z = v[2];\n    const w = m[3] * x + m[7] * y + m[11] * z + m[15];\n    const iw = w !== 0 ? 1.0 / w : 1.0;\n\n    return [\n        (m[0] * x + m[4] * y + m[8] * z + m[12]) * iw,\n        (m[1] * x + m[5] * y + m[9] * z + m[13]) * iw,\n        (m[2] * x + m[6] * y + m[10] * z + m[14]) * iw\n    ];\n}\n","// Type definitions for Spectra Table Synthesis\n\nexport interface Vec3 {\n    x: number;\n    y: number;\n    z: number;\n}\n\nexport interface ReadingPathState {\n    position: Vec3;     // Current XYZ position in spectral cube\n    rotation: Vec3;     // Rotation of the reading plane (euler angles)\n    scanPosition: number; // Position of reading line on plane (-1 to 1)\n    planeType: PlaneType;\n    shapePhase: number; // Phase offset for plane shape modulation\n}\n\nexport interface SpatialState {\n    stereoSpread: number;  // Width of stereo field (0-1)\n}\n\nexport interface SpectralSlice {\n    magnitude: Float32Array;  // Frequency magnitudes\n    phase: Float32Array;      // Phase values\n    pan: Float32Array;        // Stereo pan per frequency\n    width: Float32Array;      // Stereo width per frequency\n}\n\nexport interface VolumeResolution {\n    x: number;  // Frequency bins (horizontal)\n    y: number;  // Morph axis - different samples at different Y positions (vertical)\n    z: number;  // Time slices within each sample (depth)\n}\n\n// Plane types for reading path visualization\nexport enum PlaneType {\n    FLAT = 'PLANE',\n    SINCOS = 'PLOT 1',\n    WAVE = 'PLOT 2',\n    RIPPLE = 'PLOT 3',\n}\n\n// Sensible density ranges for the spectral volume\nexport const VOLUME_DENSITY_X_MIN = 16;\nexport const VOLUME_DENSITY_X_MAX = 512;\nexport const VOLUME_DENSITY_X_DEFAULT = 64;\n\nexport const VOLUME_DENSITY_Y_MIN = 1;  // Minimum 1 sample\nexport const VOLUME_DENSITY_Y_MAX = 16; // Max 16 samples to morph\nexport const VOLUME_DENSITY_Y_DEFAULT = 2;\n\nexport const VOLUME_DENSITY_Z_MIN = 16;  // Minimum time resolution\nexport const VOLUME_DENSITY_Z_MAX = 1024;\nexport const VOLUME_DENSITY_Z_DEFAULT = 128;\n\n// Synthesis modes\nexport enum SynthMode {\n    SPECTRAL = 'iFFT Spectral',   // iFFT / additive synthesis from frequency bins\n    WAVETABLE = 'Wavetable', // Direct waveform playback from reading line\n    WHITENOISE_BAND_Q_FILTER = 'Noise band filter', // Subtractive noise filtering\n}\n\n// Carrier waveform types for wavetable AM synthesis\nexport enum CarrierType {\n    SINE = 0,\n    SAW = 1,\n    SQUARE = 2,\n    TRIANGLE = 3,\n}\n\nexport interface LFOState {\n    waveform: string;\n    frequency: number;\n    amplitude: number;\n    offset: number;\n}\n\n// Octave doubling state for octave layering\nexport interface OctaveDoublingState {\n    lowCount: number;      // 0-10, number of octaves below base frequency\n    highCount: number;     // 0-10, number of octaves above base frequency\n    multiplier: number;    // 0.0-1.0, volume decay per octave step\n}\n\nexport const defaultOctaveDoublingState: OctaveDoublingState = {\n    lowCount: 0,\n    highCount: 0,\n    multiplier: 0.5\n};\n\n// Generator parameter interfaces\nexport interface JuliaParams {\n    scale: number;      // 0.5 - 2.0, default 1.2\n    cReal: number;      // -1 to 1, default -0.4\n    cImag: number;      // -1 to 1, default 0.6\n}\n\nexport interface MandelbulbParams {\n    power: number;      // 2 - 12, default 8\n    scale: number;      // 0.5 - 2.0, default 1.2\n    iterations: number; // 4 - 20, default 12\n}\n\nexport interface MengerParams {\n    iterations: number; // 1 - 5, default 4\n    scale: number;      // 0.5 - 2.0, default 1.0\n    holeSize: number;   // 0.2 - 0.5, default 0.33\n}\n\nexport interface PlasmaParams {\n    frequency: number;  // 1 - 10, default 3\n    complexity: number; // 1 - 6, default 4\n    contrast: number;   // 0.5 - 3.0, default 2.0\n}\n\nexport interface GameOfLifeParams {\n    density: number;    // 0.1 - 0.5, default 0.3\n    birthMin: number;   // 4 - 6, default 5\n    surviveMin: number; // 3 - 6, default 4\n}\n\nexport type GeneratorParams = JuliaParams | MandelbulbParams | MengerParams | PlasmaParams | GameOfLifeParams;\n\n// Default generator parameters\nexport const defaultJuliaParams: JuliaParams = { scale: 1.0, cReal: -0.4, cImag: 0.6 };\nexport const defaultMandelbulbParams: MandelbulbParams = { power: 8, scale: 1.2, iterations: 12 };\nexport const defaultMengerParams: MengerParams = { iterations: 4, scale: 1.0, holeSize: 0.33 };\nexport const defaultPlasmaParams: PlasmaParams = { frequency: 3, complexity: 4, contrast: 2.0 };\nexport const defaultGameOfLifeParams: GameOfLifeParams = { density: 0.3, birthMin: 5, surviveMin: 4 };\n\n// Preset system\nexport interface PresetControls {\n    pathY: number;\n    scanPosition: number;\n    planeType: string;\n    synthMode: string;\n    frequency: number;\n    carrier: number;\n    feedback: number;\n    densityX: number;\n    densityY: number;\n    densityZ: number;\n    spectralData: string;\n    generatorParams?: GeneratorParams;\n    lfos: { waveform: string; frequency: number; amplitude: number; offset: number }[];\n    envelopes: { attack: number; decay: number; sustain: number; release: number }[];\n    modRouting: { pathY: string; scanPhase: string; shapePhase: string };\n    octave: number;\n    octaveDoubling?: OctaveDoublingState;\n    interpSamples: number;\n}\n\nexport interface PresetData {\n    name: string;\n    timestamp: number;\n    controls: PresetControls;\n}\n\nexport const STORAGE_KEY_STATE = 'spectraltable_state';\nexport const STORAGE_KEY_PRESETS = 'spectraltable_presets';\n","import { WebGLContext } from './context';\nimport {\n    VolumeResolution,\n    JuliaParams, MandelbulbParams, MengerParams, PlasmaParams, GameOfLifeParams,\n    defaultJuliaParams, defaultMandelbulbParams, defaultMengerParams, defaultPlasmaParams, defaultGameOfLifeParams\n} from '../types';\n\n// 3D Spectral Volume - GPU storage for RGBA spectral data\n// Each voxel stores: R=Magnitude, G=Phase, B=Custom1, A=Custom2\n\nexport class SpectralVolume {\n    private ctx: WebGLContext;\n    private texture: WebGLTexture | null = null;\n    private resolution: VolumeResolution;\n\n    private data: Float32Array | null = null;\n\n    // Game of Life 3D state\n    private gameOfLifeState: Uint8Array | null = null;  // Binary cell states\n    private gameOfLifeBuffer: Uint8Array | null = null; // Double buffer for updates\n\n    constructor(ctx: WebGLContext, resolution: VolumeResolution) {\n        this.ctx = ctx;\n        this.resolution = resolution;\n        this.initialize();\n    }\n\n    private initialize(): void {\n        const gl = this.ctx.gl;\n\n        // Clean up old texture if exists\n        if (this.texture) {\n            gl.deleteTexture(this.texture);\n        }\n\n        // Create 3D texture\n        this.texture = gl.createTexture();\n        if (!this.texture) throw new Error('Failed to create 3D texture');\n\n        gl.bindTexture(gl.TEXTURE_3D, this.texture);\n\n        // Allocate storage (RGBA32F format)\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n\n        // Initialize data array if not exists or size changed\n        if (!this.data || this.data.length !== totalVoxels * 4) {\n            this.data = new Float32Array(totalVoxels * 4); // RGBA\n            this.data.fill(0.0);\n        }\n\n        gl.texImage3D(\n            gl.TEXTURE_3D,\n            0,                    // mip level\n            gl.RGBA32F,           // internal format\n            x, y, z,              // dimensions\n            0,                    // border (must be 0)\n            gl.RGBA,              // format\n            gl.FLOAT,             // type\n            this.data             // data\n        );\n\n        // Set texture parameters (no filtering for now, nearest neighbor)\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_R, gl.CLAMP_TO_EDGE);\n\n        gl.bindTexture(gl.TEXTURE_3D, null);\n\n        const memoryMB = (totalVoxels * 4 * 4) / (1024 * 1024); // 4 floats, 4 bytes each\n        console.log(`✓ Spectral Volume: ${x}×${y}×${z} = ${totalVoxels} voxels (${memoryMB.toFixed(2)} MB)`);\n    }\n\n    public setData(data: Float32Array): void {\n        const gl = this.ctx.gl;\n        const { x, y, z } = this.resolution;\n\n        if (data.length !== x * y * z * 4) {\n            throw new Error('Data length does not match volume resolution');\n        }\n\n        this.data = data; // Store reference\n\n        gl.bindTexture(gl.TEXTURE_3D, this.texture);\n        gl.texSubImage3D(\n            gl.TEXTURE_3D,\n            0,\n            0, 0, 0,\n            x, y, z,\n            gl.RGBA,\n            gl.FLOAT,\n            data\n        );\n        gl.bindTexture(gl.TEXTURE_3D, null);\n    }\n\n    public generate3DJulia(params: JuliaParams = defaultJuliaParams): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        const { scale, cReal, cImag } = params;\n        const maxIter = 16;\n        const power = 8.0;\n\n        // Julia C constant (quaternion-style: real + i*imag + j*0)\n        const cx = cReal;\n        const cy = cImag;\n        const cz = 0.0;\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Map to centered coordinates [-scale, scale]\n                    const px = ((ix / (x - 1)) * 2 - 1) * scale;\n                    const py = ((iy / (y - 1)) * 2 - 1) * scale;\n                    const pz = ((iz / (z - 1)) * 2 - 1) * scale;\n\n                    let zx = px;\n                    let zy = py;\n                    let zz = pz;\n\n                    let r = 0.0;\n                    let iter = 0;\n\n                    for (; iter < maxIter; iter++) {\n                        r = Math.sqrt(zx * zx + zy * zy + zz * zz);\n                        if (r > 2.0) break;\n\n                        // Spherical coordinates for 3D power\n                        const theta = Math.acos(zz / (r + 0.0001));\n                        const phi = Math.atan2(zy, zx);\n\n                        const zr = Math.pow(r, power);\n                        const newTheta = theta * power;\n                        const newPhi = phi * power;\n\n                        zx = zr * Math.sin(newTheta) * Math.cos(newPhi) + cx;\n                        zy = zr * Math.sin(newTheta) * Math.sin(newPhi) + cy;\n                        zz = zr * Math.cos(newTheta) + cz;\n                    }\n\n                    // Interior points (didn't escape) get high magnitude\n                    // This fills the volume better than boundary-only coloring\n                    let mag = 0.0;\n                    if (iter === maxIter) {\n                        // Inside the set - use distance from origin as intensity\n                        mag = 0.8 - r * 0.3;\n                        mag = Math.max(0.2, Math.min(1.0, mag));\n                    } else if (iter > 3) {\n                        // Boundary region - smooth coloring\n                        const smoothVal = iter - Math.log2(Math.log2(r + 1));\n                        mag = (smoothVal / maxIter) * 0.6;\n                    }\n\n                    // Frequency-dependent boost (bass emphasis)\n                    const freqPos = ix / x;\n                    const freqBoost = 1.0 + (1.0 - freqPos) * 0.4;\n                    mag *= freqBoost;\n                    mag = Math.min(1.0, mag);\n\n                    const phase = (iter / maxIter + px * 0.1) % 1.0;\n                    const custom1 = (py / scale + 1) * 0.5;\n                    const custom2 = (pz / scale + 1) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    public generateMandelbulb(params: MandelbulbParams = defaultMandelbulbParams): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        const { power, scale, iterations } = params;\n        const maxIter = Math.round(iterations);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Map to centered coordinates [-scale, scale]\n                    const px = ((ix / (x - 1)) * 2 - 1) * scale;\n                    const py = ((iy / (y - 1)) * 2 - 1) * scale;\n                    const pz = ((iz / (z - 1)) * 2 - 1) * scale;\n\n                    // Mandelbulb: z = z^n + c where c is the starting point\n                    let zx = 0, zy = 0, zz = 0;\n                    let r = 0.0;\n                    let iter = 0;\n\n                    for (; iter < maxIter; iter++) {\n                        r = Math.sqrt(zx * zx + zy * zy + zz * zz);\n                        if (r > 2.0) break;\n\n                        // Spherical coordinates\n                        const theta = Math.acos(zz / (r + 0.0001));\n                        const phi = Math.atan2(zy, zx);\n\n                        const zr = Math.pow(r, power);\n                        const newTheta = theta * power;\n                        const newPhi = phi * power;\n\n                        // z^n + c\n                        zx = zr * Math.sin(newTheta) * Math.cos(newPhi) + px;\n                        zy = zr * Math.sin(newTheta) * Math.sin(newPhi) + py;\n                        zz = zr * Math.cos(newTheta) + pz;\n                    }\n\n                    // Interior points get high magnitude\n                    let mag = 0.0;\n                    if (iter === maxIter) {\n                        // Inside the Mandelbulb\n                        mag = 0.9 - r * 0.2;\n                        mag = Math.max(0.3, Math.min(1.0, mag));\n                    } else if (iter > 2) {\n                        // Boundary - iteration-based coloring\n                        mag = (iter / maxIter) * 0.5;\n                    }\n\n                    // Frequency-dependent boost\n                    const freqPos = ix / x;\n                    const freqBoost = 1.0 + (1.0 - freqPos) * 0.4;\n                    mag *= freqBoost;\n                    mag = Math.min(1.0, mag);\n\n                    const phase = (iter / maxIter);\n                    const custom1 = (py / scale + 1) * 0.5;\n                    const custom2 = (pz / scale + 1) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    public generateMengerSponge(params: MengerParams = defaultMengerParams): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        const { iterations, scale } = params;\n        const maxIter = Math.round(iterations);\n\n        // Menger sponge: at each level, divide into 3x3x3 grid\n        // Remove center cube of each face (cross pattern)\n        const isInSponge = (px: number, py: number, pz: number): boolean => {\n            // Map to [0, 1] range\n            let ux = (px / scale + 1) * 0.5;\n            let uy = (py / scale + 1) * 0.5;\n            let uz = (pz / scale + 1) * 0.5;\n\n            for (let i = 0; i < maxIter; i++) {\n                // Scale up to [0, 3] and get position in 3x3x3 grid\n                ux *= 3;\n                uy *= 3;\n                uz *= 3;\n\n                const gx = Math.floor(ux) % 3;\n                const gy = Math.floor(uy) % 3;\n                const gz = Math.floor(uz) % 3;\n\n                // Check if in hole (middle of any 2 axes)\n                const midX = gx === 1;\n                const midY = gy === 1;\n                const midZ = gz === 1;\n\n                // Hole if at least 2 coordinates are in the middle\n                const holeCount = (midX ? 1 : 0) + (midY ? 1 : 0) + (midZ ? 1 : 0);\n                if (holeCount >= 2) {\n                    return false; // In a hole\n                }\n\n                // Continue to next subdivision level\n                ux = ux % 1;\n                uy = uy % 1;\n                uz = uz % 1;\n            }\n\n            return true; // Solid\n        };\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Map to centered coordinates [-scale, scale]\n                    const px = ((ix / (x - 1)) * 2 - 1) * scale;\n                    const py = ((iy / (y - 1)) * 2 - 1) * scale;\n                    const pz = ((iz / (z - 1)) * 2 - 1) * scale;\n\n                    const inSponge = isInSponge(px, py, pz);\n                    let mag = inSponge ? 0.8 : 0.0;\n\n                    // Add subtle variation based on position\n                    if (inSponge) {\n                        const detail = Math.sin(px * 10) * Math.sin(py * 10) * Math.sin(pz * 10);\n                        mag += detail * 0.1;\n                    }\n\n                    // Frequency-dependent boost\n                    const freqPos = ix / x;\n                    const freqBoost = 1.0 + (1.0 - freqPos) * 0.3;\n                    mag *= freqBoost;\n                    mag = Math.max(0, Math.min(1.0, mag));\n\n                    const phase = ((px + py + pz) / scale + 3) / 6 % 1.0;\n                    const custom1 = (py / scale + 1) * 0.5;\n                    const custom2 = (pz / scale + 1) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    // Sine Plasma state for evolution\n    private plasmaTime: number = 0;\n    private plasmaParams: PlasmaParams = defaultPlasmaParams;\n\n    public generateSinePlasma(timeOffset: number = 0, params: PlasmaParams = defaultPlasmaParams): void {\n        this.plasmaParams = params;\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        const { frequency, complexity, contrast } = params;\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Normalized coordinates -1 to 1\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    // Demo-scene style plasma: sum of sines\n                    let v = 0.0;\n                    const layers = Math.round(complexity);\n\n                    // 1. Basic waves along axes\n                    v += Math.sin(nx * frequency + timeOffset);\n                    v += Math.sin(ny * frequency * 0.8 + timeOffset * 0.8);\n                    v += Math.sin(nz * frequency * 0.6 + timeOffset * 1.2);\n\n                    // 2. Diagonal wave (if complexity > 1)\n                    if (layers > 1) {\n                        v += Math.sin((nx + ny + nz) * frequency * 0.7 + timeOffset * 0.5);\n                    }\n\n                    // 3. Circular pattern (if complexity > 2)\n                    if (layers > 2) {\n                        const dist = Math.sqrt(nx * nx + ny * ny + nz * nz);\n                        v += Math.sin(dist * frequency * 2 - timeOffset * 1.5);\n                    }\n\n                    // 4. Spiral twisting (if complexity > 3)\n                    if (layers > 3) {\n                        const angle = Math.atan2(ny, nx);\n                        v += Math.sin(angle * 3.0 + nz * frequency + timeOffset);\n                    }\n\n                    // Normalize v roughly to 0..1\n                    const maxV = 3 + Math.min(layers - 1, 3);\n                    let mag = (v + maxV) / (maxV * 2);\n\n                    // Add hard edges (classic demo effect)\n                    mag = (Math.sin(mag * 10 * contrast) + 1.0) * 0.5;\n\n                    // Apply contrast curve\n                    mag = Math.pow(mag, contrast);\n\n                    // Frequency-dependent boost\n                    const freqPos = ix / x;\n                    const freqBoost = 1.0 + (1.0 - freqPos) * 0.5;\n                    mag *= freqBoost;\n\n                    mag = Math.max(0.0, Math.min(0.95, mag));\n\n                    const phase = (mag + timeOffset * 0.2) % 1.0;\n                    const custom1 = (Math.sin(nx * Math.PI + timeOffset) + 1.0) * 0.5;\n                    const custom2 = (Math.cos(ny * Math.PI + timeOffset) + 1.0) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    public stepSinePlasma(): void {\n        this.plasmaTime += 0.02;\n        this.generateSinePlasma(this.plasmaTime, this.plasmaParams);\n    }\n\n    public clearData(): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n        data.fill(0.0);\n        this.setData(data);\n    }\n\n    public sample(x: number, y: number, z: number): Float32Array {\n        if (!this.data) return new Float32Array([0, 0, 0, 0]);\n\n        const { x: w, y: h, z: d } = this.resolution;\n\n        // Clamp coordinates to [0, 1]\n        const u = Math.max(0, Math.min(1, x));\n        const v = Math.max(0, Math.min(1, y));\n        const w_coord = Math.max(0, Math.min(1, z));\n\n        // Convert to grid coordinates\n        const gx = u * (w - 1);\n        const gy = v * (h - 1);\n        const gz = w_coord * (d - 1);\n\n        // Integer parts\n        const x0 = Math.floor(gx);\n        const y0 = Math.floor(gy);\n        const z0 = Math.floor(gz);\n\n        // Fractional parts\n        const fx = gx - x0;\n        const fy = gy - y0;\n        const fz = gz - z0;\n\n        // Next neighbors (clamp to max index)\n        const x1 = Math.min(x0 + 1, w - 1);\n        const y1 = Math.min(y0 + 1, h - 1);\n        const z1 = Math.min(z0 + 1, d - 1);\n\n        // Helper to get index\n        const getIdx = (ix: number, iy: number, iz: number) => (iz * h * w + iy * w + ix) * 4;\n\n        // Sample 8 corners\n        const c000 = getIdx(x0, y0, z0);\n        const c100 = getIdx(x1, y0, z0);\n        const c010 = getIdx(x0, y1, z0);\n        const c110 = getIdx(x1, y1, z0);\n        const c001 = getIdx(x0, y0, z1);\n        const c101 = getIdx(x1, y0, z1);\n        const c011 = getIdx(x0, y1, z1);\n        const c111 = getIdx(x1, y1, z1);\n\n        const result = new Float32Array(4);\n\n        // Trilinear interpolation for each channel\n        for (let i = 0; i < 4; i++) {\n            const v000 = this.data[c000 + i];\n            const v100 = this.data[c100 + i];\n            const v010 = this.data[c010 + i];\n            const v110 = this.data[c110 + i];\n            const v001 = this.data[c001 + i];\n            const v101 = this.data[c101 + i];\n            const v011 = this.data[c011 + i];\n            const v111 = this.data[c111 + i];\n\n            // Interpolate along x\n            const c00 = v000 * (1 - fx) + v100 * fx;\n            const c10 = v010 * (1 - fx) + v110 * fx;\n            const c01 = v001 * (1 - fx) + v101 * fx;\n            const c11 = v011 * (1 - fx) + v111 * fx;\n\n            // Interpolate along y\n            const c0 = c00 * (1 - fy) + c10 * fy;\n            const c1 = c01 * (1 - fy) + c11 * fy;\n\n            // Interpolate along z\n            result[i] = c0 * (1 - fz) + c1 * fz;\n        }\n\n        return result;\n    }\n\n    public updateResolution(resolution: VolumeResolution): void {\n        this.resolution = resolution;\n        this.data = null; // Force reallocation\n        this.initialize();\n    }\n\n    public getResolution(): VolumeResolution {\n        return { ...this.resolution };\n    }\n\n    public getTexture(): WebGLTexture | null {\n        return this.texture;\n    }\n\n    public destroy(): void {\n        if (this.texture) {\n            this.ctx.gl.deleteTexture(this.texture);\n            this.texture = null;\n        }\n        this.data = null;\n        this.gameOfLifeState = null;\n        this.gameOfLifeBuffer = null;\n    }\n\n    // ===== 3D Game of Life =====\n    private golParams: GameOfLifeParams = defaultGameOfLifeParams;\n\n    public initGameOfLife(params: GameOfLifeParams = defaultGameOfLifeParams): void {\n        this.golParams = params;\n        const { x, y, z } = this.resolution;\n        const totalCells = x * y * z;\n\n        // Initialize state arrays\n        this.gameOfLifeState = new Uint8Array(totalCells);\n        this.gameOfLifeBuffer = new Uint8Array(totalCells);\n\n        // Fill with random blobs based on density parameter\n        for (let i = 0; i < totalCells; i++) {\n            this.gameOfLifeState[i] = Math.random() < params.density ? 1 : 0;\n        }\n\n        // Convert initial state to spectral data\n        this.gameOfLifeToSpectral();\n    }\n\n    public stepGameOfLife(): void {\n        if (!this.gameOfLifeState || !this.gameOfLifeBuffer) return;\n\n        const { x, y, z } = this.resolution;\n        const { birthMin, surviveMin } = this.golParams;\n\n        // Helper to get cell index with wrapping (toroidal topology)\n        const getIdx = (ix: number, iy: number, iz: number): number => {\n            const wx = ((ix % x) + x) % x;\n            const wy = ((iy % y) + y) % y;\n            const wz = ((iz % z) + z) % z;\n            return wz * y * x + wy * x + wx;\n        };\n\n        // Count neighbors for each cell\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const idx = getIdx(ix, iy, iz);\n                    let neighbors = 0;\n\n                    // Check all 26 neighbors (3x3x3 - 1)\n                    for (let dz = -1; dz <= 1; dz++) {\n                        for (let dy = -1; dy <= 1; dy++) {\n                            for (let dx = -1; dx <= 1; dx++) {\n                                if (dx === 0 && dy === 0 && dz === 0) continue;\n                                const nIdx = getIdx(ix + dx, iy + dy, iz + dz);\n                                neighbors += this.gameOfLifeState![nIdx];\n                            }\n                        }\n                    }\n\n                    // Configurable 3D Game of Life rules\n                    // Survive if neighbors >= surviveMin and <= surviveMin + 1\n                    // Born if neighbors === birthMin\n                    const alive = this.gameOfLifeState[idx] === 1;\n\n                    if (alive) {\n                        this.gameOfLifeBuffer[idx] = (neighbors >= surviveMin && neighbors <= surviveMin + 1) ? 1 : 0;\n                    } else {\n                        this.gameOfLifeBuffer[idx] = (neighbors === birthMin) ? 1 : 0;\n                    }\n                }\n            }\n        }\n\n        // Swap buffers\n        const temp = this.gameOfLifeState;\n        this.gameOfLifeState = this.gameOfLifeBuffer;\n        this.gameOfLifeBuffer = temp;\n\n        // Update spectral data\n        this.gameOfLifeToSpectral();\n    }\n\n    private gameOfLifeToSpectral(): void {\n        if (!this.gameOfLifeState) return;\n\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const cellIdx = iz * y * x + iy * x + ix;\n                    const alive = this.gameOfLifeState[cellIdx];\n\n                    // Convert to spectral data\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    let mag = alive ? 0.8 : 0.0;\n\n                    // Boost low frequencies\n                    if (alive) {\n                        const freqBoost = 1.0 + (1.0 - (nx + 1) * 0.5) * 0.4;\n                        mag *= freqBoost;\n                    }\n\n                    // Phase varies by position\n                    const phase = (ix / x + iy / y + iz / z) / 3.0;\n                    const custom1 = (ny + 1) * 0.5;\n                    const custom2 = (nz + 1) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n}\n","import { PlaneType } from '../types';\n\n// Generate reading path plane geometry with different algorithms\n\nexport class ReadingPathGeometry {\n    // Helper to calculate Y height for a given X, Z and plane type with phase\n    private static calculateHeight(x: number, z: number, planeType: PlaneType, phase: number = 0): number {\n        switch (planeType) {\n            case PlaneType.FLAT:\n                return 0;\n\n            case PlaneType.SINCOS:\n                // Sine and cosine modulation with phase\n                // Add phase to create movement\n                return 0.3 * (Math.sin((x + phase) * Math.PI * 2) * Math.cos((z + phase) * Math.PI * 2));\n\n            case PlaneType.WAVE:\n                // Wave pattern\n                return 0.2 * Math.sin((x + z + phase) * Math.PI * 3);\n\n            case PlaneType.RIPPLE:\n                // Circular ripple from center\n                const dist = Math.sqrt(x * x + z * z);\n                // Invert phase for outward ripple effect\n                return 0.25 * Math.sin((dist - phase) * Math.PI * 4) / (1 + dist * 2);\n\n            default:\n                return 0;\n        }\n    }\n\n    // Generate a grid-based plane with various height modulation functions\n    public static generatePlane(\n        planeType: PlaneType,\n        gridSize: number = 32,\n        phase: number = 0\n    ): { positions: Float32Array; indices: Uint16Array } {\n        const positions: number[] = [];\n        const indices: number[] = [];\n\n        // Generate grid vertices\n        for (let iz = 0; iz < gridSize; iz++) {\n            for (let ix = 0; ix < gridSize; ix++) {\n                // Normalize to [-1, 1]\n                const x = (ix / (gridSize - 1)) * 2 - 1;\n                const z = (iz / (gridSize - 1)) * 2 - 1;\n\n                const y = this.calculateHeight(x, z, planeType, phase);\n\n                positions.push(x, y, z);\n            }\n        }\n\n        // Generate triangle indices for wireframe edges\n        for (let iz = 0; iz < gridSize - 1; iz++) {\n            for (let ix = 0; ix < gridSize - 1; ix++) {\n                const topLeft = iz * gridSize + ix;\n                const topRight = topLeft + 1;\n                const bottomLeft = (iz + 1) * gridSize + ix;\n                const bottomRight = bottomLeft + 1;\n\n                // Horizontal lines\n                if (ix < gridSize - 1) {\n                    indices.push(topLeft, topRight);\n                    indices.push(bottomLeft, bottomRight);\n                }\n\n                // Vertical lines\n                if (iz < gridSize - 1) {\n                    indices.push(topLeft, bottomLeft);\n                    indices.push(topRight, bottomRight);\n                }\n            }\n        }\n\n        return {\n            positions: new Float32Array(positions),\n            indices: new Uint16Array(indices),\n        };\n    }\n\n    // Generate the reading line that follows the plane contour\n    // This line represents the current spectral slice being read\n    // It spans X [-1, 1] at a specific Z (relative to plane)\n    public static generateReadingLine(\n        planeType: PlaneType,\n        resolutionX: number,\n        currentZ: number = 0, // Z position relative to plane space [-1, 1]\n        phase: number = 0\n    ): Float32Array {\n        const positions: number[] = [];\n\n        // Ensure we stay within bounds\n        const z = Math.max(-1, Math.min(1, currentZ));\n\n        for (let i = 0; i < resolutionX; i++) {\n            const x = (i / (resolutionX - 1)) * 2 - 1;\n            const y = this.calculateHeight(x, z, planeType, phase);\n\n            positions.push(x, y, z);\n        }\n\n        return new Float32Array(positions);\n    }\n}\n","import { WebGLContext } from './context';\nimport {\n    wireframeVertexShader,\n    wireframeFragmentShader,\n    pointVertexShader,\n    pointFragmentShader,\n    planeVertexShader,\n    planeFragmentShader\n} from './shaders';\nimport {\n    mat4Perspective, mat4LookAt, mat4Multiply,\n    mat4RotateX, mat4RotateY, mat4RotateZ, mat4Translate,\n    vec3TransformMat4\n} from './math';\nimport { SpectralVolume } from './spectral-volume';\nimport { ReadingPathGeometry } from './reading-path';\nimport {\n    VolumeResolution, ReadingPathState, PlaneType,\n    JuliaParams, MandelbulbParams, MengerParams, PlasmaParams, GameOfLifeParams,\n    GeneratorParams\n} from '../types';\n\n// Renderer for wireframe cube + spectral volume points + reading path\n\nexport class Renderer {\n    private ctx: WebGLContext;\n\n    // Wireframe rendering\n    private wireframeProgram: WebGLProgram;\n    private wireframeVAO: WebGLVertexArrayObject;\n    private wireframeUMVP: WebGLUniformLocation;\n    private wireframeUColor: WebGLUniformLocation;\n\n    // Point cloud rendering\n    private pointProgram: WebGLProgram;\n    private pointVAO: WebGLVertexArrayObject | null = null;\n    private pointCount = 0;\n    private pointUMVP: WebGLUniformLocation;\n    private pointUVolume: WebGLUniformLocation; // Changed from pointUColor\n    private pointUAlpha: WebGLUniformLocation;\n    private pointUSize: WebGLUniformLocation;\n    private pointUVolumeRes: WebGLUniformLocation;\n\n    // Reading path rendering\n    private planeProgram: WebGLProgram;\n    private planeVAO: WebGLVertexArrayObject | null = null;\n    private planeIndexCount = 0;\n    private planeUMVP: WebGLUniformLocation;\n    private planeUModel: WebGLUniformLocation;\n    private planeUVolume: WebGLUniformLocation;\n    private planeUAlpha: WebGLUniformLocation;\n\n    private lineVAO: WebGLVertexArrayObject | null = null;\n    private lineUMVP: WebGLUniformLocation;\n    private lineUColor: WebGLUniformLocation;\n    private lineVertexCount = 0; // Added this property\n\n    // Axes rendering\n    private axesVAO: WebGLVertexArrayObject | null = null;\n    private axesCounts: [number, number, number] = [0, 0, 0]; // Vertex counts for X, Y, Z axes\n    private axesUMVP: WebGLUniformLocation;\n    private axesUColor: WebGLUniformLocation;\n\n    // State\n    private spectralVolume: SpectralVolume;\n    private pathState: ReadingPathState = {\n        position: { x: 0, y: 0, z: 0 },\n        rotation: { x: 0, y: 0, z: 0 },\n        scanPosition: 0,\n        planeType: PlaneType.FLAT,\n        shapePhase: 0\n    };\n\n    // Camera state\n    private rotationX = 0.3;\n    private rotationY = 0.4;\n    private cameraDistance = 6.5;\n    private isDragging = false;\n    private lastMouseX = 0;\n    private lastMouseY = 0;\n    private activeMouseButton = -1; // -1: None, 0: Left, 2: Right\n\n    constructor(ctx: WebGLContext, initialResolution: VolumeResolution) {\n        this.ctx = ctx;\n\n        // Create spectral volume\n        this.spectralVolume = new SpectralVolume(ctx, initialResolution);\n\n        // Compile wireframe shaders\n        this.wireframeProgram = this.createProgram(wireframeVertexShader, wireframeFragmentShader);\n        const wireMVP = ctx.gl.getUniformLocation(this.wireframeProgram, 'uModelViewProjection');\n        const wireColor = ctx.gl.getUniformLocation(this.wireframeProgram, 'uColor');\n        if (!wireMVP || !wireColor) throw new Error('Failed to get wireframe uniform locations');\n        this.wireframeUMVP = wireMVP;\n        this.wireframeUColor = wireColor;\n        this.wireframeVAO = this.createWireframeCube();\n\n        // Axes shaders (reuse wireframe)\n        this.axesUMVP = wireMVP;\n        this.axesUColor = wireColor;\n        this.updateAxesGeometry();\n\n        // Compile point cloud shaders\n        this.pointProgram = this.createProgram(pointVertexShader, pointFragmentShader);\n        const pointMVP = ctx.gl.getUniformLocation(this.pointProgram, 'uModelViewProjection');\n        const pointVolume = ctx.gl.getUniformLocation(this.pointProgram, 'uVolume');\n        const pointAlpha = ctx.gl.getUniformLocation(this.pointProgram, 'uAlpha');\n        const pointSize = ctx.gl.getUniformLocation(this.pointProgram, 'uPointSize');\n        const pointVolumeRes = ctx.gl.getUniformLocation(this.pointProgram, 'uVolumeRes');\n\n        // Note: uVolume might be null if optimized out, but usually it shouldn't be if used.\n        // However, getUniformLocation returns null if not found.\n        if (!pointMVP || !pointAlpha || !pointSize) {\n            throw new Error('Failed to get point uniform locations');\n        }\n        this.pointUMVP = pointMVP;\n        this.pointUVolume = pointVolume!; // Assert non-null or handle it\n        this.pointUAlpha = pointAlpha;\n        this.pointUSize = pointSize;\n        this.pointUVolumeRes = pointVolumeRes!;\n\n        // Compile plane shaders (re-using wireframe shader for line, plane shader for surface)\n        this.planeProgram = this.createProgram(planeVertexShader, planeFragmentShader);\n        const planeMVP = ctx.gl.getUniformLocation(this.planeProgram, 'uModelViewProjection');\n        const planeModel = ctx.gl.getUniformLocation(this.planeProgram, 'uModelMatrix');\n        const planeVolume = ctx.gl.getUniformLocation(this.planeProgram, 'uVolume');\n        const planeAlpha = ctx.gl.getUniformLocation(this.planeProgram, 'uAlpha');\n\n        if (!planeMVP || !planeAlpha) throw new Error('Failed to get plane uniform locations');\n\n        this.planeUMVP = planeMVP;\n        this.planeUModel = planeModel!; // Assert non-null or handle\n        this.planeUVolume = planeVolume!; // Assert non-null or handle\n        this.planeUAlpha = planeAlpha;\n\n        // Reuse wireframe program for the reading line (it's just a solid color line)\n        this.lineUMVP = wireMVP;\n        this.lineUColor = wireColor;\n\n        // Initialize geometry\n        this.updatePointCloud(initialResolution);\n        this.updateReadingPathGeometry();\n\n        console.log('✓ Renderer initialized');\n    }\n\n    private generateCharGeometry(char: string, x: number, y: number, z: number, scale: number): number[] {\n        // Simple vector font\n        // Returns [x1, y1, z1, x2, y2, z2, ...]\n        const lines: number[] = [];\n        const s = scale;\n\n        // Helper to add line\n        const l = (x1: number, y1: number, x2: number, y2: number) => {\n            lines.push(x + x1 * s, y + y1 * s, z);\n            lines.push(x + x2 * s, y + y2 * s, z);\n        };\n\n        // 5x7 grid concept (approx)\n        switch (char.toUpperCase()) {\n            case 'T':\n                l(0, 2, 2, 2); // Top bar\n                l(1, 2, 1, 0); // Vertical\n                break;\n            case 'I':\n                l(1, 2, 1, 0);\n                break;\n            case 'M':\n                l(0, 0, 0, 2); // Left\n                l(2, 0, 2, 2); // Right\n                l(0, 2, 1, 1); // Diag\n                l(1, 1, 2, 2); // Diag\n                break;\n            case 'E':\n                l(0, 2, 2, 2); // Top\n                l(0, 1, 1.5, 1); // Mid\n                l(0, 0, 2, 0); // Bot\n                l(0, 0, 0, 2); // Vert\n                break;\n            case 'O':\n                l(0, 0, 2, 0); l(2, 0, 2, 2); l(2, 2, 0, 2); l(0, 2, 0, 0);\n                break;\n            case 'R':\n                l(0, 0, 0, 2); // Vert\n                l(0, 2, 2, 2); l(2, 2, 2, 1); l(2, 1, 0, 1); // Head\n                l(0, 1, 2, 0); // Leg\n                break;\n            case 'P':\n                l(0, 0, 0, 2);\n                l(0, 2, 2, 2); l(2, 2, 2, 1); l(2, 1, 0, 1);\n                break;\n            case 'H':\n                l(0, 0, 0, 2); l(2, 0, 2, 2); l(0, 1, 2, 1);\n                break;\n            case 'A':\n                l(0, 0, 0, 1.5); // Right leg (bottom to mid)\n                l(2, 0, 2, 1.5); // Left leg\n                l(0, 1.5, 1, 2); // Left slope\n                l(2, 1.5, 1, 2); // Right slope\n                l(0, 1, 2, 1);   // Crossbar\n                break;\n            case 'B':\n                l(0, 0, 0, 2);\n                l(0, 2, 1.5, 2); l(1.5, 2, 2, 1.5); l(2, 1.5, 1.5, 1); l(1.5, 1, 0, 1); // Top loop\n                l(0, 1, 1.5, 1); l(1.5, 1, 2, 0.5); l(2, 0.5, 1.5, 0); l(1.5, 0, 0, 0); // Bot loop\n                break;\n            case 'N':\n                l(0, 0, 0, 2); l(2, 0, 2, 2); l(0, 2, 2, 0);\n                break;\n            case 'S':\n                l(2, 2, 0, 2); l(0, 2, 0, 1); l(0, 1, 2, 1); l(2, 1, 2, 0); l(2, 0, 0, 0);\n                break;\n        }\n        return lines;\n    }\n\n    // Generate text geometry on a specific plane alignment\n    private generateTextString(text: string, startX: number, startY: number, startZ: number, scale: number, axis: 'x' | 'y' | 'z'): number[] {\n        const vertices: number[] = [];\n        let cursor = 0;\n\n        for (let i = 0; i < text.length; i++) {\n            const char = text[i];\n\n            // Adjust cursor mapping based on axis\n            let lx = startX, ly = startY, lz = startZ;\n\n            if (axis === 'x') {\n                lx += cursor;\n                // For X axis label, we want it reading from left to right along X?\n                // Or facing the camera? Let's just lay it flat next to the axis.\n                // Text along X, Up is Y.\n                // generateCharGeometry assumes X is horizontal char width, Y is vertical char height.\n                // So default works for X.\n                const newVerts = this.generateCharGeometry(char, lx, ly, lz, scale);\n                vertices.push(...newVerts);\n                cursor += scale * 3.0; // Spacing\n            } else if (axis === 'y') {\n                // Vertical text?\n                // Let's stack letters.\n                ly += cursor;\n                const newVerts = this.generateCharGeometry(char, lx, ly, lz, scale);\n                vertices.push(...newVerts);\n                cursor += scale * 3.0; // Up\n            } else {\n                lz += cursor;\n                // On Z axis\n                // Need to rotate logic of char gen, but let's cheat by swapping coords in buffer\n                const charPoints = this.generateCharGeometry(char, 0, ly, 0, scale);\n                // Swap X (char horizontal) to Z\n                for (let k = 0; k < charPoints.length; k += 3) {\n                    vertices.push(\n                        lx,                 // X fixed\n                        charPoints[k + 1],    // Y same\n                        lz + charPoints[k]  // X maps to Z\n                    );\n                }\n                cursor += scale * 3.0;\n            }\n        }\n        return vertices;\n    }\n\n    private updateAxesGeometry(): void {\n        const gl = this.ctx.gl;\n        if (this.axesVAO) gl.deleteVertexArray(this.axesVAO);\n\n        const vertices: number[] = [];\n\n        // Define origins and lengths\n        const origin = -1.2;\n        const length = 1.0;\n        const arrowSize = 0.05;\n\n        // --- X AXIS (BINS) ---\n        // Line\n        const xStart = vertices.length / 3;\n        vertices.push(origin, origin, origin); // Start\n        vertices.push(origin + length, origin, origin); // End\n\n        // Arrowhead\n        const tipX = origin + length;\n        vertices.push(tipX, origin, origin, tipX - arrowSize, origin + arrowSize, origin);\n        vertices.push(tipX, origin, origin, tipX - arrowSize, origin - arrowSize, origin);\n        vertices.push(tipX, origin, origin, tipX - arrowSize, origin, origin + arrowSize);\n        vertices.push(tipX, origin, origin, tipX - arrowSize, origin, origin - arrowSize);\n\n        // Label \"BINS\"\n        // Place along X, slightly below\n        const labelX = this.generateTextString(\"BINS\", origin + 0.2, origin - 0.2, origin, 0.05, 'x');\n        vertices.push(...labelX);\n\n        const xCount = (vertices.length / 3) - xStart;\n\n        // --- Y AXIS (MORPH) ---\n        const yStart = vertices.length / 3;\n        // Line\n        vertices.push(origin, origin, origin);\n        vertices.push(origin, origin + length, origin);\n\n        // Arrowhead\n        const tipY = origin + length;\n        vertices.push(origin, tipY, origin, origin + arrowSize, tipY - arrowSize, origin);\n        vertices.push(origin, tipY, origin, origin - arrowSize, tipY - arrowSize, origin);\n        vertices.push(origin, tipY, origin, origin, tipY - arrowSize, origin + arrowSize);\n        vertices.push(origin, tipY, origin, origin, tipY - arrowSize, origin - arrowSize);\n\n        // Label \"MORPH\"\n        // Place along Y\n        const labelY = this.generateTextString(\"MORPH\", origin - 0.2, origin + 0.2, origin, 0.05, 'y');\n        vertices.push(...labelY);\n\n        const yCount = (vertices.length / 3) - yStart;\n\n        // --- Z AXIS (TIME) ---\n        const zStart = vertices.length / 3;\n        // Line\n        vertices.push(origin, origin, origin);\n        vertices.push(origin, origin, origin + length);\n\n        // Arrowhead\n        const tipZ = origin + length;\n        vertices.push(origin, origin, tipZ, origin + arrowSize, origin, tipZ - arrowSize);\n        vertices.push(origin, origin, tipZ, origin - arrowSize, origin, tipZ - arrowSize);\n        vertices.push(origin, origin, tipZ, origin, origin + arrowSize, tipZ - arrowSize);\n        vertices.push(origin, origin, tipZ, origin, origin - arrowSize, tipZ - arrowSize);\n\n        // Label \"PHASE\"\n        const labelZ = this.generateTextString(\"PHASE\", origin - 0.2, origin, origin + 0.2, 0.05, 'z');\n        vertices.push(...labelZ);\n\n        const zCount = (vertices.length / 3) - zStart;\n\n        this.axesCounts = [xCount, yCount, zCount];\n\n        // Create buffers\n        const vao = gl.createVertexArray();\n        if (!vao) throw new Error(\"Failed axes VAO\");\n        gl.bindVertexArray(vao);\n\n        const vbo = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);\n\n        const posLoc = gl.getAttribLocation(this.wireframeProgram, 'aPosition');\n        gl.enableVertexAttribArray(posLoc);\n        gl.vertexAttribPointer(posLoc, 3, gl.FLOAT, false, 0, 0);\n\n        gl.bindVertexArray(null);\n        this.axesVAO = vao;\n    }\n\n    private createProgram(vertexSrc: string, fragmentSrc: string): WebGLProgram {\n        const gl = this.ctx.gl;\n\n        const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n        if (!vertexShader) throw new Error('Failed to create vertex shader');\n        gl.shaderSource(vertexShader, vertexSrc);\n        gl.compileShader(vertexShader);\n\n        if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n            const log = gl.getShaderInfoLog(vertexShader);\n            throw new Error(`Vertex shader compile error: ${log}`);\n        }\n\n        const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n        if (!fragmentShader) throw new Error('Failed to create fragment shader');\n        gl.shaderSource(fragmentShader, fragmentSrc);\n        gl.compileShader(fragmentShader);\n\n        if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n            const log = gl.getShaderInfoLog(fragmentShader);\n            throw new Error(`Fragment shader compile error: ${log}`);\n        }\n\n        const program = gl.createProgram();\n        if (!program) throw new Error('Failed to create program');\n        gl.attachShader(program, vertexShader);\n        gl.attachShader(program, fragmentShader);\n        gl.linkProgram(program);\n\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            const log = gl.getProgramInfoLog(program);\n            throw new Error(`Program link error: ${log}`);\n        }\n\n        return program;\n    }\n\n    private createWireframeCube(): WebGLVertexArrayObject {\n        const gl = this.ctx.gl;\n\n        // Cube vertices (centered at origin, size 2x2x2)\n        const vertices = new Float32Array([\n            -1, -1, -1,  // 0\n            1, -1, -1,  // 1\n            1, 1, -1,  // 2\n            -1, 1, -1,  // 3\n            -1, -1, 1,  // 4\n            1, -1, 1,  // 5\n            1, 1, 1,  // 6\n            -1, 1, 1,  // 7\n        ]);\n\n        // Wireframe edges (12 edges of a cube)\n        const indices = new Uint16Array([\n            0, 1, 1, 2, 2, 3, 3, 0,  // Front face\n            4, 5, 5, 6, 6, 7, 7, 4,  // Back face\n            0, 4, 1, 5, 2, 6, 3, 7,  // Connecting edges\n        ]);\n\n        const vao = gl.createVertexArray();\n        if (!vao) throw new Error('Failed to create VAO');\n        gl.bindVertexArray(vao);\n\n        const vertexBuffer = gl.createBuffer();\n        if (!vertexBuffer) throw new Error('Failed to create vertex buffer');\n        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n\n        const aPositionLoc = gl.getAttribLocation(this.wireframeProgram, 'aPosition');\n        gl.enableVertexAttribArray(aPositionLoc);\n        gl.vertexAttribPointer(aPositionLoc, 3, gl.FLOAT, false, 0, 0);\n\n        const indexBuffer = gl.createBuffer();\n        if (!indexBuffer) throw new Error('Failed to create index buffer');\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n\n        gl.bindVertexArray(null);\n\n        return vao;\n    }\n\n    private generatePointCloud(resolution: VolumeResolution): Float32Array {\n        const { x, y, z } = resolution;\n        const totalPoints = x * y * z;\n        const positions = new Float32Array(totalPoints * 3);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Map from grid indices to normalized cube space [-1, 1]\n                    positions[idx++] = (ix / (x - 1)) * 2 - 1;\n                    positions[idx++] = (iy / (y - 1)) * 2 - 1;\n                    positions[idx++] = (iz / (z - 1)) * 2 - 1;\n                }\n            }\n        }\n\n        return positions;\n    }\n\n    private updatePointCloud(resolution: VolumeResolution): void {\n        const gl = this.ctx.gl;\n\n        if (this.pointVAO) gl.deleteVertexArray(this.pointVAO);\n\n        const positions = this.generatePointCloud(resolution);\n        this.pointCount = positions.length / 3;\n\n        const vao = gl.createVertexArray();\n        if (!vao) throw new Error('Failed to create point VAO');\n        gl.bindVertexArray(vao);\n\n        const buffer = gl.createBuffer();\n        if (!buffer) throw new Error('Failed to create point buffer');\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n        const aPositionLoc = gl.getAttribLocation(this.pointProgram, 'aPosition');\n        gl.enableVertexAttribArray(aPositionLoc);\n        gl.vertexAttribPointer(aPositionLoc, 3, gl.FLOAT, false, 0, 0);\n\n        gl.bindVertexArray(null);\n        this.pointVAO = vao;\n\n        console.log(`✓ Point cloud: ${this.pointCount} points`);\n    }\n\n    private updateReadingPathGeometry(): void {\n        const gl = this.ctx.gl;\n\n        // 1. Update Plane Geometry\n        if (this.planeVAO) gl.deleteVertexArray(this.planeVAO);\n\n        const { positions, indices } = ReadingPathGeometry.generatePlane(\n            this.pathState.planeType,\n            32,\n            this.pathState.shapePhase\n        );\n        this.planeIndexCount = indices.length;\n\n        const planeVAO = gl.createVertexArray();\n        if (!planeVAO) throw new Error('Failed to create plane VAO');\n        gl.bindVertexArray(planeVAO);\n\n        const planeVBO = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, planeVBO);\n        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n        const planePosLoc = gl.getAttribLocation(this.planeProgram, 'aPosition');\n        gl.enableVertexAttribArray(planePosLoc);\n        gl.vertexAttribPointer(planePosLoc, 3, gl.FLOAT, false, 0, 0);\n\n        const planeIBO = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, planeIBO);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n\n        gl.bindVertexArray(null);\n        this.planeVAO = planeVAO;\n\n        // 2. Update Line Geometry\n        // We use the current volume resolution X for the line detail\n        const resolution = this.spectralVolume.getResolution();\n        this.updateReadingLineGeometry(resolution.x);\n    }\n\n    private updateReadingLineGeometry(resolutionX: number): void {\n        const gl = this.ctx.gl;\n\n        if (this.lineVAO) gl.deleteVertexArray(this.lineVAO);\n\n        const linePositions = ReadingPathGeometry.generateReadingLine(\n            this.pathState.planeType,\n            resolutionX,\n            this.pathState.scanPosition,\n            this.pathState.shapePhase\n        );\n\n        this.lineVertexCount = linePositions.length / 3;\n\n        const lineVAO = gl.createVertexArray();\n        if (!lineVAO) throw new Error('Failed to create line VAO');\n        gl.bindVertexArray(lineVAO);\n\n        const lineVBO = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, lineVBO);\n        gl.bufferData(gl.ARRAY_BUFFER, linePositions, gl.DYNAMIC_DRAW);\n\n        const linePosLoc = gl.getAttribLocation(this.wireframeProgram, 'aPosition');\n        gl.enableVertexAttribArray(linePosLoc);\n        gl.vertexAttribPointer(linePosLoc, 3, gl.FLOAT, false, 0, 0);\n\n        gl.bindVertexArray(null);\n        this.lineVAO = lineVAO;\n    }\n\n    public render(deltaTime: number = 0.016): void {\n        // Update logic (auto-reset plane rotation, etc.)\n        this.update(deltaTime);\n\n        const gl = this.ctx.gl;\n\n        // Clear\n        this.ctx.clear(0.08, 0.08, 0.12);\n\n        // Enable blending\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n        // Calculate Camera MVP\n        const aspect = gl.canvas.width / gl.canvas.height;\n        const projection = mat4Perspective(Math.PI / 4, aspect, 0.1, 100.0);\n        const view = mat4LookAt([0, 0, this.cameraDistance], [0, 0, 0], [0, 1, 0]);\n\n        const rotX = mat4RotateX(this.rotationX);\n        const rotY = mat4RotateY(this.rotationY);\n        const model = mat4Multiply(rotY, rotX);\n\n        const viewModel = mat4Multiply(view, model);\n        const cameraMVP = mat4Multiply(projection, viewModel);\n\n        // 1. Draw Axis Explanations (Time, Morph, Bins)\n        // These share the same MVP as the cube so they rotate with it\n        if (this.axesVAO) {\n            gl.useProgram(this.wireframeProgram);\n            gl.uniformMatrix4fv(this.axesUMVP, false, cameraMVP);\n            gl.bindVertexArray(this.axesVAO);\n\n            let offset = 0;\n            const [cx, cy, cz] = this.axesCounts;\n\n            // X (Bins) - Cyan/Red\n            gl.uniform3f(this.axesUColor, 1.0, 0.3, 0.3); // Red\n            gl.drawArrays(gl.LINES, offset, cx);\n            offset += cx;\n\n            // Y (Morph) - Green\n            gl.uniform3f(this.axesUColor, 0.3, 1.0, 0.3); // Green\n            gl.drawArrays(gl.LINES, offset, cy);\n            offset += cy;\n\n            // Z (Time) - Blue\n            gl.uniform3f(this.axesUColor, 0.4, 0.4, 1.0); // Blue\n            gl.drawArrays(gl.LINES, offset, cz);\n\n            gl.bindVertexArray(null);\n        }\n\n        // 1. Draw Point Cloud\n        if (this.pointVAO) {\n            gl.useProgram(this.pointProgram);\n            gl.uniformMatrix4fv(this.pointUMVP, false, cameraMVP);\n\n            // Bind volume texture\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_3D, this.spectralVolume.getTexture());\n            gl.uniform1i(this.pointUVolume, 0);\n\n            gl.uniform1f(this.pointUAlpha, 0.15); // Base alpha\n            gl.uniform1f(this.pointUSize, 3.0);   // Base size\n\n            // Pass volume resolution for density-based size clamping\n            const res = this.spectralVolume.getResolution();\n            gl.uniform3f(this.pointUVolumeRes, res.x, res.y, res.z);\n\n            gl.bindVertexArray(this.pointVAO);\n            gl.drawArrays(gl.POINTS, 0, this.pointCount);\n            gl.bindVertexArray(null);\n        }\n\n        // Calculate plane transform\n        const pRotX = mat4RotateX(this.pathState.rotation.x);\n        const pRotY = mat4RotateY(this.pathState.rotation.y);\n        const pRotZ = mat4RotateZ(this.pathState.rotation.z);\n        const pTrans = mat4Translate(\n            this.pathState.position.x,\n            this.pathState.position.y,\n            this.pathState.position.z\n        );\n\n        let planeModel = mat4Multiply(pRotY, pRotX);\n        planeModel = mat4Multiply(pRotZ, planeModel);\n        planeModel = mat4Multiply(pTrans, planeModel);\n\n        const worldPlaneModel = mat4Multiply(model, planeModel);\n        const planeViewModel = mat4Multiply(view, worldPlaneModel);\n        const planeMVP = mat4Multiply(projection, planeViewModel);\n\n        // 2. Draw Reading Path Plane\n        if (this.planeVAO) {\n            gl.useProgram(this.planeProgram);\n            gl.uniformMatrix4fv(this.planeUMVP, false, planeMVP);\n            gl.uniformMatrix4fv(this.planeUModel, false, worldPlaneModel); // Pass model matrix\n\n            // Bind volume texture (reuse slot 0)\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_3D, this.spectralVolume.getTexture());\n            gl.uniform1i(this.planeUVolume, 0);\n\n            gl.uniform1f(this.planeUAlpha, 0.3); // Slightly more opaque to see colors\n\n            gl.bindVertexArray(this.planeVAO);\n            gl.drawElements(gl.LINES, this.planeIndexCount, gl.UNSIGNED_SHORT, 0);\n            gl.bindVertexArray(null);\n        }\n\n        // 3. Draw Reading Position Line (Green contour line)\n        if (this.lineVAO) {\n            // Use same MVP as plane so it sticks to it\n            gl.useProgram(this.wireframeProgram);\n            gl.uniformMatrix4fv(this.lineUMVP, false, planeMVP);\n            gl.uniform3f(this.lineUColor, 0.2, 1.0, 0.2); // Bright Green\n\n            gl.bindVertexArray(this.lineVAO);\n            gl.drawArrays(gl.LINE_STRIP, 0, this.lineVertexCount);\n            gl.bindVertexArray(null);\n        }\n\n        // 4. Draw Wireframe Cube (Bounds)\n        gl.useProgram(this.wireframeProgram);\n        gl.uniformMatrix4fv(this.wireframeUMVP, false, cameraMVP);\n        gl.uniform3f(this.wireframeUColor, 0.3, 0.6, 1.0); // Blue\n\n        gl.bindVertexArray(this.wireframeVAO);\n        gl.drawElements(gl.LINES, 24, gl.UNSIGNED_SHORT, 0);\n        gl.bindVertexArray(null);\n\n        gl.disable(gl.BLEND);\n    }\n\n    public resize(width: number, height: number): void {\n        this.ctx.resize(width, height);\n    }\n\n    public updateVolumeResolution(resolution: VolumeResolution): void {\n        this.spectralVolume.updateResolution(resolution);\n        this.updatePointCloud(resolution);\n        this.updateReadingPathGeometry();\n        // Also update reading line resolution\n        this.updateReadingLineGeometry(resolution.x);\n    }\n\n    public getSpectralVolume(): SpectralVolume {\n        return this.spectralVolume;\n    }\n\n    public updateReadingPath(state: ReadingPathState): void {\n        const typeChanged = state.planeType !== this.pathState.planeType;\n        const scanChanged = state.scanPosition !== this.pathState.scanPosition;\n        const phaseChanged = state.shapePhase !== this.pathState.shapePhase;\n\n        // Always preserve mouse-controlled rotation (x and z)\n        // Since rotation sliders were removed, controls always return 0 for rotation\n        // We maintain rotation state internally via mouse interaction\n        this.pathState = {\n            ...state,\n            rotation: {\n                x: this.pathState.rotation.x,  // Preserve mouse-controlled\n                y: state.rotation.y,            // Not used\n                z: this.pathState.rotation.z    // Preserve mouse-controlled\n            }\n        };\n\n        if (typeChanged || phaseChanged) {\n            this.updateReadingPathGeometry();\n        } else if (scanChanged) {\n            const resolution = this.spectralVolume.getResolution();\n            this.updateReadingLineGeometry(resolution.x);\n        }\n    }\n\n    public updateSpectralData(dataSet: string, params?: GeneratorParams): void {\n        switch (dataSet) {\n            case '3d-julia':\n                this.spectralVolume.generate3DJulia(params as JuliaParams);\n                break;\n            case 'mandelbulb':\n                this.spectralVolume.generateMandelbulb(params as MandelbulbParams);\n                break;\n            case 'menger-sponge':\n                this.spectralVolume.generateMengerSponge(params as MengerParams);\n                break;\n            case 'sine-plasma':\n                this.spectralVolume.generateSinePlasma(0, params as PlasmaParams);\n                break;\n            case 'game-of-life':\n                this.spectralVolume.initGameOfLife(params as GameOfLifeParams);\n                break;\n            default:\n                this.spectralVolume.clearData();\n                break;\n        }\n    }\n\n    public getReadingLineSpectralData(): Float32Array {\n        // 1. Get reading line positions in plane space\n        const resolution = this.spectralVolume.getResolution();\n        const linePositions = ReadingPathGeometry.generateReadingLine(\n            this.pathState.planeType,\n            resolution.x, // Use X resolution for sampling density\n            this.pathState.scanPosition,\n            this.pathState.shapePhase\n        );\n\n        // 2. Calculate plane transform matrix\n        const pRotX = mat4RotateX(this.pathState.rotation.x);\n        const pRotY = mat4RotateY(this.pathState.rotation.y);\n        const pRotZ = mat4RotateZ(this.pathState.rotation.z);\n        const pTrans = mat4Translate(\n            this.pathState.position.x,\n            this.pathState.position.y,\n            this.pathState.position.z\n        );\n\n        let planeModel = mat4Multiply(pRotY, pRotX);\n        planeModel = mat4Multiply(pRotZ, planeModel);\n        planeModel = mat4Multiply(pTrans, planeModel);\n\n        // 3. Transform points to world space and sample volume\n        const numPoints = linePositions.length / 3;\n        const result = new Float32Array(numPoints * 4); // RGBA per point\n\n        for (let i = 0; i < numPoints; i++) {\n            const px = linePositions[i * 3];\n            const py = linePositions[i * 3 + 1];\n            const pz = linePositions[i * 3 + 2];\n\n            // Transform to world space\n            const worldPos = vec3TransformMat4([px, py, pz], planeModel);\n\n            // Convert world space [-1, 1] to texture space [0, 1]\n            const tx = (worldPos[0] + 1.0) * 0.5;\n            const ty = (worldPos[1] + 1.0) * 0.5;\n            const tz = (worldPos[2] + 1.0) * 0.5;\n\n            // Sample volume\n            const sample = this.spectralVolume.sample(tx, ty, tz);\n\n            // Store all channels\n            result[i * 4] = sample[0];     // R: Magnitude\n            result[i * 4 + 1] = sample[1]; // G: Phase\n            result[i * 4 + 2] = sample[2]; // B: Pan\n            result[i * 4 + 3] = sample[3]; // A: Width\n        }\n\n        return result;\n    }\n\n    // Mouse interaction\n    public onMouseDown(x: number, y: number, button: number): void {\n        this.isDragging = true;\n        this.lastMouseX = x;\n        this.lastMouseY = y;\n        this.activeMouseButton = button;\n    }\n\n    public onMouseMove(x: number, y: number): void {\n        if (!this.isDragging) return;\n\n        const dx = x - this.lastMouseX;\n        const dy = y - this.lastMouseY;\n\n        this.lastMouseX = x;\n        this.lastMouseY = y;\n\n        const sensitivity = 0.01;\n\n        if (this.activeMouseButton === 2) {\n            // Right click: Rotate Camera (Cube)\n            this.rotationY += dx * sensitivity;\n            this.rotationX += dy * sensitivity;\n        } else if (this.activeMouseButton === 0) {\n            // Left click: Rotate Reading Plane\n            // We update the path state directly.\n            // Note: This needs to be communicated back to controls if we want sliders to update.\n            // For now, we just update local state which might get overwritten by controls if they change.\n            // Ideally, we should emit an event.\n\n            // Invert controls for intuitive feel\n            this.pathState.rotation.z -= dx * sensitivity;\n            this.pathState.rotation.x -= dy * sensitivity;\n\n            // Limit rotation to avoid flipping\n            this.pathState.rotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, this.pathState.rotation.x));\n            this.pathState.rotation.z = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, this.pathState.rotation.z));\n        }\n    }\n\n    public onMouseUp(): void {\n        this.isDragging = false;\n        this.activeMouseButton = -1;\n    }\n\n    public zoom(delta: number): void {\n        const zoomSpeed = 0.005;\n        this.cameraDistance += delta * zoomSpeed;\n        // Clamp distance\n        this.cameraDistance = Math.max(2.0, Math.min(20.0, this.cameraDistance));\n    }\n\n    public resetView(): void {\n        this.rotationX = 0.3;\n        this.rotationY = 0.4;\n        this.cameraDistance = 6.5;\n    }\n\n    public update(deltaTime: number): void {\n        // Auto-reset plane rotation if not dragging\n        if (!this.isDragging) {\n            const decay = 5.0 * deltaTime; // Speed of return\n\n            // Lerp towards 0\n            this.pathState.rotation.x += (0 - this.pathState.rotation.x) * decay;\n            this.pathState.rotation.z += (0 - this.pathState.rotation.z) * decay;\n\n            // Snap to 0 if very close\n            if (Math.abs(this.pathState.rotation.x) < 0.001) this.pathState.rotation.x = 0;\n            if (Math.abs(this.pathState.rotation.z) < 0.001) this.pathState.rotation.z = 0;\n        }\n    }\n\n    public destroy(): void {\n        this.spectralVolume.destroy();\n    }\n}\n","import { PresetData, PresetControls, STORAGE_KEY_STATE, STORAGE_KEY_PRESETS } from '../types';\n\nexport class PresetManager {\n    private presets: PresetData[] = [];\n    private onPresetsChange: (() => void) | null = null;\n\n    constructor() {\n        this.loadPresets();\n    }\n\n    private loadPresets(): void {\n        try {\n            const stored = localStorage.getItem(STORAGE_KEY_PRESETS);\n            if (stored) {\n                this.presets = JSON.parse(stored);\n            }\n        } catch (e) {\n            console.warn('Failed to load presets:', e);\n            this.presets = [];\n        }\n    }\n\n    private savePresets(): void {\n        try {\n            localStorage.setItem(STORAGE_KEY_PRESETS, JSON.stringify(this.presets));\n            if (this.onPresetsChange) this.onPresetsChange();\n        } catch (e) {\n            console.warn('Failed to save presets:', e);\n        }\n    }\n\n    public getPresets(): PresetData[] {\n        return [...this.presets];\n    }\n\n    public savePreset(name: string, controls: PresetControls): void {\n        const preset: PresetData = {\n            name,\n            timestamp: Date.now(),\n            controls\n        };\n\n        // Check if preset with same name exists\n        const existingIdx = this.presets.findIndex(p => p.name === name);\n        if (existingIdx >= 0) {\n            this.presets[existingIdx] = preset;\n        } else {\n            this.presets.push(preset);\n        }\n\n        this.savePresets();\n        console.log(`✓ Preset saved: ${name}`);\n    }\n\n    public deletePreset(name: string): boolean {\n        const idx = this.presets.findIndex(p => p.name === name);\n        if (idx >= 0) {\n            this.presets.splice(idx, 1);\n            this.savePresets();\n            console.log(`✓ Preset deleted: ${name}`);\n            return true;\n        }\n        return false;\n    }\n\n    public getPreset(name: string): PresetData | undefined {\n        return this.presets.find(p => p.name === name);\n    }\n\n    // Auto-save current state (not a named preset, just last session state)\n    public saveCurrentState(controls: PresetControls): void {\n        try {\n            localStorage.setItem(STORAGE_KEY_STATE, JSON.stringify(controls));\n        } catch (e) {\n            console.warn('Failed to save state:', e);\n        }\n    }\n\n    public loadCurrentState(): PresetControls | null {\n        try {\n            const stored = localStorage.getItem(STORAGE_KEY_STATE);\n            if (stored) {\n                return JSON.parse(stored);\n            }\n        } catch (e) {\n            console.warn('Failed to load state:', e);\n        }\n        return null;\n    }\n\n    public setPresetsChangeCallback(callback: () => void): void {\n        this.onPresetsChange = callback;\n    }\n}\n\n","export const WAVEFORM_ICONS: Record<string, string> = {\n    sine: '<svg viewBox=\"0 0 24 20\"><path d=\"M 2 10 Q 7 0 12 10 T 22 10\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/></svg>',\n    saw: '<svg viewBox=\"0 0 24 20\"><path d=\"M 2 18 L 18 2 L 18 18\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/></svg>',\n    square: '<svg viewBox=\"0 0 24 20\"><path d=\"M 2 18 L 2 2 L 12 2 L 12 18 L 22 18 L 22 2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/></svg>',\n    triangle: '<svg viewBox=\"0 0 24 20\"><path d=\"M 2 18 L 12 2 L 22 18\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/></svg>',\n    none: '<svg viewBox=\"0 0 24 20\"></svg>'\n};\n\nexport const SECTION_ICONS: Record<string, string> = {\n    'Wave/Spectral Volume': `<svg viewBox=\"0 0 64 64\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n        <path d=\"M 32 10 L 58 24 L 58 52 L 32 64 L 6 52 L 6 24 Z\" />\n        <path d=\"M 32 10 L 32 38 L 58 24\" />\n        <path d=\"M 32 38 L 6 24\" />\n        <path d=\"M 32 38 L 32 64\" />\n    </svg>`,\n    'Audio Synthesis': `<svg viewBox=\"0 0 64 64\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n        <path d=\"M 5 32 Q 15 10 25 32 T 45 32\" />\n        <path d=\"M 45 32 L 45 15 L 60 32 L 45 49 L 45 32\" />\n        <circle cx=\"15\" cy=\"32\" r=\"2\" fill=\"currentColor\" />\n    </svg>`,\n    'Reading Path': `<svg viewBox=\"0 0 64 64\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n        <path d=\"M 10 50 L 50 50 M 10 50 L 10 10 M 10 50 L 40 30\" stroke-opacity=\"0.3\" />\n        <path d=\"M 8 40 C 20 40, 30 10, 55 15\" stroke-width=\"2\" />\n        <circle cx=\"55\" cy=\"15\" r=\"3\" fill=\"currentColor\" />\n    </svg>`,\n    'LFOs': `<svg viewBox=\"0 0 64 64\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n        <circle cx=\"32\" cy=\"32\" r=\"28\" stroke-dasharray=\"4 4\" stroke-opacity=\"0.3\" />\n        <path d=\"M 12 32 C 12 10, 32 10, 32 32 C 32 54, 52 54, 52 32\" />\n        <path d=\"M 50 32 L 54 32\" />\n    </svg>`,\n    'Visualization': `<svg viewBox=\"0 0 64 64\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n        <rect x=\"8\" y=\"40\" width=\"8\" height=\"16\" />\n        <rect x=\"20\" y=\"25\" width=\"8\" height=\"31\" />\n        <rect x=\"32\" y=\"35\" width=\"8\" height=\"21\" />\n        <rect x=\"44\" y=\"15\" width=\"8\" height=\"41\" />\n        <path d=\"M 5 56 L 59 56\" />\n    </svg>`\n};\n\n/**\n * Toggle between 'slider' and 'knob' UI modes.\n */\nexport const CONTROL_STYLE: 'slider' | 'knob' = 'knob';\n\n/**\n * Creates a section card with a title.\n * Returns the card element which acts as the container for controls.\n */\nexport function createSection(parent: HTMLElement, title: string, mode: 'slider' | 'knob' = CONTROL_STYLE): HTMLElement {\n    const card = document.createElement('div');\n    card.className = 'control-card';\n    if (mode === 'knob') card.classList.add('knob-layout');\n    const header = document.createElement('div');\n    header.className = 'control-section-title';\n    header.textContent = title;\n\n    // Add background icon\n    if (SECTION_ICONS[title]) {\n        const iconContainer = document.createElement('div');\n        iconContainer.className = 'section-icon';\n        iconContainer.innerHTML = SECTION_ICONS[title];\n        card.appendChild(iconContainer);\n    }\n\n    card.appendChild(header);\n    parent.appendChild(card);\n    return card;\n}\n\n/**\n * Standard slider factory.\n */\nexport function createSlider(\n    parent: HTMLElement,\n    id: string,\n    label: string,\n    min: number,\n    max: number,\n    value: number,\n    step: number,\n    onInput?: (val: number) => void,\n    mode: 'slider' | 'knob' = CONTROL_STYLE\n): HTMLInputElement {\n    const group = document.createElement('div');\n    group.className = 'control-group';\n    if (mode === 'knob') group.classList.add('knob-centered');\n    const labelEl = document.createElement('label');\n    labelEl.htmlFor = id;\n    labelEl.textContent = label;\n    const valueDisplay = document.createElement('span');\n    valueDisplay.className = 'value-display';\n    valueDisplay.id = `${id}-value`;\n    const updateDisplay = (val: number) => {\n        valueDisplay.textContent = step >= 1 ? String(Math.round(val)) : val.toFixed(2);\n    };\n    updateDisplay(value);\n    const slider = document.createElement('input');\n    slider.type = 'range';\n    slider.id = id;\n    slider.min = String(min);\n    slider.max = String(max);\n    slider.value = String(value);\n    slider.step = String(step);\n    slider.className = 'slider';\n    slider.addEventListener('input', () => {\n        const val = parseFloat(slider.value);\n        updateDisplay(val);\n        if (onInput) onInput(val);\n    });\n    if (mode === 'knob') {\n        slider.style.display = 'none';\n        group.appendChild(labelEl);\n        group.appendChild(createKnobElement(slider));\n        group.appendChild(valueDisplay);\n    } else {\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(valueDisplay);\n        group.appendChild(labelRow);\n        group.appendChild(slider);\n    }\n    parent.appendChild(group);\n    return slider;\n}\n\n/**\n * Creates a visual knob that controls a hidden input.\n */\nfunction createKnobElement(input: HTMLInputElement): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'knob-container';\n    if (input.disabled) container.classList.add('disabled');\n\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    svg.setAttribute('viewBox', '0 0 48 48');\n    svg.setAttribute('class', 'knob-svg');\n\n    // Track arc\n    const track = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    track.setAttribute('class', 'knob-track');\n    track.setAttribute('d', describeArc(24, 24, 18, 225, 495));\n    svg.appendChild(track);\n\n    // Value arc\n    const valueArc = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    valueArc.setAttribute('class', 'knob-value');\n    svg.appendChild(valueArc);\n\n    // Modulation range arc\n    const modArc = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    modArc.setAttribute('class', 'knob-mod-range');\n    svg.appendChild(modArc);\n\n    // Center circle\n    const center = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    center.setAttribute('class', 'knob-center');\n    center.setAttribute('cx', '24');\n    center.setAttribute('cy', '24');\n    center.setAttribute('r', '14');\n    svg.appendChild(center);\n\n    // Pointer\n    const pointer = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    pointer.setAttribute('class', 'knob-pointer');\n    pointer.setAttribute('r', '2');\n    svg.appendChild(pointer);\n\n    container.appendChild(svg);\n\n    const updateKnob = () => {\n        const val = parseFloat(input.value);\n        const min = parseFloat(input.min);\n        const max = parseFloat(input.max);\n        const percent = (val - min) / (max - min);\n\n        // Update value arc\n        const endAngle = 225 + percent * 270;\n        valueArc.setAttribute('d', describeArc(24, 24, 18, 225, endAngle));\n\n        // Update modulation range arc\n        const inputAny = input as any;\n        if (inputAny.hasModulation) {\n            const offset = typeof inputAny.modOffset === 'number' ? inputAny.modOffset : 0;\n            const amp = typeof inputAny.modAmplitude === 'number' ? inputAny.modAmplitude : 0;\n\n            // start = offset - 0.5 * amp, end = offset + 0.5 * amp\n            const startVal = offset - amp;\n            const endVal = offset + amp;\n\n            const startP = (startVal - min) / (max - min);\n            const endP = (endVal - min) / (max - min);\n\n            const sAngle = 225 + Math.max(0, Math.min(1, startP)) * 270;\n            const eAngle = 225 + Math.max(0, Math.min(1, endP)) * 270;\n\n            if (Math.abs(eAngle - sAngle) > 0.1) {\n                modArc.setAttribute('d', describeArc(24, 24, 21.5, sAngle, eAngle));\n                modArc.style.display = 'block';\n            } else {\n                modArc.style.display = 'none';\n            }\n        } else {\n            modArc.style.display = 'none';\n        }\n\n        // Update pointer\n        const rad = (endAngle - 90) * (Math.PI / 180);\n        const px = 24 + 10 * Math.cos(rad);\n        const py = 24 + 10 * Math.sin(rad);\n        pointer.setAttribute('cx', String(px));\n        pointer.setAttribute('cy', String(py));\n\n        if (input.disabled) container.classList.add('disabled');\n        else container.classList.remove('disabled');\n    };\n\n    // Interaction\n    let isDragging = false;\n    let startY = 0;\n    let startVal = 0;\n\n    container.addEventListener('mousedown', (e) => {\n        if (input.disabled) return;\n        isDragging = true;\n        startY = e.clientY;\n        startVal = parseFloat(input.value);\n        document.body.style.cursor = 'ns-resize';\n\n        const onMouseMove = (moveEvent: MouseEvent) => {\n            if (!isDragging) return;\n            const deltaY = startY - moveEvent.clientY;\n            const range = parseFloat(input.max) - parseFloat(input.min);\n            const sensitivity = range / 200; // 200px for full range\n            let newVal = startVal + deltaY * sensitivity;\n\n            const step = parseFloat(input.step) || 0.01;\n            newVal = Math.round(newVal / step) * step;\n            newVal = Math.max(parseFloat(input.min), Math.min(parseFloat(input.max), newVal));\n\n            input.value = String(newVal);\n            input.dispatchEvent(new Event('input'));\n            updateKnob();\n        };\n\n        const onMouseUp = () => {\n            isDragging = false;\n            document.body.style.cursor = '';\n            window.removeEventListener('mousemove', onMouseMove);\n            window.removeEventListener('mouseup', onMouseUp);\n        };\n\n        window.addEventListener('mousemove', onMouseMove);\n        window.addEventListener('mouseup', onMouseUp);\n    });\n\n    // Observer to update knob when input value changes programmatically\n    const observer = new MutationObserver(() => updateKnob());\n    observer.observe(input, { attributes: true, attributeFilter: ['value', 'disabled'] });\n\n    // Also poll/check for value changes if MutationObserver doesn't catch .value assignment\n    // (In many cases, setting .value doesn't trigger MutationObserver)\n    const originalValueSetter = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value')?.set;\n    if (originalValueSetter) {\n        Object.defineProperty(input, 'value', {\n            set: function (v) {\n                originalValueSetter.call(this, v);\n                updateKnob();\n            },\n            get: Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value')?.get,\n            configurable: true\n        });\n    }\n\n    (input as any).updateKnob = updateKnob;\n    updateKnob();\n    return container;\n}\n\nfunction polarToCartesian(centerX: number, centerY: number, radius: number, angleInDegrees: number) {\n    const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;\n    return {\n        x: centerX + (radius * Math.cos(angleInRadians)),\n        y: centerY + (radius * Math.sin(angleInRadians))\n    };\n}\n\nfunction describeArc(x: number, y: number, radius: number, startAngle: number, endAngle: number) {\n    const start = polarToCartesian(x, y, radius, endAngle);\n    const end = polarToCartesian(x, y, radius, startAngle);\n    const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\";\n    const d = [\n        \"M\", start.x, start.y,\n        \"A\", radius, radius, 0, largeArcFlag, 0, end.x, end.y\n    ].join(\" \");\n    return d;\n}\n\n/**\n * Standard select factory.\n */\nexport function createSelect(\n    parent: HTMLElement,\n    id: string,\n    label: string,\n    options: string[] | { value: string, label: string }[],\n    onChange?: (val: string) => void\n): HTMLSelectElement {\n    const group = document.createElement('div');\n    group.className = 'control-group';\n\n    const labelEl = document.createElement('label');\n    labelEl.htmlFor = id;\n    labelEl.textContent = label;\n\n    const select = document.createElement('select');\n    select.id = id;\n\n    options.forEach(opt => {\n        const optEl = document.createElement('option');\n        if (typeof opt === 'string') {\n            optEl.value = opt;\n            optEl.textContent = opt;\n        } else {\n            optEl.value = opt.value;\n            optEl.textContent = opt.label;\n        }\n        select.appendChild(optEl);\n    });\n\n    if (onChange) {\n        select.addEventListener('change', () => onChange(select.value));\n    }\n\n    const labelRow = document.createElement('div');\n    labelRow.className = 'label-row';\n    labelRow.appendChild(labelEl);\n\n    group.appendChild(labelRow);\n    group.appendChild(select);\n    parent.appendChild(group);\n\n    return select;\n}\n\n/**\n * Button factory.\n */\nexport function createButton(\n    parent: HTMLElement,\n    id: string,\n    text: string,\n    onClick: () => void,\n    className: string = 'reset-button'\n): HTMLButtonElement {\n    const group = document.createElement('div');\n    group.className = 'control-group';\n\n    const button = document.createElement('button');\n    button.id = id;\n    button.textContent = text;\n    button.className = className;\n\n    button.addEventListener('click', onClick);\n\n    group.appendChild(button);\n    parent.appendChild(group);\n    return button;\n}\n\n/**\n * Creates a slider with a modulation source selector (LFOs).\n */\nexport function createModulatableSlider(\n    parent: HTMLElement,\n    id: string,\n    label: string,\n    min: number,\n    max: number,\n    value: number,\n    step: number,\n    lfoLabels: { value: string, label: string }[],\n    onSliderInput: (val: number) => void,\n    onSourceChange: (source: string) => void,\n    mode: 'slider' | 'knob' = CONTROL_STYLE\n): { slider: HTMLInputElement, select: HTMLSelectElement } {\n    const group = document.createElement('div');\n    group.className = 'control-group';\n    if (mode === 'knob') group.classList.add('knob-centered');\n    const labelEl = document.createElement('label');\n    labelEl.htmlFor = id;\n    labelEl.textContent = label;\n    const sourceSelect = document.createElement('select');\n    sourceSelect.style.marginLeft = mode === 'knob' ? '0' : 'auto';\n    lfoLabels.forEach(opt => {\n        const option = document.createElement('option');\n        option.value = opt.value\n        option.textContent = opt.label\n        if (opt.value === 'none') option.selected = true;\n        sourceSelect.appendChild(option);\n    });\n    const valueDisplay = document.createElement('span');\n    valueDisplay.className = 'value-display';\n    valueDisplay.id = `${id}-value`;\n    const updateDisplay = (val: number) => {\n        valueDisplay.textContent = step >= 1 ? String(Math.round(val)) : val.toFixed(2);\n    };\n    updateDisplay(value);\n    const slider = document.createElement('input');\n    slider.type = 'range';\n    slider.id = id;\n    slider.min = String(min);\n    slider.max = String(max);\n    slider.value = String(value);\n    slider.step = String(step);\n    slider.className = 'slider';\n    slider.addEventListener('input', () => {\n        const val = parseFloat(slider.value);\n        updateDisplay(val);\n        onSliderInput(val);\n    });\n    sourceSelect.addEventListener('change', () => {\n        onSourceChange(sourceSelect.value);\n        slider.disabled = sourceSelect.value !== 'none';\n        group.style.opacity = sourceSelect.value !== 'none' ? '0.8' : '1.0';\n    });\n    if (mode === 'knob') {\n        slider.style.display = 'none';\n        group.appendChild(labelEl);\n        group.appendChild(sourceSelect);\n        group.appendChild(createKnobElement(slider));\n        group.appendChild(valueDisplay);\n    } else {\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(sourceSelect);\n        const valueRow = document.createElement('div');\n        valueRow.className = 'label-row';\n        valueRow.style.justifyContent = 'flex-end';\n        valueRow.appendChild(valueDisplay);\n        group.appendChild(labelRow);\n        group.appendChild(valueRow);\n        group.appendChild(slider);\n    }\n    parent.appendChild(group);\n    return { slider, select: sourceSelect };\n}\n\n/**\n * File input factory.\n */\nexport function createFileInput(\n    parent: HTMLElement,\n    id: string,\n    label: string,\n    accept: string,\n    multiple: boolean = false,\n    onChange?: (files: FileList | null) => void\n): HTMLInputElement {\n    const group = document.createElement('div');\n    group.className = 'control-group';\n\n    const labelEl = document.createElement('label');\n    labelEl.htmlFor = id;\n    labelEl.textContent = label;\n\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.id = id;\n    input.accept = accept;\n    input.multiple = multiple;\n    input.className = 'file-input';\n\n    if (onChange) {\n        input.addEventListener('change', () => onChange(input.files));\n    }\n\n    const labelRow = document.createElement('div');\n    labelRow.className = 'label-row';\n    labelRow.appendChild(labelEl);\n\n    group.appendChild(labelRow);\n    group.appendChild(input);\n    parent.appendChild(group);\n\n    return input;\n}\n\n/**\n * Number input factory for simple numeric fields.\n */\nexport function createNumberInput(\n    parent: HTMLElement,\n    id: string,\n    label: string,\n    value: number,\n    min: number,\n    max: number,\n    step: number,\n    onChange?: (val: number) => void\n): HTMLInputElement {\n    const group = document.createElement('div');\n    group.className = 'control-group-row';\n    group.style.display = 'flex';\n    group.style.alignItems = 'center';\n    group.style.gap = '8px';\n    group.style.marginBottom = '8px';\n\n    const labelEl = document.createElement('label');\n    labelEl.htmlFor = id;\n    labelEl.textContent = label;\n    labelEl.style.fontSize = '12px';\n    labelEl.style.whiteSpace = 'nowrap';\n    labelEl.style.marginBottom = '0';\n\n    const input = document.createElement('input');\n    input.type = 'number';\n    input.id = id;\n    input.min = String(min);\n    input.max = String(max);\n    input.step = String(step);\n    input.value = String(value);\n    input.style.width = '60px';\n    input.style.background = 'var(--bg-input)';\n    input.style.border = '1px solid var(--border-subtle)';\n    input.style.color = 'var(--text-main)';\n    input.style.padding = '2px 4px';\n    input.style.borderRadius = '4px';\n\n    if (onChange) {\n        input.addEventListener('change', () => onChange(parseFloat(input.value)));\n    }\n\n    group.appendChild(labelEl);\n    group.appendChild(input);\n    parent.appendChild(group);\n\n    return input;\n}\n","import { LFO } from '../modulators/lfo';\nimport {\n    ReadingPathState, VolumeResolution, SynthMode, CarrierType, PlaneType,\n    VOLUME_DENSITY_X_MIN, VOLUME_DENSITY_X_MAX, VOLUME_DENSITY_X_DEFAULT,\n    VOLUME_DENSITY_Y_MIN, VOLUME_DENSITY_Y_MAX, VOLUME_DENSITY_Y_DEFAULT,\n    VOLUME_DENSITY_Z_MIN, VOLUME_DENSITY_Z_MAX, VOLUME_DENSITY_Z_DEFAULT,\n    GeneratorParams, JuliaParams, MandelbulbParams, MengerParams, PlasmaParams, GameOfLifeParams,\n    defaultJuliaParams, defaultMandelbulbParams, defaultMengerParams, defaultPlasmaParams, defaultGameOfLifeParams,\n    PresetControls, LFOState, OctaveDoublingState, defaultOctaveDoublingState\n} from '../types';\nimport { PresetManager } from './preset-manager';\nimport {\n    createSection, createSlider, createSelect, createModulatableSlider,\n    createFileInput, createButton, createNumberInput, WAVEFORM_ICONS, CONTROL_STYLE\n} from './ui-elements';\n\ninterface SectionOpts {\n    title: string;\n    populate: (container: HTMLElement) => void;\n    mode?: 'slider' | 'knob';\n}\n\n// UI control panel with sliders for all parameters\nexport class ControlPanel {\n    private container: HTMLElement;\n\n    // Path controls\n    private pathYSlider!: HTMLInputElement;\n    private planeTypeSelect!: HTMLSelectElement;\n    private scanPositionSlider!: HTMLInputElement;\n\n    // Synth mode controls\n    private synthModeSelect!: HTMLSelectElement;\n    private synthParamsContainer: HTMLElement | null = null;\n    private interpSamplesSlider!: HTMLInputElement;\n    private midiSelect!: HTMLSelectElement;\n\n    // Volume density controls\n    private densityXSlider!: HTMLInputElement;\n    private densityYSlider!: HTMLInputElement;\n    private densityZSlider!: HTMLInputElement;\n\n    // Spectral data controls\n    private spectralDataSelect!: HTMLSelectElement;\n    private dynamicParamSlider: HTMLInputElement | null = null;\n    private dynamicParamContainer: HTMLElement | null = null;\n\n    // Generator parameter sliders\n    private generatorParamsContainer: HTMLElement | null = null;\n    private currentGeneratorParams: GeneratorParams | null = null;\n    private currentDataSet: string = 'blank';\n\n    // Progress indicators\n    private progressContainer: HTMLElement | null = null;\n    private progressFill: HTMLElement | null = null;\n    private progressText: HTMLElement | null = null;\n\n    // Callbacks\n    private onPathChange: ((state: ReadingPathState) => void) | null = null;\n    private onVolumeResolutionChange?: (resolution: VolumeResolution) => void;\n    private onSpectralDataChange?: (dataSet: string) => void;\n    private onWavUpload?: (files: FileList) => void;\n    private onSynthModeChange: ((mode: SynthMode) => void) | null = null;\n    private onCarrierChange: ((carrier: CarrierType) => void) | null = null;\n    private onFeedbackChange: ((amount: number) => void) | null = null;\n    private onMidiInputChange: ((id: string) => void) | null = null;\n    private onOctaveChange: ((octave: number) => void) | null = null;\n    private onOctaveDoublingChange: ((state: OctaveDoublingState) => void) | null = null;\n    private onInterpSamplesChange: ((samples: number) => void) | null = null;\n\n    // LFO Callbacks\n    private onLFOParamChange: ((index: number, param: string, value: any) => void) | null = null;\n    private onModulationRoutingChange: ((target: string, source: string) => void) | null = null;\n\n    // Generator params callback\n    private onGeneratorParamsChange: ((dataSet: string, params: GeneratorParams) => void) | null = null;\n\n    // Offline Render callback\n    private onRenderWav: ((note: number, duration: number) => void) | null = null;\n\n    // Preset system\n    private presetManager: PresetManager;\n    private presetSelect: HTMLSelectElement | null = null;\n    private onPresetLoad: ((controls: PresetControls) => void) | null = null;\n\n    // LFO state for serialization\n    private lfoLabels: string[] = ['None'];\n    private lfoState: LFOState[] = [];\n    private modRoutingState = { pathY: 'none', scanPhase: 'none', shapePhase: 'none' };\n    private octaveValue = 3;\n\n    // Octave doubling state\n    private octaveDoublingState: OctaveDoublingState = { ...defaultOctaveDoublingState };\n    private octaveLowSlider!: HTMLInputElement;\n    private octaveHighSlider!: HTMLInputElement;\n    private octaveMultSlider!: HTMLInputElement;\n\n    // Debounce timer for auto-save\n    private autoSaveTimer: number | null = null;\n\n    // LFO UI element references for state restoration\n    private lfoWaveSelects: HTMLSelectElement[] = [];\n    private lfoFreqSliders: HTMLInputElement[] = [];\n    private lfoAmpSliders: HTMLInputElement[] = [];\n    private lfoOffsetSliders: HTMLInputElement[] = [];\n    private lfoFreqDisplays: HTMLSpanElement[] = [];\n    private lfoAmpDisplays: HTMLSpanElement[] = [];\n    private lfoOffsetDisplays: HTMLSpanElement[] = [];\n\n    // Waveform Icon containers\n    private carrierIconContainer: HTMLElement | null = null;\n    private lfoIconContainers: HTMLElement[] = [];\n\n    // Modulation routing selects\n    private pathYSourceSelect: HTMLSelectElement | null = null;\n    private scanPhaseSourceSelect: HTMLSelectElement | null = null;\n    private shapePhaseSourceSelect: HTMLSelectElement | null = null;\n\n    constructor(containerId: string, options: { lfos: LFO[] }) {\n        const el = document.getElementById(containerId);\n        if (!el) throw new Error(`Container not found: ${containerId}`);\n        this.container = el;\n\n        this.lfoState = options.lfos.map((lfo, index) => {\n            const label = `LFO ${index + 1}`;\n            this.lfoLabels.push(label);\n            return {\n                waveform: lfo.waveform,\n                frequency: lfo.frequency,\n                amplitude: lfo.amplitude,\n                offset: lfo.offset\n            };\n        });\n\n        // Initialize preset manager\n        this.presetManager = new PresetManager();\n        this.presetManager.setPresetsChangeCallback(() => this.updatePresetDropdown());\n\n        const sections: SectionOpts[] = [\n            { title: 'Wave/Spectral Volume', populate: (c) => this.populateVolumeSection(c) },\n            { title: 'Audio Synthesis', populate: (c) => this.populateSynthesisSection(c) },\n            { title: 'Reading Path', populate: (c) => this.populatePathSection(c) },\n            { title: 'LFOs', populate: (c) => this.populateLFOSection(c) },\n            { title: 'Visualization', populate: (c) => this.populateVisualizationSection(c), mode: 'slider' },\n            { title: 'Offline Render', populate: (c) => this.populateOfflineRenderSection(c) }\n        ];\n\n        sections.forEach(s => {\n            const container = createSection(this.container, s.title, s.mode);\n            s.populate(container);\n        });\n\n        this.updateModulationRanges();\n    }\n\n    private populateVolumeSection(container: HTMLElement): void {\n        const subGroup = document.createElement('div');\n        subGroup.classList.add('sub-group');\n        container.appendChild(subGroup);\n        this.spectralDataSelect = createSelect(subGroup, 'spectral-data-type', 'Data Set', [\n            'blank', '3d-julia', 'mandelbulb', 'menger-sponge', 'sine-plasma', 'game-of-life'\n        ], (val) => {\n            if (this.onSpectralDataChange) this.onSpectralDataChange(val);\n            this.scheduleAutoSave();\n        });\n        this.createGeneratorParamsContainer(subGroup);\n        createButton(subGroup, 'reset-dataset-btn', '↻ Reset Dataset', () => {\n            if (this.onSpectralDataChange) this.onSpectralDataChange(this.spectralDataSelect.value);\n        });\n        const subGroup2 = document.createElement('div');\n        subGroup2.classList.add('sub-group');\n        container.appendChild(subGroup2);\n        createFileInput(subGroup2, 'wav-upload', 'Upload WAV (Multi-select)', '.wav,.mp3,.ogg', true, (files) => {\n            if (files && files.length > 0 && this.onWavUpload) this.onWavUpload(files);\n        });\n        this.createProgressIndicator(subGroup2);\n        this.presetSelect = createSelect(subGroup2, 'preset-select', 'Load Preset', [], (val) => {\n            if (val && this.onPresetLoad) {\n                const preset = this.presetManager.getPreset(val);\n                if (preset) this.onPresetLoad(preset.controls);\n            }\n        });\n        const defaultOpt = document.createElement('option');\n        defaultOpt.value = '';\n        defaultOpt.textContent = '-- Select Preset --';\n        this.presetSelect.insertBefore(defaultOpt, this.presetSelect.firstChild);\n        this.updatePresetDropdown();\n        const buttonGroup = document.createElement('div');\n        buttonGroup.className = 'control-group';\n        buttonGroup.style.display = 'flex';\n        buttonGroup.style.gap = '8px';\n        createButton(buttonGroup, 'save-preset-btn', '💾 Save', () => {\n            const name = prompt('Enter preset name:');\n            if (name && name.trim()) this.presetManager.savePreset(name.trim(), this.getFullState());\n        });\n        createButton(buttonGroup, 'delete-preset-btn', '🗑 Delete', () => {\n            if (this.presetSelect && this.presetSelect.value) {\n                if (confirm(`Delete preset \"${this.presetSelect.value}\"?`)) {\n                    this.presetManager.deletePreset(this.presetSelect.value);\n                }\n            }\n        });\n        subGroup2.appendChild(buttonGroup);\n    }\n\n    private populatePathSection(container: HTMLElement): void {\n        const lfoOptions = this.lfoLabels.map(l => ({\n            value: l.toLowerCase().replace(' ', ''),\n            label: l\n        }));\n        const spGroup = document.createElement('div');\n        spGroup.className = 'control-group';\n        container.appendChild(spGroup);\n        this.planeTypeSelect = createSelect(spGroup, 'plane-type', 'Plane Type', [\n            PlaneType.FLAT, PlaneType.SINCOS, PlaneType.WAVE, PlaneType.RIPPLE\n        ], (_val) => {\n            if (this.onPathChange) this.onPathChange(this.getState());\n            this.scheduleAutoSave();\n        });\n        this.shapePhaseSourceSelect = createSelect(spGroup, 'shape-phase-source', 'Shape Phase Source', lfoOptions, (source) => {\n            this.modRoutingState.shapePhase = source;\n            if (this.onModulationRoutingChange) this.onModulationRoutingChange('shapePhase', source);\n            this.scheduleAutoSave();\n        });\n        const nGroup = document.createElement('div');\n        nGroup.className = 'control-group';\n        container.appendChild(nGroup);\n        const pathYControl = createModulatableSlider(nGroup, 'path-y', 'Position Y (Morph)', -1, 1, 0, 0.01, lfoOptions,\n            (_v) => { if (this.onPathChange) this.onPathChange(this.getState()); this.scheduleAutoSave(); },\n            (source) => {\n                this.modRoutingState.pathY = source;\n                if (this.onModulationRoutingChange) this.onModulationRoutingChange('pathY', source);\n                this.scheduleAutoSave();\n                this.updateModulationRanges();\n            }\n        );\n        this.pathYSlider = pathYControl.slider;\n        this.pathYSourceSelect = pathYControl.select;\n        const scanControl = createModulatableSlider(nGroup, 'scan-pos', 'Scan Phase', -1, 1, 0, 0.01, lfoOptions as any,\n            (_v) => { if (this.onPathChange) this.onPathChange(this.getState()); this.scheduleAutoSave(); },\n            (source) => {\n                this.modRoutingState.scanPhase = source;\n                if (this.onModulationRoutingChange) this.onModulationRoutingChange('scanPhase', source);\n                this.scheduleAutoSave();\n                this.updateModulationRanges();\n            }\n        );\n        this.scanPositionSlider = scanControl.slider;\n        this.scanPhaseSourceSelect = scanControl.select;\n    }\n\n    private populateSynthesisSection(container: HTMLElement): void {\n        const subGroup = document.createElement('div');\n        subGroup.classList.add('sub-group');\n        container.appendChild(subGroup);\n\n        this.synthModeSelect = createSelect(subGroup, 'synth-mode', 'Mode', [\n            SynthMode.WAVETABLE, SynthMode.SPECTRAL, SynthMode.WHITENOISE_BAND_Q_FILTER\n        ], (val) => {\n            const mode = val as SynthMode;\n            this.updateSynthModeUI(mode);\n            if (this.onSynthModeChange) this.onSynthModeChange(mode);\n            this.scheduleAutoSave();\n        });\n\n        this.createEnvelopeUI(subGroup);\n        this.midiSelect = this.createMidiSelect(subGroup);\n        this.createOctaveSelect(subGroup);\n\n        // Dynamic synth parameter container\n        this.synthParamsContainer = document.createElement('div');\n        this.synthParamsContainer.id = 'synth-params-container';\n        this.synthParamsContainer.classList.add('sub-group');\n        container.appendChild(this.synthParamsContainer);\n\n        // Global synthesis settings (like Interpolation)\n        const subGroup2 = document.createElement('div');\n        subGroup2.classList.add('sub-group');\n        container.appendChild(subGroup2);\n\n        // Interpolation samples control (all modes)\n        this.interpSamplesSlider = createSlider(subGroup2, 'interp-samples', 'Interp Samples', 16, 1024, 64, 16, (val) => {\n            if (this.onInterpSamplesChange) this.onInterpSamplesChange(val);\n            this.scheduleAutoSave();\n        });\n\n        // Octave doubling controls (available for all modes)\n        const subGroup3 = document.createElement('div');\n        subGroup3.classList.add('sub-group');\n        container.appendChild(subGroup3);\n        const harmTitle = document.createElement('label');\n        harmTitle.textContent = 'Octave Doubling';\n        harmTitle.style.fontWeight = 'bold';\n        harmTitle.style.marginBottom = '8px';\n        harmTitle.style.display = 'block';\n        subGroup3.appendChild(harmTitle);\n\n        const octaveUpdate = () => {\n            if (this.onOctaveDoublingChange) this.onOctaveDoublingChange(this.octaveDoublingState);\n            this.scheduleAutoSave();\n        };\n\n        this.octaveLowSlider = createSlider(subGroup3, 'octave-low', 'Low (octaves below)', 0, 10, 0, 1, (val) => {\n            this.octaveDoublingState.lowCount = val;\n            octaveUpdate();\n        });\n        this.octaveHighSlider = createSlider(subGroup3, 'octave-high', 'High (octaves above)', 0, 10, 0, 1, (val) => {\n            this.octaveDoublingState.highCount = val;\n            octaveUpdate();\n        });\n        this.octaveMultSlider = createSlider(subGroup3, 'octave-mult', 'Decay (per octave)', 0, 1, 0.5, 0.01, (val) => {\n            this.octaveDoublingState.multiplier = val;\n            octaveUpdate();\n        });\n\n        // Initialize dynamic UI\n        this.updateSynthModeUI(this.synthModeSelect.value as SynthMode);\n    }\n\n    private updateSynthModeUI(mode: SynthMode): void {\n        if (!this.synthParamsContainer) return;\n        this.synthParamsContainer.innerHTML = '';\n\n        if (mode === SynthMode.WAVETABLE) {\n            this.createCarrierSelect(this.synthParamsContainer);\n            this.createFeedbackSlider(this.synthParamsContainer);\n        }\n    }\n\n    private populateLFOSection(container: HTMLElement): void {\n        this.lfoState.forEach((_, index) => this.createLFOUnit(container, index));\n    }\n\n    private populateVisualizationSection(container: HTMLElement): void {\n        const volUpdate = () => {\n            if (this.onVolumeResolutionChange) {\n                this.onVolumeResolutionChange({\n                    x: Math.round(parseFloat(this.densityXSlider.value)),\n                    y: Math.round(parseFloat(this.densityYSlider.value)),\n                    z: Math.round(parseFloat(this.densityZSlider.value)),\n                });\n            }\n            this.scheduleAutoSave();\n        };\n        this.densityXSlider = createSlider(container, 'density-x', 'Freq Bins (X)', VOLUME_DENSITY_X_MIN, VOLUME_DENSITY_X_MAX, VOLUME_DENSITY_X_DEFAULT, 1, volUpdate, 'slider');\n        this.densityYSlider = createSlider(container, 'density-y', 'Morph Layers (Y)', VOLUME_DENSITY_Y_MIN, VOLUME_DENSITY_Y_MAX, VOLUME_DENSITY_Y_DEFAULT, 1, volUpdate, 'slider');\n        this.densityZSlider = createSlider(container, 'density-z', 'Time Res (Z)', VOLUME_DENSITY_Z_MIN, VOLUME_DENSITY_Z_MAX, VOLUME_DENSITY_Z_DEFAULT, 1, volUpdate, 'slider');\n    }\n\n    private appendControl(container: HTMLElement, element: HTMLElement): void {\n        container.appendChild(element);\n    }\n\n    private populateOfflineRenderSection(container: HTMLElement): void {\n        const subGroup = document.createElement('div');\n        subGroup.classList.add('sub-group');\n        subGroup.style.display = 'flex';\n        subGroup.style.flexDirection = 'column';\n        subGroup.style.gap = '8px';\n        container.appendChild(subGroup);\n\n        const row = document.createElement('div');\n        row.style.display = 'flex';\n        row.style.alignItems = 'center';\n        row.style.gap = '12px';\n        subGroup.appendChild(row);\n\n        const baseNoteInput = createNumberInput(row, 'render-base-note', 'Base Note', 48, 0, 127, 1);\n        const durationInput = createNumberInput(row, 'render-duration', 'Duration (s)', 2.0, 0.1, 10.0, 0.1);\n\n        createButton(subGroup, 'render-wav-btn', 'RENDER WAV', () => {\n            const note = parseInt(baseNoteInput.value);\n            const duration = parseFloat(durationInput.value);\n            if (this.onRenderWav) this.onRenderWav(note, duration);\n        }, 'reset-button');\n    }\n\n    public setRenderWavCallback(callback: (note: number, duration: number) => void): void {\n        this.onRenderWav = callback;\n    }\n\n    private createLFOUnit(container: HTMLElement, index: number): void {\n        const wrapper = document.createElement('div');\n        wrapper.className = 'lfo-unit';\n        if (CONTROL_STYLE === 'knob') wrapper.classList.add('knob-layout');\n\n        const title = document.createElement('label');\n        title.innerText = `LFO ${index + 1}`;\n        wrapper.appendChild(title);\n\n        const iconContainer = document.createElement('div');\n        iconContainer.className = 'waveform-icon';\n        iconContainer.innerHTML = WAVEFORM_ICONS[this.lfoState[index].waveform] || WAVEFORM_ICONS['sine'];\n        this.lfoIconContainers[index] = iconContainer;\n\n        const waveSelect = createSelect(wrapper, `lfo-${index}-wave`, 'Waveform', [\n            { value: 'sine', label: 'Sine' },\n            { value: 'square', label: 'Square' },\n            { value: 'saw', label: 'Saw' },\n            { value: 'triangle', label: 'Triangle' }\n        ], (val) => {\n            this.lfoState[index].waveform = val;\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'waveform', val);\n            iconContainer.innerHTML = WAVEFORM_ICONS[val] || WAVEFORM_ICONS['sine'];\n            this.scheduleAutoSave();\n        });\n\n        const waveLabelRow = wrapper.querySelector('.label-row') as HTMLElement;\n        if (waveLabelRow) waveLabelRow.appendChild(iconContainer);\n\n        this.lfoWaveSelects[index] = waveSelect;\n\n        this.lfoFreqSliders[index] = createSlider(wrapper, `lfo-${index}-freq`, 'Freq', 0, 1, this.lfoState[index].frequency, 0.01, (val) => {\n            this.lfoState[index].frequency = val;\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'frequency', val);\n            this.scheduleAutoSave();\n        });\n\n        this.lfoAmpSliders[index] = createSlider(wrapper, `lfo-${index}-amp`, 'Amp', 0, 1, this.lfoState[index].amplitude, 0.01, (val) => {\n            this.lfoState[index].amplitude = val;\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'amplitude', val);\n            this.scheduleAutoSave();\n            this.updateModulationRanges();\n        });\n\n        this.lfoOffsetSliders[index] = createSlider(wrapper, `lfo-${index}-offset`, 'Offset', -1, 1, this.lfoState[index].offset, 0.01, (val) => {\n            this.lfoState[index].offset = val;\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'offset', val);\n            this.scheduleAutoSave();\n            this.updateModulationRanges();\n        });\n\n        this.appendControl(container, wrapper);\n    }\n\n    public envelopeCanvas: HTMLCanvasElement | null = null;\n\n    private createEnvelopeUI(container: HTMLElement): void {\n        const wrapper = document.createElement('div');\n        wrapper.className = 'control-group';\n        wrapper.style.height = '150px';\n\n        const canvas = document.createElement('canvas');\n        canvas.id = 'envelope-canvas-control';\n        canvas.style.width = '100%';\n        canvas.style.height = '100%';\n        canvas.style.display = 'block';\n        canvas.style.background = '#08080c';\n        canvas.style.borderRadius = '4px';\n        canvas.style.border = '1px solid var(--border-subtle)';\n\n        wrapper.appendChild(canvas);\n        this.appendControl(container, wrapper);\n        this.envelopeCanvas = canvas;\n    }\n\n    private createCarrierSelect(container: HTMLElement): HTMLSelectElement {\n        const group = document.createElement('div');\n        group.id = 'carrier-container';\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = 'carrier';\n        labelEl.textContent = 'Carrier';\n\n        const iconContainer = document.createElement('div');\n        iconContainer.className = 'waveform-icon';\n        iconContainer.innerHTML = WAVEFORM_ICONS['sine'];\n        this.carrierIconContainer = iconContainer;\n\n        const select = createSelect(group, 'carrier', 'Carrier', [\n            { value: '0', label: 'Sine' },\n            { value: '1', label: 'Saw' },\n            { value: '2', label: 'Square' },\n            { value: '3', label: 'Triangle' }\n        ], (val) => {\n            const carrierVal = parseInt(val) as CarrierType;\n            if (this.onCarrierChange) this.onCarrierChange(carrierVal);\n            const keys = ['sine', 'saw', 'square', 'triangle'];\n            iconContainer.innerHTML = WAVEFORM_ICONS[keys[carrierVal]] || WAVEFORM_ICONS['sine'];\n        });\n\n        const labelRow = group.querySelector('.label-row') as HTMLElement;\n        if (labelRow) labelRow.appendChild(iconContainer);\n\n        this.appendControl(container, group);\n        return select;\n    }\n\n    private createFeedbackSlider(container: HTMLElement): HTMLInputElement {\n        const slider = createSlider(container, 'feedback', 'Feedback', 0, 0.99, 0, 0.01, (val) => {\n            if (this.onFeedbackChange) this.onFeedbackChange(val);\n        });\n        const group = slider.closest('.control-group') as HTMLElement;\n        if (group) {\n            group.id = 'feedback-container';\n        }\n        return slider;\n    }\n\n    private createMidiSelect(container: HTMLElement): HTMLSelectElement {\n        const select = createSelect(container, 'midi-input', 'MIDI Input', [\n            { value: '', label: 'No Devices Found' }\n        ], (val) => {\n            if (this.onMidiInputChange) this.onMidiInputChange(val);\n        });\n        return select;\n    }\n\n    private createOctaveSelect(container: HTMLElement): HTMLSelectElement {\n        const select = createSelect(container, 'octave-select', 'Keyboard Octave', [\n            '0', '1', '2', '3', '4', '5', '6', '7'\n        ], (val) => {\n            this.octaveValue = parseInt(val, 10);\n            if (this.onOctaveChange) this.onOctaveChange(this.octaveValue);\n            this.scheduleAutoSave();\n        });\n        select.value = '3';\n        return select;\n    }\n\n    private updatePresetDropdown(): void {\n        if (!this.presetSelect) return;\n\n        const currentValue = this.presetSelect.value;\n        this.presetSelect.innerHTML = '';\n\n        const defaultOpt = document.createElement('option');\n        defaultOpt.value = '';\n        defaultOpt.textContent = '-- Select Preset --';\n        this.presetSelect.appendChild(defaultOpt);\n\n        const presets = this.presetManager.getPresets();\n        for (const preset of presets) {\n            const opt = document.createElement('option');\n            opt.value = preset.name;\n            opt.textContent = preset.name;\n            this.presetSelect.appendChild(opt);\n        }\n\n        // Restore selection if still exists\n        if (presets.some(p => p.name === currentValue)) {\n            this.presetSelect.value = currentValue;\n        }\n    }\n\n    private scheduleAutoSave(): void {\n        if (this.autoSaveTimer) {\n            clearTimeout(this.autoSaveTimer);\n        }\n        this.autoSaveTimer = window.setTimeout(() => {\n            this.presetManager.saveCurrentState(this.getFullState());\n        }, 500);\n    }\n\n    public getFullState(): PresetControls {\n        return {\n            pathY: parseFloat(this.pathYSlider.value),\n            scanPosition: parseFloat(this.scanPositionSlider.value),\n            planeType: this.planeTypeSelect.value,\n            synthMode: this.synthModeSelect.value,\n            frequency: 220, // Deprecated, kept for preset compatibility\n            carrier: parseInt((document.getElementById('carrier') as HTMLSelectElement)?.value || '0'),\n            feedback: parseFloat((document.getElementById('feedback') as HTMLInputElement)?.value || '0'),\n            densityX: parseFloat(this.densityXSlider.value),\n            densityY: parseFloat(this.densityYSlider.value),\n            densityZ: parseFloat(this.densityZSlider.value),\n            spectralData: this.spectralDataSelect.value,\n            generatorParams: this.currentGeneratorParams || undefined,\n            lfos: this.lfoState.map(lfo => ({ ...lfo })),\n            modRouting: { ...this.modRoutingState },\n            envelopes: [{ attack: 0.1, decay: 0.2, sustain: 0.5, release: 0.5 }], // Will be updated from AudioEngine\n            octave: this.octaveValue,\n            octaveDoubling: { ...this.octaveDoublingState },\n            interpSamples: parseFloat(this.interpSamplesSlider.value)\n        };\n    }\n\n    public setPresetLoadCallback(callback: (controls: PresetControls) => void): void {\n        this.onPresetLoad = callback;\n    }\n\n    public loadSavedState(): PresetControls | null {\n        return this.presetManager.loadCurrentState();\n    }\n\n    public applyState(state: PresetControls): void {\n        // Apply all control values from state\n        this.pathYSlider.value = String(state.pathY);\n        this.scanPositionSlider.value = String(state.scanPosition);\n        this.planeTypeSelect.value = state.planeType;\n        this.synthModeSelect.value = state.synthMode;\n        // Note: frequency slider removed, pitch controlled via MIDI/piano\n        this.densityXSlider.value = String(state.densityX);\n        this.densityYSlider.value = String(state.densityY);\n        this.densityZSlider.value = String(state.densityZ);\n        this.spectralDataSelect.value = state.spectralData;\n        this.interpSamplesSlider.value = String(state.interpSamples || 64);\n\n        // Refresh dynamic synth UI\n        this.updateSynthModeUI(state.synthMode as SynthMode);\n\n        // Update carrier and feedback\n        const carrierEl = document.getElementById('carrier') as HTMLSelectElement;\n        if (carrierEl) {\n            carrierEl.value = String(state.carrier);\n            if (this.carrierIconContainer) {\n                const options = [\n                    { value: '0', key: 'sine' },\n                    { value: '1', key: 'saw' },\n                    { value: '2', key: 'square' },\n                    { value: '3', key: 'triangle' },\n                ];\n                const key = options.find(o => o.value === carrierEl.value)?.key || 'sine';\n                this.carrierIconContainer.innerHTML = WAVEFORM_ICONS[key];\n            }\n        }\n\n        const feedbackEl = document.getElementById('feedback') as HTMLInputElement;\n        if (feedbackEl) feedbackEl.value = String(state.feedback);\n\n        // Update octave\n        const octaveEl = document.getElementById('octave-select') as HTMLSelectElement;\n        if (octaveEl) {\n            octaveEl.value = String(state.octave);\n            this.octaveValue = state.octave;\n        }\n\n        // Store LFO and routing state\n        if (state.lfos) {\n            state.lfos.forEach((lfoData, index) => {\n                if (this.lfoState[index]) {\n                    this.lfoState[index] = { ...lfoData };\n                    this.updateLFOUI(index, lfoData);\n                }\n            });\n        }\n        this.modRoutingState = { ...state.modRouting };\n\n        // Update modulation routing UI\n        this.updateModRoutingUI();\n\n        // Store generator params\n        if (state.generatorParams) {\n            this.currentGeneratorParams = state.generatorParams;\n        }\n\n        // Restore octave doubling state\n        if (state.octaveDoubling) {\n            this.octaveDoublingState = { ...state.octaveDoubling };\n            this.octaveLowSlider.value = String(state.octaveDoubling.lowCount);\n            this.octaveHighSlider.value = String(state.octaveDoubling.highCount);\n            this.octaveMultSlider.value = String(state.octaveDoubling.multiplier);\n        }\n\n        // Update value displays\n        this.updateAllDisplays();\n        this.updateModulationRanges();\n    }\n\n    private updateLFOUI(index: number, lfo: { waveform: string; frequency: number; amplitude: number; offset: number }): void {\n        if (this.lfoWaveSelects[index]) {\n            this.lfoWaveSelects[index].value = lfo.waveform;\n            if (this.lfoIconContainers[index]) {\n                this.lfoIconContainers[index].innerHTML = WAVEFORM_ICONS[lfo.waveform] || WAVEFORM_ICONS['sine'];\n            }\n        }\n        if (this.lfoFreqSliders[index]) {\n            this.lfoFreqSliders[index].value = String(lfo.frequency);\n            if (this.lfoFreqDisplays[index]) {\n                this.lfoFreqDisplays[index].textContent = `${lfo.frequency} Hz`;\n            }\n        }\n        if (this.lfoAmpSliders[index]) {\n            this.lfoAmpSliders[index].value = String(lfo.amplitude);\n            if (this.lfoAmpDisplays[index]) {\n                this.lfoAmpDisplays[index].textContent = String(lfo.amplitude);\n            }\n        }\n        if (this.lfoOffsetSliders[index]) {\n            this.lfoOffsetSliders[index].value = String(lfo.offset);\n            if (this.lfoOffsetDisplays[index]) {\n                this.lfoOffsetDisplays[index].textContent = String(lfo.offset);\n            }\n        }\n    }\n\n    private updateModRoutingUI(): void {\n        // Update pathY source select\n        if (this.pathYSourceSelect) {\n            this.pathYSourceSelect.value = this.modRoutingState.pathY;\n            this.pathYSlider.disabled = this.modRoutingState.pathY !== 'none';\n        }\n        // Update scanPhase source select\n        if (this.scanPhaseSourceSelect) {\n            this.scanPhaseSourceSelect.value = this.modRoutingState.scanPhase;\n            this.scanPositionSlider.disabled = this.modRoutingState.scanPhase !== 'none';\n        }\n        // Update shapePhase source select\n        if (this.shapePhaseSourceSelect) {\n            this.shapePhaseSourceSelect.value = this.modRoutingState.shapePhase;\n        }\n        this.updateModulationRanges();\n    }\n\n    private updateAllDisplays(): void {\n        // Update path Y display\n        const pathYDisplay = document.getElementById('path-y-value');\n        if (pathYDisplay) pathYDisplay.textContent = parseFloat(this.pathYSlider.value).toFixed(2);\n\n        // Update scan position display\n        const scanDisplay = document.getElementById('scan-pos-value');\n        if (scanDisplay) scanDisplay.textContent = parseFloat(this.scanPositionSlider.value).toFixed(2);\n\n        // Update feedback display\n        const fbDisplay = document.getElementById('feedback-value');\n        const fbEl = document.getElementById('feedback') as HTMLInputElement;\n        if (fbDisplay && fbEl) {\n            fbDisplay.textContent = Math.round(parseFloat(fbEl.value) * 100) + '%';\n        }\n\n        // Update density displays\n        const dxDisplay = document.getElementById('density-x-value');\n        const dyDisplay = document.getElementById('density-y-value');\n        const dzDisplay = document.getElementById('density-z-value');\n        if (dxDisplay) dxDisplay.textContent = String(Math.round(parseFloat(this.densityXSlider.value)));\n        if (dyDisplay) dyDisplay.textContent = String(Math.round(parseFloat(this.densityYSlider.value)));\n        if (dzDisplay) dzDisplay.textContent = String(Math.round(parseFloat(this.densityZSlider.value)));\n    }\n\n    private updateModulationRanges(): void {\n        const syncMod = (slider: HTMLInputElement, source: string) => {\n            if (!slider) return;\n            const inputAny = slider as any;\n            if (source === 'none') {\n                inputAny.hasModulation = false;\n            } else {\n                const lfoIdx = parseInt(source.replace('lfo', '')) - 1;\n                const lfo = this.lfoState[lfoIdx];\n                if (lfo) {\n                    inputAny.hasModulation = true;\n                    inputAny.modOffset = lfo.offset;\n                    inputAny.modAmplitude = lfo.amplitude;\n                } else {\n                    inputAny.hasModulation = false;\n                }\n            }\n            if (inputAny.updateKnob) inputAny.updateKnob();\n        };\n\n        syncMod(this.pathYSlider, this.modRoutingState.pathY);\n        syncMod(this.scanPositionSlider, this.modRoutingState.scanPhase);\n    }\n\n    private createGeneratorParamsContainer(container: HTMLElement): void {\n        const group = document.createElement('div');\n        group.id = 'generator-params-container';\n        group.style.display = 'none';\n        group.classList.add('lfo-unit');\n        this.appendControl(container, group);\n        this.generatorParamsContainer = group;\n    }\n\n    private showGeneratorParams(dataSet: string, initialParams?: GeneratorParams): void {\n        if (!this.generatorParamsContainer) return;\n        this.generatorParamsContainer.innerHTML = '';\n        this.currentDataSet = dataSet;\n        const triggerUpdate = () => {\n            if (this.onGeneratorParamsChange && this.currentGeneratorParams) {\n                this.onGeneratorParamsChange(this.currentDataSet, this.currentGeneratorParams);\n            }\n        };\n        const createParamSlider = (label: string, min: number, max: number, value: number, step: number, onChange: (v: number) => void) => {\n            return createSlider(this.generatorParamsContainer!, `gen-param-${label}`, label, min, max, value, step, onChange);\n        };\n        switch (dataSet) {\n            case '3d-julia': {\n                const params = { ...(initialParams as JuliaParams || defaultJuliaParams) };\n                this.currentGeneratorParams = params;\n                createParamSlider('Scale', 0.5, 2.0, params.scale, 0.1, (v) => { params.scale = v; triggerUpdate(); });\n                createParamSlider('C Real', -1, 1, params.cReal, 0.05, (v) => { params.cReal = v; triggerUpdate(); });\n                createParamSlider('C Imaginary', -1, 1, params.cImag, 0.05, (v) => { params.cImag = v; triggerUpdate(); });\n                break;\n            }\n            case 'mandelbulb': {\n                const params = { ...(initialParams as MandelbulbParams || defaultMandelbulbParams) };\n                this.currentGeneratorParams = params;\n                createParamSlider('Power', 2, 12, params.power, 1, (v) => { params.power = v; triggerUpdate(); });\n                createParamSlider('Scale', 0.5, 2.0, params.scale, 0.1, (v) => { params.scale = v; triggerUpdate(); });\n                createParamSlider('Iterations', 4, 20, params.iterations, 1, (v) => { params.iterations = v; triggerUpdate(); });\n                break;\n            }\n            case 'menger-sponge': {\n                const params = { ...(initialParams as MengerParams || defaultMengerParams) };\n                this.currentGeneratorParams = params;\n                createParamSlider('Iterations', 1, 5, params.iterations, 1, (v) => { params.iterations = v; triggerUpdate(); });\n                createParamSlider('Scale', 0.5, 2.0, params.scale, 0.1, (v) => { params.scale = v; triggerUpdate(); });\n                createParamSlider('Hole Size', 0.2, 0.5, params.holeSize, 0.01, (v) => { params.holeSize = v; triggerUpdate(); });\n                break;\n            }\n            case 'sine-plasma': {\n                const params = { ...(initialParams as PlasmaParams || defaultPlasmaParams) };\n                this.currentGeneratorParams = params;\n                createParamSlider('Frequency', 1, 10, params.frequency, 0.5, (v) => { params.frequency = v; triggerUpdate(); });\n                createParamSlider('Complexity', 1, 6, params.complexity, 1, (v) => { params.complexity = v; triggerUpdate(); });\n                createParamSlider('Contrast', 0.5, 3.0, params.contrast, 0.1, (v) => { params.contrast = v; triggerUpdate(); });\n                break;\n            }\n            case 'game-of-life': {\n                const params = { ...(initialParams as GameOfLifeParams || defaultGameOfLifeParams) };\n                this.currentGeneratorParams = params;\n                createParamSlider('Density', 0.1, 0.5, params.density, 0.05, (v) => { params.density = v; triggerUpdate(); });\n                createParamSlider('Birth Neighbors', 4, 6, params.birthMin, 1, (v) => { params.birthMin = v; triggerUpdate(); });\n                createParamSlider('Survive Neighbors', 3, 6, params.surviveMin, 1, (v) => { params.surviveMin = v; triggerUpdate(); });\n                break;\n            }\n            default:\n                this.currentGeneratorParams = null;\n                this.generatorParamsContainer.style.display = 'none';\n                return;\n        }\n\n        this.generatorParamsContainer.style.display = 'block';\n    }\n\n    private hideGeneratorParams(): void {\n        if (this.generatorParamsContainer) {\n            this.generatorParamsContainer.style.display = 'none';\n            this.generatorParamsContainer.innerHTML = '';\n        }\n        this.currentGeneratorParams = null;\n    }\n\n    private createProgressIndicator(container: HTMLElement): void {\n        const progressContainer = document.createElement('div');\n        progressContainer.id = 'wav-progress-container';\n        progressContainer.className = 'progress-container';\n        progressContainer.style.display = 'none';\n\n        const spinner = document.createElement('div');\n        spinner.className = 'spinner';\n\n        const progressBar = document.createElement('div');\n        progressBar.className = 'progress-bar';\n\n        const progressFill = document.createElement('div');\n        progressFill.id = 'wav-progress-fill';\n        progressFill.className = 'progress-fill';\n\n        const progressText = document.createElement('span');\n        progressText.id = 'wav-progress-text';\n        progressText.className = 'progress-text';\n        progressText.textContent = '0%';\n\n        progressBar.appendChild(progressFill);\n        progressContainer.appendChild(spinner);\n        progressContainer.appendChild(progressBar);\n        progressContainer.appendChild(progressText);\n\n        this.appendControl(container, progressContainer);\n        this.progressContainer = progressContainer;\n        this.progressFill = progressFill;\n        this.progressText = progressText;\n    }\n\n    public showProgress(): void {\n        if (this.progressContainer) this.progressContainer.style.display = 'flex';\n    }\n\n    public hideProgress(): void {\n        if (this.progressContainer) this.progressContainer.style.display = 'none';\n    }\n\n    public updateProgress(percent: number): void {\n        if (this.progressFill) this.progressFill.style.width = `${percent}%`;\n        if (this.progressText) this.progressText.textContent = `${Math.round(percent)}%`;\n    }\n\n    public setPathChangeCallback(callback: (state: ReadingPathState) => void): void {\n        this.onPathChange = callback;\n    }\n\n    public setSynthModeChangeCallback(callback: (mode: SynthMode) => void): void {\n        this.onSynthModeChange = callback;\n    }\n\n    public setInterpSamplesChangeCallback(callback: (samples: number) => void): void {\n        this.onInterpSamplesChange = callback;\n    }\n\n    public setCarrierChangeCallback(callback: (carrier: CarrierType) => void): void {\n        this.onCarrierChange = callback;\n    }\n\n    public setFeedbackChangeCallback(callback: (amount: number) => void): void {\n        this.onFeedbackChange = callback;\n    }\n\n    public setMidiInputChangeCallback(callback: (id: string) => void): void {\n        this.onMidiInputChange = callback;\n    }\n\n    public setOctaveChangeCallback(callback: (octave: number) => void): void {\n        this.onOctaveChange = callback;\n    }\n\n    public setOctaveDoublingChangeCallback(callback: (state: OctaveDoublingState) => void): void {\n        this.onOctaveDoublingChange = callback;\n    }\n\n    public updateMidiInputs(inputs: { id: string, name: string }[]): void {\n        const currentSelection = this.midiSelect.value;\n        this.midiSelect.innerHTML = '';\n\n        if (inputs.length === 0) {\n            const opt = document.createElement('option');\n            opt.value = '';\n            opt.textContent = 'No Devices Found';\n            this.midiSelect.appendChild(opt);\n            this.midiSelect.disabled = true;\n        } else {\n            this.midiSelect.disabled = false;\n            for (const input of inputs) {\n                const opt = document.createElement('option');\n                opt.value = input.id;\n                opt.textContent = input.name;\n                this.midiSelect.appendChild(opt);\n            }\n\n            if (inputs.some(i => i.id === currentSelection)) {\n                this.midiSelect.value = currentSelection;\n            } else if (inputs.length > 0) {\n                this.midiSelect.selectedIndex = 0;\n                if (this.onMidiInputChange) {\n                    this.onMidiInputChange(this.midiSelect.value);\n                }\n            }\n        }\n    }\n\n    public setVolumeResolutionChangeCallback(callback: (resolution: VolumeResolution) => void): void {\n        this.onVolumeResolutionChange = callback;\n    }\n\n    public setSpectralDataChangeCallback(callback: (dataSet: string) => void): void {\n        this.onSpectralDataChange = callback;\n    }\n\n    public setWavUploadCallback(callback: (files: FileList) => void): void {\n        this.onWavUpload = callback;\n    }\n\n    public setLFOParamChangeCallback(callback: (index: number, param: string, value: any) => void): void {\n        this.onLFOParamChange = callback;\n    }\n\n    public setModulationRoutingChangeCallback(callback: (target: string, source: string) => void): void {\n        this.onModulationRoutingChange = callback;\n    }\n\n    public setGeneratorParamsChangeCallback(callback: (dataSet: string, params: GeneratorParams) => void): void {\n        this.onGeneratorParamsChange = callback;\n    }\n\n    public getCurrentGeneratorParams(): GeneratorParams | null {\n        return this.currentGeneratorParams;\n    }\n\n    public updateGeneratorParamsUI(dataSet: string, initialParams?: GeneratorParams): void {\n        if (['3d-julia', 'mandelbulb', 'menger-sponge', 'sine-plasma', 'game-of-life'].includes(dataSet)) {\n            this.showGeneratorParams(dataSet, initialParams);\n        } else {\n            this.hideGeneratorParams();\n        }\n    }\n\n    public showDynamicParam(label: string, min: number, max: number, value: number, step: number): void {\n        if (!this.dynamicParamSlider || !this.dynamicParamContainer) return;\n\n        const labelEl = document.getElementById('dynamic-param-label');\n        const valueDisplay = document.getElementById('dynamic-param-value');\n\n        if (labelEl) labelEl.textContent = label;\n\n        this.dynamicParamSlider.min = String(min);\n        this.dynamicParamSlider.max = String(max);\n        this.dynamicParamSlider.value = String(value);\n        this.dynamicParamSlider.step = String(step);\n\n        if (valueDisplay) {\n            valueDisplay.textContent = step >= 1 ? String(Math.round(value)) : value.toFixed(2);\n        }\n\n        this.dynamicParamContainer.style.display = 'block';\n    }\n\n    public hideDynamicParam(): void {\n        if (this.dynamicParamContainer) {\n            this.dynamicParamContainer.style.display = 'none';\n        }\n    }\n\n    public getState(): ReadingPathState {\n        return {\n            position: {\n                x: 0,\n                y: parseFloat(this.pathYSlider.value),\n                z: 0,\n            },\n            rotation: {\n                x: 0,\n                y: 0,\n                z: 0,\n            },\n            scanPosition: parseFloat(this.scanPositionSlider.value),\n            planeType: this.planeTypeSelect.value as PlaneType,\n            shapePhase: 0,\n        };\n    }\n\n    public updateScanPosition(pos: number): void {\n        this.scanPositionSlider.value = String(pos);\n        const display = document.getElementById('scan-pos-value');\n        if (display) display.textContent = pos.toFixed(2);\n\n        if (this.onPathChange) {\n            this.onPathChange(this.getState());\n        }\n    }\n\n    public updatePathY(y: number): void {\n        this.pathYSlider.value = String(y);\n        const display = document.getElementById('path-y-value');\n        if (display) display.textContent = y.toFixed(2);\n\n        if (this.onPathChange) {\n            this.onPathChange(this.getState());\n        }\n    }\n\n    public addSpectralDataOption(value: string, label: string): void {\n        const existingOption = Array.from(this.spectralDataSelect.options).find(\n            opt => opt.value === value\n        );\n\n        if (!existingOption) {\n            const option = document.createElement('option');\n            option.value = value;\n            option.textContent = label;\n            this.spectralDataSelect.appendChild(option);\n        }\n\n        this.spectralDataSelect.value = value;\n        const event = new Event('change');\n        this.spectralDataSelect.dispatchEvent(event);\n    }\n\n    public setVolumeDensity(resolution: VolumeResolution): void {\n        this.densityXSlider.value = String(resolution.x);\n        this.densityYSlider.value = String(resolution.y);\n        this.densityZSlider.value = String(resolution.z);\n        const xDisplay = document.getElementById('density-x-value');\n        const yDisplay = document.getElementById('density-y-value');\n        const zDisplay = document.getElementById('density-z-value');\n        if (xDisplay) xDisplay.textContent = String(Math.round(resolution.x));\n        if (yDisplay) yDisplay.textContent = String(Math.round(resolution.y));\n        if (zDisplay) zDisplay.textContent = String(Math.round(resolution.z));\n    }\n}\n","\nexport class SpectrogramWebGL {\n    private canvas: HTMLCanvasElement;\n    private gl: WebGL2RenderingContext;\n    private program!: WebGLProgram;\n    private texture!: WebGLTexture;\n    private vao!: WebGLVertexArrayObject;\n\n    private titleElement: HTMLElement | null = null;\n    private width: number = 320;\n    private height: number = 320;\n    private dpr: number = 1;\n\n    private mode: 'SCANLINE' | 'AUDIO_OUTPUT' = 'AUDIO_OUTPUT';\n\n    private writeIndex: number = 0;\n    private historyHeight: number = 512;\n    private textureWidth: number = 2048;\n\n    private vertexShaderSource = `#version 300 es\n        layout(location = 0) in vec2 a_position;\n        out vec2 v_uv;\n        void main() {\n            v_uv = a_position * 0.5 + 0.5;\n            gl_Position = vec4(a_position, 0.0, 1.0);\n        }\n    `;\n\n    private fragmentShaderSource = `#version 300 es\n        precision highp float;\n        uniform sampler2D u_history;\n        uniform float u_writeIndex;\n        uniform float u_historyHeight;\n        uniform float u_dataWidth;\n        uniform float u_textureWidth;\n        uniform int u_mode;\n        in vec2 v_uv;\n        out vec4 outColor;\n\n        vec3 hsl2rgb(vec3 c) {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0);\n            return c.z + c.y * (rgb-0.5) * (1.0-abs(2.0*c.z-1.0));\n        }\n\n        void main() {\n            // Roll coords: latest row at bottom (v_uv.y = 0)\n            float y = mod(u_writeIndex - 1.0 - (v_uv.y * u_historyHeight), u_historyHeight);\n            float normY = (y + 0.5) / u_historyHeight;\n\n            float x = v_uv.x;\n            if (u_mode == 0) {\n                // Audio log scale\n                float factor = 100.0;\n                x = (pow(factor, x) - 1.0) / (factor - 1.0);\n            }\n\n            // Map [0..1] range to active portion of texture\n            float normX = (x * u_dataWidth + 0.5) / u_textureWidth;\n            float val = texture(u_history, vec2(normX, normY)).r;\n\n            vec3 color;\n            if (u_mode == 0) {\n                float hue = v_uv.x * 0.85;\n                float intensity = (val + 100.0) / 70.0;\n                intensity = clamp(intensity, 0.0, 1.0);\n                float lightness = 0.05 + intensity * 0.55;\n                color = hsl2rgb(vec3(hue, 0.9, lightness));\n            } else {\n                float hue = 0.35 + val * 0.15;\n                float lightness = 0.05 + val * 0.50;\n                color = hsl2rgb(vec3(hue, 0.8, lightness));\n            }\n\n            outColor = vec4(color, 1.0);\n        }\n    `;\n\n    constructor(containerId: string) {\n        this.canvas = document.getElementById(containerId) as HTMLCanvasElement;\n        const gl = this.canvas.getContext('webgl2', {\n            preserveDrawingBuffer: true,\n            alpha: false,\n            antialias: false\n        });\n        if (!gl) throw new Error('WebGL2 not supported');\n        this.gl = gl;\n\n        const visContent = this.canvas.closest('.vis-content');\n        if (visContent) {\n            const visGroup = visContent.closest('.vis-group');\n            if (visGroup) {\n                this.titleElement = visGroup.querySelector('.vis-header');\n            }\n        }\n        this.updateTitle();\n\n        this.program = this.createProgram(this.vertexShaderSource, this.fragmentShaderSource);\n        this.initBuffers();\n        this.initTexture();\n        this.resize();\n\n        window.addEventListener('resize', () => this.resize());\n\n        this.canvas.addEventListener('click', () => {\n            this.mode = this.mode === 'SCANLINE' ? 'AUDIO_OUTPUT' : 'SCANLINE';\n            this.updateTitle();\n        });\n    }\n\n    private createShader(type: number, source: string): WebGLShader {\n        const shader = this.gl.createShader(type)!;\n        this.gl.shaderSource(shader, source);\n        this.gl.compileShader(shader);\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n            console.error('Shader error:', this.gl.getShaderInfoLog(shader));\n            throw new Error('Shader compilation failed');\n        }\n        return shader;\n    }\n\n    private createProgram(vsSource: string, fsSource: string): WebGLProgram {\n        const vs = this.createShader(this.gl.VERTEX_SHADER, vsSource);\n        const fs = this.createShader(this.gl.FRAGMENT_SHADER, fsSource);\n        const program = this.gl.createProgram()!;\n        this.gl.attachShader(program, vs);\n        this.gl.attachShader(program, fs);\n        this.gl.linkProgram(program);\n        if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {\n            console.error('Program error:', this.gl.getProgramInfoLog(program));\n            throw new Error('Program linking failed');\n        }\n        return program;\n    }\n\n    private initBuffers(): void {\n        const gl = this.gl;\n        const positions = new Float32Array([\n            -1.0, -1.0, 1.0, -1.0, -1.0, 1.0,\n            -1.0, 1.0, 1.0, -1.0, 1.0, 1.0,\n        ]);\n\n        const vbo = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n        this.vao = gl.createVertexArray()!;\n        gl.bindVertexArray(this.vao);\n        gl.enableVertexAttribArray(0); // layout(location = 0)\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n        gl.bindVertexArray(null);\n    }\n\n    private initTexture(): void {\n        const gl = this.gl;\n        this.texture = gl.createTexture()!;\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n        gl.getExtension('EXT_color_buffer_float');\n        gl.getExtension('OES_texture_float_linear');\n\n        gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.R32F, this.textureWidth, this.historyHeight, 0, gl.RED, gl.FLOAT, null);\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n    }\n\n    private updateTitle(): void {\n        if (!this.titleElement) return;\n        this.titleElement.textContent = this.mode === 'AUDIO_OUTPUT'\n            ? 'Spectrogram'\n            : 'ReadLine Output';\n    }\n\n    public resize(): void {\n        const width = this.canvas.clientWidth;\n        const height = this.canvas.clientWidth;\n        this.dpr = window.devicePixelRatio || 1;\n\n        if (width === 0) return;\n\n        this.canvas.width = width * this.dpr;\n        this.canvas.height = height * this.dpr;\n        this.width = width * this.dpr;\n        this.height = height * this.dpr;\n\n        this.gl.viewport(0, 0, this.width, this.height);\n    }\n\n    public update(scanlineData: Float32Array, audioDataLeft?: Float32Array): void {\n        if (!scanlineData) return;\n\n        const gl = this.gl;\n\n        // Safety: ensure dimensions are valid\n        if (this.width === 0) {\n            this.resize();\n            if (this.width === 0) return;\n        }\n\n        let uploadData: Float32Array;\n        let isAudio = false;\n\n        if (this.mode === 'AUDIO_OUTPUT' && audioDataLeft) {\n            uploadData = audioDataLeft;\n            isAudio = true;\n        } else {\n            const dataWidth = scanlineData.length / 4;\n            uploadData = new Float32Array(dataWidth);\n            for (let i = 0; i < dataWidth; i++) {\n                uploadData[i] = scanlineData[i * 4];\n            }\n        }\n\n        const dataWidth = Math.min(uploadData.length, this.textureWidth);\n        if (dataWidth === 0) return;\n\n        // Upload to current write row\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, this.writeIndex, dataWidth, 1, gl.RED, gl.FLOAT, uploadData, 0);\n\n        // Advance write index\n        this.writeIndex = (this.writeIndex + 1) % this.historyHeight;\n\n        // Draw quad\n        gl.clearColor(0, 0, 0, 1);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n\n        gl.useProgram(this.program);\n        gl.bindVertexArray(this.vao);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n        gl.uniform1i(gl.getUniformLocation(this.program, 'u_history'), 0);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_writeIndex'), this.writeIndex);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_historyHeight'), this.historyHeight);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_dataWidth'), dataWidth);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_textureWidth'), this.textureWidth);\n        gl.uniform1i(gl.getUniformLocation(this.program, 'u_mode'), isAudio ? 0 : 1);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n}\n","\nexport class StereoScopeWebGL {\n    private canvas: HTMLCanvasElement;\n    private gl: WebGL2RenderingContext;\n    private program!: WebGLProgram;\n    private fadeProgram!: WebGLProgram;\n    private vao!: WebGLVertexArrayObject;\n    private quadVAO!: WebGLVertexArrayObject;\n    private vboL!: WebGLBuffer;\n    private vboR!: WebGLBuffer;\n\n    private titleElement: HTMLElement | null = null;\n    private width: number = 320;\n    private height: number = 320;\n    private dpr: number = 1;\n\n    public mode: 'lissajous' | 'channels' = 'channels';\n\n    private vertexShaderSource = `#version 300 es\n        layout(location = 0) in float a_sample;\n        layout(location = 1) in float a_other_sample; \n        \n        uniform int u_mode; \n        uniform float u_numSamples;\n        \n        void main() {\n            float x, y;\n            float index = float(gl_VertexID);\n            \n            if (u_mode == 0) {\n                // Channels mode: Linear X mapping\n                x = (index / (u_numSamples - 1.0)) * 2.0 - 1.0;\n                y = a_sample * 0.8;\n            } else {\n                // Lissajous mode: X=L, Y=R\n                x = a_sample * 0.8;\n                y = -a_other_sample * 0.8;\n            }\n            \n            gl_Position = vec4(x, y, 0.0, 1.0);\n        }\n    `;\n\n    private fragmentShaderSource = `#version 300 es\n        precision highp float;\n        uniform vec4 u_color;\n        out vec4 outColor;\n        void main() {\n            outColor = u_color;\n        }\n    `;\n\n    private fadeVertexShaderSource = `#version 300 es\n        layout(location = 0) in vec2 a_position;\n        void main() {\n            gl_Position = vec4(a_position, 0.0, 1.0);\n        }\n    `;\n\n    private fadeFragmentShaderSource = `#version 300 es\n        precision highp float;\n        uniform float u_alpha;\n        out vec4 outColor;\n        void main() {\n            outColor = vec4(0.0, 0.0, 0.0, u_alpha);\n        }\n    `;\n\n    constructor(containerId: string) {\n        this.canvas = document.getElementById(containerId) as HTMLCanvasElement;\n        const gl = this.canvas.getContext('webgl2', {\n            antialias: true,\n            alpha: false,\n            preserveDrawingBuffer: true\n        });\n        if (!gl) throw new Error('WebGL2 not supported');\n        this.gl = gl;\n\n        const visContent = this.canvas.closest('.vis-content');\n        if (visContent) {\n            const visGroup = visContent.closest('.vis-group');\n            if (visGroup) {\n                this.titleElement = visGroup.querySelector('.vis-header');\n            }\n        }\n        this.updateTitle();\n\n        this.program = this.createProgram(this.vertexShaderSource, this.fragmentShaderSource);\n        this.fadeProgram = this.createProgram(this.fadeVertexShaderSource, this.fadeFragmentShaderSource);\n\n        this.initBuffers();\n        this.resize();\n\n        window.addEventListener('resize', () => this.resize());\n\n        this.canvas.addEventListener('click', () => {\n            this.mode = this.mode === 'lissajous' ? 'channels' : 'lissajous';\n            this.updateTitle();\n        });\n    }\n\n    private createShader(type: number, source: string): WebGLShader {\n        const shader = this.gl.createShader(type)!;\n        this.gl.shaderSource(shader, source);\n        this.gl.compileShader(shader);\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n            console.error('Shader compile error:', this.gl.getShaderInfoLog(shader));\n            throw new Error('Shader compilation failed');\n        }\n        return shader;\n    }\n\n    private createProgram(vsSource: string, fsSource: string): WebGLProgram {\n        const vs = this.createShader(this.gl.VERTEX_SHADER, vsSource);\n        const fs = this.createShader(this.gl.FRAGMENT_SHADER, fsSource);\n        const program = this.gl.createProgram()!;\n        this.gl.attachShader(program, vs);\n        this.gl.attachShader(program, fs);\n        this.gl.linkProgram(program);\n        if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {\n            console.error('Program link error:', this.gl.getProgramInfoLog(program));\n            throw new Error('Program linking failed');\n        }\n        return program;\n    }\n\n    private initBuffers(): void {\n        const gl = this.gl;\n        this.vboL = gl.createBuffer()!;\n        this.vboR = gl.createBuffer()!;\n        this.vao = gl.createVertexArray()!;\n\n        // Fader quad\n        const quadVertices = new Float32Array([\n            -1, -1, 1, -1, -1, 1,\n            -1, 1, 1, -1, 1, 1,\n        ]);\n        const quadVBO = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, quadVBO);\n        gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);\n\n        this.quadVAO = gl.createVertexArray()!;\n        gl.bindVertexArray(this.quadVAO);\n        gl.enableVertexAttribArray(0);\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n        gl.bindVertexArray(null);\n    }\n\n    private updateTitle(): void {\n        if (!this.titleElement) return;\n        this.titleElement.textContent = this.mode === 'lissajous'\n            ? 'Vectorscope'\n            : 'Stereo Scope';\n    }\n\n    private resize(): void {\n        const width = this.canvas.clientWidth;\n        const height = this.canvas.clientWidth;\n        this.dpr = window.devicePixelRatio || 1;\n\n        if (width === 0) return;\n\n        this.canvas.width = width * this.dpr;\n        this.canvas.height = height * this.dpr;\n        this.width = width * this.dpr;\n        this.height = height * this.dpr;\n\n        this.gl.viewport(0, 0, this.width, this.height);\n\n        // Initial clear\n        this.gl.clearColor(0, 0, 0, 1);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n    }\n\n    public draw(left: Float32Array, right: Float32Array): void {\n        if (this.width === 0) {\n            this.resize();\n            if (this.width === 0) return;\n        }\n\n        const gl = this.gl;\n        const numSamples = left.length;\n\n        // 1. Apply persistence fade\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n        gl.useProgram(this.fadeProgram);\n        gl.bindVertexArray(this.quadVAO);\n        gl.uniform1f(gl.getUniformLocation(this.fadeProgram, 'u_alpha'), 0.2);\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // 2. Draw active waveforms\n        gl.useProgram(this.program);\n        gl.bindVertexArray(this.vao);\n\n        const modeLoc = gl.getUniformLocation(this.program, 'u_mode');\n        const colorLoc = gl.getUniformLocation(this.program, 'u_color');\n        const samplesLoc = gl.getUniformLocation(this.program, 'u_numSamples');\n\n        gl.uniform1f(samplesLoc, numSamples);\n\n        if (this.mode === 'channels') {\n            gl.uniform1i(modeLoc, 0);\n\n            // Left channel\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vboL);\n            gl.bufferData(gl.ARRAY_BUFFER, left, gl.DYNAMIC_DRAW);\n            gl.enableVertexAttribArray(0);\n            gl.vertexAttribPointer(0, 1, gl.FLOAT, false, 0, 0);\n            gl.disableVertexAttribArray(1);\n\n            gl.uniform4f(colorLoc, 0.6, 0.6, 0.6, 1.0);\n            gl.drawArrays(gl.LINE_STRIP, 0, numSamples);\n\n            // Right channel\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vboR);\n            gl.bufferData(gl.ARRAY_BUFFER, right, gl.DYNAMIC_DRAW);\n            gl.enableVertexAttribArray(0);\n            gl.vertexAttribPointer(0, 1, gl.FLOAT, false, 0, 0);\n\n            gl.uniform4f(colorLoc, 1.0, 0.3, 0.3, 1.0);\n            gl.drawArrays(gl.LINE_STRIP, 0, numSamples);\n        } else {\n            gl.uniform1i(modeLoc, 1);\n\n            // Vectorscope/Lissajous\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vboL);\n            gl.bufferData(gl.ARRAY_BUFFER, left, gl.DYNAMIC_DRAW);\n            gl.enableVertexAttribArray(0);\n            gl.vertexAttribPointer(0, 1, gl.FLOAT, false, 0, 0);\n\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vboR);\n            gl.bufferData(gl.ARRAY_BUFFER, right, gl.DYNAMIC_DRAW);\n            gl.enableVertexAttribArray(1);\n            gl.vertexAttribPointer(1, 1, gl.FLOAT, false, 0, 0);\n\n            gl.uniform4f(colorLoc, 0.0, 1.0, 0.6, 1.0);\n            gl.drawArrays(gl.LINE_STRIP, 0, numSamples);\n        }\n\n        gl.disable(gl.BLEND);\n        gl.bindVertexArray(null);\n    }\n}\n","\n// Audio Engine for Spectral Table\n// Handles AudioContext, Worklet loading, and synthesis modes (spectral/wavetable)\n\nimport { SynthMode } from '../types';\n\n// Processor code for spectral (additive/iFFT) synthesis\nconst SPECTRAL_PROCESSOR_CODE = `\n// Band-limiting constants\nconst NYQUIST_LIMIT = 0.45;  // 0.45 = 45% of Nyquist (conservative margin)\nconst ROLLOFF_MODE = 2;       // 0=hard, 1=smoothstep, 2=cosine, 3=hann\n\n// Rolloff functions: t in [0,1], returns attenuation factor [0,1]\n// t=0 means at limit edge (full signal), t=1 means at Nyquist (zero signal)\nfunction rolloffHard(t) {\n    return t < 0.001 ? 1.0 : 0.0;\n}\nfunction rolloffSmoothstep(t) {\n    const x = 1.0 - t;\n    return x * x * (3.0 - 2.0 * x);\n}\nfunction rolloffCosine(t) {\n    return 0.5 * (1.0 + Math.cos(t * Math.PI));\n}\nfunction rolloffHann(t) {\n    return 0.5 * (1.0 - Math.cos((1.0 - t) * Math.PI));\n}\n\nfunction computeRolloff(normalizedFreq, mode) {\n    // normalizedFreq = freq / nyquist, range [0, 1+]\n    if (normalizedFreq <= NYQUIST_LIMIT) return 1.0;\n    if (normalizedFreq >= 1.0) return 0.0;\n    \n    // t: 0 at limit, 1 at nyquist\n    const t = (normalizedFreq - NYQUIST_LIMIT) / (1.0 - NYQUIST_LIMIT);\n    \n    switch (mode) {\n        case 0: return rolloffHard(t);\n        case 1: return rolloffSmoothstep(t);\n        case 2: return rolloffCosine(t);\n        case 3: return rolloffHann(t);\n        default: return rolloffSmoothstep(t);\n    }\n}\n\n// Default interpolation samples (can be changed dynamically)\nconst DEFAULT_INTERP_SAMPLES = 64;\n\nclass SpectralProcessor extends AudioWorkletProcessor {\n    constructor() {\n        super();\n        // Interpolation setting\n        this.interpSamples = DEFAULT_INTERP_SAMPLES;\n        \n        // Current working spectral data (interpolated)\n        this.spectralData = new Float32Array(1024 * 4);\n        // Previous frame (start of interpolation)\n        this.prevData = new Float32Array(1024 * 4);\n        // Target frame (end of interpolation)  \n        this.targetData = new Float32Array(1024 * 4);\n        \n        // Phase accumulator per bin - runs continuously, never reset\n        this.phaseAccumulators = new Float32Array(1024);\n        \n        // Per-bin phase offset targets (from spectral data)\n        // We interpolate toward these to avoid discontinuities\n        this.prevPhaseOffsets = new Float32Array(1024);\n        this.targetPhaseOffsets = new Float32Array(1024);\n        this.currentPhaseOffsets = new Float32Array(1024);\n        \n        this.frequencyMultiplier = 1.0;\n        \n        // Octave Doubling: layering octaves\n        this.octaveLow = 0;      // 0-10 octaves below\n        this.octaveHigh = 0;     // 0-10 octaves above\n        this.octaveMult = 0.5;   // Volume decay per octave\n        \n        // Extra phase accumulators for octave doubling (10 low + 10 high per bin)\n        this.harmonicPhases = new Float32Array(1024 * 20); // This will be resized based on numPoints\n        \n        // Interpolation state: 0 = at prev, 1 = at target\n        this.interpT = 1.0;\n        // Recalculate step based on current interpSamples\n        this.interpStep = this.interpSamples > 0 ? 1.0 / (this.interpSamples + 1) : 1.0;\n        \n        this.port.onmessage = (e) => {\n            if (e.data.type === 'spectral-data') {\n                const data = e.data.data;\n                const numPoints = data.length / 4;\n                \n                // Resize harmonicPhases if numPoints changed\n                if (this.harmonicPhases.length !== numPoints * 20) {\n                    this.harmonicPhases = new Float32Array(numPoints * 20);\n                }\n\n                if (this.interpSamples === 0) {\n                    // No interpolation - instant update\n                    this.spectralData.set(data);\n                    this.targetData.set(data);\n                    // Extract phase offsets\n                    for (let bin = 0; bin < numPoints; bin++) {\n                        const offset = data[bin * 4 + 1];\n                        this.currentPhaseOffsets[bin] = offset;\n                        this.targetPhaseOffsets[bin] = offset;\n                    }\n                } else {\n                    // Snapshot current state as previous\n                    this.prevData.set(this.spectralData);\n                    this.prevPhaseOffsets.set(this.currentPhaseOffsets);\n                    \n                    // New incoming data is target\n                    this.targetData.set(data);\n                    for (let bin = 0; bin < numPoints; bin++) {\n                        this.targetPhaseOffsets[bin] = data[bin * 4 + 1];\n                    }\n                    \n                    // Reset interpolation\n                    this.interpT = 0.0;\n                }\n            } else if (e.data.type === 'frequency-multiplier') {\n                this.frequencyMultiplier = e.data.value;\n            } else if (e.data.type === 'octave-doubling') {\n                this.octaveLow = e.data.low;\n                this.octaveHigh = e.data.high;\n                this.octaveMult = e.data.multiplier;\n            } else if (e.data.type === 'interp-samples') {\n                this.interpSamples = e.data.value;\n                this.interpStep = this.interpSamples > 0 ? 1.0 / (this.interpSamples + 1) : 1.0;\n            }\n        };\n    }\n\n    process(inputs, outputs, parameters) {\n        const output = outputs[0];\n        const channelL = output[0];\n        const channelR = output[1];\n        \n        const numPoints = this.spectralData.length / 4;\n        const nyquist = sampleRate * 0.5;\n        const PI2_SR = (2 * Math.PI) / sampleRate;\n        const PI2 = 2 * Math.PI;\n        \n        for (let i = 0; i < channelL.length; i++) {\n            // Per-sample interpolation advance (skip if disabled)\n            if (this.interpSamples > 0 && this.interpT < 1.0) {\n                this.interpT += this.interpStep;\n                if (this.interpT > 1.0) this.interpT = 1.0;\n                \n                const t = this.interpT;\n                const invT = 1.0 - t;\n                \n                // Lerp all spectral data values (mag, custom1, custom2 - not phase offset)\n                for (let j = 0; j < this.spectralData.length; j++) {\n                    this.spectralData[j] = this.prevData[j] * invT + this.targetData[j] * t;\n                }\n                \n                // Lerp phase offsets separately for phase continuity\n                for (let bin = 0; bin < numPoints; bin++) {\n                    this.currentPhaseOffsets[bin] = \n                        this.prevPhaseOffsets[bin] * invT + this.targetPhaseOffsets[bin] * t;\n                }\n            }\n            \n            let sumL = 0;\n            let sumR = 0;\n            \n            for (let bin = 0; bin < numPoints; bin++) {\n                const idx = bin * 4;\n                const mag = this.spectralData[idx];\n                // Phase offset is now read from interpolated array, not spectralData\n                const phaseOffset = this.currentPhaseOffsets[bin];\n                const custom1 = this.spectralData[idx + 2];\n                \n                if (mag < 0.001) continue;\n\n                const minFreq = 20;\n                const maxFreq = 20000;\n                const normalizedBin = bin / numPoints;\n                const baseFreq = minFreq + (maxFreq - minFreq) * normalizedBin;\n                const freq = baseFreq * this.frequencyMultiplier;\n                \n                // Band-limiting: skip or attenuate bins above Nyquist threshold\n                const normalizedFreq = freq / nyquist;\n                if (normalizedFreq >= 1.0) continue;  // Hard cutoff at Nyquist\n                \n                const rolloffGain = computeRolloff(normalizedFreq, ROLLOFF_MODE);\n                if (rolloffGain < 0.001) continue;  // Skip negligible contributions\n                \n                const db = mag * 60 - 60;\n                const linearMag = Math.pow(10, db / 20) * rolloffGain;\n                \n                const p = (custom1 - 0.5) * 2;\n                const baseGainL = Math.min(1, 1 - p) * linearMag;\n                const baseGainR = Math.min(1, 1 + p) * linearMag;\n                \n                // Helper to generate oscillator at given frequency with gain\n                const generateOsc = (oscFreq, gain, phaseIdx) => {\n                    if (gain < 0.001) return;\n                    const nf = oscFreq / nyquist;\n                    if (nf >= 1.0) return;\n                    const rf = computeRolloff(nf, ROLLOFF_MODE);\n                    if (rf < 0.001) return;\n                    \n                    this.harmonicPhases[phaseIdx] += (oscFreq * PI2_SR);\n                    if (this.harmonicPhases[phaseIdx] > PI2) {\n                        this.harmonicPhases[phaseIdx] -= PI2;\n                    }\n                    const sample = Math.sin(this.harmonicPhases[phaseIdx] + phaseOffset * PI2);\n                    sumL += sample * baseGainL * gain * rf;\n                    sumR += sample * baseGainR * gain * rf;\n                };\n                \n                // Base oscillator (fundamental)\n                this.phaseAccumulators[bin] += (freq * PI2_SR);\n                if (this.phaseAccumulators[bin] > PI2) {\n                    this.phaseAccumulators[bin] -= PI2;\n                }\n                const currentPhase = this.phaseAccumulators[bin] + (phaseOffset * PI2);\n                const sample = Math.sin(currentPhase);\n                sumL += sample * baseGainL;\n                sumR += sample * baseGainR;\n                \n                // Low octaves (doubling below)\n                let harmGain = this.octaveMult;\n                for (let h = 1; h <= this.octaveLow; h++) {\n                    const harmFreq = freq / Math.pow(2, h);\n                    if (harmFreq < 20) break;\n                    const phaseIdx = bin * 20 + (h - 1);\n                    generateOsc(harmFreq, harmGain, phaseIdx);\n                    harmGain *= this.octaveMult;\n                }\n                \n                // High octaves (doubling above)\n                harmGain = this.octaveMult;\n                for (let h = 1; h <= this.octaveHigh; h++) {\n                    const harmFreq = freq * Math.pow(2, h);\n                    const phaseIdx = bin * 20 + 10 + (h - 1);\n                    generateOsc(harmFreq, harmGain, phaseIdx);\n                    harmGain *= this.octaveMult;\n                }\n            }\n            \n            const scale = 0.1; \n            channelL[i] = sumL * scale;\n            channelR[i] = sumR * scale;\n        }\n        \n        return true;\n    }\n}\nregisterProcessor('spectral-processor', SpectralProcessor);\n`;\n\n// Processor code for wavetable AM synthesis with feedback\n// Carrier wave (sine/saw/square/tri) modulated by reading line magnitudes\n// Magnitude 0 = silence, Magnitude 1 = full carrier amplitude\n// Feedback: previous output mixed back into carrier for evolving timbres\nconst WAVETABLE_PROCESSOR_CODE = `\nconst DEFAULT_INTERP_SAMPLES = 128;\n\nclass WavetableProcessor extends AudioWorkletProcessor {\n    constructor() {\n        super();\n        // Interpolation setting\n        this.interpSamples = DEFAULT_INTERP_SAMPLES;\n        \n        this.envelope = new Float32Array(1024);     // Current interpolated envelope\n        this.prevEnvelope = new Float32Array(1024); // Previous envelope\n        this.targetEnvelope = new Float32Array(1024); // Target envelope\n        this.envelopeSize = 64;\n        this.phase = 0;           // Carrier phase (0-1)\n        this.envPhase = 0;        // Envelope read position (0-1)\n        this.frequency = 220;     // Carrier frequency Hz\n        this.carrierType = 0;     // 0=sine, 1=saw, 2=square, 3=triangle\n        this.feedback = 0;        // Feedback amount 0-1\n        this.lastSample = 0;      // Previous output for feedback\n        \n        // Octave Doubling: octave layering\n        this.octaveLow = 0;    // 0-10 octaves below\n        this.octaveHigh = 0;   // 0-10 octaves above\n        this.octaveMult = 0.5; // Volume decay per octave\n        \n        // Octave doubling phases (10 low + 10 high)\n        this.harmonicPhases = new Float32Array(20);\n        this.harmonicEnvPhases = new Float32Array(20);\n        \n        // Interpolation state\n        this.interpT = 1.0;\n        this.interpStep = this.interpSamples > 0 ? 1.0 / (this.interpSamples + 1) : 1.0;\n        \n        this.port.onmessage = (e) => {\n            if (e.data.type === 'spectral-data') {\n                const data = e.data.data;\n                const numPoints = data.length / 4;\n                this.envelopeSize = numPoints;\n                \n                let maxMag = 0;\n                for (let i = 0; i < numPoints; i++) {\n                    const mag = data[i * 4];\n                    if (mag > maxMag) maxMag = mag;\n                }\n                \n                const scale = maxMag > 0.001 ? 1.0 / maxMag : 1.0;\n                \n                if (this.interpSamples === 0) {\n                    // No interpolation - instant update\n                    for (let i = 0; i < numPoints; i++) {\n                        this.envelope[i] = data[i * 4] * scale;\n                        this.targetEnvelope[i] = this.envelope[i];\n                    }\n                } else {\n                    // Snapshot current envelope as previous\n                    this.prevEnvelope.set(this.envelope);\n                    \n                    for (let i = 0; i < numPoints; i++) {\n                        this.targetEnvelope[i] = data[i * 4] * scale;\n                    }\n                    \n                    // Reset interpolation\n                    this.interpT = 0.0;\n                }\n            } else if (e.data.type === 'frequency') {\n                this.frequency = e.data.value;\n            } else if (e.data.type === 'carrier') {\n                this.carrierType = e.data.value;\n            } else if (e.data.type === 'feedback') {\n                this.feedback = e.data.value;\n            } else if (e.data.type === 'octave-doubling') {\n                this.octaveLow = e.data.low;\n                this.octaveHigh = e.data.high;\n                this.octaveMult = e.data.multiplier;\n            } else if (e.data.type === 'interp-samples') {\n                this.interpSamples = e.data.value;\n                this.interpStep = this.interpSamples > 0 ? 1.0 / (this.interpSamples + 1) : 1.0;\n            }\n        };\n    }\n    \n    // Generate carrier waveform sample at phase (0-1)\n    carrier(phase, type) {\n        switch (type) {\n            case 0: // Sine\n                return Math.sin(phase * 2 * Math.PI);\n            case 1: // Saw (falling)\n                return 1 - 2 * phase;\n            case 2: // Square\n                return phase < 0.5 ? 1 : -1;\n            case 3: // Triangle\n                return phase < 0.5 \n                    ? 4 * phase - 1 \n                    : 3 - 4 * phase;\n            default:\n                return Math.sin(phase * 2 * Math.PI);\n        }\n    }\n\n    process(inputs, outputs, parameters) {\n        const output = outputs[0];\n        const channelL = output[0];\n        const channelR = output[1];\n        \n        if (this.envelopeSize < 2) {\n            for (let i = 0; i < channelL.length; i++) {\n                channelL[i] = 0;\n                channelR[i] = 0;\n            }\n            return true;\n        }\n        \n        const carrierPhaseInc = this.frequency / sampleRate;\n        const envPhaseInc = carrierPhaseInc;\n        const nyquist = sampleRate * 0.5;\n        \n        for (let i = 0; i < channelL.length; i++) {\n            // Per-sample interpolation advance (skip if disabled)\n            if (this.interpSamples > 0 && this.interpT < 1.0) {\n                this.interpT += this.interpStep;\n                if (this.interpT > 1.0) this.interpT = 1.0;\n                \n                const t = this.interpT;\n                const invT = 1.0 - t;\n                for (let j = 0; j < this.envelopeSize; j++) {\n                    this.envelope[j] = this.prevEnvelope[j] * invT + this.targetEnvelope[j] * t;\n                }\n            }\n            \n            // Get envelope with linear interpolation\n            const envPos = this.envPhase * this.envelopeSize;\n            const envIdx0 = Math.floor(envPos) % this.envelopeSize;\n            const envIdx1 = (envIdx0 + 1) % this.envelopeSize;\n            const envFrac = envPos - Math.floor(envPos);\n            const amplitude = this.envelope[envIdx0] * (1 - envFrac) + this.envelope[envIdx1] * envFrac;\n            \n            // Get base carrier sample\n            let carrierSample = this.carrier(this.phase, this.carrierType);\n            \n            // Mix in feedback: blend carrier with previous output\n            // feedback=0: pure carrier, feedback=1: 50/50 mix with previous\n            if (this.feedback > 0) {\n                carrierSample = carrierSample * (1 - this.feedback * 0.5) + this.lastSample * this.feedback * 0.5;\n            }\n            \n            // AM synthesis: carrier * envelope\n            let totalSample = carrierSample * amplitude;\n            \n            // Add low octaves (doubling below)\n            let harmGain = this.octaveMult;\n            for (let h = 1; h <= this.octaveLow; h++) {\n                const harmFreq = this.frequency / Math.pow(2, h);\n                if (harmFreq < 20) break;\n                const phaseIdx = h - 1;\n                const harmPhaseInc = harmFreq / sampleRate;\n                \n                let harmCarrier = this.carrier(this.harmonicPhases[phaseIdx], this.carrierType);\n                \n                // Get envelope at harmonic's position\n                const harmEnvPos = this.harmonicEnvPhases[phaseIdx] * this.envelopeSize;\n                const hEnvIdx0 = Math.floor(harmEnvPos) % this.envelopeSize;\n                const hEnvIdx1 = (hEnvIdx0 + 1) % this.envelopeSize;\n                const hEnvFrac = harmEnvPos - Math.floor(harmEnvPos);\n                const harmAmp = this.envelope[hEnvIdx0] * (1 - hEnvFrac) + this.envelope[hEnvIdx1] * hEnvFrac;\n                \n                totalSample += harmCarrier * harmAmp * harmGain;\n                \n                // Advance harmonic phases\n                this.harmonicPhases[phaseIdx] += harmPhaseInc;\n                if (this.harmonicPhases[phaseIdx] >= 1.0) this.harmonicPhases[phaseIdx] -= 1.0;\n                this.harmonicEnvPhases[phaseIdx] += harmPhaseInc;\n                if (this.harmonicEnvPhases[phaseIdx] >= 1.0) this.harmonicEnvPhases[phaseIdx] -= 1.0;\n                \n                harmGain *= this.octaveMult;\n            }\n            \n            // Add high octaves (doubling above)\n            harmGain = this.octaveMult;\n            for (let h = 1; h <= this.octaveHigh; h++) {\n                const harmFreq = this.frequency * Math.pow(2, h);\n                if (harmFreq >= nyquist) break;\n                const phaseIdx = 10 + (h - 1);\n                const harmPhaseInc = harmFreq / sampleRate;\n                \n                let harmCarrier = this.carrier(this.harmonicPhases[phaseIdx], this.carrierType);\n                \n                // Get envelope at harmonic's position\n                const harmEnvPos = this.harmonicEnvPhases[phaseIdx] * this.envelopeSize;\n                const hEnvIdx0 = Math.floor(harmEnvPos) % this.envelopeSize;\n                const hEnvIdx1 = (hEnvIdx0 + 1) % this.envelopeSize;\n                const hEnvFrac = harmEnvPos - Math.floor(harmEnvPos);\n                const harmAmp = this.envelope[hEnvIdx0] * (1 - hEnvFrac) + this.envelope[hEnvIdx1] * hEnvFrac;\n                \n                totalSample += harmCarrier * harmAmp * harmGain;\n                \n                // Advance harmonic phases\n                this.harmonicPhases[phaseIdx] += harmPhaseInc;\n                if (this.harmonicPhases[phaseIdx] >= 1.0) this.harmonicPhases[phaseIdx] -= 1.0;\n                this.harmonicEnvPhases[phaseIdx] += harmPhaseInc;\n                if (this.harmonicEnvPhases[phaseIdx] >= 1.0) this.harmonicEnvPhases[phaseIdx] -= 1.0;\n                \n                harmGain *= this.octaveMult;\n            }\n            \n            // Store for feedback\n            this.lastSample = totalSample;\n            \n            const gain = 0.5;\n            channelL[i] = totalSample * gain;\n            channelR[i] = totalSample * gain;\n            \n            // Advance phases\n            this.phase += carrierPhaseInc;\n            if (this.phase >= 1.0) this.phase -= 1.0;\n            \n            this.envPhase += envPhaseInc;\n            if (this.envPhase >= 1.0) this.envPhase -= 1.0;\n        }\n        \n        return true;\n    }\n}\nregisterProcessor('wavetable-processor', WavetableProcessor);\n`;\n\n// Processor code for subtractive noise filtering\n// Starts with white noise and applies a bank of notch filters\n// spectralData[0] (R) = Frequency\n// spectralData[1] (G) = Q/Bandwidth\nconst WHITENOISE_PROCESSOR_CODE = `\nconst DEFAULT_INTERP_SAMPLES = 64;\n\nclass WhitenoiseProcessor extends AudioWorkletProcessor {\n    constructor() {\n        super();\n        // Interpolation setting\n        this.interpSamples = DEFAULT_INTERP_SAMPLES;\n        \n        this.spectralData = new Float32Array(1024 * 4);\n        this.prevData = new Float32Array(1024 * 4);\n        this.targetData = new Float32Array(1024 * 4);\n        \n        // State Variable Filter states (low and band) per potential filter band\n        this.lowStates = new Float32Array(1024);\n        this.bandStates = new Float32Array(1024);\n        \n        // Octave doubling filter states (10 low + 10 high) per bin\n        this.harmLowStates = new Float32Array(1024 * 20);\n        this.harmBandStates = new Float32Array(1024 * 20);\n        \n        this.frequencyMultiplier = 1.0;\n        \n        // Octave Doubling: layering octaves for filter bands\n        this.octaveLow = 0;\n        this.octaveHigh = 0;\n        this.octaveMult = 0.5;\n        \n        this.interpT = 1.0;\n        this.interpStep = this.interpSamples > 0 ? 1.0 / (this.interpSamples + 1) : 1.0;\n        \n        this.port.onmessage = (e) => {\n            if (e.data.type === 'spectral-data') {\n                const data = e.data.data;\n                if (this.interpSamples === 0) {\n                    this.spectralData.set(data);\n                    this.targetData.set(data);\n                } else {\n                    this.prevData.set(this.spectralData);\n                    this.targetData.set(data);\n                    this.interpT = 0.0;\n                }\n            } else if (e.data.type === 'frequency-multiplier') {\n                this.frequencyMultiplier = e.data.value;\n            } else if (e.data.type === 'octave-doubling') {\n                this.octaveLow = e.data.low;\n                this.octaveHigh = e.data.high;\n                this.octaveMult = e.data.multiplier;\n            } else if (e.data.type === 'interp-samples') {\n                this.interpSamples = e.data.value;\n                this.interpStep = this.interpSamples > 0 ? 1.0 / (this.interpSamples + 1) : 1.0;\n            }\n        };\n    }\n\n    process(inputs, outputs, parameters) {\n        const output = outputs[0];\n        const channelL = output[0];\n        const channelR = output[1];\n        \n        const numPoints = this.spectralData.length / 4;\n        \n        for (let i = 0; i < channelL.length; i++) {\n            // Per-sample interpolation for smooth parameter changes\n            if (this.interpSamples > 0 && this.interpT < 1.0) {\n                this.interpT += this.interpStep;\n                if (this.interpT > 1.0) this.interpT = 1.0;\n                const t = this.interpT;\n                const invT = 1.0 - t;\n                for (let j = 0; j < this.spectralData.length; j++) {\n                    this.spectralData[j] = this.prevData[j] * invT + this.targetData[j] * t;\n                }\n            }\n            \n            // Source: White Noise\n            const noise = Math.random() * 2 - 1;\n            let sumSubtracted = 0;\n            \n            const minFreq = 20;\n            const maxFreq = 20000;\n            const freqRange = maxFreq - minFreq;\n            const binWidth = freqRange / numPoints;\n            \n            // Subtractive Filtering (Parallel Bank of SVF Band-Pass filters subtracted from noise)\n            for (let bin = 0; bin < numPoints; bin++) {\n                const idx = bin * 4;\n                const suppression = this.spectralData[idx]; // R channel: Suppression amount\n                const qVal = this.spectralData[idx + 1];    // G channel: Width multiplier\n                \n                if (suppression < 0.001) continue;\n                \n                // Frequency mapped to index (consistent with Spectral mode)\n                const normalizedBin = bin / numPoints;\n                const baseFreq = minFreq + freqRange * normalizedBin;\n                const freq = baseFreq * this.frequencyMultiplier;\n                \n                if (freq >= sampleRate * 0.48) continue; // Protect SVF stability\n                \n                // Bandwidth: one bin width scaled by Green channel\n                const widthInBins = qVal * 10 + 0.1;\n                const BW = binWidth * widthInBins;\n                \n                // Q = center_freq / bandwidth\n                const Q = Math.max(0.5, freq / BW);\n                \n                // SVF Coefficients (Standard SVF for subtraction)\n                const f = 2.0 * Math.sin(Math.PI * freq / sampleRate);\n                const q = 1.0 / Q;\n                \n                // SVF Update Equations for Band-Pass\n                this.lowStates[bin] = this.lowStates[bin] + f * this.bandStates[bin];\n                const high = noise - this.lowStates[bin] - q * this.bandStates[bin];\n                const band = f * high + this.bandStates[bin];\n                this.bandStates[bin] = band;\n                \n                // Add to parallel subtraction sum\n                sumSubtracted += band * suppression;\n            }\n            \n            const sample = noise - sumSubtracted;\n            \n            const gain = 0.01; // User adjusted gain\n            channelL[i] = sample * gain;\n            channelR[i] = sample * gain;\n        }\n        \n        return true;\n    }\n}\nregisterProcessor('whitenoise-processor', WhitenoiseProcessor);\n`;\n\nexport class AudioEngine {\n    private ctx: AudioContext;\n    private workletNode: AudioWorkletNode | null = null;\n    private isInitialized = false;\n    private currentMode: SynthMode = SynthMode.WAVETABLE; // Default to wavetable\n\n    // Buffers for visualization\n    private timeDomainDataL: Float32Array;\n    private timeDomainDataR: Float32Array;\n    private frequencyDataL: Float32Array;\n    private frequencyDataR: Float32Array;\n    private splitNode: ChannelSplitterNode;\n    private analyserL: AnalyserNode;\n    private analyserR: AnalyserNode;\n    private masterGain: GainNode;\n\n    // ADSR Envelope\n    public attack = 0.1;\n    public decay = 0.2;\n    public sustain = 0.5;\n    public release = 0.5;\n\n    private lastNoteTime = 0;\n    private isNoteOn = false;\n\n    // Wavetable frequency (Hz)\n    private wavetableFrequency = 220;\n\n    // Carrier waveform type (0=sine, 1=saw, 2=square, 3=triangle)\n    private carrierType = 0;\n\n    // Feedback amount (0-1)\n    private feedback = 0;\n\n    // Octave doubling state\n    private octaveLow = 0;\n    private octaveHigh = 0;\n    private octaveMult = 0.5;\n\n    constructor() {\n        this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n        // Setup analysis graph\n        this.splitNode = this.ctx.createChannelSplitter(2);\n        this.analyserL = this.ctx.createAnalyser();\n        this.analyserR = this.ctx.createAnalyser();\n\n        this.masterGain = this.ctx.createGain();\n        this.masterGain.gain.value = 0;\n\n        this.analyserL.fftSize = 2048;\n        this.analyserR.fftSize = 2048;\n\n        this.timeDomainDataL = new Float32Array(this.analyserL.fftSize);\n        this.timeDomainDataR = new Float32Array(this.analyserR.fftSize);\n        this.frequencyDataL = new Float32Array(this.analyserL.frequencyBinCount);\n        this.frequencyDataR = new Float32Array(this.analyserR.frequencyBinCount);\n\n        this.splitNode.connect(this.analyserL, 0);\n        this.splitNode.connect(this.analyserR, 1);\n    }\n\n    public async initialize(): Promise<void> {\n        if (this.isInitialized) return;\n\n        try {\n            // Load both processors\n            const spectralBlob = new Blob([SPECTRAL_PROCESSOR_CODE], { type: 'application/javascript' });\n            const wavetableBlob = new Blob([WAVETABLE_PROCESSOR_CODE], { type: 'application/javascript' });\n            const whitenoiseBlob = new Blob([WHITENOISE_PROCESSOR_CODE], { type: 'application/javascript' });\n\n            const spectralUrl = URL.createObjectURL(spectralBlob);\n            const wavetableUrl = URL.createObjectURL(wavetableBlob);\n            const whitenoiseUrl = URL.createObjectURL(whitenoiseBlob);\n\n            await this.ctx.audioWorklet.addModule(spectralUrl);\n            await this.ctx.audioWorklet.addModule(wavetableUrl);\n            await this.ctx.audioWorklet.addModule(whitenoiseUrl);\n\n            URL.revokeObjectURL(spectralUrl);\n            URL.revokeObjectURL(wavetableUrl);\n            URL.revokeObjectURL(whitenoiseUrl);\n\n            // Create initial worklet based on current mode\n            this.createWorkletNode();\n\n            this.isInitialized = true;\n            console.log(`✓ Audio Engine initialized (mode: ${this.currentMode})`);\n\n        } catch (e) {\n            console.error('Failed to initialize Audio Engine:', e);\n        }\n    }\n\n    private createWorkletNode(): void {\n        // Disconnect existing node if any\n        if (this.workletNode) {\n            this.workletNode.disconnect();\n            this.workletNode = null;\n        }\n\n        let processorName = 'wavetable-processor';\n        if (this.currentMode === SynthMode.SPECTRAL) processorName = 'spectral-processor';\n        if (this.currentMode === SynthMode.WHITENOISE_BAND_Q_FILTER) processorName = 'whitenoise-processor';\n\n        this.workletNode = new AudioWorkletNode(this.ctx, processorName, {\n            numberOfInputs: 0,\n            numberOfOutputs: 1,\n            outputChannelCount: [2] // Stereo\n        });\n\n        // Connect graph\n        // Connect graph\n        this.workletNode.connect(this.masterGain);\n        this.masterGain.connect(this.ctx.destination);\n        this.masterGain.connect(this.splitNode);\n\n        // If wavetable mode, send initial frequency\n        if (this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'frequency',\n                value: this.wavetableFrequency\n            });\n        }\n\n        // Send initial octave doubling settings to the new worklet\n        if (this.workletNode) {\n            this.workletNode.port.postMessage({\n                type: 'octave-doubling',\n                low: this.octaveLow,\n                high: this.octaveHigh,\n                multiplier: this.octaveMult\n            });\n        }\n    }\n\n    public setMode(mode: SynthMode): void {\n        if (mode === this.currentMode) return;\n\n        this.currentMode = mode;\n\n        if (this.isInitialized) {\n            this.createWorkletNode();\n            console.log(`✓ Synth mode changed to: ${mode}`);\n        }\n    }\n\n    public getMode(): SynthMode {\n        return this.currentMode;\n    }\n\n    public setWavetableFrequency(freq: number): void {\n        this.wavetableFrequency = freq;\n\n        if (this.workletNode && this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'frequency',\n                value: freq\n            });\n        }\n    }\n\n    public getWavetableFrequency(): number {\n        return this.wavetableFrequency;\n    }\n\n    public setCarrier(type: number): void {\n        this.carrierType = type;\n\n        if (this.workletNode && this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'carrier',\n                value: type\n            });\n        }\n    }\n\n    public getCarrier(): number {\n        return this.carrierType;\n    }\n\n    public setFeedback(amount: number): void {\n        this.feedback = amount;\n\n        if (this.workletNode && this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'feedback',\n                value: amount\n            });\n        }\n    }\n\n    public getFeedback(): number {\n        return this.feedback;\n    }\n\n    public updateSpectralData(data: Float32Array): void {\n        if (!this.workletNode || !this.isInitialized) {\n            return;\n        }\n\n        // Send data to worklet (both modes use same message format)\n        this.workletNode.port.postMessage({\n            type: 'spectral-data',\n            data: data\n        });\n    }\n\n    public setOctaveDoubling(low: number, high: number, multiplier: number): void {\n        this.octaveLow = low;\n        this.octaveHigh = high;\n        this.octaveMult = multiplier;\n\n        if (this.workletNode && this.isInitialized) {\n            this.workletNode.port.postMessage({\n                type: 'octave-doubling',\n                low: low,\n                high: high,\n                multiplier: multiplier\n            });\n        }\n    }\n\n    public getOctaveDoubling(): { low: number, high: number, multiplier: number } {\n        return {\n            low: this.octaveLow,\n            high: this.octaveHigh,\n            multiplier: this.octaveMult\n        };\n    }\n\n    public setInterpSamples(samples: number): void {\n        if (this.workletNode && this.isInitialized) {\n            this.workletNode.port.postMessage({\n                type: 'interp-samples',\n                value: samples\n            });\n        }\n    }\n\n    public getScopeData(): { left: Float32Array, right: Float32Array } {\n        this.analyserL.getFloatTimeDomainData(this.timeDomainDataL as any);\n        this.analyserR.getFloatTimeDomainData(this.timeDomainDataR as any);\n        return {\n            left: this.timeDomainDataL,\n            right: this.timeDomainDataR\n        };\n    }\n\n    public getAudioSpectralData(): { left: Float32Array, right: Float32Array } {\n        this.analyserL.getFloatFrequencyData(this.frequencyDataL as any);\n        this.analyserR.getFloatFrequencyData(this.frequencyDataR as any);\n        return {\n            left: this.frequencyDataL,\n            right: this.frequencyDataR\n        };\n    }\n\n    public setSpectralPitch(multiplier: number): void {\n        const supported = this.currentMode === SynthMode.SPECTRAL ||\n            this.currentMode === SynthMode.WHITENOISE_BAND_Q_FILTER;\n        if (this.workletNode && supported) {\n            this.workletNode.port.postMessage({\n                type: 'frequency-multiplier',\n                value: multiplier\n            });\n        }\n    }\n\n    public resume(): void {\n        if (this.ctx.state === 'suspended') {\n            this.ctx.resume();\n        }\n    }\n\n    public triggerAttack(params?: { a: number, d: number, s: number }): void {\n        const now = this.ctx.currentTime;\n        this.lastNoteTime = now;\n        this.isNoteOn = true;\n\n        if (params) {\n            this.attack = params.a;\n            this.decay = params.d;\n            this.sustain = params.s;\n        }\n\n        // Cancel any pending ramps\n        this.masterGain.gain.cancelScheduledValues(now);\n\n        // Smooth transition from current value\n        const currentGain = this.masterGain.gain.value; // Approximate, see getGain() for precision\n        this.masterGain.gain.setValueAtTime(currentGain, now);\n\n        // Attack ramp\n        // Target peak (1.0 or user defined?) usually 1.0, then decay to Sustain\n        const peak = 1.0;\n        this.masterGain.gain.linearRampToValueAtTime(peak, now + this.attack);\n\n        // Decay ramp\n        this.masterGain.gain.linearRampToValueAtTime(this.sustain, now + this.attack + this.decay);\n    }\n\n    public triggerRelease(r?: number): void {\n        const now = this.ctx.currentTime;\n        this.isNoteOn = false;\n\n        if (r !== undefined) this.release = r;\n\n        // Cancel future\n        this.masterGain.gain.cancelScheduledValues(now);\n\n        // We need to ramp from *current* calculated gain to 0\n        // Web Audio's .value attribute is not always the instantaneous ramp value during scheduling\n        // But cancelScheduledValues() sets it to the current scheduled value? \n        // No, it holds the value at 'now'. \n        // However, safest to calculate it or just use setTargetAtTime which handles it automatically?\n        // User asked for \"green line graph\", implies linear release.\n        // linearRampToValueAtTime requires a starting point.\n\n        // Let's rely on browser behavior: \n        // cancelScheduledValues(now) -> the param value becomes constant at the value it had at 'now'.\n        // So we just ramp from there.\n        // Wait, if we are in middle of attack, 'value' might jump?\n        // Actually, strictly speaking `setValueAtTime(this.masterGain.gain.value, now)` is needed to anchor it.\n        // But reading `.value` during automation is spec'd to return the automated value?\n        // \"If the AudioParam is being automated, the value property returns the current value of the parameter.\" (MDN)\n\n        const currentGain = this.masterGain.gain.value;\n        this.masterGain.gain.setValueAtTime(currentGain, now);\n        this.masterGain.gain.linearRampToValueAtTime(0, now + this.release);\n    }\n\n    public getEnvelopeState(): {\n        attack: number,\n        decay: number,\n        sustain: number,\n        release: number,\n        isNoteOn: boolean,\n        lastNoteTime: number,\n        currentTime: number\n    } {\n        return {\n            attack: this.attack,\n            decay: this.decay,\n            sustain: this.sustain,\n            release: this.release,\n            isNoteOn: this.isNoteOn,\n            lastNoteTime: this.lastNoteTime,\n            currentTime: this.ctx.currentTime\n        };\n    }\n\n    public async renderOffline(\n        note: number,\n        duration: number,\n        currentSpectralData: Float32Array,\n        params: {\n            mode: SynthMode,\n            wavetableParams: { frequency: number, carrier: number, feedback: number },\n            octaveDoubling: { low: number, high: number, multiplier: number },\n            interpSamples: number\n        }\n    ): Promise<Blob> {\n        const offlineSampleRate = 44100;\n        const totalDuration = duration + this.release;\n        const lengthSamples = Math.ceil(totalDuration * offlineSampleRate);\n\n        const offlineCtx = new OfflineAudioContext(2, lengthSamples, offlineSampleRate);\n\n        // Load processors into offline context\n        const spectralBlob = new Blob([SPECTRAL_PROCESSOR_CODE], { type: 'application/javascript' });\n        const wavetableBlob = new Blob([WAVETABLE_PROCESSOR_CODE], { type: 'application/javascript' });\n        const whitenoiseBlob = new Blob([WHITENOISE_PROCESSOR_CODE], { type: 'application/javascript' });\n\n        const spectralUrl = URL.createObjectURL(spectralBlob);\n        const wavetableUrl = URL.createObjectURL(wavetableBlob);\n        const whitenoiseUrl = URL.createObjectURL(whitenoiseBlob);\n\n        await offlineCtx.audioWorklet.addModule(spectralUrl);\n        await offlineCtx.audioWorklet.addModule(wavetableUrl);\n        await offlineCtx.audioWorklet.addModule(whitenoiseUrl);\n\n        URL.revokeObjectURL(spectralUrl);\n        URL.revokeObjectURL(wavetableUrl);\n        URL.revokeObjectURL(whitenoiseUrl);\n\n        let processorName = 'wavetable-processor';\n        if (params.mode === SynthMode.SPECTRAL) processorName = 'spectral-processor';\n        if (params.mode === SynthMode.WHITENOISE_BAND_Q_FILTER) processorName = 'whitenoise-processor';\n\n        const node = new AudioWorkletNode(offlineCtx, processorName, {\n            numberOfInputs: 0,\n            numberOfOutputs: 1,\n            outputChannelCount: [2]\n        });\n\n        const masterGain = offlineCtx.createGain();\n        masterGain.gain.value = 0;\n\n        node.connect(masterGain);\n        masterGain.connect(offlineCtx.destination);\n\n        // Setup parameters\n        node.port.postMessage({ type: 'spectral-data', data: currentSpectralData });\n        node.port.postMessage({ type: 'interp-samples', value: params.interpSamples });\n        node.port.postMessage({\n            type: 'octave-doubling',\n            low: params.octaveDoubling.low,\n            high: params.octaveDoubling.high,\n            multiplier: params.octaveDoubling.multiplier\n        });\n\n        if (params.mode === SynthMode.WAVETABLE) {\n            const freq = 440 * Math.pow(2, (note - 69) / 12);\n            node.port.postMessage({ type: 'frequency', value: freq });\n            node.port.postMessage({ type: 'carrier', value: params.wavetableParams.carrier });\n            node.port.postMessage({ type: 'feedback', value: params.wavetableParams.feedback });\n        } else {\n            // Spectral modes use multiplier\n            const targetFreq = 440 * Math.pow(2, (note - 69) / 12);\n            const rootFreq = 440;\n            node.port.postMessage({ type: 'frequency-multiplier', value: targetFreq / rootFreq });\n        }\n\n        // Trigger Envelope\n        const now = 0;\n        masterGain.gain.setValueAtTime(0, now);\n        masterGain.gain.linearRampToValueAtTime(1.0, now + this.attack);\n        masterGain.gain.linearRampToValueAtTime(this.sustain, now + this.attack + this.decay);\n\n        // Release\n        const releaseStart = duration;\n        masterGain.gain.setValueAtTime(this.sustain, releaseStart);\n        masterGain.gain.linearRampToValueAtTime(0, releaseStart + this.release);\n\n        const renderedBuffer = await offlineCtx.startRendering();\n        return this.audioBufferToWav(renderedBuffer);\n    }\n\n    private audioBufferToWav(buffer: AudioBuffer): Blob {\n        const numOfChan = buffer.numberOfChannels;\n        const length = buffer.length * numOfChan * 2 + 44;\n        const out = new ArrayBuffer(length);\n        const view = new DataView(out);\n        const channels = [];\n        let i;\n        let sample;\n        let offset = 0;\n        let pos = 0;\n\n        // write WAVE header\n        setUint32(0x46464952);                         // \"RIFF\"\n        setUint32(length - 8);                         // file length - 8\n        setUint32(0x45564157);                         // \"WAVE\"\n\n        setUint32(0x20746d66);                         // \"fmt \" chunk\n        setUint32(16);                                 // length = 16\n        setUint16(1);                                  // PCM (uncompressed)\n        setUint16(numOfChan);\n        setUint32(buffer.sampleRate);\n        setUint32(buffer.sampleRate * 2 * numOfChan);  // avg. bytes/sec\n        setUint16(numOfChan * 2);                      // block-align\n        setUint16(16);                                 // 16-bit (hardcoded)\n\n        setUint32(0x61746164);                         // \"data\" - chunk\n        setUint32(length - pos - 4);                   // chunk length\n\n        // write interleaved data\n        for (i = 0; i < buffer.numberOfChannels; i++) {\n            channels.push(buffer.getChannelData(i));\n        }\n\n        while (pos < length) {\n            for (i = 0; i < numOfChan; i++) {             // interleave channels\n                sample = Math.max(-1, Math.min(1, channels[i][offset])); // clamp\n                sample = (sample < 0 ? sample * 0x8000 : sample * 0x7FFF) | 0; // scale to 16-bit signed int\n                view.setInt16(pos, sample, true);          // write 16-bit sample\n                pos += 2;\n            }\n            offset++;                                     // next source sample\n        }\n\n        return new Blob([out], { type: 'audio/wav' });\n\n        function setUint16(data: number) {\n            view.setUint16(pos, data, true);\n            pos += 2;\n        }\n\n        function setUint32(data: number) {\n            view.setUint32(pos, data, true);\n            pos += 4;\n        }\n    }\n}\n","// Audio analysis and spectral volume conversion\n// Converts WAV/audio files into 3D spectral volume data using FFT\n\nexport class AudioAnalyzer {\n    private audioContext: AudioContext;\n\n    constructor() {\n        this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n\n    /**\n     * Analyze multiple files for morphing\n     * Each file is placed at a different Y position in the volume\n     * All files are time-stretched to the same Z length\n     */\n    public async analyzeMultipleFiles(\n        files: File[],\n        volumeSize: { x: number, y: number, z: number },\n        onProgress?: (percent: number) => void\n    ): Promise<Float32Array> {\n        const { x: xSize, y: ySize, z: zSize } = volumeSize;\n        const numFiles = files.length;\n\n        console.log(`Analyzing ${numFiles} files for morphing into ${xSize}x${ySize}x${zSize} volume`);\n\n        // Initialize volume with zeros\n        const volumeData = new Float32Array(xSize * ySize * zSize * 4); // RGBA\n\n        // Process each file\n        for (let fileIdx = 0; fileIdx < numFiles; fileIdx++) {\n            const file = files[fileIdx];\n\n            // Load and decode audio\n            const arrayBuffer = await file.arrayBuffer();\n            const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n            const channelData = audioBuffer.getChannelData(0);\n            const sampleRate = audioBuffer.sampleRate;\n\n            console.log(`  [${fileIdx + 1}/${numFiles}] ${file.name}: ${audioBuffer.duration.toFixed(2)}s`);\n\n            // Calculate which Y index this file should occupy\n            // For 1 file: Y=0 (middle)\n            // For 2 files: Y=-1, Y=1 (first and last)\n            // For 3+ files: equally spaced from -1 to 1\n            const yPosition = numFiles === 1 ? 0 : -1 + (fileIdx / (numFiles - 1)) * 2;\n            const yIndex = Math.round((yPosition + 1) * 0.5 * (ySize - 1));\n\n            // Time-stretch audio to fit Z dimension\n            const fftSize = 2048;\n            const samplesNeeded = zSize * fftSize;\n            const processedData = this.timeStretch(channelData, samplesNeeded);\n\n            // Frequency mapping constants\n            const minFreq = 20;\n            const maxFreq = 20000;\n\n            // Process each Z slice (time)\n            for (let iz = 0; iz < zSize; iz++) {\n                const startSample = iz * fftSize;\n                const signal = new Float32Array(fftSize);\n\n                // Extract window\n                for (let i = 0; i < fftSize; i++) {\n                    if (startSample + i < processedData.length) {\n                        signal[i] = processedData[startSample + i];\n                    }\n                }\n\n                // Apply Hann window\n                for (let i = 0; i < fftSize; i++) {\n                    signal[i] *= 0.5 * (1 - Math.cos(2 * Math.PI * i / fftSize));\n                }\n\n                // Perform FFT\n                const spectrum = this.simpleFFT(signal);\n\n                // Map spectrum to X axis (Linear Frequency 0-22kHz)\n                for (let ix = 0; ix < xSize; ix++) {\n                    const normalizedX = ix / xSize;\n                    const freq = minFreq + (maxFreq - minFreq) * normalizedX;\n                    const binIndex = Math.floor(freq * fftSize / sampleRate);\n                    const safeBinIndex = Math.max(0, Math.min(spectrum.length - 1, binIndex));\n                    const magnitude = spectrum[safeBinIndex] || 0;\n\n                    // Convert to dB scale\n                    let val = 0;\n                    if (magnitude > 0.000001) {\n                        const db = 20 * Math.log10(magnitude);\n                        val = (db + 60) / 60;\n                        val = Math.max(0, Math.min(1, val));\n                    }\n\n                    // Write to the specific Y slice for this file\n                    const idx = (iz * ySize * xSize + yIndex * xSize + ix) * 4;\n\n                    volumeData[idx] = val;                        // R: Magnitude\n                    volumeData[idx + 1] = ix / xSize;             // G: Phase (freq-based)\n                    volumeData[idx + 2] = ix / xSize;             // B: Pan\n                    volumeData[idx + 3] = iz / zSize;             // A: Width\n                }\n\n                // Report progress\n                if (onProgress && iz % 10 === 0) {\n                    const fileProgress = (fileIdx / numFiles) * 100;\n                    const sliceProgress = ((iz / zSize) / numFiles) * 100;\n                    onProgress(fileProgress + sliceProgress);\n                }\n\n                // Yield to main thread periodically\n                if (iz % 20 === 0) {\n                    await new Promise(resolve => requestAnimationFrame(resolve));\n                }\n            }\n        }\n\n        if (onProgress) onProgress(100);\n        console.log('✓ Multi-file morphing volume created');\n        return volumeData;\n    }\n\n    public async analyzeFile(\n        file: File,\n        volumeSize: { x: number, y: number, z: number },\n        onProgress?: (percent: number) => void\n    ): Promise<{ data: Float32Array, adjustedSize: { x: number, y: number, z: number } }> {\n        // Load audio file\n        const arrayBuffer = await file.arrayBuffer();\n        const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n\n        // Get audio data (mix to mono from stereo)\n        const channelData = audioBuffer.getChannelData(0);\n        const totalSamples = channelData.length;\n        const sampleRate = audioBuffer.sampleRate;\n\n        console.log(`Analyzing: ${file.name}, ${audioBuffer.duration.toFixed(2)}s, ${sampleRate}Hz, ${totalSamples} samples`);\n\n        const { x: xSize, y: ySize, z: zSize } = volumeSize;\n\n        // Minimum samples needed for good FFT (2048 is a good FFT size)\n        const minFFTSize = 2048;\n\n        // Calculate total samples needed to fill the volume\n        const samplesNeeded = zSize * ySize * minFFTSize;\n\n        let processedData: Float32Array;\n\n        if (totalSamples < samplesNeeded) {\n            // Time-stretch (interpolate) to fill the volume\n            console.log(`Time-stretching audio: ${totalSamples} → ${samplesNeeded} samples (${(samplesNeeded / totalSamples).toFixed(2)}x)`);\n            if (onProgress) onProgress(10);\n            processedData = this.timeStretch(channelData, samplesNeeded);\n            if (onProgress) onProgress(20);\n        } else {\n            // Use as-is or downsample if much longer\n            processedData = channelData;\n            if (onProgress) onProgress(15);\n        }\n\n        const volumeData = new Float32Array(xSize * ySize * zSize * 4); // RGBA\n\n        // Split sample by Z depth (morph layers)\n\n        const totalIterations = zSize;\n        let iterationCount = 0;\n        let lastYieldTime = performance.now();\n\n        // We will process the audio in Z steps (Time)\n        // Each Z step represents a point in time\n        // X is Frequency (Logarithmic)\n        // Y is replicated\n\n        const stepSize = Math.floor(processedData.length / zSize);\n\n        // Frequency mapping constants\n        const minFreq = 20;\n        const maxFreq = 20000; // Fixed range for consistency\n\n        for (let iz = 0; iz < zSize; iz++) {\n            // Calculate start position for this time slice\n            const startSample = iz * stepSize;\n\n            // Extract a window for FFT\n            // Use a window size that gives good frequency resolution, e.g., 2048 or 4096\n            // But we map it to xSize bins\n            const fftSize = 2048;\n            const signal = new Float32Array(fftSize);\n\n            // Copy samples (with bounds check)\n            for (let i = 0; i < fftSize; i++) {\n                if (startSample + i < processedData.length) {\n                    signal[i] = processedData[startSample + i];\n                }\n            }\n\n            // Apply Hann window\n            for (let i = 0; i < fftSize; i++) {\n                signal[i] *= 0.5 * (1 - Math.cos(2 * Math.PI * i / fftSize));\n            }\n\n            // Perform FFT\n            const spectrum = this.simpleFFT(signal);\n            const numBins = spectrum.length;\n\n            // Store this slice's data temporarily to normalize later? \n            // Or just do a first pass? \n            // For simplicity/speed, we'll use a running normalization or just a reasonable scale.\n            // But user asked for normalization. Let's find local max first?\n            // No, global max is better. But that requires two passes.\n            // Let's stick to a reasonable scaling + log scale which is more robust.\n\n            // Map spectrum to X axis (Linear Frequency 0-22kHz)\n            for (let ix = 0; ix < xSize; ix++) {\n                const normalizedX = ix / xSize;\n\n                // Linear mapping:\n                // freq = minFreq + (maxFreq - minFreq) * normalizedX\n                // binFreq = bin * sampleRate / fftSize\n                // bin = freq * fftSize / sampleRate\n\n                const freq = minFreq + (maxFreq - minFreq) * normalizedX;\n                const binIndex = Math.floor(freq * fftSize / sampleRate);\n\n                // Clamp bin index\n                const safeBinIndex = Math.max(0, Math.min(numBins - 1, binIndex));\n\n                const magnitude = spectrum[safeBinIndex] || 0;\n\n                // Convert to dB-like scale\n                let val = 0;\n                if (magnitude > 0.000001) {\n                    const db = 20 * Math.log10(magnitude);\n                    // Range -60dB to 0dB\n                    val = (db + 60) / 60;\n                    val = Math.max(0, Math.min(1, val));\n                }\n\n                // Replicate across Y\n                for (let iy = 0; iy < ySize; iy++) {\n                    const idx = (iz * ySize * xSize + iy * xSize + ix) * 4;\n\n                    // R: Magnitude\n                    volumeData[idx] = val;\n\n                    // G: Phase (frequency-based)\n                    volumeData[idx + 1] = ix / xSize;\n\n                    // B: Pan (spread)\n                    volumeData[idx + 2] = ix / xSize;\n\n                    // A: Width\n                    volumeData[idx + 3] = iz / zSize;\n                }\n            }\n\n            // Report progress\n            iterationCount++;\n            if (onProgress && iterationCount % 5 === 0) {\n                const percent = 20 + (iterationCount / totalIterations) * 80;\n                onProgress(percent);\n            }\n\n            // Yield to main thread\n            if (performance.now() - lastYieldTime > 12) {\n                await new Promise(resolve => requestAnimationFrame(resolve));\n                lastYieldTime = performance.now();\n            }\n        }\n\n        if (onProgress) onProgress(100);\n        console.log('✓ Converted to spectral volume');\n        return { data: volumeData, adjustedSize: volumeSize };\n    }\n\n    private timeStretch(input: Float32Array, targetLength: number): Float32Array {\n        // Simple linear interpolation time-stretching\n        const output = new Float32Array(targetLength);\n        const ratio = input.length / targetLength;\n\n        for (let i = 0; i < targetLength; i++) {\n            const srcPos = i * ratio;\n            const srcIdx = Math.floor(srcPos);\n            const frac = srcPos - srcIdx;\n\n            // Linear interpolation between samples\n            if (srcIdx + 1 < input.length) {\n                output[i] = input[srcIdx] * (1 - frac) + input[srcIdx + 1] * frac;\n            } else {\n                output[i] = input[srcIdx];\n            }\n        }\n\n        return output;\n    }\n\n    private simpleFFT(signal: Float32Array): Float32Array {\n        // Simple DFT for magnitude spectrum\n        // For production, consider using a proper FFT library\n        const N = signal.length;\n        const spectrum = new Float32Array(N / 2);\n\n        for (let k = 0; k < N / 2; k++) {\n            let real = 0;\n            let imag = 0;\n\n            for (let n = 0; n < N; n++) {\n                const angle = -2 * Math.PI * k * n / N;\n                real += signal[n] * Math.cos(angle);\n                imag += signal[n] * Math.sin(angle);\n            }\n\n            spectrum[k] = Math.sqrt(real * real + imag * imag) / N;\n        }\n\n        return spectrum;\n    }\n}\n","\nexport class MidiHandler {\n    private midiAccess: any = null;\n    private activeInput: any = null;\n    private activeNotes: Map<number, number> = new Map(); // Note -> Velocity\n\n    // Callbacks\n    private onNoteChangeCallback: ((note: number | null) => void) | null = null;\n    private onConnectionChangeCallback: ((isConnected: boolean) => void) | null = null;\n    private onRawNoteCallback: ((note: number, velocity: number) => void) | null = null;  // For visualization\n\n    constructor() {\n        this.initialize();\n    }\n\n    private async initialize() {\n        try {\n            if ((navigator as any).requestMIDIAccess) {\n                this.midiAccess = await (navigator as any).requestMIDIAccess();\n\n                // Get first available input\n                const inputs = this.midiAccess.inputs.values();\n                for (let input of inputs) {\n                    this.setInput(input);\n                    break; // Just grab the first one for now\n                }\n\n                this.midiAccess.onstatechange = (e: any) => {\n                    console.log('MIDI State Change:', e.port.name, e.port.state, e.port.connection);\n                    if (e.port.type === 'input') {\n                        if (e.port.state === 'connected' && !this.activeInput) {\n                            this.setInput(e.port);\n                        } else if (e.port.state === 'disconnected' && this.activeInput && this.activeInput.id === e.port.id) {\n                            this.activeInput = null;\n                            if (this.onConnectionChangeCallback) {\n                                this.onConnectionChangeCallback(false);\n                            }\n                        }\n                    }\n                };\n            } else {\n                console.warn('Web MIDI API not supported in this browser.');\n            }\n        } catch (err) {\n            console.error('MIDI Access Failed:', err);\n        }\n    }\n\n    private setInput(input: any) {\n        this.activeInput = input;\n        console.log(`MIDI Input Selected: ${input.name}`);\n\n        input.onmidimessage = (message: any) => {\n            this.handleMessage(message);\n        };\n\n        if (this.onConnectionChangeCallback) {\n            this.onConnectionChangeCallback(true);\n        }\n    }\n\n    private handleMessage(message: any) {\n        const [status, data1, data2] = message.data;\n        const command = status & 0xF0;\n        // const channel = status & 0x0F;\n        const note = data1;\n        const velocity = data2;\n\n        // Note On\n        if (command === 0x90 && velocity > 0) {\n            this.activeNotes.set(note, velocity);\n            this.triggerHighestNote();\n            if (this.onRawNoteCallback) this.onRawNoteCallback(note, velocity);\n        }\n        // Note Off (or Note On with vel 0)\n        else if (command === 0x80 || (command === 0x90 && velocity === 0)) {\n            this.activeNotes.delete(note);\n            this.triggerHighestNote();\n            if (this.onRawNoteCallback) this.onRawNoteCallback(note, 0);\n        }\n    }\n\n    private triggerHighestNote() {\n        if (!this.onNoteChangeCallback) return;\n\n        if (this.activeNotes.size === 0) {\n            this.onNoteChangeCallback(null);\n            return;\n        }\n\n        // Monophonic: Last note priority or Highest note?\n        // Let's implement Highest Note Priority for standard synth feel\n        let highestNote = -1;\n        for (let note of this.activeNotes.keys()) {\n            if (note > highestNote) highestNote = note;\n        }\n\n        if (highestNote !== -1) {\n            this.onNoteChangeCallback(highestNote);\n        }\n    }\n\n    public setNoteChangeCallback(callback: (note: number | null) => void) {\n        this.onNoteChangeCallback = callback;\n    }\n\n    public setRawNoteCallback(callback: (note: number, velocity: number) => void) {\n        this.onRawNoteCallback = callback;\n    }\n\n    public setConnectionChangeCallback(callback: (isConnected: boolean) => void) {\n        this.onConnectionChangeCallback = callback;\n    }\n\n    public getInputs(): { id: string, name: string }[] {\n        if (!this.midiAccess) return [];\n        const inputs: { id: string, name: string }[] = [];\n        this.midiAccess.inputs.forEach((input: any) => {\n            inputs.push({ id: input.id, name: input.name });\n        });\n        return inputs;\n    }\n\n    public selectInput(id: string) {\n        if (!this.midiAccess) return;\n        const input = this.midiAccess.inputs.get(id);\n        if (input) {\n            this.setInput(input);\n        }\n    }\n\n    public simulateNoteOn(note: number, velocity: number) {\n        this.activeNotes.set(note, velocity);\n        this.triggerHighestNote();\n        // Allow visualization update if needed (e.g. if driven by computer keyboard later)\n        if (this.onRawNoteCallback) this.onRawNoteCallback(note, velocity);\n    }\n\n    public simulateNoteOff(note: number) {\n        this.activeNotes.delete(note);\n        this.triggerHighestNote();\n        if (this.onRawNoteCallback) this.onRawNoteCallback(note, 0);\n    }\n}\n","\nimport { AudioEngine } from '../audio/audio-engine';\n\nexport class EnvelopeEditor {\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private engine: AudioEngine;\n\n    private width = 0;\n    private height = 0;\n\n    // View settings\n    private maxTime = 2.0; // Seconds visible on X axis\n    private padding = 20;\n\n    // Interaction state\n    private isDragging = false;\n    private activeNode = -1; // 0=AttackPeak, 1=DecayEnd/SustainStart, 2=ReleaseEnd\n\n    // Visual Sustain Duration\n    private sustainVisualDuration = 0.5;\n\n    constructor(containerOrId: string | HTMLCanvasElement, engine: AudioEngine) {\n        let el: HTMLCanvasElement | null = null;\n        if (typeof containerOrId === 'string') {\n            el = document.getElementById(containerOrId) as HTMLCanvasElement;\n        } else {\n            el = containerOrId;\n        }\n\n        if (!el) throw new Error(`Canvas not found`);\n        this.canvas = el;\n        this.ctx = this.canvas.getContext('2d')!;\n        this.engine = engine;\n\n        this.resize();\n        window.addEventListener('resize', () => this.resize());\n\n        // Interaction\n        this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));\n        window.addEventListener('mousemove', this.onMouseMove.bind(this));\n        window.addEventListener('mouseup', this.onMouseUp.bind(this));\n\n        // Start animation loop for playhead\n        this.animate();\n    }\n\n    private resize(): void {\n        this.canvas.width = this.canvas.clientWidth;\n        this.canvas.height = this.canvas.clientHeight;\n        this.width = this.canvas.width;\n        this.height = this.canvas.height;\n        this.draw();\n    }\n\n    private animate(): void {\n        this.draw();\n        requestAnimationFrame(() => this.animate());\n    }\n\n    private draw(): void {\n        const { width, height, ctx } = this;\n        const state = this.engine.getEnvelopeState();\n\n        // Clear\n        ctx.fillStyle = '#08080c';\n        ctx.fillRect(0, 0, width, height);\n\n        // Draw Grid\n        ctx.strokeStyle = '#222';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        // Time grid (every 0.5s)\n        for (let t = 0; t <= this.maxTime; t += 0.5) {\n            const x = this.timeToX(t);\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, height);\n        }\n        // Level grid (0, 0.5, 1.0)\n        for (let l = 0; l <= 1.0; l += 0.5) {\n            const y = this.valToY(l);\n            ctx.moveTo(0, y);\n            ctx.lineTo(width, y);\n        }\n        ctx.stroke();\n\n        // Calculate Nodes\n        const aTime = state.attack;\n        const dTime = state.decay;\n        const sLevel = state.sustain;\n        const rTime = state.release;\n\n        // Visual Layout:\n        // P0 (0,0)\n        // P1 (A_time, 1.0) -> Attack Peak\n        // P2 (A+D_time, S_level) -> Decay End / Sustain Start\n        // P3 (A+D+S_vis, S_level) -> Sustain End (Visual only)\n        // P4 (A+D+S_vis+R, 0) -> Release End\n\n        const p0 = { x: 0, y: 0 };\n        const p1 = { x: aTime, y: 1.0 };\n        const p2 = { x: aTime + dTime, y: sLevel };\n        const p3 = { x: aTime + dTime + this.sustainVisualDuration, y: sLevel };\n        const p4 = { x: aTime + dTime + this.sustainVisualDuration + rTime, y: 0 };\n\n        // Draw Envelope Line\n        ctx.strokeStyle = '#00ff88'; // Neon Green\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(this.timeToX(p0.x), this.valToY(p0.y));\n        ctx.lineTo(this.timeToX(p1.x), this.valToY(p1.y));\n        ctx.lineTo(this.timeToX(p2.x), this.valToY(p2.y));\n        ctx.lineTo(this.timeToX(p3.x), this.valToY(p3.y));\n        ctx.lineTo(this.timeToX(p4.x), this.valToY(p4.y));\n        ctx.stroke();\n\n        // Draw Interactive Nodes\n        this.drawNode(p1.x, p1.y, this.activeNode === 0); // Attack\n        this.drawNode(p2.x, p2.y, this.activeNode === 1); // Decay/Sustain\n        this.drawNode(p4.x, p4.y, this.activeNode === 2); // Release\n\n        // Labels\n        ctx.fillStyle = '#666';\n        ctx.font = '10px Inter';\n        ctx.fillText('A', this.timeToX(p1.x), this.valToY(p1.y) - 10);\n        ctx.fillText('D', this.timeToX(p2.x), this.valToY(p2.y) - 10);\n        ctx.fillText('R', this.timeToX(p4.x), this.valToY(p4.y) - 10);\n\n        // Draw Playhead\n        if (state.isNoteOn) {\n            const timeSinceNote = state.currentTime - state.lastNoteTime;\n\n            // Logic to trace the actual envelope value visual position\n            // If Attack phase (t < A)\n            // If Decay phase (t < A+D)\n            // If Sustain phase (t >= A+D) -> Clamp to visual sustain region? \n            // Better: Draw vertical line at current time\n\n            let playHeadX = 0;\n            if (timeSinceNote < aTime + dTime) {\n                // In A or D phase\n                playHeadX = timeSinceNote;\n            } else {\n                // In Sustain phase. We clamp it visually within the sustain block\n                // OR loop it? Usually standard ADSR just holds.\n                // We'll calculate offset into sustain\n                const sustainTime = timeSinceNote - (aTime + dTime);\n                // Clamp visual position to P2 -> P3 range?\n                // Or let it run? If it runs past P3, it looks like release?\n                // Let's loop it in the visual sustain block for feedback?\n                // Or just clamp at P3?\n                // Just clamp it to end of visual sustain for clarity\n                const maxSustainX = aTime + dTime + this.sustainVisualDuration;\n                playHeadX = Math.min(aTime + dTime + sustainTime, maxSustainX);\n            }\n\n            const x = this.timeToX(playHeadX);\n            ctx.strokeStyle = '#0088ff';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, height);\n            ctx.stroke();\n        } else {\n            // Note released. We are in Release phase.\n            // Problem: We need to know when Release started to draw accurate position.\n            // But state only gives us params and noteOn status.\n            // We can't easily visualize the release ramp playhead linearly without storing releaseStartTime.\n            // But main goal is configuration. Playhead during hold is most useful.\n        }\n    }\n\n    private drawNode(t: number, v: number, active: boolean): void {\n        const x = this.timeToX(t);\n        const y = this.valToY(v);\n\n        this.ctx.beginPath();\n        this.ctx.arc(x, y, 6, 0, Math.PI * 2);\n        this.ctx.fillStyle = active ? '#fff' : '#00ff88';\n        this.ctx.fill();\n        this.ctx.stroke();\n    }\n\n    private timeToX(t: number): number {\n        return this.padding + (t / this.maxTime) * (this.width - 2 * this.padding);\n    }\n\n    private xToTime(x: number): number {\n        return ((x - this.padding) / (this.width - 2 * this.padding)) * this.maxTime;\n    }\n\n    private valToY(v: number): number {\n        // v is 0..1 (or more). Canvas Y is inverted (0 at top)\n        // Map 0 -> height - padding\n        // Map 1 -> padding\n        const usableHeight = this.height - 2 * this.padding;\n        return this.height - this.padding - (v * usableHeight);\n    }\n\n    private yToVal(y: number): number {\n        const usableHeight = this.height - 2 * this.padding;\n        const relativeY = this.height - this.padding - y;\n        return relativeY / usableHeight;\n    }\n\n    // Interaction Handlers\n    private onMouseDown(e: MouseEvent): void {\n        const rect = this.canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        // Hit test nodes\n        // P1 (Attack)\n        const state = this.engine.getEnvelopeState();\n        const p1 = { t: state.attack, v: 1.0 };\n        const p2 = { t: state.attack + state.decay, v: state.sustain };\n        const p4 = { t: state.attack + state.decay + this.sustainVisualDuration + state.release, v: 0 };\n\n        const nodes = [p1, p2, p4];\n\n        for (let i = 0; i < nodes.length; i++) {\n            const nx = this.timeToX(nodes[i].t);\n            const ny = this.valToY(nodes[i].v);\n            const dist = Math.sqrt((x - nx) ** 2 + (y - ny) ** 2);\n\n            if (dist < 10) {\n                this.isDragging = true;\n                this.activeNode = i;\n                return; // Interaction started\n            }\n        }\n    }\n\n    private onMouseMove(e: MouseEvent): void {\n        if (!this.isDragging) return;\n\n        const rect = this.canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const time = Math.max(0, this.xToTime(x));\n        const val = Math.max(0, Math.min(1.0, this.yToVal(y)));\n\n        // Update AudioEngine params based on node\n        // Node 0: Attack (v=1 fixed, t=attack)\n        // Node 1: Decay (v=sustain, t=attack+decay)\n        // Node 2: Release (v=0 fixed, t=attack+decay+sustainVis+release)\n\n        // We need current values to calc deltas\n        const state = this.engine.getEnvelopeState();\n\n        if (this.activeNode === 0) {\n            // Dragging Attack\n            this.engine.attack = time; // Simple mapping\n            // Note: If Attack > Decay End, weird? \n            // Actually Node 1 is absolute time. So Attack is just Time.\n        } else if (this.activeNode === 1) {\n            // Dragging Decay/Sustain\n            this.engine.sustain = val;\n\n            // X position determines Decay Time.\n            // X = Attack + Decay. So Decay = X - Attack.\n            const newDecay = time - state.attack;\n            this.engine.decay = Math.max(0, newDecay);\n        } else if (this.activeNode === 2) {\n            // Dragging Release\n            // X = Attack + Decay + SusVis + Release\n            const startOfRelease = state.attack + state.decay + this.sustainVisualDuration;\n            const newRelease = time - startOfRelease;\n            this.engine.release = Math.max(0.01, newRelease);\n        }\n    }\n\n    private onMouseUp(): void {\n        this.isDragging = false;\n        this.activeNode = -1;\n    }\n}\n","\nexport class PianoKeyboard {\n    private container: HTMLElement;\n    private keys: Map<number, HTMLElement> = new Map();\n    private activeNotes: Set<number> = new Set();\n\n    // Callbacks\n    private onNoteChange: ((note: number, velocity: number) => void) | null = null;\n\n    // Range: Defaults to 5 Octaves\n    private numOctaves = 5;\n    private baseOctave = 3; // Starts at C3\n    private startNote = 36;\n    private endNote = 72;\n\n    // Keyboard mapping: key -> [octaveOffset, noteInOctave]\n    // Tracker style: lower row = octave 0, upper row = octave 1\n    private static readonly KEY_MAP: Record<string, [number, number]> = {\n        // Lower octave (Z row) - octave offset 0\n        'z': [0, 0],   // C\n        's': [0, 1],   // C#\n        'x': [0, 2],   // D\n        'd': [0, 3],   // D#\n        'c': [0, 4],   // E\n        'v': [0, 5],   // F\n        'g': [0, 6],   // F#\n        'b': [0, 7],   // G\n        'h': [0, 8],   // G#\n        'n': [0, 9],   // A\n        'j': [0, 10],  // A#\n        'm': [0, 11],  // B\n\n        // Upper octave (Q row) - octave offset 1\n        'q': [1, 0],   // C\n        '2': [1, 1],   // C#\n        'w': [1, 2],   // D\n        '3': [1, 3],   // D#\n        'e': [1, 4],   // E\n        'r': [1, 5],   // F\n        '5': [1, 6],   // F#\n        't': [1, 7],   // G\n        '6': [1, 8],   // G#\n        'y': [1, 9],   // A\n        '7': [1, 10],  // A#\n        'u': [1, 11],  // B\n    };\n\n    // Reverse lookup: noteInOctave -> key (for hints)\n    // [lowerOctaveKey, upperOctaveKey]\n    private static readonly NOTE_TO_KEYS: Record<number, [string, string]> = {\n        0: ['z', 'q'],   // C\n        1: ['s', '2'],   // C#\n        2: ['x', 'w'],   // D\n        3: ['d', '3'],   // D#\n        4: ['c', 'e'],   // E\n        5: ['v', 'r'],   // F\n        6: ['g', '5'],   // F#\n        7: ['b', 't'],   // G\n        8: ['h', '6'],   // G#\n        9: ['n', 'y'],   // A\n        10: ['j', '7'],   // A#\n        11: ['m', 'u'],   // B\n    };\n\n    // Track which keys are currently held (for key repeat handling)\n    private heldKeys: Set<string> = new Set();\n\n    constructor(containerId: string) {\n        const el = document.getElementById(containerId);\n        if (!el) throw new Error(`Container ${containerId} not found`);\n        this.container = el;\n\n        this.updateRange(); // Calculates start/end and creates keys\n        this.setupKeyboardListeners();\n\n        // Prevent drag selection\n        this.container.addEventListener('selectstart', e => e.preventDefault());\n    }\n\n    public setBaseOctave(octave: number) {\n        this.baseOctave = octave;\n        this.updateRange();\n    }\n\n    private updateRange() {\n        this.startNote = this.baseOctave * 12;\n        this.endNote = this.startNote + (this.numOctaves * 12);\n        this.createKeys();\n    }\n\n    private setupKeyboardListeners() {\n        window.addEventListener('keydown', (e) => {\n            // Ignore if typing in an input field\n            if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n                return;\n            }\n\n            const key = e.key.toLowerCase();\n\n            // Ignore key repeat\n            if (this.heldKeys.has(key)) return;\n\n            const mapping = PianoKeyboard.KEY_MAP[key];\n            if (mapping) {\n                e.preventDefault();\n                this.heldKeys.add(key);\n                const [octaveOffset, noteInOctave] = mapping;\n                const note = (this.baseOctave + octaveOffset) * 12 + noteInOctave;\n                this.triggerNoteOn(note);\n            }\n        });\n\n        window.addEventListener('keyup', (e) => {\n            const key = e.key.toLowerCase();\n\n            if (this.heldKeys.has(key)) {\n                this.heldKeys.delete(key);\n                const mapping = PianoKeyboard.KEY_MAP[key];\n                if (mapping) {\n                    const [octaveOffset, noteInOctave] = mapping;\n                    const note = (this.baseOctave + octaveOffset) * 12 + noteInOctave;\n                    this.triggerNoteOff(note);\n                }\n            }\n        });\n\n        // Release all keys when window loses focus\n        window.addEventListener('blur', () => {\n            for (const key of this.heldKeys) {\n                const mapping = PianoKeyboard.KEY_MAP[key];\n                if (mapping) {\n                    const [octaveOffset, noteInOctave] = mapping;\n                    const note = (this.baseOctave + octaveOffset) * 12 + noteInOctave;\n                    this.triggerNoteOff(note);\n                }\n            }\n            this.heldKeys.clear();\n        });\n    }\n\n    private createKeys() {\n        this.container.innerHTML = '';\n        this.keys.clear();\n\n        const whiteKeys = [0, 2, 4, 5, 7, 9, 11]; // Indices in octave\n\n        // Count white keys for width calculation\n        let numWhiteKeys = 0;\n        for (let i = this.startNote; i <= this.endNote; i++) {\n            if (whiteKeys.includes(i % 12)) {\n                numWhiteKeys++;\n            }\n        }\n\n        const whiteKeyWidth = 100 / numWhiteKeys;\n        let whiteKeyIndex = 0;\n\n        for (let note = this.startNote; note <= this.endNote; note++) {\n            const noteOctave = Math.floor(note / 12);\n            const noteInOctave = note % 12;\n            const isWhite = whiteKeys.includes(noteInOctave);\n\n            const key = document.createElement('div');\n            this.keys.set(note, key);\n\n            key.dataset.note = String(note);\n\n            if (isWhite) {\n                key.className = 'piano-key white';\n                key.style.width = `${whiteKeyWidth}%`;\n                key.style.left = `${whiteKeyIndex * whiteKeyWidth}%`;\n                whiteKeyIndex++;\n            } else {\n                key.className = 'piano-key black';\n                key.style.width = `${whiteKeyWidth * 0.7}%`;\n                key.style.left = `${(whiteKeyIndex - 1) * whiteKeyWidth + (whiteKeyWidth * 0.65)}%`;\n                key.style.zIndex = '2';\n            }\n\n            // Add keyboard hint label\n            const hint = this.getKeyHint(noteOctave, noteInOctave);\n            if (hint) {\n                const hintEl = document.createElement('span');\n                hintEl.className = 'key-hint';\n                hintEl.textContent = hint;\n                key.appendChild(hintEl);\n            }\n\n            // Mouse events\n            key.addEventListener('mousedown', (e) => {\n                if (e.buttons === 1) {\n                    this.triggerNoteOn(note);\n                    const upHandler = () => {\n                        this.triggerNoteOff(note);\n                        window.removeEventListener('mouseup', upHandler);\n                    };\n                    window.addEventListener('mouseup', upHandler);\n                }\n            });\n\n            key.addEventListener('mouseenter', (e) => {\n                if (e.buttons === 1) {\n                    this.triggerNoteOn(note);\n                    key.addEventListener('mouseleave', () => {\n                        this.triggerNoteOff(note);\n                    }, { once: true });\n                }\n            });\n\n            this.container.appendChild(key);\n        }\n    }\n\n    private getKeyHint(noteOctave: number, noteInOctave: number): string | null {\n        // Check if this note falls within keyboard-mapped range\n        const keyPair = PianoKeyboard.NOTE_TO_KEYS[noteInOctave];\n        if (!keyPair) return null;\n\n        // Lower octave (baseOctave) uses first key, upper (+1) uses second\n        if (noteOctave === this.baseOctave) {\n            return keyPair[0];\n        } else if (noteOctave === this.baseOctave + 1) {\n            return keyPair[1];\n        }\n        return null;\n    }\n\n    private triggerNoteOn(note: number) {\n        if (this.activeNotes.has(note)) return;\n        this.activeNotes.add(note);\n        this.setVisualizeState(note, true);\n        if (this.onNoteChange) this.onNoteChange(note, 127);\n    }\n\n    private triggerNoteOff(note: number) {\n        if (!this.activeNotes.has(note)) return;\n        this.activeNotes.delete(note);\n        this.setVisualizeState(note, false);\n        if (this.onNoteChange) this.onNoteChange(note, 0);\n    }\n\n    public setVisualizeState(note: number, on: boolean) {\n        const key = this.keys.get(note);\n        if (!key) return; // Out of range\n\n        if (on) {\n            key.classList.add('active');\n        } else {\n            key.classList.remove('active');\n        }\n    }\n\n    public setNoteChangeCallback(callback: (note: number, velocity: number) => void) {\n        this.onNoteChange = callback;\n    }\n}\n","\nexport type LFOWaveform = 'sine' | 'square' | 'saw' | 'triangle';\n\nexport class LFO {\n    public waveform: LFOWaveform = 'sine';\n    public frequency: number = 0.5; // Hz\n    public amplitude: number = 1.0; // 0-1 multiplier\n    private phase: number = 0; // 0-1\n\n    public offset: number = 0.0; // -1 to 1\n\n    constructor(freq: number = 1.0) {\n        this.frequency = freq;\n    }\n\n    public setWaveform(wave: LFOWaveform): void {\n        this.waveform = wave;\n    }\n\n    public setFrequency(freq: number): void {\n        this.frequency = freq;\n    }\n\n    public setAmplitude(amp: number): void {\n        this.amplitude = amp;\n    }\n\n    public setOffset(offset: number): void {\n        this.offset = offset;\n    }\n\n    public update(deltaTime: number): number {\n        // Increment phase (freq * seconds)\n        this.phase += this.frequency * deltaTime;\n        // Wrap 0-1\n        if (this.phase >= 1.0) this.phase -= Math.floor(this.phase);\n\n        let value = 0;\n        switch (this.waveform) {\n            case 'sine':\n                value = Math.sin(this.phase * 2 * Math.PI);\n                break;\n            case 'square':\n                value = this.phase < 0.5 ? 1.0 : -1.0;\n                break;\n            case 'saw':\n                // 1.0 to -1.0\n                value = 1.0 - 2.0 * this.phase;\n                break;\n            case 'triangle':\n                // -1 to 1 to -1\n                // 0.0 -> -1\n                // 0.5 -> 1\n                // 1.0 -> -1\n                // 4 * phase - 1 (0..0.5 maps to -1..1)\n                value = this.phase < 0.5\n                    ? 4.0 * this.phase - 1.0\n                    : 3.0 - 4.0 * this.phase;\n                break;\n        }\n\n        // Apply amplitude and offset\n        let output = (value * this.amplitude) + this.offset;\n\n        // Clamp to -1 to 1\n        return Math.max(-1.0, Math.min(1.0, output));\n    }\n}\n","import './style.css';\nimport { WebGLContext } from './gpu/context';\nimport { Renderer } from './gpu/renderer';\nimport { ControlPanel } from './ui/controls';\nimport { SpectrogramWebGL as Spectrogram } from './ui/spectrogram-webgl';\nimport { StereoScopeWebGL as StereoScope } from './ui/scope-webgl';\nimport { AudioEngine } from './audio/audio-engine';\nimport { AudioAnalyzer } from './audio/audio-analyzer';\nimport { MidiHandler } from './audio/midi-handler';\nimport { EnvelopeEditor } from './ui/envelope-editor';\nimport { PianoKeyboard } from './ui/piano';\nimport {\n    ReadingPathState, VolumeResolution, SynthMode, CarrierType,\n    VOLUME_DENSITY_X_DEFAULT, VOLUME_DENSITY_Y_DEFAULT, VOLUME_DENSITY_Z_DEFAULT,\n    GeneratorParams, PresetControls, OctaveDoublingState\n} from './types';\nimport { LFO, LFOWaveform } from './modulators/lfo';\n\n// Main application entry point\n// Initializes WebGL, UI, and wires up event handling\n\nclass SpectralTableApp {\n    private glContext: WebGLContext;\n    private renderer: Renderer;\n    private controls: ControlPanel;\n    private spectrogram: Spectrogram;\n    private scope: StereoScope;\n    private audioEngine: AudioEngine;\n    private audioAnalyzer: AudioAnalyzer;\n    private midiHandler: MidiHandler;\n    private piano: PianoKeyboard;\n    private canvas: HTMLCanvasElement;\n    private currentNote: number | null = null;\n    private animationFrameId: number = 0;\n\n    // Store uploaded spectral volumes\n    private uploadedVolumes: Map<string, Float32Array> = new Map();\n\n    // Animation state\n    private gameOfLifeActive = false;\n    private gameOfLifeSpeed = 0.5; // 0-1 range\n    private gameOfLifeLastUpdate = 0;\n\n    private sinePlasmaActive = false;\n    private sinePlasmaSpeed = 0.5; // 0-1 range\n    private sinePlasmaLastUpdate = 0;\n\n    // Modulation Logic\n    private lfos: LFO[] = [\n        new LFO(0.5),\n        new LFO(0.5)\n    ];\n    private pathYSource: string = 'none'; // 'none', 'lfo1', 'lfo2'\n    private scanPhaseSource: string = 'none';\n    private shapePhaseSource: string = 'none';\n\n    constructor() {\n        console.log('Spectra Table Synthesis - Initializing...');\n\n        // Initialize WebGL\n        this.canvas = document.getElementById('gl-canvas') as HTMLCanvasElement;\n        if (!this.canvas) throw new Error('Canvas not found');\n\n        this.glContext = new WebGLContext(this.canvas);\n\n        // Create renderer with default resolution\n        const defaultResolution: VolumeResolution = {\n            x: VOLUME_DENSITY_X_DEFAULT,\n            y: VOLUME_DENSITY_Y_DEFAULT,\n            z: VOLUME_DENSITY_Z_DEFAULT,\n        };\n        this.renderer = new Renderer(this.glContext, defaultResolution);\n\n        // Initialize UI controls\n        this.controls = new ControlPanel('controls', {\n            lfos: this.lfos,\n        });\n\n        // Create Spectrogram and Scope\n        this.spectrogram = new Spectrogram('spectrogram-canvas');\n        this.scope = new StereoScope('scope-canvas');\n\n        // Initialize Audio Engine\n        this.audioEngine = new AudioEngine();\n\n        // Initialize envelope editor logic\n        const envCanvas = this.controls.envelopeCanvas;\n        if (envCanvas) {\n            new EnvelopeEditor(envCanvas, this.audioEngine);\n        } else {\n            console.error('Envelope canvas not created in controls');\n        }\n\n        // Initialize Audio Analyzer\n        this.audioAnalyzer = new AudioAnalyzer();\n\n        // Initialize MIDI Handler\n        this.midiHandler = new MidiHandler();\n        this.midiHandler.setNoteChangeCallback(this.onMidiNote.bind(this));\n        this.midiHandler.setConnectionChangeCallback((isConnected) => {\n            if (isConnected) console.log('✓ MIDI Device Connected');\n            this.controls.updateMidiInputs(this.midiHandler.getInputs());\n        });\n\n        // Initialize Piano\n        this.piano = new PianoKeyboard('piano-container');\n\n        // Piano -> MidiHandler\n        this.piano.setNoteChangeCallback((note, velocity) => {\n            if (velocity > 0) {\n                this.midiHandler.simulateNoteOn(note, velocity);\n            } else {\n                this.midiHandler.simulateNoteOff(note);\n            }\n        });\n\n        // MidiHandler Raw -> Piano Visualization\n        this.midiHandler.setRawNoteCallback((note, velocity) => {\n            this.piano.setVisualizeState(note, velocity > 0);\n        });\n\n        // MIDI Input Selection\n        this.controls.setMidiInputChangeCallback((id) => {\n            this.midiHandler.selectInput(id);\n        });\n\n        this.controls.setOctaveChangeCallback((octave) => {\n            this.piano.setBaseOctave(octave);\n        });\n\n        // Initial input list population (might be empty initially)\n        setTimeout(() => {\n            this.controls.updateMidiInputs(this.midiHandler.getInputs());\n        }, 500);\n\n        // Wire up callbacks\n        this.controls.setPathChangeCallback(this.onPathChange.bind(this));\n        this.controls.setVolumeResolutionChangeCallback(this.onVolumeResolutionChange.bind(this));\n        this.controls.setSpectralDataChangeCallback(this.onSpectralDataChange.bind(this));\n        this.controls.setWavUploadCallback(this.onWavUpload.bind(this));\n        this.controls.setSynthModeChangeCallback(this.onSynthModeChange.bind(this));\n        this.controls.setCarrierChangeCallback(this.onCarrierChange.bind(this));\n        this.controls.setFeedbackChangeCallback(this.onFeedbackChange.bind(this));\n        this.controls.setOctaveDoublingChangeCallback(this.onOctaveDoublingChange.bind(this));\n        this.controls.setInterpSamplesChangeCallback((samples) => this.audioEngine.setInterpSamples(samples));\n        this.controls.setGeneratorParamsChangeCallback(this.onGeneratorParamsChange.bind(this));\n        this.controls.setPresetLoadCallback(this.onPresetLoad.bind(this));\n        this.controls.setRenderWavCallback(this.onRenderWav.bind(this));\n\n\n        // LFO Wiring\n        this.controls.setLFOParamChangeCallback((index, param, value) => {\n            const lfo = this.lfos[index];\n            if (!lfo) return;   // Invalid index\n            if (param === 'waveform') lfo.setWaveform(value as LFOWaveform);\n            if (param === 'frequency') lfo.setFrequency(value);\n            if (param === 'amplitude') lfo.setAmplitude(value);\n            if (param === 'offset') lfo.setOffset(value);\n        });\n\n        this.controls.setModulationRoutingChangeCallback((target, source) => {\n            if (target === 'pathY') this.pathYSource = source;\n            if (target === 'scanPhase') this.scanPhaseSource = source;\n            if (target === 'shapePhase') this.shapePhaseSource = source;\n        });\n\n        // Handle window resize\n        window.addEventListener('resize', this.onResize.bind(this));\n        this.onResize();\n\n        // Initialize audio engine early\n        this.audioEngine.initialize().then(() => {\n            console.log('✓ Audio engine ready (suspended until user interaction)');\n        });\n\n        // Wire up mouse events for 3D rotation\n        this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));\n        this.canvas.addEventListener('mousemove', this.onMouseMove.bind(this));\n        this.canvas.addEventListener('mouseup', this.onMouseUp.bind(this));\n        this.canvas.addEventListener('mouseleave', this.onMouseUp.bind(this));\n        this.canvas.addEventListener('wheel', this.onWheel.bind(this), { passive: false });\n\n        // Prevent context menu on right-click\n        this.canvas.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        // Resume audio on any canvas interaction\n        this.canvas.addEventListener('click', () => {\n            this.audioEngine.resume();\n        });\n\n        // Keyboard shortcuts\n        window.addEventListener('keydown', (e) => {\n            if (e.code === 'Space') {\n                e.preventDefault();\n                this.audioEngine.resume();\n                console.log('Audio resumed (Space)');\n            }\n        });\n\n        // Start render loop\n        this.startRenderLoop();\n\n        // Try to restore saved state\n        this.restoreSavedState();\n\n        console.log('✓ Application initialized');\n    }\n\n    private restoreSavedState(): void {\n        const savedState = this.controls.loadSavedState();\n        if (savedState) {\n            console.log('Restoring saved state...');\n            this.applyPresetState(savedState);\n        }\n    }\n\n    private onPresetLoad(controls: PresetControls): void {\n        console.log('Loading preset...');\n        this.applyPresetState(controls);\n    }\n\n    private applyPresetState(state: PresetControls): void {\n        // Apply to controls UI\n        this.controls.applyState(state);\n\n        // Apply to LFOs\n        this.lfos.forEach((lfo, index) => {\n            if (!state.lfos || index >= state.lfos.length) return;\n            lfo.setWaveform(state.lfos[index].waveform as any);\n            lfo.setFrequency(state.lfos[index].frequency);\n            lfo.setAmplitude(state.lfos[index].amplitude);\n            lfo.setOffset(state.lfos[index].offset);\n        });\n\n        // Apply modulation routing\n        this.pathYSource = state.modRouting.pathY;\n        this.scanPhaseSource = state.modRouting.scanPhase;\n        this.shapePhaseSource = state.modRouting.shapePhase;\n\n        // Apply audio settings\n        this.audioEngine.setMode(state.synthMode as SynthMode);\n        this.audioEngine.setWavetableFrequency(state.frequency);\n        this.audioEngine.setCarrier(state.carrier);\n        this.audioEngine.setFeedback(state.feedback);\n        this.audioEngine.setInterpSamples(state.interpSamples || 64);\n\n        // Apply amp envelope (always first envelope)\n        if (state.envelopes?.[0]) {\n            this.audioEngine.attack = state.envelopes[0].attack;\n            this.audioEngine.decay = state.envelopes[0].decay;\n            this.audioEngine.sustain = state.envelopes[0].sustain;\n            this.audioEngine.release = state.envelopes[0].release;\n        }\n\n        // Apply piano octave\n        this.piano.setBaseOctave(state.octave);\n\n        // Apply octave doubling\n        if (state.octaveDoubling) {\n            this.audioEngine.setOctaveDoubling(\n                state.octaveDoubling.lowCount,\n                state.octaveDoubling.highCount,\n                state.octaveDoubling.multiplier\n            );\n        }\n\n        // Apply volume resolution\n        const resolution = { x: state.densityX, y: state.densityY, z: state.densityZ };\n        this.renderer.updateVolumeResolution(resolution);\n\n        // Update generator params UI and trigger data generation\n        this.controls.updateGeneratorParamsUI(state.spectralData, state.generatorParams);\n\n        // Trigger spectral data change (will use generator params if available)\n        this.onSpectralDataChange(state.spectralData, state.generatorParams);\n\n        // Update path\n        this.onPathChange(this.controls.getState());\n\n        console.log('✓ State applied');\n    }\n\n    private onPathChange(state: ReadingPathState): void {\n        this.renderer.updateReadingPath(state);\n    }\n\n\n\n    private onVolumeResolutionChange(resolution: VolumeResolution): void {\n        console.log('Volume resolution changed:', resolution);\n        this.renderer.updateVolumeResolution(resolution);\n\n        // Re-generate current spectral data with new resolution\n        const currentData = (document.getElementById('spectral-data-type') as HTMLSelectElement)?.value || 'blank';\n\n        // Reinitialize Game of Life if it's active\n        if (currentData === 'game-of-life' && this.gameOfLifeActive) {\n            this.renderer.getSpectralVolume().initGameOfLife();\n            this.gameOfLifeLastUpdate = performance.now();\n            console.log('✓ Game of Life reinitialized with new density');\n        } else if (currentData === 'sine-plasma' && this.sinePlasmaActive) {\n            this.renderer.getSpectralVolume().generateSinePlasma(0);\n            this.sinePlasmaLastUpdate = performance.now();\n            console.log('✓ Sine Plasma reinitialized with new density');\n        } else if (!this.uploadedVolumes.has(currentData)) {\n            // Regenerate other built-in datasets\n            this.renderer.updateSpectralData(currentData);\n        }\n        // Note: Uploaded volumes maintain their data across resolution changes\n    }\n\n    private onSpectralDataChange(dataSet: string, initialParams?: GeneratorParams): void {\n        console.log('Spectral data changed:', dataSet);\n\n        // Stop any active animations\n        this.gameOfLifeActive = false;\n        this.sinePlasmaActive = false;\n\n        // Show generator params UI for supported generators\n        this.controls.updateGeneratorParamsUI(dataSet, initialParams);\n\n        // Check if it's an uploaded volume\n        if (this.uploadedVolumes.has(dataSet)) {\n            const volumeData = this.uploadedVolumes.get(dataSet)!;\n            this.renderer.getSpectralVolume().setData(volumeData);\n            this.controls.hideDynamicParam();\n        } else if (dataSet === 'game-of-life') {\n            // Initialize Game of Life with current params\n            const params = this.controls.getCurrentGeneratorParams();\n            this.renderer.updateSpectralData(dataSet, params || undefined);\n            this.gameOfLifeActive = true;\n            this.gameOfLifeLastUpdate = performance.now();\n\n            // Show dynamic parameter slider for evolution speed (0-1)\n            this.controls.showDynamicParam('Evolution Speed', 0, 1, 0.5, 0.01);\n            console.log('✓ Game of Life initialized');\n        } else if (dataSet === 'sine-plasma') {\n            // Initialize Sine Plasma with current params\n            const params = this.controls.getCurrentGeneratorParams();\n            this.renderer.updateSpectralData(dataSet, params || undefined);\n            this.sinePlasmaActive = true;\n            this.sinePlasmaLastUpdate = performance.now();\n\n            // Show dynamic parameter slider for evolution speed (0-1)\n            this.controls.showDynamicParam('Evolution Speed', 0, 1, 0.5, 0.01);\n            console.log('✓ Sine Plasma initialized with evolution');\n        } else {\n            // Built-in data sets with params\n            const params = this.controls.getCurrentGeneratorParams();\n            this.renderer.updateSpectralData(dataSet, params || undefined);\n            this.controls.hideDynamicParam();\n        }\n\n        // Resume audio when data changes\n        this.audioEngine.resume();\n    }\n\n    private onSynthModeChange(mode: SynthMode): void {\n        this.audioEngine.setMode(mode);\n        console.log(`✓ Synth mode: ${mode}`);\n    }\n\n    private onCarrierChange(carrier: CarrierType): void {\n        this.audioEngine.setCarrier(carrier);\n    }\n\n    private onFeedbackChange(amount: number): void {\n        this.audioEngine.setFeedback(amount);\n    }\n\n    private onOctaveDoublingChange(state: OctaveDoublingState): void {\n        this.audioEngine.setOctaveDoubling(\n            state.lowCount,\n            state.highCount,\n            state.multiplier\n        );\n    }\n\n    private onGeneratorParamsChange(dataSet: string, params: GeneratorParams): void {\n        // Regenerate with new params\n        this.renderer.updateSpectralData(dataSet, params);\n    }\n\n    private onMidiNote(note: number | null): void {\n        // Handle Note Off / All Keys Up\n        if (note === null) {\n            this.currentNote = null;\n            this.audioEngine.triggerRelease();\n            return;\n        }\n\n        // Avoid re-triggering if the highest note hasn't changed (e.g. releasing a lower key)\n        if (note === this.currentNote) {\n            return;\n        }\n\n        this.currentNote = note;\n\n        // Convert MIDI note to frequency\n        // f = 440 * 2^((n - 69) / 12)\n        const freq = 440 * Math.pow(2, (note - 69) / 12);\n\n        const mode = this.audioEngine.getMode();\n\n        if (mode === SynthMode.WAVETABLE) {\n            // Set wavetable frequency directly from MIDI\n            this.audioEngine.setWavetableFrequency(freq);\n        } else if (mode === SynthMode.SPECTRAL) {\n            // Spectral Mode Pitch Strategy\n            // Root = 440Hz (A4)\n            // Multiplier = TargetFreq / Root\n            const rootFreq = 440;\n            const multiplier = freq / rootFreq;\n\n            this.audioEngine.setSpectralPitch(multiplier);\n        }\n\n        // Trigger Envelope Attack (Multi-trigger behavior: every new note triggers attack)\n        this.audioEngine.triggerAttack();\n    }\n\n    private async onRenderWav(note: number, duration: number): Promise<void> {\n        console.log(`Rendering WAV for note ${note}, duration ${duration}s...`);\n\n        // Use current spectral snapshot from renderer\n        const spectralData = this.renderer.getReadingLineSpectralData();\n        const octaveDoubling = this.audioEngine.getOctaveDoubling();\n\n        // Get current state from controls\n        const state = this.controls.getFullState();\n\n        try {\n            const blob = await this.audioEngine.renderOffline(note, duration, spectralData, {\n                mode: state.synthMode as SynthMode,\n                wavetableParams: {\n                    frequency: 220, // Not used directly in offline render as note is passed\n                    carrier: state.carrier,\n                    feedback: state.feedback\n                },\n                octaveDoubling: {\n                    low: octaveDoubling.low,\n                    high: octaveDoubling.high,\n                    multiplier: octaveDoubling.multiplier\n                },\n                interpSamples: state.interpSamples\n            });\n\n            // Trigger download\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `spectral_sample_note_${note}.wav`;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            URL.revokeObjectURL(url);\n\n            console.log('✓ WAV render complete and downloaded');\n        } catch (error) {\n            console.error('Offline render failed:', error);\n            alert(`Failed to render WAV: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n\n    private async onWavUpload(files: FileList): Promise<void> {\n        const fileArray = Array.from(files);\n        console.log(`Processing ${fileArray.length} audio file(s) for morphing`);\n\n        try {\n            // Show progress\n            this.controls.showProgress();\n            this.controls.updateProgress(0);\n\n            // Get current volume resolution\n            const resolution = this.renderer.getSpectralVolume().getResolution();\n\n            // Set Y density to number of files\n            const numSamples = fileArray.length;\n            const newResolution = {\n                ...resolution,\n                y: numSamples\n            };\n\n            // Update Y density slider\n            this.controls.setVolumeDensity(newResolution);\n            this.renderer.updateVolumeResolution(newResolution);\n\n            // Analyze all files and build the morphing volume\n            const volumeData = await this.audioAnalyzer.analyzeMultipleFiles(\n                fileArray,\n                newResolution,\n                (percent) => this.controls.updateProgress(percent)\n            );\n\n            // Store the volume data\n            const volumeName = fileArray.length === 1\n                ? fileArray[0].name.replace(/\\.[^/.]+$/, '')\n                : `Morph_${fileArray.length}_samples`;\n\n            this.uploadedVolumes.set(volumeName, volumeData);\n\n            // Set volume data directly\n            this.renderer.getSpectralVolume().setData(volumeData);\n\n            // Add to dropdown and select it\n            this.controls.addSpectralDataOption(volumeName, volumeName);\n\n            console.log(`✓ Processed ${fileArray.length} file(s) into morphing volume`);\n        } catch (error) {\n            console.error('Failed to process audio file(s):', error);\n            alert(`Error processing audio file(s): ${error instanceof Error ? error.message : 'Unknown error'}`);\n        } finally {\n            // Hide progress\n            setTimeout(() => this.controls.hideProgress(), 500);\n        }\n    }\n\n    private onResize(): void {\n        const rect = this.canvas.getBoundingClientRect();\n        this.renderer.resize(rect.width, rect.width);\n    }\n\n    private onMouseDown(event: MouseEvent): void {\n        this.renderer.onMouseDown(event.clientX, event.clientY, event.button);\n\n        // Resume audio context on user interaction\n        this.audioEngine.resume();\n    }\n\n    private onMouseMove(event: MouseEvent): void {\n        this.renderer.onMouseMove(event.clientX, event.clientY);\n    }\n\n    private onMouseUp(): void {\n        this.renderer.onMouseUp();\n    }\n\n    private onWheel(event: WheelEvent): void {\n        event.preventDefault();\n        this.renderer.zoom(event.deltaY);\n    }\n\n    private startRenderLoop(): void {\n        let lastTime = performance.now();\n\n        const render = (time: number) => {\n            const deltaTime = (time - lastTime) / 1000; // Seconds\n            lastTime = time;\n\n            // Update Game of Life animation\n            if (this.gameOfLifeActive && this.gameOfLifeSpeed > 0) {\n                // Speed 0 = paused\n                // Speed 1 = instant (no delay)\n                // Map speed to delay: at 1.0 -> 0ms delay, at 0.01 -> 1000ms delay\n                const delay = (1.0 - this.gameOfLifeSpeed) * 1000;\n                const timeSinceLastUpdate = time - this.gameOfLifeLastUpdate;\n\n                if (timeSinceLastUpdate >= delay) {\n                    this.renderer.getSpectralVolume().stepGameOfLife();\n                    this.gameOfLifeLastUpdate = time;\n                }\n            }\n\n            // Update Sine Plasma animation\n            if (this.sinePlasmaActive && this.sinePlasmaSpeed > 0) {\n                // Speed 0 = static\n                // Speed 1 = fast evolution (every frame)\n                // Speed controls frequency of updates\n                const delay = (1.0 - this.sinePlasmaSpeed) * 100; // Max 100ms between updates\n                const timeSinceLastUpdate = time - this.sinePlasmaLastUpdate;\n\n                if (timeSinceLastUpdate >= delay) {\n                    this.renderer.getSpectralVolume().stepSinePlasma();\n                    this.sinePlasmaLastUpdate = time;\n                }\n            }\n\n            // LFO modulation update\n            this.lfos.forEach((lfo, index) => {\n                const lfoOut = lfo.update(deltaTime);\n                const sourceName = `lfo${index + 1}`;\n                if (this.pathYSource === sourceName) {\n                    this.controls.updatePathY(lfoOut);\n                }\n                if (this.scanPhaseSource === sourceName) {\n                    this.controls.updateScanPosition(lfoOut);\n                }\n                if (this.shapePhaseSource === sourceName) {\n                    const state = this.controls.getState();\n                    state.shapePhase = lfoOut;\n                    this.renderer.updateReadingPath(state);\n                }\n            });\n\n            this.renderer.render(deltaTime);\n\n            // Get spectral data (RGBA)\n            const spectralData = this.renderer.getReadingLineSpectralData();\n\n            // Update Audio\n            this.audioEngine.updateSpectralData(spectralData);\n\n            // Get Audio FFT data\n            const audioSpectralData = this.audioEngine.getAudioSpectralData();\n\n            // Update Visualizations\n            this.spectrogram.update(spectralData, audioSpectralData.left);\n\n            // Update Scope\n            const scopeData = this.audioEngine.getScopeData();\n            this.scope.draw(scopeData.left, scopeData.right);\n\n            this.animationFrameId = requestAnimationFrame(render);\n        };\n        requestAnimationFrame(render);\n    }\n\n    public destroy(): void {\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n        }\n        this.renderer.destroy();\n    }\n}\n\n// Initialize app when DOM is ready\nconst app = new SpectralTableApp();\n\n// Cleanup on page unload\nwindow.addEventListener('beforeunload', () => {\n    app.destroy();\n});\n"],"names":["WebGLContext","canvas","__publicField","gl","required","ext","width","height","r","g","b","wireframeVertexShader","wireframeFragmentShader","pointVertexShader","pointFragmentShader","planeVertexShader","planeFragmentShader","mat4Identity","m","mat4Perspective","fov","aspect","near","far","f","nf","mat4LookAt","eye","center","up","z0","z1","z2","len","zx","zy","zz","x0","x1","x2","xx","xy","xz","yx","yy","yz","mat4RotateX","angle","c","s","mat4RotateY","mat4RotateZ","mat4Translate","x","y","z","mat4Multiply","a","out","i","j","vec3TransformMat4","v","w","iw","PlaneType","VOLUME_DENSITY_X_MIN","VOLUME_DENSITY_X_MAX","VOLUME_DENSITY_X_DEFAULT","VOLUME_DENSITY_Y_MIN","VOLUME_DENSITY_Y_MAX","VOLUME_DENSITY_Y_DEFAULT","VOLUME_DENSITY_Z_MIN","VOLUME_DENSITY_Z_MAX","VOLUME_DENSITY_Z_DEFAULT","SynthMode","defaultOctaveDoublingState","defaultJuliaParams","defaultMandelbulbParams","defaultMengerParams","defaultPlasmaParams","defaultGameOfLifeParams","STORAGE_KEY_STATE","STORAGE_KEY_PRESETS","SpectralVolume","ctx","resolution","totalVoxels","memoryMB","data","params","scale","cReal","cImag","maxIter","power","cx","cy","cz","idx","iz","iy","ix","px","py","pz","iter","theta","phi","zr","newTheta","newPhi","mag","freqBoost","phase","custom1","custom2","iterations","isInSponge","ux","uy","uz","gx","gy","gz","midX","midY","midZ","inSponge","detail","timeOffset","frequency","complexity","contrast","nx","ny","nz","layers","dist","maxV","h","d","u","w_coord","y0","fx","fy","fz","y1","getIdx","c000","c100","c010","c110","c001","c101","c011","c111","result","v000","v100","v010","v110","v001","v101","v011","v111","c00","c10","c01","c11","c0","c1","totalCells","birthMin","surviveMin","wx","wy","neighbors","dz","dy","dx","nIdx","temp","cellIdx","alive","ReadingPathGeometry","planeType","gridSize","positions","indices","topLeft","topRight","bottomLeft","bottomRight","resolutionX","currentZ","Renderer","initialResolution","wireMVP","wireColor","pointMVP","pointVolume","pointAlpha","pointSize","pointVolumeRes","planeMVP","planeModel","planeVolume","planeAlpha","char","lines","l","y2","text","startX","startY","startZ","axis","vertices","cursor","lx","ly","lz","newVerts","charPoints","k","origin","length","arrowSize","xStart","tipX","labelX","xCount","yStart","tipY","labelY","yCount","zStart","tipZ","labelZ","zCount","vao","vbo","posLoc","vertexSrc","fragmentSrc","vertexShader","log","fragmentShader","program","vertexBuffer","aPositionLoc","indexBuffer","totalPoints","buffer","planeVAO","planeVBO","planePosLoc","planeIBO","linePositions","lineVAO","lineVBO","linePosLoc","deltaTime","projection","view","rotX","rotY","model","viewModel","cameraMVP","offset","res","pRotX","pRotY","pRotZ","pTrans","worldPlaneModel","planeViewModel","state","typeChanged","scanChanged","phaseChanged","dataSet","numPoints","worldPos","tx","ty","tz","sample","button","sensitivity","delta","decay","PresetManager","stored","name","controls","preset","existingIdx","p","e","callback","WAVEFORM_ICONS","SECTION_ICONS","CONTROL_STYLE","createSection","parent","title","mode","card","header","iconContainer","createSlider","id","label","min","max","value","step","onInput","group","labelEl","valueDisplay","updateDisplay","val","slider","createKnobElement","labelRow","input","container","svg","track","describeArc","valueArc","modArc","pointer","updateKnob","endAngle","inputAny","amp","startVal","endVal","startP","endP","sAngle","eAngle","rad","isDragging","onMouseMove","moveEvent","deltaY","newVal","onMouseUp","originalValueSetter","polarToCartesian","centerX","centerY","radius","angleInDegrees","angleInRadians","startAngle","start","end","largeArcFlag","createSelect","options","onChange","select","opt","optEl","createButton","onClick","className","createModulatableSlider","lfoLabels","onSliderInput","onSourceChange","sourceSelect","option","valueRow","createFileInput","accept","multiple","createNumberInput","ControlPanel","containerId","el","lfo","index","subGroup","subGroup2","files","defaultOpt","buttonGroup","lfoOptions","spGroup","_val","source","nGroup","pathYControl","_v","scanControl","subGroup3","harmTitle","octaveUpdate","_","volUpdate","element","row","baseNoteInput","durationInput","note","duration","wrapper","waveSelect","waveLabelRow","carrierVal","keys","currentValue","presets","carrierEl","key","o","feedbackEl","octaveEl","lfoData","pathYDisplay","scanDisplay","fbDisplay","fbEl","dxDisplay","dyDisplay","dzDisplay","syncMod","lfoIdx","initialParams","triggerUpdate","createParamSlider","progressContainer","spinner","progressBar","progressFill","progressText","percent","inputs","currentSelection","pos","display","event","xDisplay","yDisplay","zDisplay","SpectrogramWebGL","visContent","visGroup","type","shader","vsSource","fsSource","vs","fs","scanlineData","audioDataLeft","uploadData","isAudio","dataWidth","StereoScopeWebGL","quadVertices","quadVBO","left","right","numSamples","modeLoc","colorLoc","samplesLoc","SPECTRAL_PROCESSOR_CODE","WAVETABLE_PROCESSOR_CODE","WHITENOISE_PROCESSOR_CODE","AudioEngine","spectralBlob","wavetableBlob","whitenoiseBlob","spectralUrl","wavetableUrl","whitenoiseUrl","processorName","freq","amount","low","high","multiplier","samples","supported","now","currentGain","currentSpectralData","totalDuration","lengthSamples","offlineCtx","node","masterGain","targetFreq","releaseStart","renderedBuffer","numOfChan","channels","setUint32","setUint16","AudioAnalyzer","volumeSize","onProgress","xSize","ySize","zSize","numFiles","volumeData","fileIdx","file","arrayBuffer","audioBuffer","channelData","sampleRate","yPosition","yIndex","fftSize","samplesNeeded","processedData","minFreq","maxFreq","startSample","signal","spectrum","normalizedX","binIndex","safeBinIndex","magnitude","fileProgress","sliceProgress","resolve","totalSamples","totalIterations","iterationCount","lastYieldTime","stepSize","numBins","targetLength","output","ratio","srcPos","srcIdx","frac","N","real","imag","n","MidiHandler","err","message","status","data1","data2","command","velocity","highestNote","EnvelopeEditor","containerOrId","engine","t","aTime","dTime","sLevel","rTime","p0","p1","p2","p3","p4","timeSinceNote","playHeadX","sustainTime","maxSustainX","active","usableHeight","rect","nodes","time","newDecay","startOfRelease","newRelease","_PianoKeyboard","octave","mapping","octaveOffset","noteInOctave","whiteKeys","numWhiteKeys","whiteKeyWidth","whiteKeyIndex","noteOctave","isWhite","hint","hintEl","upHandler","keyPair","on","PianoKeyboard","LFO","wave","SpectralTableApp","defaultResolution","Spectrogram","StereoScope","envCanvas","isConnected","param","target","savedState","currentData","carrier","spectralData","octaveDoubling","blob","url","error","fileArray","newResolution","volumeName","lastTime","render","delay","lfoOut","sourceName","audioSpectralData","scopeData","app"],"mappings":"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,MAAM0d,GAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA0P1BC,GAA2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAqO3BC,GAA4B;AAAA;AAAA;AAAA;AAAA;AAA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"}