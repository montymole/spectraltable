{"version":3,"file":"index-GmN-bx8R.js","sources":["../../src/gpu/context.ts","../../src/gpu/shaders.ts","../../src/gpu/math.ts","../../src/gpu/spectral-volume.ts","../../src/types/index.ts","../../src/gpu/reading-path.ts","../../src/gpu/renderer.ts","../../src/ui/controls.ts","../../src/ui/spectrogram.ts","../../src/ui/scope.ts","../../src/audio/audio-engine.ts","../../src/audio/audio-analyzer.ts","../../src/audio/midi-handler.ts","../../src/ui/envelope-editor.ts","../../src/ui/piano.ts","../../src/modulators/lfo.ts","../../src/main.ts"],"sourcesContent":["// WebGL2 context manager with extension validation\n\nexport class WebGLContext {\n    public readonly gl: WebGL2RenderingContext;\n    private canvas: HTMLCanvasElement;\n\n    constructor(canvas: HTMLCanvasElement) {\n        this.canvas = canvas;\n\n        const gl = canvas.getContext('webgl2', {\n            alpha: false,\n            antialias: true,\n            depth: true,\n        });\n\n        if (!gl) {\n            throw new Error('WebGL2 not supported');\n        }\n\n        this.gl = gl;\n        this.validateExtensions();\n        this.logInfo();\n    }\n\n    private validateExtensions(): void {\n        const required = ['EXT_color_buffer_float'];\n\n        for (const ext of required) {\n            if (!this.gl.getExtension(ext)) {\n                throw new Error(`Required WebGL extension not available: ${ext}`);\n            }\n        }\n    }\n\n    private logInfo(): void {\n        const gl = this.gl;\n        console.log('✓ WebGL2 Context Created');\n        console.log('  Vendor:', gl.getParameter(gl.VENDOR));\n        console.log('  Renderer:', gl.getParameter(gl.RENDERER));\n        console.log('  Version:', gl.getParameter(gl.VERSION));\n        console.log('  GLSL Version:', gl.getParameter(gl.SHADING_LANGUAGE_VERSION));\n    }\n\n    public resize(width: number, height: number): void {\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.gl.viewport(0, 0, width, height);\n    }\n\n    public clear(r: number, g: number, b: number): void {\n        this.gl.clearColor(r, g, b, 1.0);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n    }\n}\n","// Shader source code for rendering\n\n// ====== Wireframe Cube Shaders ======\n\nexport const wireframeVertexShader = `#version 300 es\nprecision highp float;\n\nin vec3 aPosition;\nuniform mat4 uModelViewProjection;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aPosition, 1.0);\n}\n`;\n\nexport const wireframeFragmentShader = `#version 300 es\nprecision highp float;\n\nuniform vec3 uColor;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(uColor, 1.0);\n}\n`;\n\n// ====== Point Cloud Shaders (for spectral volume visualization) ======\n\nexport const pointVertexShader = `#version 300 es\nprecision highp float;\nprecision highp sampler3D;\n\nin vec3 aPosition;\nuniform mat4 uModelViewProjection;\nuniform float uPointSize;\nuniform sampler3D uVolume;\nuniform vec3 uVolumeRes; // Volume resolution (x, y, z) for density calculation\n\nout vec4 vColor;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aPosition, 1.0);\n  \n  // Sample volume data\n  vec3 texCoord = (aPosition + 1.0) * 0.5;\n  vec4 data = texture(uVolume, texCoord);\n  \n  // R = Magnitude, G = Phase, B = Custom1, A = Custom2\n  float magnitude = data.r;\n  float phase = data.g;\n  \n  // Calculate maximum point size based on grid density\n  // Points should not be larger than the grid cell spacing\n  float minRes = min(min(uVolumeRes.x, uVolumeRes.y), uVolumeRes.z);\n  float maxPointSize = (2.0 / minRes) * 100.0; // Grid cell size in screen space (approximate)\n  \n  // Size based on magnitude with logarithmic scaling\n  // Logarithmic scale makes low magnitudes more visible while preserving dynamics\n  float size = uPointSize;\n  if (magnitude > 0.001) {\n      // log(1 + x*k) gives gentle compression, making dim points visible\n      size = uPointSize * (1.0 + log(1.0 + magnitude * 20.0) * 1.5);\n  }\n  \n  // Clamp to max size based on density\n  size = min(size, maxPointSize);\n  \n  gl_PointSize = size;\n  \n  // Pass color to fragment shader\n  // R channel = Magnitude (Red)\n  // G channel = Phase (Green)\n  // Mix them for visualization\n  vColor = vec4(magnitude, phase, 0.2, magnitude); \n}\n`;\n\nexport const pointFragmentShader = `#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nuniform float uAlpha;\nout vec4 fragColor;\n\nvoid main() {\n  // Make points circular (not square)\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n  \n  // Use color from vertex shader, modulate alpha\n  // If magnitude is low, make it very transparent\n  float alpha = uAlpha;\n  if (vColor.r > 0.01) {\n      alpha = uAlpha + vColor.r * 0.5; // More opacity for higher magnitude\n  }\n  \n  fragColor = vec4(vColor.rgb, alpha);\n}\n`;\n\n// ====== Plane Shaders (for reading path visualization) ======\n\nexport const planeVertexShader = `#version 300 es\nprecision highp float;\nprecision highp sampler3D;\n\nin vec3 aPosition;\nuniform mat4 uModelViewProjection;\nuniform mat4 uModelMatrix; // To transform position to world space for sampling\nuniform sampler3D uVolume;\n\nout vec4 vColor;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aPosition, 1.0);\n  \n  // Transform position to world space (which matches volume space [-1, 1])\n  // Note: The plane is transformed by uModelMatrix (rotation/translation)\n  // We need to sample the volume at this transformed position.\n  // However, uModelViewProjection includes View and Projection.\n  // We need a separate uModelMatrix to get world coordinates.\n  // BUT, wait. The plane vertices are local to the plane.\n  // The plane moves through the volume.\n  // So we need to apply the plane's transformation to get volume coordinates.\n  \n  vec4 worldPos = uModelMatrix * vec4(aPosition, 1.0);\n  vec3 texCoord = (worldPos.xyz + 1.0) * 0.5;\n  \n  // Sample volume\n  // Use trilinear filtering (hardware or manual if needed, but hardware linear is usually fine)\n  vec4 data = texture(uVolume, texCoord);\n  \n  // Visualize data\n  // R = Magnitude -> Red/Intensity\n  // G = Phase -> Green/Variation\n  float mag = data.r;\n  float phase = data.g;\n  \n  // Base color (teal) mixed with data\n  vec3 baseColor = vec3(0.0, 1.0, 0.5);\n  vec3 activeColor = vec3(1.0, 0.2, 0.2); // Reddish for high magnitude\n  \n  // Mix based on magnitude\n  vec3 finalColor = mix(baseColor, activeColor, mag);\n  \n  // Add phase influence to green channel\n  finalColor.g += phase * 0.3;\n  \n  vColor = vec4(finalColor, 1.0);\n}\n`;\n\nexport const planeFragmentShader = `#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nuniform float uAlpha;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(vColor.rgb, uAlpha);\n}\n`;\n","// Simple 4x4 matrix operations for MVP transforms\n// Carmack-style: simple, direct, no abstraction\n\nexport type Mat4 = Float32Array; // 16 elements, column-major\n\nexport function mat4Identity(): Mat4 {\n    const m = new Float32Array(16);\n    m[0] = m[5] = m[10] = m[15] = 1.0;\n    return m;\n}\n\nexport function mat4Perspective(fov: number, aspect: number, near: number, far: number): Mat4 {\n    const f = 1.0 / Math.tan(fov / 2.0);\n    const nf = 1.0 / (near - far);\n\n    const m = new Float32Array(16);\n    m[0] = f / aspect;\n    m[5] = f;\n    m[10] = (far + near) * nf;\n    m[11] = -1.0;\n    m[14] = 2.0 * far * near * nf;\n    return m;\n}\n\nexport function mat4LookAt(eye: [number, number, number], center: [number, number, number], up: [number, number, number]): Mat4 {\n    const z0 = eye[0] - center[0];\n    const z1 = eye[1] - center[1];\n    const z2 = eye[2] - center[2];\n\n    let len = 1.0 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n    const zx = z0 * len;\n    const zy = z1 * len;\n    const zz = z2 * len;\n\n    const x0 = up[1] * zz - up[2] * zy;\n    const x1 = up[2] * zx - up[0] * zz;\n    const x2 = up[0] * zy - up[1] * zx;\n\n    len = 1.0 / Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n    const xx = x0 * len;\n    const xy = x1 * len;\n    const xz = x2 * len;\n\n    const yx = zy * xz - zz * xy;\n    const yy = zz * xx - zx * xz;\n    const yz = zx * xy - zy * xx;\n\n    const m = new Float32Array(16);\n    m[0] = xx;\n    m[1] = yx;\n    m[2] = zx;\n    m[4] = xy;\n    m[5] = yy;\n    m[6] = zy;\n    m[8] = xz;\n    m[9] = yz;\n    m[10] = zz;\n    m[12] = -(xx * eye[0] + xy * eye[1] + xz * eye[2]);\n    m[13] = -(yx * eye[0] + yy * eye[1] + yz * eye[2]);\n    m[14] = -(zx * eye[0] + zy * eye[1] + zz * eye[2]);\n    m[15] = 1.0;\n    return m;\n}\n\nexport function mat4RotateX(angle: number): Mat4 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    const m = mat4Identity();\n    m[5] = c;\n    m[6] = s;\n    m[9] = -s;\n    m[10] = c;\n    return m;\n}\n\nexport function mat4RotateY(angle: number): Mat4 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    const m = mat4Identity();\n    m[0] = c;\n    m[2] = -s;\n    m[8] = s;\n    m[10] = c;\n    return m;\n}\n\nexport function mat4RotateZ(angle: number): Mat4 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    const m = mat4Identity();\n    m[0] = c;\n    m[1] = s;\n    m[4] = -s;\n    m[5] = c;\n    return m;\n}\n\nexport function mat4Translate(x: number, y: number, z: number): Mat4 {\n    const m = mat4Identity();\n    m[12] = x;\n    m[13] = y;\n    m[14] = z;\n    return m;\n}\n\nexport function mat4Multiply(a: Mat4, b: Mat4): Mat4 {\n    const out = new Float32Array(16);\n\n    for (let i = 0; i < 4; i++) {\n        for (let j = 0; j < 4; j++) {\n            out[j * 4 + i] =\n                a[0 * 4 + i] * b[j * 4 + 0] +\n                a[1 * 4 + i] * b[j * 4 + 1] +\n                a[2 * 4 + i] * b[j * 4 + 2] +\n                a[3 * 4 + i] * b[j * 4 + 3];\n        }\n    }\n\n    return out;\n}\n\nexport function vec3TransformMat4(v: [number, number, number], m: Mat4): [number, number, number] {\n    const x = v[0], y = v[1], z = v[2];\n    const w = m[3] * x + m[7] * y + m[11] * z + m[15];\n    const iw = w !== 0 ? 1.0 / w : 1.0;\n\n    return [\n        (m[0] * x + m[4] * y + m[8] * z + m[12]) * iw,\n        (m[1] * x + m[5] * y + m[9] * z + m[13]) * iw,\n        (m[2] * x + m[6] * y + m[10] * z + m[14]) * iw\n    ];\n}\n","import { WebGLContext } from './context';\nimport { VolumeResolution } from '../types';\n\n// 3D Spectral Volume - GPU storage for RGBA spectral data\n// Each voxel stores: R=Magnitude, G=Phase, B=Custom1, A=Custom2\n\nexport class SpectralVolume {\n    private ctx: WebGLContext;\n    private texture: WebGLTexture | null = null;\n    private resolution: VolumeResolution;\n\n    private data: Float32Array | null = null;\n\n    // Game of Life 3D state\n    private gameOfLifeState: Uint8Array | null = null;  // Binary cell states\n    private gameOfLifeBuffer: Uint8Array | null = null; // Double buffer for updates\n\n    constructor(ctx: WebGLContext, resolution: VolumeResolution) {\n        this.ctx = ctx;\n        this.resolution = resolution;\n        this.initialize();\n    }\n\n    private initialize(): void {\n        const gl = this.ctx.gl;\n\n        // Clean up old texture if exists\n        if (this.texture) {\n            gl.deleteTexture(this.texture);\n        }\n\n        // Create 3D texture\n        this.texture = gl.createTexture();\n        if (!this.texture) throw new Error('Failed to create 3D texture');\n\n        gl.bindTexture(gl.TEXTURE_3D, this.texture);\n\n        // Allocate storage (RGBA32F format)\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n\n        // Initialize data array if not exists or size changed\n        if (!this.data || this.data.length !== totalVoxels * 4) {\n            this.data = new Float32Array(totalVoxels * 4); // RGBA\n            this.data.fill(0.0);\n        }\n\n        gl.texImage3D(\n            gl.TEXTURE_3D,\n            0,                    // mip level\n            gl.RGBA32F,           // internal format\n            x, y, z,              // dimensions\n            0,                    // border (must be 0)\n            gl.RGBA,              // format\n            gl.FLOAT,             // type\n            this.data             // data\n        );\n\n        // Set texture parameters (no filtering for now, nearest neighbor)\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_3D, gl.TEXTURE_WRAP_R, gl.CLAMP_TO_EDGE);\n\n        gl.bindTexture(gl.TEXTURE_3D, null);\n\n        const memoryMB = (totalVoxels * 4 * 4) / (1024 * 1024); // 4 floats, 4 bytes each\n        console.log(`✓ Spectral Volume: ${x}×${y}×${z} = ${totalVoxels} voxels (${memoryMB.toFixed(2)} MB)`);\n    }\n\n    public setData(data: Float32Array): void {\n        const gl = this.ctx.gl;\n        const { x, y, z } = this.resolution;\n\n        if (data.length !== x * y * z * 4) {\n            throw new Error('Data length does not match volume resolution');\n        }\n\n        this.data = data; // Store reference\n\n        gl.bindTexture(gl.TEXTURE_3D, this.texture);\n        gl.texSubImage3D(\n            gl.TEXTURE_3D,\n            0,\n            0, 0, 0,\n            x, y, z,\n            gl.RGBA,\n            gl.FLOAT,\n            data\n        );\n        gl.bindTexture(gl.TEXTURE_3D, null);\n    }\n\n    public generate3DJulia(): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        // 3D Julia Set - using parameters that create a sparser structure\n        const maxIter = 12;  // More iterations for better detail\n        const power = 8.0;\n        const scale = 2.2;   // Larger scale to sample outside dense core\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    const shiftedX = (nx + 1) * scale - 1.0;\n                    const shiftedY = ny * scale;\n                    const shiftedZ = nz * scale;\n\n                    // Different C constant for sparser region\n                    const cx = -0.2;\n                    const cy = 0.6;\n                    const cz = 0.2;\n\n                    let zx = shiftedX;\n                    let zy = shiftedY;\n                    let zz = shiftedZ;\n\n                    let r = 0.0;\n                    let iter = 0;\n\n                    for (; iter < maxIter; iter++) {\n                        r = Math.sqrt(zx * zx + zy * zy + zz * zz);\n                        if (r > 2.0) break;  // Lower threshold\n\n                        let theta = Math.acos(zz / r);\n                        let phi = Math.atan2(zy, zx);\n\n                        const zr = Math.pow(r, power);\n                        theta = theta * power;\n                        phi = phi * power;\n\n                        zx = zr * Math.sin(theta) * Math.cos(phi);\n                        zy = zr * Math.sin(theta) * Math.sin(phi);\n                        zz = zr * Math.cos(theta);\n\n                        zx += cx;\n                        zy += cy;\n                        zz += cz;\n                    }\n\n                    let mag = 0.0;\n\n                    // Only the boundary region (escaped points) will have magnitude\n                    if (iter < maxIter && iter > 2) {\n                        const smoothIter = iter + 1 - Math.log(Math.log(r)) / Math.log(2);\n                        mag = Math.max(0, 1.0 - (smoothIter / maxIter));\n\n                        // Apply power curve to create gaps (more aggressive)\n                        mag = Math.pow(mag, 2.5);\n\n                        // Apply threshold - only keep stronger values\n                        if (mag < 0.25) {\n                            mag = 0.0;\n                        } else {\n                            // Rescale after threshold\n                            mag = (mag - 0.25) / 0.75;\n                        }\n                    }\n\n                    // Boost low frequencies slightly\n                    const freqBoost = 1.0 + (1.0 - (nx + 1) * 0.5) * 0.3;\n                    mag *= freqBoost;\n                    mag = Math.min(1.0, mag);\n\n                    const phase = (iter / maxIter + nx * 0.1) % 1.0;\n                    const custom1 = (ny + 1) * 0.5;  // Generic value (Y-based)\n                    const custom2 = (nz + 1) * 0.5;  // Generic value (Z-based)\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    public generateMandelbulb(): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        const maxIter = 12;\n        const power = 8.0;\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    // Shift to low freq corner\n                    const px = (nx + 1) * 1.2 - 1.0;\n                    const py = ny * 1.2;\n                    const pz = nz * 1.2;\n\n                    let zx = 0, zy = 0, zz = 0;\n                    let dr = 1.0;\n                    let r = 0.0;\n                    let iter = 0;\n\n                    for (; iter < maxIter; iter++) {\n                        r = Math.sqrt(zx * zx + zy * zy + zz * zz);\n                        if (r > 2.0) break;\n\n                        let theta = Math.acos(zz / r);\n                        let phi = Math.atan2(zy, zx);\n                        dr = Math.pow(r, power - 1.0) * power * dr + 1.0;\n\n                        const zr = Math.pow(r, power);\n                        theta = theta * power;\n                        phi = phi * power;\n\n                        zx = zr * Math.sin(theta) * Math.cos(phi) + px;\n                        zy = zr * Math.sin(theta) * Math.sin(phi) + py;\n                        zz = zr * Math.cos(theta) + pz;\n                    }\n\n                    let mag = 0.0;\n                    if (iter < maxIter) {\n                        const dist = 0.5 * Math.log(r) * r / dr;\n                        mag = Math.max(0, 1.0 - dist * 8.0);\n                    }\n\n                    // Apply gamma to create gaps\n                    mag = Math.pow(mag, 1.8);\n\n                    const freqBoost = 1.0 + (1.0 - (nx + 1) * 0.5) * 0.4;\n                    mag *= freqBoost;\n\n                    const phase = (iter / maxIter);\n                    const custom1 = (ny + 1) * 0.5;  // Generic value (Y-based)\n                    const custom2 = (nz + 1) * 0.5;  // Generic value (Z-based)\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    public generateMengerSponge(): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    // Shift to low freq\n                    let px = (nx + 1) * 1.5;\n                    let py = (ny + 1) * 1.5;\n                    let pz = (nz + 1) * 1.5;\n\n                    let inSponge = true;\n                    let scale = 1.0;\n\n                    // Iterate sponge subdivisions\n                    for (let i = 0; i < 4; i++) {\n                        px = Math.abs(px);\n                        py = Math.abs(py);\n                        pz = Math.abs(pz);\n\n                        // Check if in center third (hole)\n                        if (px > scale / 3 && px < 2 * scale / 3 &&\n                            py > scale / 3 && py < 2 * scale / 3) {\n                            inSponge = false;\n                            break;\n                        }\n                        if (py > scale / 3 && py < 2 * scale / 3 &&\n                            pz > scale / 3 && pz < 2 * scale / 3) {\n                            inSponge = false;\n                            break;\n                        }\n                        if (pz > scale / 3 && pz < 2 * scale / 3 &&\n                            px > scale / 3 && px < 2 * scale / 3) {\n                            inSponge = false;\n                            break;\n                        }\n\n                        px = px * 3.0 % scale;\n                        py = py * 3.0 % scale;\n                        pz = pz * 3.0 % scale;\n                        scale /= 3.0;\n                    }\n\n                    let mag = inSponge ? 0.7 : 0.0;\n\n                    // Add surface detail\n                    const dist = Math.sqrt(px * px + py * py + pz * pz);\n                    mag *= 0.8 + 0.2 * Math.sin(dist * 20);\n\n                    const freqBoost = 1.0 + (1.0 - (nx + 1) * 0.5) * 0.3;\n                    mag *= freqBoost;\n\n                    const phase = (px + py + pz) % 1.0;\n                    const custom1 = (ny + 1) * 0.5;  // Generic value (Y-based)\n                    const custom2 = (nz + 1) * 0.5;  // Generic value (Z-based)\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    // Sine Plasma state for evolution\n    private plasmaTime: number = 0;\n\n    public generateSinePlasma(timeOffset: number = 0): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Normalized coordinates -1 to 1\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    // Demo-scene style plasma: sum of sines\n                    let v = 0.0;\n\n                    // 1. Basic waves along axes\n                    v += Math.sin(nx * 3.0 + timeOffset);\n                    v += Math.sin(ny * 2.5 + timeOffset * 0.8);\n                    v += Math.sin(nz * 2.0 + timeOffset * 1.2);\n\n                    // 2. Diagonal wave\n                    v += Math.sin((nx + ny + nz) * 2.0 + timeOffset * 0.5);\n\n                    // 3. Circular pattern (distance from center)\n                    const dist = Math.sqrt(nx * nx + ny * ny + nz * nz);\n                    v += Math.sin(dist * 6.0 - timeOffset * 1.5);\n\n                    // 4. Spiral twisting\n                    const angle = Math.atan2(ny, nx);\n                    v += Math.sin(angle * 3.0 + nz * 4.0 + timeOffset);\n\n                    // v ranges roughly -6 to 6, map to 0..1\n                    let mag = (v + 6.0) / 12.0;\n\n                    // Add some \"hard\" edges or rings (classic demo effect)\n                    // sin(v * constant)\n                    mag = (Math.sin(mag * 15.0) + 1.0) * 0.5;\n\n                    // Apply power curve to create gaps/contrast\n                    mag = Math.pow(mag, 2.5);\n\n                    // Boost low frequencies (left side of X axis)\n                    // This makes the bass frequencies more prominent in the plasma\n                    const freqBoost = 1.0 + (1.0 - (nx + 1) * 0.5) * 0.5;\n                    mag *= freqBoost;\n\n                    // Clamp\n                    mag = Math.max(0.0, Math.min(0.9, mag));\n\n                    // Phase varies with the plasma value itself for complex twisting\n                    const phase = (mag + timeOffset * 0.2) % 1.0;\n\n                    // Custom channels follow spatial gradients\n                    const custom1 = (Math.sin(nx * Math.PI + timeOffset) + 1.0) * 0.5;\n                    const custom2 = (Math.cos(ny * Math.PI + timeOffset) + 1.0) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n\n    public stepSinePlasma(): void {\n        this.plasmaTime += 0.02;  // Smooth evolution\n        this.generateSinePlasma(this.plasmaTime);\n    }\n\n    public clearData(): void {\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n        data.fill(0.0);\n        this.setData(data);\n    }\n\n    public sample(x: number, y: number, z: number): Float32Array {\n        if (!this.data) return new Float32Array([0, 0, 0, 0]);\n\n        const { x: w, y: h, z: d } = this.resolution;\n\n        // Clamp coordinates to [0, 1]\n        const u = Math.max(0, Math.min(1, x));\n        const v = Math.max(0, Math.min(1, y));\n        const w_coord = Math.max(0, Math.min(1, z));\n\n        // Convert to grid coordinates\n        const gx = u * (w - 1);\n        const gy = v * (h - 1);\n        const gz = w_coord * (d - 1);\n\n        // Integer parts\n        const x0 = Math.floor(gx);\n        const y0 = Math.floor(gy);\n        const z0 = Math.floor(gz);\n\n        // Fractional parts\n        const fx = gx - x0;\n        const fy = gy - y0;\n        const fz = gz - z0;\n\n        // Next neighbors (clamp to max index)\n        const x1 = Math.min(x0 + 1, w - 1);\n        const y1 = Math.min(y0 + 1, h - 1);\n        const z1 = Math.min(z0 + 1, d - 1);\n\n        // Helper to get index\n        const getIdx = (ix: number, iy: number, iz: number) => (iz * h * w + iy * w + ix) * 4;\n\n        // Sample 8 corners\n        const c000 = getIdx(x0, y0, z0);\n        const c100 = getIdx(x1, y0, z0);\n        const c010 = getIdx(x0, y1, z0);\n        const c110 = getIdx(x1, y1, z0);\n        const c001 = getIdx(x0, y0, z1);\n        const c101 = getIdx(x1, y0, z1);\n        const c011 = getIdx(x0, y1, z1);\n        const c111 = getIdx(x1, y1, z1);\n\n        const result = new Float32Array(4);\n\n        // Trilinear interpolation for each channel\n        for (let i = 0; i < 4; i++) {\n            const v000 = this.data[c000 + i];\n            const v100 = this.data[c100 + i];\n            const v010 = this.data[c010 + i];\n            const v110 = this.data[c110 + i];\n            const v001 = this.data[c001 + i];\n            const v101 = this.data[c101 + i];\n            const v011 = this.data[c011 + i];\n            const v111 = this.data[c111 + i];\n\n            // Interpolate along x\n            const c00 = v000 * (1 - fx) + v100 * fx;\n            const c10 = v010 * (1 - fx) + v110 * fx;\n            const c01 = v001 * (1 - fx) + v101 * fx;\n            const c11 = v011 * (1 - fx) + v111 * fx;\n\n            // Interpolate along y\n            const c0 = c00 * (1 - fy) + c10 * fy;\n            const c1 = c01 * (1 - fy) + c11 * fy;\n\n            // Interpolate along z\n            result[i] = c0 * (1 - fz) + c1 * fz;\n        }\n\n        return result;\n    }\n\n    public updateResolution(resolution: VolumeResolution): void {\n        this.resolution = resolution;\n        this.data = null; // Force reallocation\n        this.initialize();\n    }\n\n    public getResolution(): VolumeResolution {\n        return { ...this.resolution };\n    }\n\n    public getTexture(): WebGLTexture | null {\n        return this.texture;\n    }\n\n    public destroy(): void {\n        if (this.texture) {\n            this.ctx.gl.deleteTexture(this.texture);\n            this.texture = null;\n        }\n        this.data = null;\n        this.gameOfLifeState = null;\n        this.gameOfLifeBuffer = null;\n    }\n\n    // ===== 3D Game of Life =====\n\n    public initGameOfLife(): void {\n        const { x, y, z } = this.resolution;\n        const totalCells = x * y * z;\n\n        // Initialize state arrays\n        this.gameOfLifeState = new Uint8Array(totalCells);\n        this.gameOfLifeBuffer = new Uint8Array(totalCells);\n\n        // Fill with random blobs (30% density)\n        for (let i = 0; i < totalCells; i++) {\n            this.gameOfLifeState[i] = Math.random() < 0.3 ? 1 : 0;\n        }\n\n        // Convert initial state to spectral data\n        this.gameOfLifeToSpectral();\n    }\n\n    public stepGameOfLife(): void {\n        if (!this.gameOfLifeState || !this.gameOfLifeBuffer) return;\n\n        const { x, y, z } = this.resolution;\n\n        // Helper to get cell index with wrapping (toroidal topology)\n        const getIdx = (ix: number, iy: number, iz: number): number => {\n            const wx = ((ix % x) + x) % x;\n            const wy = ((iy % y) + y) % y;\n            const wz = ((iz % z) + z) % z;\n            return wz * y * x + wy * x + wx;\n        };\n\n        // Count neighbors for each cell\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const idx = getIdx(ix, iy, iz);\n                    let neighbors = 0;\n\n                    // Check all 26 neighbors (3x3x3 - 1)\n                    for (let dz = -1; dz <= 1; dz++) {\n                        for (let dy = -1; dy <= 1; dy++) {\n                            for (let dx = -1; dx <= 1; dx++) {\n                                if (dx === 0 && dy === 0 && dz === 0) continue;\n                                const nIdx = getIdx(ix + dx, iy + dy, iz + dz);\n                                neighbors += this.gameOfLifeState![nIdx];\n                            }\n                        }\n                    }\n\n                    // 3D Game of Life rule: 4-5-5\n                    // Survive if 4 or 5 neighbors\n                    // Born if exactly 5 neighbors\n                    const alive = this.gameOfLifeState[idx] === 1;\n\n                    if (alive) {\n                        this.gameOfLifeBuffer[idx] = (neighbors === 4 || neighbors === 5) ? 1 : 0;\n                    } else {\n                        this.gameOfLifeBuffer[idx] = (neighbors === 5) ? 1 : 0;\n                    }\n                }\n            }\n        }\n\n        // Swap buffers\n        const temp = this.gameOfLifeState;\n        this.gameOfLifeState = this.gameOfLifeBuffer;\n        this.gameOfLifeBuffer = temp;\n\n        // Update spectral data\n        this.gameOfLifeToSpectral();\n    }\n\n    private gameOfLifeToSpectral(): void {\n        if (!this.gameOfLifeState) return;\n\n        const { x, y, z } = this.resolution;\n        const totalVoxels = x * y * z;\n        const data = new Float32Array(totalVoxels * 4);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    const cellIdx = iz * y * x + iy * x + ix;\n                    const alive = this.gameOfLifeState[cellIdx];\n\n                    // Convert to spectral data\n                    const nx = (ix / x) * 2 - 1;\n                    const ny = (iy / y) * 2 - 1;\n                    const nz = (iz / z) * 2 - 1;\n\n                    let mag = alive ? 0.8 : 0.0;\n\n                    // Boost low frequencies\n                    if (alive) {\n                        const freqBoost = 1.0 + (1.0 - (nx + 1) * 0.5) * 0.4;\n                        mag *= freqBoost;\n                    }\n\n                    // Phase varies by position\n                    const phase = (ix / x + iy / y + iz / z) / 3.0;\n                    const custom1 = (ny + 1) * 0.5;\n                    const custom2 = (nz + 1) * 0.5;\n\n                    data[idx++] = mag;\n                    data[idx++] = phase;\n                    data[idx++] = custom1;\n                    data[idx++] = custom2;\n                }\n            }\n        }\n\n        this.setData(data);\n    }\n}\n","// Type definitions for Spectra Table Synthesis\n\nexport interface Vec3 {\n    x: number;\n    y: number;\n    z: number;\n}\n\nexport interface ReadingPathState {\n    position: Vec3;     // Current XYZ position in spectral cube\n    rotation: Vec3;     // Rotation of the reading plane (euler angles)\n    scanPosition: number; // Position of reading line on plane (-1 to 1)\n    planeType: PlaneType;\n}\n\nexport interface SpatialState {\n    stereoSpread: number;  // Width of stereo field (0-1)\n}\n\nexport interface SpectralSlice {\n    magnitude: Float32Array;  // Frequency magnitudes\n    phase: Float32Array;      // Phase values\n    pan: Float32Array;        // Stereo pan per frequency\n    width: Float32Array;      // Stereo width per frequency\n}\n\nexport interface VolumeResolution {\n    x: number;  // Frequency bins (horizontal)\n    y: number;  // Morph axis - different samples at different Y positions (vertical)\n    z: number;  // Time slices within each sample (depth)\n}\n\n// Plane types for reading path visualization\nexport enum PlaneType {\n    FLAT = 'PLANE',\n    SINCOS = 'PLOT 1',\n    WAVE = 'PLOT 2',\n    RIPPLE = 'PLOT 3',\n}\n\n// Sensible density ranges for the spectral volume\nexport const VOLUME_DENSITY_X_MIN = 16;\nexport const VOLUME_DENSITY_X_MAX = 512;\nexport const VOLUME_DENSITY_X_DEFAULT = 64;\n\nexport const VOLUME_DENSITY_Y_MIN = 1;  // Minimum 1 sample\nexport const VOLUME_DENSITY_Y_MAX = 16; // Max 16 samples to morph\nexport const VOLUME_DENSITY_Y_DEFAULT = 2;\n\nexport const VOLUME_DENSITY_Z_MIN = 16;  // Minimum time resolution\nexport const VOLUME_DENSITY_Z_MAX = 1024;\nexport const VOLUME_DENSITY_Z_DEFAULT = 128;\n\n// Synthesis modes\nexport enum SynthMode {\n    SPECTRAL = 'spectral',   // iFFT / additive synthesis from frequency bins\n    WAVETABLE = 'wavetable', // Direct waveform playback from reading line\n}\n\n// Carrier waveform types for wavetable AM synthesis\nexport enum CarrierType {\n    SINE = 0,\n    SAW = 1,\n    SQUARE = 2,\n    TRIANGLE = 3,\n}\n","import { PlaneType } from '../types';\n\n// Generate reading path plane geometry with different algorithms\n\nexport class ReadingPathGeometry {\n    // Helper to calculate Y height for a given X, Z and plane type\n    private static calculateHeight(x: number, z: number, planeType: PlaneType): number {\n        switch (planeType) {\n            case PlaneType.FLAT:\n                return 0;\n\n            case PlaneType.SINCOS:\n                // Sine and cosine modulation\n                return 0.3 * (Math.sin(x * Math.PI * 2) * Math.cos(z * Math.PI * 2));\n\n            case PlaneType.WAVE:\n                // Wave pattern\n                return 0.2 * Math.sin((x + z) * Math.PI * 3);\n\n            case PlaneType.RIPPLE:\n                // Circular ripple from center\n                const dist = Math.sqrt(x * x + z * z);\n                return 0.25 * Math.sin(dist * Math.PI * 4) / (1 + dist * 2);\n\n            default:\n                return 0;\n        }\n    }\n\n    // Generate a grid-based plane with various height modulation functions\n    public static generatePlane(\n        planeType: PlaneType,\n        gridSize: number = 32\n    ): { positions: Float32Array; indices: Uint16Array } {\n        const positions: number[] = [];\n        const indices: number[] = [];\n\n        // Generate grid vertices\n        for (let iz = 0; iz < gridSize; iz++) {\n            for (let ix = 0; ix < gridSize; ix++) {\n                // Normalize to [-1, 1]\n                const x = (ix / (gridSize - 1)) * 2 - 1;\n                const z = (iz / (gridSize - 1)) * 2 - 1;\n\n                const y = this.calculateHeight(x, z, planeType);\n\n                positions.push(x, y, z);\n            }\n        }\n\n        // Generate triangle indices for wireframe edges\n        for (let iz = 0; iz < gridSize - 1; iz++) {\n            for (let ix = 0; ix < gridSize - 1; ix++) {\n                const topLeft = iz * gridSize + ix;\n                const topRight = topLeft + 1;\n                const bottomLeft = (iz + 1) * gridSize + ix;\n                const bottomRight = bottomLeft + 1;\n\n                // Horizontal lines\n                if (ix < gridSize - 1) {\n                    indices.push(topLeft, topRight);\n                    indices.push(bottomLeft, bottomRight);\n                }\n\n                // Vertical lines\n                if (iz < gridSize - 1) {\n                    indices.push(topLeft, bottomLeft);\n                    indices.push(topRight, bottomRight);\n                }\n            }\n        }\n\n        return {\n            positions: new Float32Array(positions),\n            indices: new Uint16Array(indices),\n        };\n    }\n\n    // Generate the reading line that follows the plane contour\n    // This line represents the current spectral slice being read\n    // It spans X [-1, 1] at a specific Z (relative to plane)\n    public static generateReadingLine(\n        planeType: PlaneType,\n        resolutionX: number,\n        currentZ: number = 0 // Z position relative to plane space [-1, 1]\n    ): Float32Array {\n        const positions: number[] = [];\n\n        // Ensure we stay within bounds\n        const z = Math.max(-1, Math.min(1, currentZ));\n\n        for (let i = 0; i < resolutionX; i++) {\n            const x = (i / (resolutionX - 1)) * 2 - 1;\n            const y = this.calculateHeight(x, z, planeType);\n\n            positions.push(x, y, z);\n        }\n\n        return new Float32Array(positions);\n    }\n}\n","import { WebGLContext } from './context';\nimport {\n    wireframeVertexShader,\n    wireframeFragmentShader,\n    pointVertexShader,\n    pointFragmentShader,\n    planeVertexShader,\n    planeFragmentShader\n} from './shaders';\nimport {\n    mat4Perspective, mat4LookAt, mat4Multiply,\n    mat4RotateX, mat4RotateY, mat4RotateZ, mat4Translate,\n    vec3TransformMat4\n} from './math';\nimport { SpectralVolume } from './spectral-volume';\nimport { ReadingPathGeometry } from './reading-path';\nimport { VolumeResolution, ReadingPathState, PlaneType } from '../types';\n\n// Renderer for wireframe cube + spectral volume points + reading path\n\nexport class Renderer {\n    private ctx: WebGLContext;\n\n    // Wireframe rendering\n    private wireframeProgram: WebGLProgram;\n    private wireframeVAO: WebGLVertexArrayObject;\n    private wireframeUMVP: WebGLUniformLocation;\n    private wireframeUColor: WebGLUniformLocation;\n\n    // Point cloud rendering\n    private pointProgram: WebGLProgram;\n    private pointVAO: WebGLVertexArrayObject | null = null;\n    private pointCount = 0;\n    private pointUMVP: WebGLUniformLocation;\n    private pointUVolume: WebGLUniformLocation; // Changed from pointUColor\n    private pointUAlpha: WebGLUniformLocation;\n    private pointUSize: WebGLUniformLocation;\n    private pointUVolumeRes: WebGLUniformLocation;\n\n    // Reading path rendering\n    private planeProgram: WebGLProgram;\n    private planeVAO: WebGLVertexArrayObject | null = null;\n    private planeIndexCount = 0;\n    private planeUMVP: WebGLUniformLocation;\n    private planeUModel: WebGLUniformLocation;\n    private planeUVolume: WebGLUniformLocation;\n    private planeUAlpha: WebGLUniformLocation;\n\n    private lineVAO: WebGLVertexArrayObject | null = null;\n    private lineUMVP: WebGLUniformLocation;\n    private lineUColor: WebGLUniformLocation;\n    private lineVertexCount = 0; // Added this property\n\n    // State\n    private spectralVolume: SpectralVolume;\n    private pathState: ReadingPathState = {\n        position: { x: 0, y: 0, z: 0 },\n        rotation: { x: 0, y: 0, z: 0 },\n        scanPosition: 0,\n        planeType: PlaneType.FLAT\n    };\n\n    // Camera state\n    private rotationX = 0.3;\n    private rotationY = 0.4;\n    private isDragging = false;\n    private lastMouseX = 0;\n    private lastMouseY = 0;\n    private activeMouseButton = -1; // -1: None, 0: Left, 2: Right\n\n    constructor(ctx: WebGLContext, initialResolution: VolumeResolution) {\n        this.ctx = ctx;\n\n        // Create spectral volume\n        this.spectralVolume = new SpectralVolume(ctx, initialResolution);\n\n        // Compile wireframe shaders\n        this.wireframeProgram = this.createProgram(wireframeVertexShader, wireframeFragmentShader);\n        const wireMVP = ctx.gl.getUniformLocation(this.wireframeProgram, 'uModelViewProjection');\n        const wireColor = ctx.gl.getUniformLocation(this.wireframeProgram, 'uColor');\n        if (!wireMVP || !wireColor) throw new Error('Failed to get wireframe uniform locations');\n        this.wireframeUMVP = wireMVP;\n        this.wireframeUColor = wireColor;\n        this.wireframeVAO = this.createWireframeCube();\n\n        // Compile point cloud shaders\n        this.pointProgram = this.createProgram(pointVertexShader, pointFragmentShader);\n        const pointMVP = ctx.gl.getUniformLocation(this.pointProgram, 'uModelViewProjection');\n        const pointVolume = ctx.gl.getUniformLocation(this.pointProgram, 'uVolume');\n        const pointAlpha = ctx.gl.getUniformLocation(this.pointProgram, 'uAlpha');\n        const pointSize = ctx.gl.getUniformLocation(this.pointProgram, 'uPointSize');\n        const pointVolumeRes = ctx.gl.getUniformLocation(this.pointProgram, 'uVolumeRes');\n\n        // Note: uVolume might be null if optimized out, but usually it shouldn't be if used.\n        // However, getUniformLocation returns null if not found.\n        if (!pointMVP || !pointAlpha || !pointSize) {\n            throw new Error('Failed to get point uniform locations');\n        }\n        this.pointUMVP = pointMVP;\n        this.pointUVolume = pointVolume!; // Assert non-null or handle it\n        this.pointUAlpha = pointAlpha;\n        this.pointUSize = pointSize;\n        this.pointUVolumeRes = pointVolumeRes!;\n\n        // Compile plane shaders (re-using wireframe shader for line, plane shader for surface)\n        this.planeProgram = this.createProgram(planeVertexShader, planeFragmentShader);\n        const planeMVP = ctx.gl.getUniformLocation(this.planeProgram, 'uModelViewProjection');\n        const planeModel = ctx.gl.getUniformLocation(this.planeProgram, 'uModelMatrix');\n        const planeVolume = ctx.gl.getUniformLocation(this.planeProgram, 'uVolume');\n        const planeAlpha = ctx.gl.getUniformLocation(this.planeProgram, 'uAlpha');\n\n        if (!planeMVP || !planeAlpha) throw new Error('Failed to get plane uniform locations');\n\n        this.planeUMVP = planeMVP;\n        this.planeUModel = planeModel!; // Assert non-null or handle\n        this.planeUVolume = planeVolume!; // Assert non-null or handle\n        this.planeUAlpha = planeAlpha;\n\n        // Reuse wireframe program for the reading line (it's just a solid color line)\n        this.lineUMVP = wireMVP;\n        this.lineUColor = wireColor;\n\n        // Initialize geometry\n        this.updatePointCloud(initialResolution);\n        this.updateReadingPathGeometry();\n\n        console.log('✓ Renderer initialized');\n    }\n\n    private createProgram(vertexSrc: string, fragmentSrc: string): WebGLProgram {\n        const gl = this.ctx.gl;\n\n        const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n        if (!vertexShader) throw new Error('Failed to create vertex shader');\n        gl.shaderSource(vertexShader, vertexSrc);\n        gl.compileShader(vertexShader);\n\n        if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n            const log = gl.getShaderInfoLog(vertexShader);\n            throw new Error(`Vertex shader compile error: ${log}`);\n        }\n\n        const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n        if (!fragmentShader) throw new Error('Failed to create fragment shader');\n        gl.shaderSource(fragmentShader, fragmentSrc);\n        gl.compileShader(fragmentShader);\n\n        if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n            const log = gl.getShaderInfoLog(fragmentShader);\n            throw new Error(`Fragment shader compile error: ${log}`);\n        }\n\n        const program = gl.createProgram();\n        if (!program) throw new Error('Failed to create program');\n        gl.attachShader(program, vertexShader);\n        gl.attachShader(program, fragmentShader);\n        gl.linkProgram(program);\n\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            const log = gl.getProgramInfoLog(program);\n            throw new Error(`Program link error: ${log}`);\n        }\n\n        return program;\n    }\n\n    private createWireframeCube(): WebGLVertexArrayObject {\n        const gl = this.ctx.gl;\n\n        // Cube vertices (centered at origin, size 2x2x2)\n        const vertices = new Float32Array([\n            -1, -1, -1,  // 0\n            1, -1, -1,  // 1\n            1, 1, -1,  // 2\n            -1, 1, -1,  // 3\n            -1, -1, 1,  // 4\n            1, -1, 1,  // 5\n            1, 1, 1,  // 6\n            -1, 1, 1,  // 7\n        ]);\n\n        // Wireframe edges (12 edges of a cube)\n        const indices = new Uint16Array([\n            0, 1, 1, 2, 2, 3, 3, 0,  // Front face\n            4, 5, 5, 6, 6, 7, 7, 4,  // Back face\n            0, 4, 1, 5, 2, 6, 3, 7,  // Connecting edges\n        ]);\n\n        const vao = gl.createVertexArray();\n        if (!vao) throw new Error('Failed to create VAO');\n        gl.bindVertexArray(vao);\n\n        const vertexBuffer = gl.createBuffer();\n        if (!vertexBuffer) throw new Error('Failed to create vertex buffer');\n        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n\n        const aPositionLoc = gl.getAttribLocation(this.wireframeProgram, 'aPosition');\n        gl.enableVertexAttribArray(aPositionLoc);\n        gl.vertexAttribPointer(aPositionLoc, 3, gl.FLOAT, false, 0, 0);\n\n        const indexBuffer = gl.createBuffer();\n        if (!indexBuffer) throw new Error('Failed to create index buffer');\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n\n        gl.bindVertexArray(null);\n\n        return vao;\n    }\n\n    private generatePointCloud(resolution: VolumeResolution): Float32Array {\n        const { x, y, z } = resolution;\n        const totalPoints = x * y * z;\n        const positions = new Float32Array(totalPoints * 3);\n\n        let idx = 0;\n        for (let iz = 0; iz < z; iz++) {\n            for (let iy = 0; iy < y; iy++) {\n                for (let ix = 0; ix < x; ix++) {\n                    // Map from grid indices to normalized cube space [-1, 1]\n                    positions[idx++] = (ix / (x - 1)) * 2 - 1;\n                    positions[idx++] = (iy / (y - 1)) * 2 - 1;\n                    positions[idx++] = (iz / (z - 1)) * 2 - 1;\n                }\n            }\n        }\n\n        return positions;\n    }\n\n    private updatePointCloud(resolution: VolumeResolution): void {\n        const gl = this.ctx.gl;\n\n        if (this.pointVAO) gl.deleteVertexArray(this.pointVAO);\n\n        const positions = this.generatePointCloud(resolution);\n        this.pointCount = positions.length / 3;\n\n        const vao = gl.createVertexArray();\n        if (!vao) throw new Error('Failed to create point VAO');\n        gl.bindVertexArray(vao);\n\n        const buffer = gl.createBuffer();\n        if (!buffer) throw new Error('Failed to create point buffer');\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n        const aPositionLoc = gl.getAttribLocation(this.pointProgram, 'aPosition');\n        gl.enableVertexAttribArray(aPositionLoc);\n        gl.vertexAttribPointer(aPositionLoc, 3, gl.FLOAT, false, 0, 0);\n\n        gl.bindVertexArray(null);\n        this.pointVAO = vao;\n\n        console.log(`✓ Point cloud: ${this.pointCount} points`);\n    }\n\n    private updateReadingPathGeometry(): void {\n        const gl = this.ctx.gl;\n\n        // 1. Update Plane Geometry\n        if (this.planeVAO) gl.deleteVertexArray(this.planeVAO);\n\n        const { positions, indices } = ReadingPathGeometry.generatePlane(this.pathState.planeType);\n        this.planeIndexCount = indices.length;\n\n        const planeVAO = gl.createVertexArray();\n        if (!planeVAO) throw new Error('Failed to create plane VAO');\n        gl.bindVertexArray(planeVAO);\n\n        const planeVBO = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, planeVBO);\n        gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n        const planePosLoc = gl.getAttribLocation(this.planeProgram, 'aPosition');\n        gl.enableVertexAttribArray(planePosLoc);\n        gl.vertexAttribPointer(planePosLoc, 3, gl.FLOAT, false, 0, 0);\n\n        const planeIBO = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, planeIBO);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n\n        gl.bindVertexArray(null);\n        this.planeVAO = planeVAO;\n\n        // 2. Update Line Geometry\n        // We use the current volume resolution X for the line detail\n        const resolution = this.spectralVolume.getResolution();\n        this.updateReadingLineGeometry(resolution.x);\n    }\n\n    private updateReadingLineGeometry(resolutionX: number): void {\n        const gl = this.ctx.gl;\n\n        if (this.lineVAO) gl.deleteVertexArray(this.lineVAO);\n\n        const linePositions = ReadingPathGeometry.generateReadingLine(\n            this.pathState.planeType,\n            resolutionX,\n            this.pathState.scanPosition\n        );\n\n        this.lineVertexCount = linePositions.length / 3;\n\n        const lineVAO = gl.createVertexArray();\n        if (!lineVAO) throw new Error('Failed to create line VAO');\n        gl.bindVertexArray(lineVAO);\n\n        const lineVBO = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, lineVBO);\n        gl.bufferData(gl.ARRAY_BUFFER, linePositions, gl.DYNAMIC_DRAW);\n\n        const linePosLoc = gl.getAttribLocation(this.wireframeProgram, 'aPosition');\n        gl.enableVertexAttribArray(linePosLoc);\n        gl.vertexAttribPointer(linePosLoc, 3, gl.FLOAT, false, 0, 0);\n\n        gl.bindVertexArray(null);\n        this.lineVAO = lineVAO;\n    }\n\n    public render(deltaTime: number = 0.016): void {\n        // Update logic (auto-reset plane rotation, etc.)\n        this.update(deltaTime);\n\n        const gl = this.ctx.gl;\n\n        // Clear\n        this.ctx.clear(0.08, 0.08, 0.12);\n\n        // Enable blending\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n        // Calculate Camera MVP\n        const aspect = gl.canvas.width / gl.canvas.height;\n        const projection = mat4Perspective(Math.PI / 4, aspect, 0.1, 100.0);\n        const view = mat4LookAt([0, 0, 6.5], [0, 0, 0], [0, 1, 0]);\n\n        const rotX = mat4RotateX(this.rotationX);\n        const rotY = mat4RotateY(this.rotationY);\n        const model = mat4Multiply(rotY, rotX);\n\n        const viewModel = mat4Multiply(view, model);\n        const cameraMVP = mat4Multiply(projection, viewModel);\n\n        // 1. Draw Point Cloud\n        if (this.pointVAO) {\n            gl.useProgram(this.pointProgram);\n            gl.uniformMatrix4fv(this.pointUMVP, false, cameraMVP);\n\n            // Bind volume texture\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_3D, this.spectralVolume.getTexture());\n            gl.uniform1i(this.pointUVolume, 0);\n\n            gl.uniform1f(this.pointUAlpha, 0.15); // Base alpha\n            gl.uniform1f(this.pointUSize, 3.0);   // Base size\n\n            // Pass volume resolution for density-based size clamping\n            const res = this.spectralVolume.getResolution();\n            gl.uniform3f(this.pointUVolumeRes, res.x, res.y, res.z);\n\n            gl.bindVertexArray(this.pointVAO);\n            gl.drawArrays(gl.POINTS, 0, this.pointCount);\n            gl.bindVertexArray(null);\n        }\n\n        // Calculate plane transform\n        const pRotX = mat4RotateX(this.pathState.rotation.x);\n        const pRotY = mat4RotateY(this.pathState.rotation.y);\n        const pRotZ = mat4RotateZ(this.pathState.rotation.z);\n        const pTrans = mat4Translate(\n            this.pathState.position.x,\n            this.pathState.position.y,\n            this.pathState.position.z\n        );\n\n        let planeModel = mat4Multiply(pRotY, pRotX);\n        planeModel = mat4Multiply(pRotZ, planeModel);\n        planeModel = mat4Multiply(pTrans, planeModel);\n\n        const worldPlaneModel = mat4Multiply(model, planeModel);\n        const planeViewModel = mat4Multiply(view, worldPlaneModel);\n        const planeMVP = mat4Multiply(projection, planeViewModel);\n\n        // 2. Draw Reading Path Plane\n        if (this.planeVAO) {\n            gl.useProgram(this.planeProgram);\n            gl.uniformMatrix4fv(this.planeUMVP, false, planeMVP);\n            gl.uniformMatrix4fv(this.planeUModel, false, worldPlaneModel); // Pass model matrix\n\n            // Bind volume texture (reuse slot 0)\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_3D, this.spectralVolume.getTexture());\n            gl.uniform1i(this.planeUVolume, 0);\n\n            gl.uniform1f(this.planeUAlpha, 0.3); // Slightly more opaque to see colors\n\n            gl.bindVertexArray(this.planeVAO);\n            gl.drawElements(gl.LINES, this.planeIndexCount, gl.UNSIGNED_SHORT, 0);\n            gl.bindVertexArray(null);\n        }\n\n        // 3. Draw Reading Position Line (Green contour line)\n        if (this.lineVAO) {\n            // Use same MVP as plane so it sticks to it\n            gl.useProgram(this.wireframeProgram);\n            gl.uniformMatrix4fv(this.lineUMVP, false, planeMVP);\n            gl.uniform3f(this.lineUColor, 0.2, 1.0, 0.2); // Bright Green\n\n            gl.bindVertexArray(this.lineVAO);\n            gl.drawArrays(gl.LINE_STRIP, 0, this.lineVertexCount);\n            gl.bindVertexArray(null);\n        }\n\n        // 4. Draw Wireframe Cube (Bounds)\n        gl.useProgram(this.wireframeProgram);\n        gl.uniformMatrix4fv(this.wireframeUMVP, false, cameraMVP);\n        gl.uniform3f(this.wireframeUColor, 0.3, 0.6, 1.0); // Blue\n\n        gl.bindVertexArray(this.wireframeVAO);\n        gl.drawElements(gl.LINES, 24, gl.UNSIGNED_SHORT, 0);\n        gl.bindVertexArray(null);\n\n        gl.disable(gl.BLEND);\n    }\n\n    public resize(width: number, height: number): void {\n        this.ctx.resize(width, height);\n    }\n\n    public updateVolumeResolution(resolution: VolumeResolution): void {\n        this.spectralVolume.updateResolution(resolution);\n        this.updatePointCloud(resolution);\n        this.updateReadingPathGeometry();\n        // Also update reading line resolution\n        this.updateReadingLineGeometry(resolution.x);\n    }\n\n    public getSpectralVolume(): SpectralVolume {\n        return this.spectralVolume;\n    }\n\n    public updateReadingPath(state: ReadingPathState): void {\n        const typeChanged = state.planeType !== this.pathState.planeType;\n        const scanChanged = state.scanPosition !== this.pathState.scanPosition;\n\n        // Always preserve mouse-controlled rotation (x and z)\n        // Since rotation sliders were removed, controls always return 0 for rotation\n        // We maintain rotation state internally via mouse interaction\n        this.pathState = {\n            ...state,\n            rotation: {\n                x: this.pathState.rotation.x,  // Preserve mouse-controlled\n                y: state.rotation.y,            // Not used\n                z: this.pathState.rotation.z    // Preserve mouse-controlled\n            }\n        };\n\n        if (typeChanged) {\n            this.updateReadingPathGeometry();\n        } else if (scanChanged) {\n            const resolution = this.spectralVolume.getResolution();\n            this.updateReadingLineGeometry(resolution.x);\n        }\n    }\n\n    public updateSpectralData(dataSet: string): void {\n        switch (dataSet) {\n            case '3d-julia':\n                this.spectralVolume.generate3DJulia();\n                break;\n            case 'mandelbulb':\n                this.spectralVolume.generateMandelbulb();\n                break;\n            case 'menger-sponge':\n                this.spectralVolume.generateMengerSponge();\n                break;\n\n            default:\n                this.spectralVolume.clearData();\n                break;\n        }\n    }\n\n    public getReadingLineSpectralData(): Float32Array {\n        // 1. Get reading line positions in plane space\n        const resolution = this.spectralVolume.getResolution();\n        const linePositions = ReadingPathGeometry.generateReadingLine(\n            this.pathState.planeType,\n            resolution.x, // Use X resolution for sampling density\n            this.pathState.scanPosition\n        );\n\n        // 2. Calculate plane transform matrix\n        const pRotX = mat4RotateX(this.pathState.rotation.x);\n        const pRotY = mat4RotateY(this.pathState.rotation.y);\n        const pRotZ = mat4RotateZ(this.pathState.rotation.z);\n        const pTrans = mat4Translate(\n            this.pathState.position.x,\n            this.pathState.position.y,\n            this.pathState.position.z\n        );\n\n        let planeModel = mat4Multiply(pRotY, pRotX);\n        planeModel = mat4Multiply(pRotZ, planeModel);\n        planeModel = mat4Multiply(pTrans, planeModel);\n\n        // 3. Transform points to world space and sample volume\n        const numPoints = linePositions.length / 3;\n        const result = new Float32Array(numPoints * 4); // RGBA per point\n\n        for (let i = 0; i < numPoints; i++) {\n            const px = linePositions[i * 3];\n            const py = linePositions[i * 3 + 1];\n            const pz = linePositions[i * 3 + 2];\n\n            // Transform to world space\n            const worldPos = vec3TransformMat4([px, py, pz], planeModel);\n\n            // Convert world space [-1, 1] to texture space [0, 1]\n            const tx = (worldPos[0] + 1.0) * 0.5;\n            const ty = (worldPos[1] + 1.0) * 0.5;\n            const tz = (worldPos[2] + 1.0) * 0.5;\n\n            // Sample volume\n            const sample = this.spectralVolume.sample(tx, ty, tz);\n\n            // Store all channels\n            result[i * 4] = sample[0];     // R: Magnitude\n            result[i * 4 + 1] = sample[1]; // G: Phase\n            result[i * 4 + 2] = sample[2]; // B: Pan\n            result[i * 4 + 3] = sample[3]; // A: Width\n        }\n\n        return result;\n    }\n\n    // Mouse interaction\n    public onMouseDown(x: number, y: number, button: number): void {\n        this.isDragging = true;\n        this.lastMouseX = x;\n        this.lastMouseY = y;\n        this.activeMouseButton = button;\n    }\n\n    public onMouseMove(x: number, y: number): void {\n        if (!this.isDragging) return;\n\n        const dx = x - this.lastMouseX;\n        const dy = y - this.lastMouseY;\n\n        this.lastMouseX = x;\n        this.lastMouseY = y;\n\n        const sensitivity = 0.01;\n\n        if (this.activeMouseButton === 2) {\n            // Right click: Rotate Camera (Cube)\n            this.rotationY += dx * sensitivity;\n            this.rotationX += dy * sensitivity;\n        } else if (this.activeMouseButton === 0) {\n            // Left click: Rotate Reading Plane\n            // We update the path state directly.\n            // Note: This needs to be communicated back to controls if we want sliders to update.\n            // For now, we just update local state which might get overwritten by controls if they change.\n            // Ideally, we should emit an event.\n\n            // Invert controls for intuitive feel\n            this.pathState.rotation.z -= dx * sensitivity;\n            this.pathState.rotation.x -= dy * sensitivity;\n\n            // Limit rotation to avoid flipping\n            this.pathState.rotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, this.pathState.rotation.x));\n            this.pathState.rotation.z = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, this.pathState.rotation.z));\n        }\n    }\n\n    public onMouseUp(): void {\n        this.isDragging = false;\n        this.activeMouseButton = -1;\n    }\n\n    public update(deltaTime: number): void {\n        // Auto-reset plane rotation if not dragging\n        if (!this.isDragging) {\n            const decay = 5.0 * deltaTime; // Speed of return\n\n            // Lerp towards 0\n            this.pathState.rotation.x += (0 - this.pathState.rotation.x) * decay;\n            this.pathState.rotation.z += (0 - this.pathState.rotation.z) * decay;\n\n            // Snap to 0 if very close\n            if (Math.abs(this.pathState.rotation.x) < 0.001) this.pathState.rotation.x = 0;\n            if (Math.abs(this.pathState.rotation.z) < 0.001) this.pathState.rotation.z = 0;\n        }\n    }\n\n    public destroy(): void {\n        this.spectralVolume.destroy();\n    }\n}\n","import { ReadingPathState, VolumeResolution, SynthMode, CarrierType, VOLUME_DENSITY_X_MIN, VOLUME_DENSITY_X_MAX, VOLUME_DENSITY_X_DEFAULT, VOLUME_DENSITY_Y_MIN, VOLUME_DENSITY_Y_MAX, VOLUME_DENSITY_Y_DEFAULT, VOLUME_DENSITY_Z_MIN, VOLUME_DENSITY_Z_MAX, VOLUME_DENSITY_Z_DEFAULT, PlaneType } from '../types';\n\n// UI control panel with sliders for all parameters\n\nexport class ControlPanel {\n    private container: HTMLElement;\n    private currentSectionContainer: HTMLElement | null = null;\n\n    // Path controls\n    private pathYSlider: HTMLInputElement;\n    // Rotation sliders removed - now controlled by mouse\n    private planeTypeSelect: HTMLSelectElement;\n\n    private scanPositionSlider: HTMLInputElement;\n\n    // Synth mode controls\n    private synthModeSelect: HTMLSelectElement;\n    private frequencySlider: HTMLInputElement;\n    private frequencyContainer: HTMLElement | null = null;\n    private carrierContainer: HTMLElement | null = null;\n    private feedbackContainer: HTMLElement | null = null;\n\n    private midiSelect: HTMLSelectElement;\n\n    // Volume density controls\n    private densityXSlider: HTMLInputElement;\n    private densityYSlider: HTMLInputElement;\n    private densityZSlider: HTMLInputElement;\n\n    // Spectral data controls\n    private spectralDataSelect: HTMLSelectElement;\n    private wavUploadInput: HTMLInputElement;\n    private dynamicParamSlider: HTMLInputElement | null = null;\n    private dynamicParamContainer: HTMLElement | null = null;\n\n    // Callbacks\n    private onPathChange: ((state: ReadingPathState) => void) | null = null;\n    private onVolumeResolutionChange?: (resolution: VolumeResolution) => void;\n    private onSpectralDataChange?: (dataSet: string) => void;\n    private onWavUpload?: (files: FileList) => void;\n    private onDynamicParamChange?: (value: number) => void;\n    private onSynthModeChange: ((mode: SynthMode) => void) | null = null;\n    private onFrequencyChange: ((freq: number) => void) | null = null;\n    private onCarrierChange: ((carrier: CarrierType) => void) | null = null;\n    private onFeedbackChange: ((amount: number) => void) | null = null;\n    private onMidiInputChange: ((id: string) => void) | null = null;\n    private onOctaveChange: ((octave: number) => void) | null = null;\n\n    // LFO Callbacks\n    private onLFOParamChange: ((index: number, param: string, value: any) => void) | null = null;\n    private onModulationRoutingChange: ((target: string, source: string) => void) | null = null;\n\n    constructor(containerId: string) {\n        const el = document.getElementById(containerId);\n        if (!el) throw new Error(`Container not found: ${containerId}`);\n        this.container = el;\n\n        this.createSection('Wave/Spectral Volume');\n        this.spectralDataSelect = this.createSelect('spectral-data-type', 'Data Set', [\n            'blank',\n            '3d-julia',\n            'mandelbulb',\n            'menger-sponge',\n            'sine-plasma',\n            'game-of-life'\n        ]);\n\n        // Add reset button next to dataset selector\n        this.createResetButton();\n\n        // Dynamic parameter slider (shown for certain datasets)\n        this.createDynamicParameterSlider();\n\n        // Add WAV upload (multi-select for morphing)\n        this.wavUploadInput = this.createFileInput('wav-upload', 'Upload WAV (Multi-select)', '.wav,.mp3,.ogg', true);\n\n        // Add progress indicator\n        this.createProgressIndicator();\n\n        // Create section headers\n        this.createSection('Reading Path');\n        // Modulatable Sliders\n        const pathYControl = this.createModulatableSlider('path-y', 'Position Y (Morph)', -1, 1, 0, 0.01, 'pathY');\n        this.pathYSlider = pathYControl.slider;\n\n        this.planeTypeSelect = this.createSelect('plane-type', 'Plane Type', [\n            PlaneType.FLAT,\n            PlaneType.SINCOS,\n            PlaneType.WAVE,\n            PlaneType.RIPPLE,\n        ]);\n\n        // Speed slider removed\n\n        const scanPosControl = this.createModulatableSlider('scan-pos', 'Scan Phase', -1, 1, 0, 0.01, 'scanPhase');\n        this.scanPositionSlider = scanPosControl.slider;\n\n        // LFO Section\n        this.createSection('LFOs');\n        this.createLFOUnit(0);\n        this.createLFOUnit(1);\n\n        // Initialize controls\n        this.createSection('Audio Synthesis');\n        this.synthModeSelect = this.createSelect('synth-mode', 'Mode', [\n            SynthMode.WAVETABLE,\n            SynthMode.SPECTRAL,\n        ]);\n        this.frequencySlider = this.createFrequencySlider();\n        this.createCarrierSelect();\n        this.createFeedbackSlider();\n        this.midiSelect = this.createMidiSelect();\n        this.createOctaveSelect();\n\n        this.createSection('Visualization');\n        this.densityXSlider = this.createSlider('density-x', 'Freq Bins (X)', VOLUME_DENSITY_X_MIN, VOLUME_DENSITY_X_MAX, VOLUME_DENSITY_X_DEFAULT, 1);\n        this.densityYSlider = this.createSlider('density-y', 'Morph Layers (Y)', VOLUME_DENSITY_Y_MIN, VOLUME_DENSITY_Y_MAX, VOLUME_DENSITY_Y_DEFAULT, 1);\n        this.densityZSlider = this.createSlider('density-z', 'Time Res (Z)', VOLUME_DENSITY_Z_MIN, VOLUME_DENSITY_Z_MAX, VOLUME_DENSITY_Z_DEFAULT, 1);\n\n        this.wireUpEvents();\n    }\n\n    // ... (createSection, createSlider, createSelect methods remain same)\n\n    private createSection(title: string): void {\n        const card = document.createElement('div');\n        card.className = 'control-card';\n\n        const header = document.createElement('div');\n        header.className = 'control-section-title';\n        header.textContent = title;\n\n        card.appendChild(header);\n        this.container.appendChild(card);\n        this.currentSectionContainer = card;\n    }\n\n    private appendControl(element: HTMLElement): void {\n        (this.currentSectionContainer || this.container).appendChild(element);\n    }\n\n    private createSlider(\n        id: string,\n        label: string,\n        min: number,\n        max: number,\n        value: number,\n        step: number\n    ): HTMLInputElement {\n        const group = document.createElement('div');\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = id;\n        labelEl.textContent = label;\n\n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'value-display';\n        valueDisplay.textContent = step >= 1 ? String(Math.round(value)) : value.toFixed(2);\n        valueDisplay.id = `${id}-value`;\n\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.id = id;\n        slider.min = String(min);\n        slider.max = String(max);\n        slider.value = String(value);\n        slider.step = String(step);\n        slider.className = 'slider';\n\n        // Update value display on change\n        slider.addEventListener('input', () => {\n            const val = parseFloat(slider.value);\n            valueDisplay.textContent = step >= 1 ? String(Math.round(val)) : val.toFixed(2);\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(valueDisplay);\n\n        group.appendChild(labelRow);\n        group.appendChild(slider);\n        this.appendControl(group);\n\n        return slider;\n    }\n\n    private createSelect(id: string, label: string, options: string[]): HTMLSelectElement {\n        const group = document.createElement('div');\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = id;\n        labelEl.textContent = label;\n\n        const select = document.createElement('select');\n        select.id = id;\n        select.className = 'select';\n\n        for (const option of options) {\n            const optEl = document.createElement('option');\n            optEl.value = option;\n            optEl.textContent = option;\n            select.appendChild(optEl);\n        }\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n\n        group.appendChild(labelRow);\n        group.appendChild(select);\n        this.appendControl(group);\n\n        return select;\n    }\n\n    private createModulatableSlider(\n        id: string,\n        label: string,\n        min: number,\n        max: number,\n        value: number,\n        step: number,\n        targetParam: string\n    ): { slider: HTMLInputElement, select: HTMLSelectElement } {\n        const group = document.createElement('div');\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = id;\n        labelEl.textContent = label;\n\n        // Source Selector (None, LFO1, LFO2)\n        const sourceSelect = document.createElement('select');\n        sourceSelect.className = 'source-select';\n        sourceSelect.style.marginLeft = 'auto';\n        sourceSelect.style.fontSize = '0.7rem';\n        sourceSelect.style.padding = '2px';\n\n        ['None', 'LFO 1', 'LFO 2'].forEach(opt => {\n            const option = document.createElement('option');\n            option.value = opt.toLowerCase().replace(' ', ''); // none, lfo1, lfo2\n            option.textContent = opt;\n            if (opt === 'None') option.selected = true;\n            sourceSelect.appendChild(option);\n        });\n\n        sourceSelect.addEventListener('change', () => {\n            if (this.onModulationRoutingChange) {\n                this.onModulationRoutingChange(targetParam, sourceSelect.value);\n            }\n            // Disable slider if modulated?\n            slider.disabled = sourceSelect.value !== 'none';\n            group.style.opacity = sourceSelect.value !== 'none' ? '0.8' : '1.0';\n        });\n\n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'value-display';\n        valueDisplay.textContent = step >= 1 ? String(Math.round(value)) : value.toFixed(2);\n        valueDisplay.id = `${id}-value`;\n\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.id = id;\n        slider.min = String(min);\n        slider.max = String(max);\n        slider.value = String(value);\n        slider.step = String(step);\n        slider.className = 'slider';\n\n        slider.addEventListener('input', () => {\n            const val = parseFloat(slider.value);\n            valueDisplay.textContent = step >= 1 ? String(Math.round(val)) : val.toFixed(2);\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(sourceSelect);\n\n        const valueRow = document.createElement('div');\n        valueRow.className = 'label-row';\n        valueRow.style.justifyContent = 'flex-end';\n        valueRow.appendChild(valueDisplay);\n\n        group.appendChild(labelRow);\n        group.appendChild(valueRow);\n        group.appendChild(slider);\n        this.appendControl(group);\n\n        return { slider, select: sourceSelect };\n    }\n\n    private createLFOUnit(index: number): void {\n        const wrapper = document.createElement('div');\n        wrapper.className = 'lfo-unit';\n        wrapper.style.marginBottom = '10px';\n        wrapper.style.padding = '5px';\n        wrapper.style.borderLeft = '2px solid #333';\n\n        const title = document.createElement('div');\n        title.className = 'label-row';\n        title.innerHTML = `<label>LFO ${index + 1}</label>`;\n        wrapper.appendChild(title);\n\n        // Waveform\n        const waveSelect = document.createElement('select');\n        waveSelect.className = 'select';\n        ['Sine', 'Square', 'Saw', 'Triangle'].forEach(w => {\n            const opt = document.createElement('option');\n            opt.value = w.toLowerCase();\n            opt.textContent = w;\n            waveSelect.appendChild(opt);\n        });\n        waveSelect.addEventListener('change', () => {\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'waveform', waveSelect.value);\n        });\n        wrapper.appendChild(waveSelect);\n\n        // Frequency (0 - 2000Hz)\n        const freqLabel = document.createElement('div');\n        freqLabel.className = 'label-row';\n        freqLabel.innerHTML = '<label>Freq</label><span class=\"value-display\">1.0 Hz</span>';\n        const freqDisplay = freqLabel.querySelector('span')!;\n\n        const freqSlider = document.createElement('input');\n        freqSlider.type = 'range';\n        freqSlider.min = '0';\n        freqSlider.max = '2000'; // User requested\n        freqSlider.step = '0.1';\n        freqSlider.value = '1.0';\n        freqSlider.className = 'slider';\n        freqSlider.addEventListener('input', () => {\n            freqDisplay.textContent = `${freqSlider.value} Hz`;\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'frequency', parseFloat(freqSlider.value));\n        });\n        wrapper.appendChild(freqLabel);\n        wrapper.appendChild(freqSlider);\n\n        // Amplitude (0 - 1)\n        const ampLabel = document.createElement('div');\n        ampLabel.className = 'label-row';\n        ampLabel.innerHTML = '<label>Amp</label><span class=\"value-display\">0.5</span>';\n        const ampDisplay = ampLabel.querySelector('span')!; // Fix: defined ampDisplay\n\n        const ampSlider = document.createElement('input');\n        ampSlider.type = 'range';\n        ampSlider.min = '0';\n        ampSlider.max = '1';\n        ampSlider.step = '0.01';\n        ampSlider.value = '0.5';\n        ampSlider.className = 'slider';\n        ampSlider.addEventListener('input', () => {\n            ampDisplay.textContent = ampSlider.value;\n            if (this.onLFOParamChange) this.onLFOParamChange(index, 'amplitude', parseFloat(ampSlider.value));\n        });\n        wrapper.appendChild(ampLabel);\n        wrapper.appendChild(ampSlider);\n\n        this.appendControl(wrapper);\n    }\n\n    private createFrequencySlider(): HTMLInputElement {\n        // Frequency slider with note name display\n        // Range: 20Hz to 2000Hz, default 220Hz (A3)\n        const group = document.createElement('div');\n        group.id = 'frequency-container';\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = 'frequency';\n        labelEl.textContent = 'Frequency';\n\n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'value-display';\n        valueDisplay.id = 'frequency-value';\n        valueDisplay.textContent = '220 Hz (A3)';\n\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.id = 'frequency';\n        slider.min = '20';\n        slider.max = '2000';\n        slider.value = '220';\n        slider.step = '1';\n        slider.className = 'slider';\n\n        // Update value display with note name\n        slider.addEventListener('input', () => {\n            const freq = parseFloat(slider.value);\n            const noteName = this.freqToNoteName(freq);\n            valueDisplay.textContent = `${Math.round(freq)} Hz (${noteName})`;\n            if (this.onFrequencyChange) {\n                this.onFrequencyChange(freq);\n            }\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(valueDisplay);\n\n        group.appendChild(labelRow);\n        group.appendChild(slider);\n        this.appendControl(group);\n\n        this.frequencySlider = slider;\n        return slider;\n    }\n\n    private createCarrierSelect(): HTMLSelectElement {\n        const group = document.createElement('div');\n        group.id = 'carrier-container';\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = 'carrier';\n        labelEl.textContent = 'Carrier';\n\n        const select = document.createElement('select');\n        select.id = 'carrier';\n        select.className = 'select';\n\n        const options = [\n            { value: '0', label: 'Sine' },\n            { value: '1', label: 'Saw' },\n            { value: '2', label: 'Square' },\n            { value: '3', label: 'Triangle' },\n        ];\n\n        for (const opt of options) {\n            const optEl = document.createElement('option');\n            optEl.value = opt.value;\n            optEl.textContent = opt.label;\n            select.appendChild(optEl);\n        }\n\n        select.addEventListener('change', () => {\n            if (this.onCarrierChange) {\n                this.onCarrierChange(parseInt(select.value) as CarrierType);\n            }\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n\n        group.appendChild(labelRow);\n        group.appendChild(select);\n        this.appendControl(group);\n\n        return select;\n    }\n\n    private createFeedbackSlider(): HTMLInputElement {\n        const group = document.createElement('div');\n        group.id = 'feedback-container';\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = 'feedback';\n        labelEl.textContent = 'Feedback';\n\n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'value-display';\n        valueDisplay.id = 'feedback-value';\n        valueDisplay.textContent = '0%';\n\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.id = 'feedback';\n        slider.min = '0';\n        slider.max = '0.99';\n        slider.value = '0';\n        slider.step = '0.01';\n        slider.className = 'slider';\n\n        slider.addEventListener('input', () => {\n            const val = parseFloat(slider.value);\n            valueDisplay.textContent = Math.round(val * 100) + '%';\n            if (this.onFeedbackChange) {\n                this.onFeedbackChange(val);\n            }\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(valueDisplay);\n\n        group.appendChild(labelRow);\n        group.appendChild(slider);\n        this.appendControl(group);\n\n        return slider;\n    }\n\n    private createMidiSelect(): HTMLSelectElement {\n        const group = document.createElement('div');\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = 'midi-input';\n        labelEl.textContent = 'MIDI Input';\n\n        const select = document.createElement('select');\n        select.id = 'midi-input';\n        select.className = 'select';\n\n        // Default option\n        const defaultOpt = document.createElement('option');\n        defaultOpt.value = '';\n        defaultOpt.textContent = 'No Devices Found';\n        select.appendChild(defaultOpt);\n\n        select.addEventListener('change', () => {\n            if (this.onMidiInputChange) {\n                this.onMidiInputChange(select.value);\n            }\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n\n        group.appendChild(labelRow);\n        group.appendChild(select);\n        this.appendControl(group);\n\n        return select;\n    }\n\n    private createOctaveSelect(): HTMLSelectElement {\n        const select = this.createSelect('octave-select', 'Keyboard Octave', ['0', '1', '2', '3', '4', '5', '6', '7']);\n        select.value = '3'; // Default C3\n        select.addEventListener('change', () => {\n            if (this.onOctaveChange) {\n                this.onOctaveChange(parseInt(select.value, 10));\n            }\n        });\n        return select;\n    }\n\n    private freqToNoteName(freq: number): string {\n        // A4 = 440Hz = MIDI 69\n        const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n        const midiNote = 12 * Math.log2(freq / 440) + 69;\n        const roundedMidi = Math.round(midiNote);\n        const octave = Math.floor(roundedMidi / 12) - 1;\n        const noteIndex = roundedMidi % 12;\n        return `${noteNames[noteIndex]}${octave}`;\n    }\n\n    private createFileInput(id: string, label: string, accept: string, multiple: boolean = false): HTMLInputElement {\n        const group = document.createElement('div');\n        group.className = 'control-group';\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = id;\n        labelEl.textContent = label;\n\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.id = id;\n        input.accept = accept;\n        input.multiple = multiple;\n        input.className = 'file-input';\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n\n        group.appendChild(labelRow);\n        group.appendChild(input);\n        this.appendControl(group);\n\n        return input;\n    }\n\n    private createResetButton(): void {\n        const group = document.createElement('div');\n        group.className = 'control-group';\n\n        const button = document.createElement('button');\n        button.id = 'reset-dataset-btn';\n        button.textContent = '↻ Reset Dataset';\n        button.className = 'reset-button';\n\n        button.addEventListener('click', () => {\n            // Trigger spectral data change callback to reinit current dataset\n            if (this.onSpectralDataChange) {\n                const currentDataset = this.spectralDataSelect.value;\n                this.onSpectralDataChange(currentDataset);\n            }\n        });\n\n        group.appendChild(button);\n        this.appendControl(group);\n    }\n\n    private createDynamicParameterSlider(): void {\n        const container = document.createElement('div');\n        container.id = 'dynamic-param-container';\n        container.className = 'control-group';\n        container.style.display = 'none'; // Hidden by default\n\n        const labelEl = document.createElement('label');\n        labelEl.htmlFor = 'dynamic-param';\n        labelEl.id = 'dynamic-param-label';\n        labelEl.textContent = 'Parameter';\n\n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'value-display';\n        valueDisplay.id = 'dynamic-param-value';\n        valueDisplay.textContent = '500';\n\n        const slider = document.createElement('input');\n        slider.type = 'range';\n        slider.id = 'dynamic-param';\n        slider.min = '0';\n        slider.max = '1000';\n        slider.value = '500';\n        slider.step = '10';\n        slider.className = 'slider';\n\n        // Update value display on change\n        slider.addEventListener('input', () => {\n            const val = parseFloat(slider.value);\n            valueDisplay.textContent = Math.round(val).toString();\n            if (this.onDynamicParamChange) {\n                this.onDynamicParamChange(val);\n            }\n        });\n\n        const labelRow = document.createElement('div');\n        labelRow.className = 'label-row';\n        labelRow.appendChild(labelEl);\n        labelRow.appendChild(valueDisplay);\n\n        container.appendChild(labelRow);\n        container.appendChild(slider);\n        this.appendControl(container);\n\n        this.dynamicParamSlider = slider;\n        this.dynamicParamContainer = container;\n    }\n\n    private createProgressIndicator(): void {\n        const progressContainer = document.createElement('div');\n        progressContainer.id = 'wav-progress-container';\n        progressContainer.className = 'progress-container';\n        progressContainer.style.display = 'none'; // Hidden by default\n\n        const spinner = document.createElement('div');\n        spinner.className = 'spinner';\n\n        const progressBar = document.createElement('div');\n        progressBar.className = 'progress-bar';\n\n        const progressFill = document.createElement('div');\n        progressFill.id = 'wav-progress-fill';\n        progressFill.className = 'progress-fill';\n\n        const progressText = document.createElement('span');\n        progressText.id = 'wav-progress-text';\n        progressText.className = 'progress-text';\n        progressText.textContent = '0%';\n\n        progressBar.appendChild(progressFill);\n        progressContainer.appendChild(spinner);\n        progressContainer.appendChild(progressBar);\n        progressContainer.appendChild(progressText);\n\n        this.appendControl(progressContainer);\n    }\n\n    private wireUpEvents(): void {\n        const pathUpdate = () => {\n            if (this.onPathChange) {\n                this.onPathChange(this.getState());\n            }\n        };\n\n\n\n        const volumeUpdate = () => {\n            if (this.onVolumeResolutionChange) {\n                this.onVolumeResolutionChange({\n                    x: Math.round(parseFloat(this.densityXSlider.value)),\n                    y: Math.round(parseFloat(this.densityYSlider.value)),\n                    z: Math.round(parseFloat(this.densityZSlider.value)),\n                });\n            }\n        };\n\n        const spectralDataUpdate = () => {\n            if (this.onSpectralDataChange) {\n                this.onSpectralDataChange(this.spectralDataSelect.value);\n            }\n        };\n\n        this.spectralDataSelect.addEventListener('change', spectralDataUpdate);\n\n        // WAV upload (multi-file support)\n        this.wavUploadInput.addEventListener('change', () => {\n            const files = this.wavUploadInput.files;\n            if (files && files.length > 0 && this.onWavUpload) {\n                this.onWavUpload(files);\n            }\n        });\n\n        this.pathYSlider.addEventListener('input', pathUpdate);\n        // Rotation sliders removed - controlled by mouse\n        this.planeTypeSelect.addEventListener('change', pathUpdate);\n        this.scanPositionSlider.addEventListener('input', pathUpdate);\n\n        // Synth mode change\n        this.synthModeSelect.addEventListener('change', () => {\n            const mode = this.synthModeSelect.value as SynthMode;\n            // Show/hide wavetable-specific controls based on mode\n            const isWavetable = mode === SynthMode.WAVETABLE;\n            if (this.frequencyContainer) {\n                this.frequencyContainer.style.display = isWavetable ? 'block' : 'none';\n            }\n            if (this.carrierContainer) {\n                this.carrierContainer.style.display = isWavetable ? 'block' : 'none';\n            }\n            if (this.feedbackContainer) {\n                this.feedbackContainer.style.display = isWavetable ? 'block' : 'none';\n            }\n            if (this.onSynthModeChange) {\n                this.onSynthModeChange(mode);\n            }\n        });\n\n        // Volume density sliders trigger on change (not input) to avoid too many reinits\n        this.densityXSlider.addEventListener('change', volumeUpdate);\n        this.densityYSlider.addEventListener('change', volumeUpdate);\n        this.densityZSlider.addEventListener('change', volumeUpdate);\n    }\n\n    public setPathChangeCallback(callback: (state: ReadingPathState) => void): void {\n        this.onPathChange = callback;\n    }\n\n    public setSynthModeChangeCallback(callback: (mode: SynthMode) => void): void {\n        this.onSynthModeChange = callback;\n    }\n\n    public setFrequencyChangeCallback(callback: (freq: number) => void): void {\n        this.onFrequencyChange = callback;\n    }\n\n    public setFrequency(freq: number): void {\n        if (this.frequencySlider) {\n            this.frequencySlider.value = String(freq);\n        }\n        const valueDisplay = document.getElementById('frequency-value');\n        if (valueDisplay) {\n            const noteName = this.freqToNoteName(freq);\n            valueDisplay.textContent = `${Math.round(freq)} Hz (${noteName})`;\n        }\n    }\n\n    public setCarrierChangeCallback(callback: (carrier: CarrierType) => void): void {\n        this.onCarrierChange = callback;\n    }\n\n    public setFeedbackChangeCallback(callback: (amount: number) => void): void {\n        this.onFeedbackChange = callback;\n    }\n\n    public setMidiInputChangeCallback(callback: (id: string) => void): void {\n        this.onMidiInputChange = callback;\n    }\n\n    public setOctaveChangeCallback(callback: (octave: number) => void): void {\n        this.onOctaveChange = callback;\n    }\n\n    public updateMidiInputs(inputs: { id: string, name: string }[]): void {\n        // Save current selection\n        const currentSelection = this.midiSelect.value;\n\n        this.midiSelect.innerHTML = '';\n\n        if (inputs.length === 0) {\n            const opt = document.createElement('option');\n            opt.value = '';\n            opt.textContent = 'No Devices Found';\n            this.midiSelect.appendChild(opt);\n            this.midiSelect.disabled = true;\n        } else {\n            this.midiSelect.disabled = false;\n\n            // Add \"None\" or placeholder? User probably wants to select one.\n            // Let's rely on logic to select first one if not selected\n\n            for (const input of inputs) {\n                const opt = document.createElement('option');\n                opt.value = input.id;\n                opt.textContent = input.name;\n                this.midiSelect.appendChild(opt);\n            }\n\n            // Restore selection if still exists, or select first\n            if (inputs.some(i => i.id === currentSelection)) {\n                this.midiSelect.value = currentSelection;\n            } else if (inputs.length > 0) {\n                this.midiSelect.selectedIndex = 0;\n                if (this.onMidiInputChange) {\n                    this.onMidiInputChange(this.midiSelect.value);\n                }\n            }\n        }\n    }\n\n    public setVolumeResolutionChangeCallback(callback: (resolution: VolumeResolution) => void): void {\n        this.onVolumeResolutionChange = callback;\n    }\n\n    public setSpectralDataChangeCallback(callback: (dataSet: string) => void): void {\n        this.onSpectralDataChange = callback;\n    }\n\n    public setWavUploadCallback(callback: (files: FileList) => void): void {\n        this.onWavUpload = callback;\n    }\n\n    public setDynamicParamChangeCallback(callback: (value: number) => void): void {\n        this.onDynamicParamChange = callback;\n    }\n\n    public setLFOParamChangeCallback(callback: (index: number, param: string, value: any) => void): void {\n        this.onLFOParamChange = callback;\n    }\n\n    public setModulationRoutingChangeCallback(callback: (target: string, source: string) => void): void {\n        this.onModulationRoutingChange = callback;\n    }\n\n    public showDynamicParam(label: string, min: number, max: number, value: number, step: number): void {\n        if (!this.dynamicParamSlider || !this.dynamicParamContainer) return;\n\n        const labelEl = document.getElementById('dynamic-param-label');\n        const valueDisplay = document.getElementById('dynamic-param-value');\n\n        if (labelEl) labelEl.textContent = label;\n\n        this.dynamicParamSlider.min = String(min);\n        this.dynamicParamSlider.max = String(max);\n        this.dynamicParamSlider.value = String(value);\n        this.dynamicParamSlider.step = String(step);\n\n        if (valueDisplay) {\n            valueDisplay.textContent = step >= 1 ? String(Math.round(value)) : value.toFixed(2);\n        }\n\n        this.dynamicParamContainer.style.display = 'block';\n    }\n\n    public hideDynamicParam(): void {\n        if (this.dynamicParamContainer) {\n            this.dynamicParamContainer.style.display = 'none';\n        }\n    }\n\n    public getState(): ReadingPathState {\n        return {\n            position: {\n                x: 0,\n                y: parseFloat(this.pathYSlider.value),\n                z: 0,\n            },\n            rotation: {\n                x: 0, // Controlled by mouse\n                y: 0, // Not used\n                z: 0, // Controlled by mouse\n            },\n            scanPosition: parseFloat(this.scanPositionSlider.value),\n            planeType: this.planeTypeSelect.value as PlaneType,\n        };\n    }\n\n    // getSpeed Removed\n\n    public updateScanPosition(pos: number): void {\n        this.scanPositionSlider.value = String(pos);\n        // Update display\n        const display = document.getElementById('scan-pos-value');\n        if (display) display.textContent = pos.toFixed(2);\n\n        // Trigger callback manually\n        if (this.onPathChange) {\n            this.onPathChange(this.getState());\n        }\n    }\n\n    public updatePathY(y: number): void {\n        this.pathYSlider.value = String(y);\n        const display = document.getElementById('path-y-value');\n        if (display) display.textContent = y.toFixed(2);\n\n        // Trigger callback manually\n        if (this.onPathChange) {\n            this.onPathChange(this.getState());\n        }\n    }\n\n    public addSpectralDataOption(value: string, label: string): void {\n        // Check if option already exists\n        const existingOption = Array.from(this.spectralDataSelect.options).find(\n            opt => opt.value === value\n        );\n\n        if (!existingOption) {\n            const option = document.createElement('option');\n            option.value = value;\n            option.textContent = label;\n            this.spectralDataSelect.appendChild(option);\n        }\n\n        // Select the new option\n        this.spectralDataSelect.value = value;\n\n        // Trigger change event\n        const event = new Event('change');\n        this.spectralDataSelect.dispatchEvent(event);\n    }\n\n    public setVolumeDensity(resolution: VolumeResolution): void {\n        // Update slider values\n        this.densityXSlider.value = String(resolution.x);\n        this.densityYSlider.value = String(resolution.y);\n        this.densityZSlider.value = String(resolution.z);\n\n        // Update displays\n        const xDisplay = document.getElementById('density-x-value');\n        const yDisplay = document.getElementById('density-y-value');\n        const zDisplay = document.getElementById('density-z-value');\n\n        if (xDisplay) xDisplay.textContent = String(Math.round(resolution.x));\n        if (yDisplay) yDisplay.textContent = String(Math.round(resolution.y));\n        if (zDisplay) zDisplay.textContent = String(Math.round(resolution.z));\n    }\n\n    public showProgress(): void {\n        const container = document.getElementById('wav-progress-container');\n        if (container) container.style.display = 'flex';\n    }\n\n    public hideProgress(): void {\n        const container = document.getElementById('wav-progress-container');\n        if (container) container.style.display = 'none';\n    }\n\n    public updateProgress(percent: number): void {\n        const fill = document.getElementById('wav-progress-fill');\n        const text = document.getElementById('wav-progress-text');\n\n        if (fill) fill.style.width = `${percent}%`;\n        if (text) text.textContent = `${Math.round(percent)}%`;\n    }\n}\n","\nexport class Spectrogram {\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private width: number;\n    private height: number;\n    private tempCanvas: HTMLCanvasElement;\n    private tempCtx: CanvasRenderingContext2D;\n\n    private mode: 'SCANLINE' | 'AUDIO_OUTPUT' = 'SCANLINE';\n\n    constructor(contaiderId: string) {\n        this.canvas = document.getElementById(contaiderId) as HTMLCanvasElement;\n\n        const ctx = this.canvas.getContext('2d');\n        if (!ctx) throw new Error('Failed to get 2D context');\n        this.ctx = ctx;\n\n        // Create temp canvas for scrolling\n        this.tempCanvas = document.createElement('canvas');\n        const tempCtx = this.tempCanvas.getContext('2d');\n        if (!tempCtx) throw new Error('Failed to get temp 2D context');\n        this.tempCtx = tempCtx;\n\n        this.width = 320;\n        this.height = 160;\n        this.resize();\n\n        window.addEventListener('resize', () => this.resize());\n\n        // Toggle mode on click\n        this.canvas.addEventListener('click', () => {\n            this.mode = this.mode === 'SCANLINE' ? 'AUDIO_OUTPUT' : 'SCANLINE';\n        });\n    }\n\n    private resize(): void {\n        // Get the display size from the canvas element (set by CSS)\n        const width = this.canvas.clientWidth;\n        const height = this.canvas.clientHeight;\n\n        // Handle high DPI displays\n        const dpr = window.devicePixelRatio || 1;\n\n        this.canvas.width = width * dpr;\n        this.canvas.height = height * dpr;\n\n        this.width = width * dpr;\n        this.height = height * dpr;\n\n        // Update temp canvas size\n        this.tempCanvas.width = width * dpr;\n        this.tempCanvas.height = height * dpr;\n\n        // Clear\n        this.ctx.fillStyle = '#000';\n        this.ctx.fillRect(0, 0, this.width, this.height);\n    }\n\n    public update(scanlineData: Float32Array, audioDataLeft?: Float32Array): void {\n        if (!scanlineData) return;\n\n        // 1. Shift existing content upwards\n        this.tempCtx.drawImage(this.canvas, 0, 0);\n        this.ctx.drawImage(this.tempCtx.canvas, 0, -1);\n\n        // 2. Draw new row at the bottom edge\n        const y = this.height - 1;\n        const w = this.width;\n\n        let dataToVisualize: Float32Array;\n        let isAudioData = false;\n\n        if (this.mode === 'AUDIO_OUTPUT' && audioDataLeft) {\n            dataToVisualize = audioDataLeft;\n            isAudioData = true;\n        } else {\n            // Default to scanline (RGBA stride)\n            dataToVisualize = scanlineData;\n        }\n\n        const numPoints = isAudioData ? dataToVisualize.length : dataToVisualize.length / 4;\n\n        const row = this.ctx.createImageData(w, 1);\n        const buf = row.data; // RGBA\n\n        for (let x = 0; x < w; x++) {\n            // Map x (0..w-1) to data index\n            const normalizedX = x / w; // 0..1\n\n            // Logarithmic mapping for audio visualization looks better\n            let readIndex: number;\n            if (isAudioData) {\n                // Log scale: buffer index ~ exp(x)\n                // We want to map x=[0..1] to freq=[0..Nyquist]\n                // Simple log approximation\n                const logX = Math.pow(normalizedX, 2.0); // Simple exp-like curve\n                readIndex = Math.floor(logX * (numPoints - 1));\n            } else {\n                // Linear for scanline\n                readIndex = Math.floor(normalizedX * (numPoints - 1));\n            }\n\n            let val: number;\n\n            if (isAudioData) {\n                // Audio data is in dB (-100 to 0 typically)\n                // Map to 0..1\n                // -100dB -> 0\n                // -30dB -> 1\n                const db = dataToVisualize[readIndex];\n                val = (db + 100) / 70;\n                val = Math.max(0, Math.min(1, val));\n            } else {\n                // Scanline data is RGBA, magnitude is R (index * 4)\n                val = dataToVisualize[readIndex * 4];\n            }\n\n            // Color map: Black -> Cyan -> White\n            let r = 0, g = 0, b = 0;\n\n            if (val < 0.5) {\n                // Black to Cyan\n                const t = val * 2.0;\n                r = 0;\n                g = t * 255;\n                b = t * 255;\n            } else {\n                // Cyan to White\n                const t = (val - 0.5) * 2.0;\n                r = t * 255;\n                g = 255;\n                b = 255;\n            }\n\n            const idx = x * 4;\n            buf[idx + 0] = r;\n            buf[idx + 1] = g;\n            buf[idx + 2] = b;\n            buf[idx + 3] = 255; // Alpha\n        }\n\n        this.ctx.putImageData(row, 0, y);\n    }\n\n\n}\n","\nexport class StereoScope {\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private width: number;\n    private height: number;\n\n    public mode: 'lissajous' | 'channels' = 'channels';\n\n    constructor(containerId: string) {\n        this.canvas = document.getElementById(containerId) as HTMLCanvasElement;\n\n        // Add click handler to toggle mode\n        this.canvas.addEventListener('click', () => {\n            this.mode = this.mode === 'lissajous' ? 'channels' : 'lissajous';\n        });\n\n        const ctx = this.canvas.getContext('2d');\n        if (!ctx) throw new Error('Failed to get 2D context');\n        this.ctx = ctx;\n\n        this.width = 320;\n        this.height = 160;\n        this.resize();\n\n        window.addEventListener('resize', () => this.resize());\n    }\n\n    private resize(): void {\n        // Get the display size from the canvas element (set by CSS)\n        const width = this.canvas.clientWidth;\n        const height = this.canvas.clientHeight;\n\n        // Handle high DPI displays\n        const dpr = window.devicePixelRatio || 1;\n\n        this.canvas.width = width * dpr;\n        this.canvas.height = height * dpr;\n\n        this.width = width * dpr;\n        this.height = height * dpr;\n    }\n\n    public draw(left: Float32Array, right: Float32Array): void {\n        const w = this.width;\n        const h = this.height;\n        const cx = w / 2;\n        const cy = h / 2;\n\n        // Fade out\n        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';\n        this.ctx.fillRect(0, 0, w, h);\n\n        this.ctx.lineWidth = 1.5;\n\n        if (this.mode === 'lissajous') {\n            this.ctx.strokeStyle = '#00ff88'; // Greenish cyan\n            this.ctx.beginPath();\n\n            // Draw Lissajous (X=Left, Y=Right)\n            // Or Vectorscope style: rotated 45 degrees\n            // Standard Lissajous:\n            // x = left * scale + cx\n            // y = right * scale + cy\n\n            const scale = Math.min(w, h) * 0.4;\n\n            // Downsample for performance if needed\n            const step = 2;\n\n            for (let i = 0; i < left.length; i += step) {\n                const l = left[i];\n                const r = right[i];\n\n                // Rotate 45 degrees for standard stereo field view\n                // M = S (Mid = Sum)\n                // S = D (Side = Diff)\n                // But simple L/R plot is:\n                const x = l * scale + cx;\n                const y = -r * scale + cy; // Flip Y for audio convention usually\n\n                if (i === 0) {\n                    this.ctx.moveTo(x, y);\n                } else {\n                    this.ctx.lineTo(x, y);\n                }\n            }\n            this.ctx.stroke();\n        } else {\n            // Channels mode: Left (Gray) and Right (Red)\n            const scaleY = h * 0.4;\n            const step = Math.ceil(left.length / w);\n\n            // Draw Left (Gray)\n            this.ctx.strokeStyle = '#888888';\n            this.ctx.beginPath();\n            for (let i = 0; i < left.length; i += step) {\n                const x = (i / left.length) * w;\n                const y = cy - left[i] * scaleY;\n                if (i === 0) this.ctx.moveTo(x, y);\n                else this.ctx.lineTo(x, y);\n            }\n            this.ctx.stroke();\n\n            // Draw Right (Red)\n            this.ctx.strokeStyle = '#ff4444';\n            this.ctx.beginPath();\n            for (let i = 0; i < right.length; i += step) {\n                const x = (i / right.length) * w;\n                const y = cy - right[i] * scaleY;\n                if (i === 0) this.ctx.moveTo(x, y);\n                else this.ctx.lineTo(x, y);\n            }\n            this.ctx.stroke();\n        }\n\n\n    }\n}\n","\n// Audio Engine for Spectral Table\n// Handles AudioContext, Worklet loading, and synthesis modes (spectral/wavetable)\n\nimport { SynthMode } from '../types';\n\n// Processor code for spectral (additive/iFFT) synthesis\nconst SPECTRAL_PROCESSOR_CODE = `\nclass SpectralProcessor extends AudioWorkletProcessor {\n    constructor() {\n        super();\n        this.spectralData = new Float32Array(1024 * 4); // RGBA\n        this.phaseAccumulators = new Float32Array(1024); // For oscillator bank\n        this.frequencyMultiplier = 1.0;\n        this.port.onmessage = (e) => {\n            if (e.data.type === 'spectral-data') {\n                this.spectralData = e.data.data;\n            } else if (e.data.type === 'frequency-multiplier') {\n                this.frequencyMultiplier = e.data.value;\n            }\n        };\n    }\n\n    process(inputs, outputs, parameters) {\n        const output = outputs[0];\n        const channelL = output[0];\n        const channelR = output[1];\n        \n        const numPoints = this.spectralData.length / 4;\n        \n        for (let i = 0; i < channelL.length; i++) {\n            let sumL = 0;\n            let sumR = 0;\n            \n            for (let bin = 0; bin < numPoints; bin++) {\n                const idx = bin * 4;\n                const mag = this.spectralData[idx];\n                const phaseOffset = this.spectralData[idx + 1];\n                const custom1 = this.spectralData[idx + 2];\n                \n                if (mag < 0.001) continue;\n\n                const minFreq = 20;\n                const maxFreq = 20000;\n                const normalizedBin = bin / numPoints;\n                const baseFreq = minFreq + (maxFreq - minFreq) * normalizedBin;\n                const freq = baseFreq * this.frequencyMultiplier;\n                \n                const db = mag * 60 - 60;\n                const linearMag = Math.pow(10, db / 20);\n                \n                const phaseInc = (freq * 2 * Math.PI) / sampleRate;\n                this.phaseAccumulators[bin] += phaseInc;\n                if (this.phaseAccumulators[bin] > 2 * Math.PI) {\n                    this.phaseAccumulators[bin] -= 2 * Math.PI;\n                }\n                \n                const currentPhase = this.phaseAccumulators[bin] + (phaseOffset * 2 * Math.PI);\n                const sample = Math.sin(currentPhase);\n                \n                const p = (custom1 - 0.5) * 2;\n                const gainL = Math.min(1, 1 - p) * linearMag;\n                const gainR = Math.min(1, 1 + p) * linearMag;\n                \n                sumL += sample * gainL;\n                sumR += sample * gainR;\n            }\n            \n            const scale = 0.1; \n            channelL[i] = sumL * scale;\n            channelR[i] = sumR * scale;\n        }\n        \n        return true;\n    }\n}\nregisterProcessor('spectral-processor', SpectralProcessor);\n`;\n\n// Processor code for wavetable AM synthesis with feedback\n// Carrier wave (sine/saw/square/tri) modulated by reading line magnitudes\n// Magnitude 0 = silence, Magnitude 1 = full carrier amplitude\n// Feedback: previous output mixed back into carrier for evolving timbres\nconst WAVETABLE_PROCESSOR_CODE = `\nclass WavetableProcessor extends AudioWorkletProcessor {\n    constructor() {\n        super();\n        this.envelope = new Float32Array(1024); // Amplitude envelope from reading line\n        this.envelopeSize = 64;\n        this.phase = 0;           // Carrier phase (0-1)\n        this.envPhase = 0;        // Envelope read position (0-1)\n        this.frequency = 220;     // Carrier frequency Hz\n        this.carrierType = 0;     // 0=sine, 1=saw, 2=square, 3=triangle\n        this.feedback = 0;        // Feedback amount 0-1\n        this.lastSample = 0;      // Previous output for feedback\n        \n        this.port.onmessage = (e) => {\n            if (e.data.type === 'spectral-data') {\n                const data = e.data.data;\n                const numPoints = data.length / 4;\n                this.envelopeSize = numPoints;\n                \n                let maxMag = 0;\n                for (let i = 0; i < numPoints; i++) {\n                    const mag = data[i * 4];\n                    if (mag > maxMag) maxMag = mag;\n                }\n                \n                const scale = maxMag > 0.001 ? 1.0 / maxMag : 1.0;\n                for (let i = 0; i < numPoints; i++) {\n                    this.envelope[i] = data[i * 4] * scale;\n                }\n            } else if (e.data.type === 'frequency') {\n                this.frequency = e.data.value;\n            } else if (e.data.type === 'carrier') {\n                this.carrierType = e.data.value;\n            } else if (e.data.type === 'feedback') {\n                this.feedback = e.data.value;\n            }\n        };\n    }\n    \n    // Generate carrier waveform sample at phase (0-1)\n    carrier(phase, type) {\n        switch (type) {\n            case 0: // Sine\n                return Math.sin(phase * 2 * Math.PI);\n            case 1: // Saw (falling)\n                return 1 - 2 * phase;\n            case 2: // Square\n                return phase < 0.5 ? 1 : -1;\n            case 3: // Triangle\n                return phase < 0.5 \n                    ? 4 * phase - 1 \n                    : 3 - 4 * phase;\n            default:\n                return Math.sin(phase * 2 * Math.PI);\n        }\n    }\n\n    process(inputs, outputs, parameters) {\n        const output = outputs[0];\n        const channelL = output[0];\n        const channelR = output[1];\n        \n        if (this.envelopeSize < 2) {\n            for (let i = 0; i < channelL.length; i++) {\n                channelL[i] = 0;\n                channelR[i] = 0;\n            }\n            return true;\n        }\n        \n        const carrierPhaseInc = this.frequency / sampleRate;\n        const envPhaseInc = carrierPhaseInc;\n        \n        for (let i = 0; i < channelL.length; i++) {\n            // Get base carrier sample\n            let carrierSample = this.carrier(this.phase, this.carrierType);\n            \n            // Mix in feedback: blend carrier with previous output\n            // feedback=0: pure carrier, feedback=1: 50/50 mix with previous\n            if (this.feedback > 0) {\n                carrierSample = carrierSample * (1 - this.feedback * 0.5) + this.lastSample * this.feedback * 0.5;\n            }\n            \n            // Get envelope with linear interpolation\n            const envPos = this.envPhase * this.envelopeSize;\n            const envIdx0 = Math.floor(envPos) % this.envelopeSize;\n            const envIdx1 = (envIdx0 + 1) % this.envelopeSize;\n            const envFrac = envPos - Math.floor(envPos);\n            const amplitude = this.envelope[envIdx0] * (1 - envFrac) + this.envelope[envIdx1] * envFrac;\n            \n            // AM synthesis: carrier * envelope\n            const sample = carrierSample * amplitude;\n            \n            // Store for feedback\n            this.lastSample = sample;\n            \n            const gain = 0.5;\n            channelL[i] = sample * gain;\n            channelR[i] = sample * gain;\n            \n            // Advance phases\n            this.phase += carrierPhaseInc;\n            if (this.phase >= 1.0) this.phase -= 1.0;\n            \n            this.envPhase += envPhaseInc;\n            if (this.envPhase >= 1.0) this.envPhase -= 1.0;\n        }\n        \n        return true;\n    }\n}\nregisterProcessor('wavetable-processor', WavetableProcessor);\n`;\n\nexport class AudioEngine {\n    private ctx: AudioContext;\n    private workletNode: AudioWorkletNode | null = null;\n    private isInitialized = false;\n    private currentMode: SynthMode = SynthMode.WAVETABLE; // Default to wavetable\n\n    // Buffers for visualization\n    private timeDomainDataL: Float32Array;\n    private timeDomainDataR: Float32Array;\n    private frequencyDataL: Float32Array;\n    private frequencyDataR: Float32Array;\n    private splitNode: ChannelSplitterNode;\n    private analyserL: AnalyserNode;\n    private analyserR: AnalyserNode;\n    private masterGain: GainNode;\n\n    // ADSR Envelope\n    public attack = 0.1;\n    public decay = 0.2;\n    public sustain = 0.5;\n    public release = 0.5;\n\n    private lastNoteTime = 0;\n    private isNoteOn = false;\n\n    // Wavetable frequency (Hz)\n    private wavetableFrequency = 220;\n\n    // Carrier waveform type (0=sine, 1=saw, 2=square, 3=triangle)\n    private carrierType = 0;\n\n    // Feedback amount (0-1)\n    private feedback = 0;\n\n    constructor() {\n        this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n        // Setup analysis graph\n        this.splitNode = this.ctx.createChannelSplitter(2);\n        this.analyserL = this.ctx.createAnalyser();\n        this.analyserR = this.ctx.createAnalyser();\n\n        this.masterGain = this.ctx.createGain();\n        this.masterGain.gain.value = 0;\n\n        this.analyserL.fftSize = 2048;\n        this.analyserR.fftSize = 2048;\n\n        this.timeDomainDataL = new Float32Array(this.analyserL.fftSize);\n        this.timeDomainDataR = new Float32Array(this.analyserR.fftSize);\n        this.frequencyDataL = new Float32Array(this.analyserL.frequencyBinCount);\n        this.frequencyDataR = new Float32Array(this.analyserR.frequencyBinCount);\n\n        this.splitNode.connect(this.analyserL, 0);\n        this.splitNode.connect(this.analyserR, 1);\n    }\n\n    public async initialize(): Promise<void> {\n        if (this.isInitialized) return;\n\n        try {\n            // Load both processors\n            const spectralBlob = new Blob([SPECTRAL_PROCESSOR_CODE], { type: 'application/javascript' });\n            const wavetableBlob = new Blob([WAVETABLE_PROCESSOR_CODE], { type: 'application/javascript' });\n\n            const spectralUrl = URL.createObjectURL(spectralBlob);\n            const wavetableUrl = URL.createObjectURL(wavetableBlob);\n\n            await this.ctx.audioWorklet.addModule(spectralUrl);\n            await this.ctx.audioWorklet.addModule(wavetableUrl);\n\n            URL.revokeObjectURL(spectralUrl);\n            URL.revokeObjectURL(wavetableUrl);\n\n            // Create initial worklet based on current mode\n            this.createWorkletNode();\n\n            this.isInitialized = true;\n            console.log(`✓ Audio Engine initialized (mode: ${this.currentMode})`);\n\n        } catch (e) {\n            console.error('Failed to initialize Audio Engine:', e);\n        }\n    }\n\n    private createWorkletNode(): void {\n        // Disconnect existing node if any\n        if (this.workletNode) {\n            this.workletNode.disconnect();\n            this.workletNode = null;\n        }\n\n        const processorName = this.currentMode === SynthMode.SPECTRAL\n            ? 'spectral-processor'\n            : 'wavetable-processor';\n\n        this.workletNode = new AudioWorkletNode(this.ctx, processorName, {\n            numberOfInputs: 0,\n            numberOfOutputs: 1,\n            outputChannelCount: [2] // Stereo\n        });\n\n        // Connect graph\n        // Connect graph\n        this.workletNode.connect(this.masterGain);\n        this.masterGain.connect(this.ctx.destination);\n        this.masterGain.connect(this.splitNode);\n\n        // If wavetable mode, send initial frequency\n        if (this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'frequency',\n                value: this.wavetableFrequency\n            });\n        }\n    }\n\n    public setMode(mode: SynthMode): void {\n        if (mode === this.currentMode) return;\n\n        this.currentMode = mode;\n\n        if (this.isInitialized) {\n            this.createWorkletNode();\n            console.log(`✓ Synth mode changed to: ${mode}`);\n        }\n    }\n\n    public getMode(): SynthMode {\n        return this.currentMode;\n    }\n\n    public setWavetableFrequency(freq: number): void {\n        this.wavetableFrequency = freq;\n\n        if (this.workletNode && this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'frequency',\n                value: freq\n            });\n        }\n    }\n\n    public getWavetableFrequency(): number {\n        return this.wavetableFrequency;\n    }\n\n    public setCarrier(type: number): void {\n        this.carrierType = type;\n\n        if (this.workletNode && this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'carrier',\n                value: type\n            });\n        }\n    }\n\n    public getCarrier(): number {\n        return this.carrierType;\n    }\n\n    public setFeedback(amount: number): void {\n        this.feedback = amount;\n\n        if (this.workletNode && this.currentMode === SynthMode.WAVETABLE) {\n            this.workletNode.port.postMessage({\n                type: 'feedback',\n                value: amount\n            });\n        }\n    }\n\n    public getFeedback(): number {\n        return this.feedback;\n    }\n\n    public updateSpectralData(data: Float32Array): void {\n        if (!this.workletNode || !this.isInitialized) {\n            return;\n        }\n\n        // Send data to worklet (both modes use same message format)\n        this.workletNode.port.postMessage({\n            type: 'spectral-data',\n            data: data\n        });\n    }\n\n    public getScopeData(): { left: Float32Array, right: Float32Array } {\n        this.analyserL.getFloatTimeDomainData(this.timeDomainDataL as any);\n        this.analyserR.getFloatTimeDomainData(this.timeDomainDataR as any);\n        return {\n            left: this.timeDomainDataL,\n            right: this.timeDomainDataR\n        };\n    }\n\n    public getAudioSpectralData(): { left: Float32Array, right: Float32Array } {\n        this.analyserL.getFloatFrequencyData(this.frequencyDataL as any);\n        this.analyserR.getFloatFrequencyData(this.frequencyDataR as any);\n        return {\n            left: this.frequencyDataL,\n            right: this.frequencyDataR\n        };\n    }\n\n    public setSpectralPitch(multiplier: number): void {\n        if (this.workletNode && this.currentMode === SynthMode.SPECTRAL) {\n            this.workletNode.port.postMessage({\n                type: 'frequency-multiplier',\n                value: multiplier\n            });\n        }\n    }\n\n    public resume(): void {\n        if (this.ctx.state === 'suspended') {\n            this.ctx.resume();\n        }\n    }\n\n    public triggerAttack(params?: { a: number, d: number, s: number }): void {\n        const now = this.ctx.currentTime;\n        this.lastNoteTime = now;\n        this.isNoteOn = true;\n\n        if (params) {\n            this.attack = params.a;\n            this.decay = params.d;\n            this.sustain = params.s;\n        }\n\n        // Cancel any pending ramps\n        this.masterGain.gain.cancelScheduledValues(now);\n\n        // Smooth transition from current value\n        const currentGain = this.masterGain.gain.value; // Approximate, see getGain() for precision\n        this.masterGain.gain.setValueAtTime(currentGain, now);\n\n        // Attack ramp\n        // Target peak (1.0 or user defined?) usually 1.0, then decay to Sustain\n        const peak = 1.0;\n        this.masterGain.gain.linearRampToValueAtTime(peak, now + this.attack);\n\n        // Decay ramp\n        this.masterGain.gain.linearRampToValueAtTime(this.sustain, now + this.attack + this.decay);\n    }\n\n    public triggerRelease(r?: number): void {\n        const now = this.ctx.currentTime;\n        this.isNoteOn = false;\n\n        if (r !== undefined) this.release = r;\n\n        // Cancel future\n        this.masterGain.gain.cancelScheduledValues(now);\n\n        // We need to ramp from *current* calculated gain to 0\n        // Web Audio's .value attribute is not always the instantaneous ramp value during scheduling\n        // But cancelScheduledValues() sets it to the current scheduled value? \n        // No, it holds the value at 'now'. \n        // However, safest to calculate it or just use setTargetAtTime which handles it automatically?\n        // User asked for \"green line graph\", implies linear release.\n        // linearRampToValueAtTime requires a starting point.\n\n        // Let's rely on browser behavior: \n        // cancelScheduledValues(now) -> the param value becomes constant at the value it had at 'now'.\n        // So we just ramp from there.\n        // Wait, if we are in middle of attack, 'value' might jump?\n        // Actually, strictly speaking `setValueAtTime(this.masterGain.gain.value, now)` is needed to anchor it.\n        // But reading `.value` during automation is spec'd to return the automated value?\n        // \"If the AudioParam is being automated, the value property returns the current value of the parameter.\" (MDN)\n\n        const currentGain = this.masterGain.gain.value;\n        this.masterGain.gain.setValueAtTime(currentGain, now);\n        this.masterGain.gain.linearRampToValueAtTime(0, now + this.release);\n    }\n\n    public getEnvelopeState(): {\n        attack: number,\n        decay: number,\n        sustain: number,\n        release: number,\n        isNoteOn: boolean,\n        lastNoteTime: number,\n        currentTime: number\n    } {\n        return {\n            attack: this.attack,\n            decay: this.decay,\n            sustain: this.sustain,\n            release: this.release,\n            isNoteOn: this.isNoteOn,\n            lastNoteTime: this.lastNoteTime,\n            currentTime: this.ctx.currentTime\n        };\n    }\n}\n","// Audio analysis and spectral volume conversion\n// Converts WAV/audio files into 3D spectral volume data using FFT\n\nexport class AudioAnalyzer {\n    private audioContext: AudioContext;\n\n    constructor() {\n        this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n\n    /**\n     * Analyze multiple files for morphing\n     * Each file is placed at a different Y position in the volume\n     * All files are time-stretched to the same Z length\n     */\n    public async analyzeMultipleFiles(\n        files: File[],\n        volumeSize: { x: number, y: number, z: number },\n        onProgress?: (percent: number) => void\n    ): Promise<Float32Array> {\n        const { x: xSize, y: ySize, z: zSize } = volumeSize;\n        const numFiles = files.length;\n\n        console.log(`Analyzing ${numFiles} files for morphing into ${xSize}x${ySize}x${zSize} volume`);\n\n        // Initialize volume with zeros\n        const volumeData = new Float32Array(xSize * ySize * zSize * 4); // RGBA\n\n        // Process each file\n        for (let fileIdx = 0; fileIdx < numFiles; fileIdx++) {\n            const file = files[fileIdx];\n\n            // Load and decode audio\n            const arrayBuffer = await file.arrayBuffer();\n            const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n            const channelData = audioBuffer.getChannelData(0);\n            const sampleRate = audioBuffer.sampleRate;\n\n            console.log(`  [${fileIdx + 1}/${numFiles}] ${file.name}: ${audioBuffer.duration.toFixed(2)}s`);\n\n            // Calculate which Y index this file should occupy\n            // For 1 file: Y=0 (middle)\n            // For 2 files: Y=-1, Y=1 (first and last)\n            // For 3+ files: equally spaced from -1 to 1\n            const yPosition = numFiles === 1 ? 0 : -1 + (fileIdx / (numFiles - 1)) * 2;\n            const yIndex = Math.round((yPosition + 1) * 0.5 * (ySize - 1));\n\n            // Time-stretch audio to fit Z dimension\n            const fftSize = 2048;\n            const samplesNeeded = zSize * fftSize;\n            const processedData = this.timeStretch(channelData, samplesNeeded);\n\n            // Frequency mapping constants\n            const minFreq = 20;\n            const maxFreq = 20000;\n\n            // Process each Z slice (time)\n            for (let iz = 0; iz < zSize; iz++) {\n                const startSample = iz * fftSize;\n                const signal = new Float32Array(fftSize);\n\n                // Extract window\n                for (let i = 0; i < fftSize; i++) {\n                    if (startSample + i < processedData.length) {\n                        signal[i] = processedData[startSample + i];\n                    }\n                }\n\n                // Apply Hann window\n                for (let i = 0; i < fftSize; i++) {\n                    signal[i] *= 0.5 * (1 - Math.cos(2 * Math.PI * i / fftSize));\n                }\n\n                // Perform FFT\n                const spectrum = this.simpleFFT(signal);\n\n                // Map spectrum to X axis (Linear Frequency 0-22kHz)\n                for (let ix = 0; ix < xSize; ix++) {\n                    const normalizedX = ix / xSize;\n                    const freq = minFreq + (maxFreq - minFreq) * normalizedX;\n                    const binIndex = Math.floor(freq * fftSize / sampleRate);\n                    const safeBinIndex = Math.max(0, Math.min(spectrum.length - 1, binIndex));\n                    const magnitude = spectrum[safeBinIndex] || 0;\n\n                    // Convert to dB scale\n                    let val = 0;\n                    if (magnitude > 0.000001) {\n                        const db = 20 * Math.log10(magnitude);\n                        val = (db + 60) / 60;\n                        val = Math.max(0, Math.min(1, val));\n                    }\n\n                    // Write to the specific Y slice for this file\n                    const idx = (iz * ySize * xSize + yIndex * xSize + ix) * 4;\n\n                    volumeData[idx] = val;                        // R: Magnitude\n                    volumeData[idx + 1] = ix / xSize;             // G: Phase (freq-based)\n                    volumeData[idx + 2] = ix / xSize;             // B: Pan\n                    volumeData[idx + 3] = iz / zSize;             // A: Width\n                }\n\n                // Report progress\n                if (onProgress && iz % 10 === 0) {\n                    const fileProgress = (fileIdx / numFiles) * 100;\n                    const sliceProgress = ((iz / zSize) / numFiles) * 100;\n                    onProgress(fileProgress + sliceProgress);\n                }\n\n                // Yield to main thread periodically\n                if (iz % 20 === 0) {\n                    await new Promise(resolve => requestAnimationFrame(resolve));\n                }\n            }\n        }\n\n        if (onProgress) onProgress(100);\n        console.log('✓ Multi-file morphing volume created');\n        return volumeData;\n    }\n\n    public async analyzeFile(\n        file: File,\n        volumeSize: { x: number, y: number, z: number },\n        onProgress?: (percent: number) => void\n    ): Promise<{ data: Float32Array, adjustedSize: { x: number, y: number, z: number } }> {\n        // Load audio file\n        const arrayBuffer = await file.arrayBuffer();\n        const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n\n        // Get audio data (mix to mono from stereo)\n        const channelData = audioBuffer.getChannelData(0);\n        const totalSamples = channelData.length;\n        const sampleRate = audioBuffer.sampleRate;\n\n        console.log(`Analyzing: ${file.name}, ${audioBuffer.duration.toFixed(2)}s, ${sampleRate}Hz, ${totalSamples} samples`);\n\n        const { x: xSize, y: ySize, z: zSize } = volumeSize;\n\n        // Minimum samples needed for good FFT (2048 is a good FFT size)\n        const minFFTSize = 2048;\n\n        // Calculate total samples needed to fill the volume\n        const samplesNeeded = zSize * ySize * minFFTSize;\n\n        let processedData: Float32Array;\n\n        if (totalSamples < samplesNeeded) {\n            // Time-stretch (interpolate) to fill the volume\n            console.log(`Time-stretching audio: ${totalSamples} → ${samplesNeeded} samples (${(samplesNeeded / totalSamples).toFixed(2)}x)`);\n            if (onProgress) onProgress(10);\n            processedData = this.timeStretch(channelData, samplesNeeded);\n            if (onProgress) onProgress(20);\n        } else {\n            // Use as-is or downsample if much longer\n            processedData = channelData;\n            if (onProgress) onProgress(15);\n        }\n\n        const volumeData = new Float32Array(xSize * ySize * zSize * 4); // RGBA\n\n        // Split sample by Z depth (morph layers)\n\n        const totalIterations = zSize;\n        let iterationCount = 0;\n        let lastYieldTime = performance.now();\n\n        // We will process the audio in Z steps (Time)\n        // Each Z step represents a point in time\n        // X is Frequency (Logarithmic)\n        // Y is replicated\n\n        const stepSize = Math.floor(processedData.length / zSize);\n\n        // Frequency mapping constants\n        const minFreq = 20;\n        const maxFreq = 20000; // Fixed range for consistency\n\n        for (let iz = 0; iz < zSize; iz++) {\n            // Calculate start position for this time slice\n            const startSample = iz * stepSize;\n\n            // Extract a window for FFT\n            // Use a window size that gives good frequency resolution, e.g., 2048 or 4096\n            // But we map it to xSize bins\n            const fftSize = 2048;\n            const signal = new Float32Array(fftSize);\n\n            // Copy samples (with bounds check)\n            for (let i = 0; i < fftSize; i++) {\n                if (startSample + i < processedData.length) {\n                    signal[i] = processedData[startSample + i];\n                }\n            }\n\n            // Apply Hann window\n            for (let i = 0; i < fftSize; i++) {\n                signal[i] *= 0.5 * (1 - Math.cos(2 * Math.PI * i / fftSize));\n            }\n\n            // Perform FFT\n            const spectrum = this.simpleFFT(signal);\n            const numBins = spectrum.length;\n\n            // Store this slice's data temporarily to normalize later? \n            // Or just do a first pass? \n            // For simplicity/speed, we'll use a running normalization or just a reasonable scale.\n            // But user asked for normalization. Let's find local max first?\n            // No, global max is better. But that requires two passes.\n            // Let's stick to a reasonable scaling + log scale which is more robust.\n\n            // Map spectrum to X axis (Linear Frequency 0-22kHz)\n            for (let ix = 0; ix < xSize; ix++) {\n                const normalizedX = ix / xSize;\n\n                // Linear mapping:\n                // freq = minFreq + (maxFreq - minFreq) * normalizedX\n                // binFreq = bin * sampleRate / fftSize\n                // bin = freq * fftSize / sampleRate\n\n                const freq = minFreq + (maxFreq - minFreq) * normalizedX;\n                const binIndex = Math.floor(freq * fftSize / sampleRate);\n\n                // Clamp bin index\n                const safeBinIndex = Math.max(0, Math.min(numBins - 1, binIndex));\n\n                const magnitude = spectrum[safeBinIndex] || 0;\n\n                // Convert to dB-like scale\n                let val = 0;\n                if (magnitude > 0.000001) {\n                    const db = 20 * Math.log10(magnitude);\n                    // Range -60dB to 0dB\n                    val = (db + 60) / 60;\n                    val = Math.max(0, Math.min(1, val));\n                }\n\n                // Replicate across Y\n                for (let iy = 0; iy < ySize; iy++) {\n                    const idx = (iz * ySize * xSize + iy * xSize + ix) * 4;\n\n                    // R: Magnitude\n                    volumeData[idx] = val;\n\n                    // G: Phase (frequency-based)\n                    volumeData[idx + 1] = ix / xSize;\n\n                    // B: Pan (spread)\n                    volumeData[idx + 2] = ix / xSize;\n\n                    // A: Width\n                    volumeData[idx + 3] = iz / zSize;\n                }\n            }\n\n            // Report progress\n            iterationCount++;\n            if (onProgress && iterationCount % 5 === 0) {\n                const percent = 20 + (iterationCount / totalIterations) * 80;\n                onProgress(percent);\n            }\n\n            // Yield to main thread\n            if (performance.now() - lastYieldTime > 12) {\n                await new Promise(resolve => requestAnimationFrame(resolve));\n                lastYieldTime = performance.now();\n            }\n        }\n\n        if (onProgress) onProgress(100);\n        console.log('✓ Converted to spectral volume');\n        return { data: volumeData, adjustedSize: volumeSize };\n    }\n\n    private timeStretch(input: Float32Array, targetLength: number): Float32Array {\n        // Simple linear interpolation time-stretching\n        const output = new Float32Array(targetLength);\n        const ratio = input.length / targetLength;\n\n        for (let i = 0; i < targetLength; i++) {\n            const srcPos = i * ratio;\n            const srcIdx = Math.floor(srcPos);\n            const frac = srcPos - srcIdx;\n\n            // Linear interpolation between samples\n            if (srcIdx + 1 < input.length) {\n                output[i] = input[srcIdx] * (1 - frac) + input[srcIdx + 1] * frac;\n            } else {\n                output[i] = input[srcIdx];\n            }\n        }\n\n        return output;\n    }\n\n    private simpleFFT(signal: Float32Array): Float32Array {\n        // Simple DFT for magnitude spectrum\n        // For production, consider using a proper FFT library\n        const N = signal.length;\n        const spectrum = new Float32Array(N / 2);\n\n        for (let k = 0; k < N / 2; k++) {\n            let real = 0;\n            let imag = 0;\n\n            for (let n = 0; n < N; n++) {\n                const angle = -2 * Math.PI * k * n / N;\n                real += signal[n] * Math.cos(angle);\n                imag += signal[n] * Math.sin(angle);\n            }\n\n            spectrum[k] = Math.sqrt(real * real + imag * imag) / N;\n        }\n\n        return spectrum;\n    }\n}\n","\nexport class MidiHandler {\n    private midiAccess: any = null;\n    private activeInput: any = null;\n    private activeNotes: Map<number, number> = new Map(); // Note -> Velocity\n\n    // Callbacks\n    private onNoteChangeCallback: ((note: number | null) => void) | null = null;\n    private onConnectionChangeCallback: ((isConnected: boolean) => void) | null = null;\n    private onRawNoteCallback: ((note: number, velocity: number) => void) | null = null;  // For visualization\n\n    constructor() {\n        this.initialize();\n    }\n\n    private async initialize() {\n        try {\n            if ((navigator as any).requestMIDIAccess) {\n                this.midiAccess = await (navigator as any).requestMIDIAccess();\n\n                // Get first available input\n                const inputs = this.midiAccess.inputs.values();\n                for (let input of inputs) {\n                    this.setInput(input);\n                    break; // Just grab the first one for now\n                }\n\n                this.midiAccess.onstatechange = (e: any) => {\n                    console.log('MIDI State Change:', e.port.name, e.port.state, e.port.connection);\n                    if (e.port.type === 'input') {\n                        if (e.port.state === 'connected' && !this.activeInput) {\n                            this.setInput(e.port);\n                        } else if (e.port.state === 'disconnected' && this.activeInput && this.activeInput.id === e.port.id) {\n                            this.activeInput = null;\n                            if (this.onConnectionChangeCallback) {\n                                this.onConnectionChangeCallback(false);\n                            }\n                        }\n                    }\n                };\n            } else {\n                console.warn('Web MIDI API not supported in this browser.');\n            }\n        } catch (err) {\n            console.error('MIDI Access Failed:', err);\n        }\n    }\n\n    private setInput(input: any) {\n        this.activeInput = input;\n        console.log(`MIDI Input Selected: ${input.name}`);\n\n        input.onmidimessage = (message: any) => {\n            this.handleMessage(message);\n        };\n\n        if (this.onConnectionChangeCallback) {\n            this.onConnectionChangeCallback(true);\n        }\n    }\n\n    private handleMessage(message: any) {\n        const [status, data1, data2] = message.data;\n        const command = status & 0xF0;\n        // const channel = status & 0x0F;\n        const note = data1;\n        const velocity = data2;\n\n        // Note On\n        if (command === 0x90 && velocity > 0) {\n            this.activeNotes.set(note, velocity);\n            this.triggerHighestNote();\n            if (this.onRawNoteCallback) this.onRawNoteCallback(note, velocity);\n        }\n        // Note Off (or Note On with vel 0)\n        else if (command === 0x80 || (command === 0x90 && velocity === 0)) {\n            this.activeNotes.delete(note);\n            this.triggerHighestNote();\n            if (this.onRawNoteCallback) this.onRawNoteCallback(note, 0);\n        }\n    }\n\n    private triggerHighestNote() {\n        if (!this.onNoteChangeCallback) return;\n\n        if (this.activeNotes.size === 0) {\n            this.onNoteChangeCallback(null);\n            return;\n        }\n\n        // Monophonic: Last note priority or Highest note?\n        // Let's implement Highest Note Priority for standard synth feel\n        let highestNote = -1;\n        for (let note of this.activeNotes.keys()) {\n            if (note > highestNote) highestNote = note;\n        }\n\n        if (highestNote !== -1) {\n            this.onNoteChangeCallback(highestNote);\n        }\n    }\n\n    public setNoteChangeCallback(callback: (note: number | null) => void) {\n        this.onNoteChangeCallback = callback;\n    }\n\n    public setRawNoteCallback(callback: (note: number, velocity: number) => void) {\n        this.onRawNoteCallback = callback;\n    }\n\n    public setConnectionChangeCallback(callback: (isConnected: boolean) => void) {\n        this.onConnectionChangeCallback = callback;\n    }\n\n    public getInputs(): { id: string, name: string }[] {\n        if (!this.midiAccess) return [];\n        const inputs: { id: string, name: string }[] = [];\n        this.midiAccess.inputs.forEach((input: any) => {\n            inputs.push({ id: input.id, name: input.name });\n        });\n        return inputs;\n    }\n\n    public selectInput(id: string) {\n        if (!this.midiAccess) return;\n        const input = this.midiAccess.inputs.get(id);\n        if (input) {\n            this.setInput(input);\n        }\n    }\n\n    public simulateNoteOn(note: number, velocity: number) {\n        this.activeNotes.set(note, velocity);\n        this.triggerHighestNote();\n        // Allow visualization update if needed (e.g. if driven by computer keyboard later)\n        if (this.onRawNoteCallback) this.onRawNoteCallback(note, velocity);\n    }\n\n    public simulateNoteOff(note: number) {\n        this.activeNotes.delete(note);\n        this.triggerHighestNote();\n        if (this.onRawNoteCallback) this.onRawNoteCallback(note, 0);\n    }\n}\n","\nimport { AudioEngine } from '../audio/audio-engine';\n\nexport class EnvelopeEditor {\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private engine: AudioEngine;\n\n    private width = 0;\n    private height = 0;\n\n    // View settings\n    private maxTime = 2.0; // Seconds visible on X axis\n    private padding = 20;\n\n    // Interaction state\n    private isDragging = false;\n    private activeNode = -1; // 0=AttackPeak, 1=DecayEnd/SustainStart, 2=ReleaseEnd\n\n    // Visual Sustain Duration\n    private sustainVisualDuration = 0.5;\n\n    constructor(containerId: string, engine: AudioEngine) {\n        const el = document.getElementById(containerId) as HTMLCanvasElement;\n        if (!el) throw new Error(`Canvas ${containerId} not found`);\n        this.canvas = el;\n        this.ctx = this.canvas.getContext('2d')!;\n        this.engine = engine;\n\n        this.resize();\n        window.addEventListener('resize', () => this.resize());\n\n        // Interaction\n        this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));\n        window.addEventListener('mousemove', this.onMouseMove.bind(this));\n        window.addEventListener('mouseup', this.onMouseUp.bind(this));\n\n        // Start animation loop for playhead\n        this.animate();\n    }\n\n    private resize(): void {\n        this.canvas.width = this.canvas.clientWidth;\n        this.canvas.height = this.canvas.clientHeight;\n        this.width = this.canvas.width;\n        this.height = this.canvas.height;\n        this.draw();\n    }\n\n    private animate(): void {\n        this.draw();\n        requestAnimationFrame(() => this.animate());\n    }\n\n    private draw(): void {\n        const { width, height, ctx } = this;\n        const state = this.engine.getEnvelopeState();\n\n        // Clear\n        ctx.fillStyle = '#08080c';\n        ctx.fillRect(0, 0, width, height);\n\n        // Draw Grid\n        ctx.strokeStyle = '#222';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        // Time grid (every 0.5s)\n        for (let t = 0; t <= this.maxTime; t += 0.5) {\n            const x = this.timeToX(t);\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, height);\n        }\n        // Level grid (0, 0.5, 1.0)\n        for (let l = 0; l <= 1.0; l += 0.5) {\n            const y = this.valToY(l);\n            ctx.moveTo(0, y);\n            ctx.lineTo(width, y);\n        }\n        ctx.stroke();\n\n        // Calculate Nodes\n        const aTime = state.attack;\n        const dTime = state.decay;\n        const sLevel = state.sustain;\n        const rTime = state.release;\n\n        // Visual Layout:\n        // P0 (0,0)\n        // P1 (A_time, 1.0) -> Attack Peak\n        // P2 (A+D_time, S_level) -> Decay End / Sustain Start\n        // P3 (A+D+S_vis, S_level) -> Sustain End (Visual only)\n        // P4 (A+D+S_vis+R, 0) -> Release End\n\n        const p0 = { x: 0, y: 0 };\n        const p1 = { x: aTime, y: 1.0 };\n        const p2 = { x: aTime + dTime, y: sLevel };\n        const p3 = { x: aTime + dTime + this.sustainVisualDuration, y: sLevel };\n        const p4 = { x: aTime + dTime + this.sustainVisualDuration + rTime, y: 0 };\n\n        // Draw Envelope Line\n        ctx.strokeStyle = '#00ff88'; // Neon Green\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(this.timeToX(p0.x), this.valToY(p0.y));\n        ctx.lineTo(this.timeToX(p1.x), this.valToY(p1.y));\n        ctx.lineTo(this.timeToX(p2.x), this.valToY(p2.y));\n        ctx.lineTo(this.timeToX(p3.x), this.valToY(p3.y));\n        ctx.lineTo(this.timeToX(p4.x), this.valToY(p4.y));\n        ctx.stroke();\n\n        // Draw Interactive Nodes\n        this.drawNode(p1.x, p1.y, this.activeNode === 0); // Attack\n        this.drawNode(p2.x, p2.y, this.activeNode === 1); // Decay/Sustain\n        this.drawNode(p4.x, p4.y, this.activeNode === 2); // Release\n\n        // Labels\n        ctx.fillStyle = '#666';\n        ctx.font = '10px Inter';\n        ctx.fillText('A', this.timeToX(p1.x), this.valToY(p1.y) - 10);\n        ctx.fillText('D', this.timeToX(p2.x), this.valToY(p2.y) - 10);\n        ctx.fillText('R', this.timeToX(p4.x), this.valToY(p4.y) - 10);\n\n        // Draw Playhead\n        if (state.isNoteOn) {\n            const timeSinceNote = state.currentTime - state.lastNoteTime;\n\n            // Logic to trace the actual envelope value visual position\n            // If Attack phase (t < A)\n            // If Decay phase (t < A+D)\n            // If Sustain phase (t >= A+D) -> Clamp to visual sustain region? \n            // Better: Draw vertical line at current time\n\n            let playHeadX = 0;\n            if (timeSinceNote < aTime + dTime) {\n                // In A or D phase\n                playHeadX = timeSinceNote;\n            } else {\n                // In Sustain phase. We clamp it visually within the sustain block\n                // OR loop it? Usually standard ADSR just holds.\n                // We'll calculate offset into sustain\n                const sustainTime = timeSinceNote - (aTime + dTime);\n                // Clamp visual position to P2 -> P3 range?\n                // Or let it run? If it runs past P3, it looks like release?\n                // Let's loop it in the visual sustain block for feedback?\n                // Or just clamp at P3?\n                // Just clamp it to end of visual sustain for clarity\n                const maxSustainX = aTime + dTime + this.sustainVisualDuration;\n                playHeadX = Math.min(aTime + dTime + sustainTime, maxSustainX);\n            }\n\n            const x = this.timeToX(playHeadX);\n            ctx.strokeStyle = '#0088ff';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, height);\n            ctx.stroke();\n        } else {\n            // Note released. We are in Release phase.\n            // Problem: We need to know when Release started to draw accurate position.\n            // But state only gives us params and noteOn status.\n            // We can't easily visualize the release ramp playhead linearly without storing releaseStartTime.\n            // But main goal is configuration. Playhead during hold is most useful.\n        }\n    }\n\n    private drawNode(t: number, v: number, active: boolean): void {\n        const x = this.timeToX(t);\n        const y = this.valToY(v);\n\n        this.ctx.beginPath();\n        this.ctx.arc(x, y, 6, 0, Math.PI * 2);\n        this.ctx.fillStyle = active ? '#fff' : '#00ff88';\n        this.ctx.fill();\n        this.ctx.stroke();\n    }\n\n    private timeToX(t: number): number {\n        return this.padding + (t / this.maxTime) * (this.width - 2 * this.padding);\n    }\n\n    private xToTime(x: number): number {\n        return ((x - this.padding) / (this.width - 2 * this.padding)) * this.maxTime;\n    }\n\n    private valToY(v: number): number {\n        // v is 0..1 (or more). Canvas Y is inverted (0 at top)\n        // Map 0 -> height - padding\n        // Map 1 -> padding\n        const usableHeight = this.height - 2 * this.padding;\n        return this.height - this.padding - (v * usableHeight);\n    }\n\n    private yToVal(y: number): number {\n        const usableHeight = this.height - 2 * this.padding;\n        const relativeY = this.height - this.padding - y;\n        return relativeY / usableHeight;\n    }\n\n    // Interaction Handlers\n    private onMouseDown(e: MouseEvent): void {\n        const rect = this.canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        // Hit test nodes\n        // P1 (Attack)\n        const state = this.engine.getEnvelopeState();\n        const p1 = { t: state.attack, v: 1.0 };\n        const p2 = { t: state.attack + state.decay, v: state.sustain };\n        const p4 = { t: state.attack + state.decay + this.sustainVisualDuration + state.release, v: 0 };\n\n        const nodes = [p1, p2, p4];\n\n        for (let i = 0; i < nodes.length; i++) {\n            const nx = this.timeToX(nodes[i].t);\n            const ny = this.valToY(nodes[i].v);\n            const dist = Math.sqrt((x - nx) ** 2 + (y - ny) ** 2);\n\n            if (dist < 10) {\n                this.isDragging = true;\n                this.activeNode = i;\n                return; // Interaction started\n            }\n        }\n    }\n\n    private onMouseMove(e: MouseEvent): void {\n        if (!this.isDragging) return;\n\n        const rect = this.canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const time = Math.max(0, this.xToTime(x));\n        const val = Math.max(0, Math.min(1.0, this.yToVal(y)));\n\n        // Update AudioEngine params based on node\n        // Node 0: Attack (v=1 fixed, t=attack)\n        // Node 1: Decay (v=sustain, t=attack+decay)\n        // Node 2: Release (v=0 fixed, t=attack+decay+sustainVis+release)\n\n        // We need current values to calc deltas\n        const state = this.engine.getEnvelopeState();\n\n        if (this.activeNode === 0) {\n            // Dragging Attack\n            this.engine.attack = time; // Simple mapping\n            // Note: If Attack > Decay End, weird? \n            // Actually Node 1 is absolute time. So Attack is just Time.\n        } else if (this.activeNode === 1) {\n            // Dragging Decay/Sustain\n            this.engine.sustain = val;\n\n            // X position determines Decay Time.\n            // X = Attack + Decay. So Decay = X - Attack.\n            const newDecay = time - state.attack;\n            this.engine.decay = Math.max(0, newDecay);\n        } else if (this.activeNode === 2) {\n            // Dragging Release\n            // X = Attack + Decay + SusVis + Release\n            const startOfRelease = state.attack + state.decay + this.sustainVisualDuration;\n            const newRelease = time - startOfRelease;\n            this.engine.release = Math.max(0.01, newRelease);\n        }\n    }\n\n    private onMouseUp(): void {\n        this.isDragging = false;\n        this.activeNode = -1;\n    }\n}\n","\nexport class PianoKeyboard {\n    private container: HTMLElement;\n    private keys: Map<number, HTMLElement> = new Map();\n    private activeNotes: Set<number> = new Set();\n\n    // Callbacks\n    private onNoteChange: ((note: number, velocity: number) => void) | null = null;\n\n    // Range: Defaults to 3 Octaves\n    private numOctaves = 3;\n    private baseOctave = 3; // Starts at C3\n    private startNote = 36;\n    private endNote = 72;\n\n    constructor(containerId: string) {\n        const el = document.getElementById(containerId);\n        if (!el) throw new Error(`Container ${containerId} not found`);\n        this.container = el;\n\n        this.updateRange(); // Calculates start/end and creates keys\n\n        // Prevent drag selection\n        this.container.addEventListener('selectstart', e => e.preventDefault());\n    }\n\n    public setBaseOctave(octave: number) {\n        this.baseOctave = octave;\n        this.updateRange();\n    }\n\n    private updateRange() {\n        this.startNote = this.baseOctave * 12;\n        this.endNote = this.startNote + (this.numOctaves * 12);\n        this.createKeys();\n    }\n\n    private createKeys() {\n        this.container.innerHTML = '';\n        this.keys.clear();\n\n        const whiteKeys = [0, 2, 4, 5, 7, 9, 11]; // Indices in octave\n\n        // Count white keys for width calculation\n        let numWhiteKeys = 0;\n        for (let i = this.startNote; i <= this.endNote; i++) {\n            if (whiteKeys.includes(i % 12)) {\n                numWhiteKeys++;\n            }\n        }\n\n        const whiteKeyWidth = 100 / numWhiteKeys;\n        let whiteKeyIndex = 0;\n\n        for (let note = this.startNote; note <= this.endNote; note++) {\n            // const octave = Math.floor(note / 12); // Unused\n            const noteInOctave = note % 12;\n            const isWhite = whiteKeys.includes(noteInOctave);\n\n            const key = document.createElement('div');\n            this.keys.set(note, key);\n\n            key.dataset.note = String(note);\n\n            if (isWhite) {\n                key.className = 'piano-key white';\n                key.style.width = `${whiteKeyWidth}%`;\n                key.style.left = `${whiteKeyIndex * whiteKeyWidth}%`;\n                whiteKeyIndex++;\n            } else {\n                key.className = 'piano-key black';\n                key.style.width = `${whiteKeyWidth * 0.7}%`;\n                key.style.left = `${(whiteKeyIndex - 1) * whiteKeyWidth + (whiteKeyWidth * 0.65)}%`;\n                key.style.zIndex = '2';\n            }\n\n            // Mouse events\n            key.addEventListener('mousedown', (e) => {\n                if (e.buttons === 1) {\n                    this.triggerNoteOn(note);\n                    const upHandler = () => {\n                        this.triggerNoteOff(note);\n                        window.removeEventListener('mouseup', upHandler);\n                    };\n                    window.addEventListener('mouseup', upHandler);\n                }\n            });\n\n            key.addEventListener('mouseenter', (e) => {\n                if (e.buttons === 1) {\n                    this.triggerNoteOn(note);\n                    key.addEventListener('mouseleave', () => {\n                        this.triggerNoteOff(note);\n                    }, { once: true });\n                }\n            });\n\n            this.container.appendChild(key);\n        }\n    }\n\n    private triggerNoteOn(note: number) {\n        if (this.activeNotes.has(note)) return;\n        this.activeNotes.add(note);\n        this.setVisualizeState(note, true);\n        if (this.onNoteChange) this.onNoteChange(note, 127);\n    }\n\n    private triggerNoteOff(note: number) {\n        if (!this.activeNotes.has(note)) return;\n        this.activeNotes.delete(note);\n        this.setVisualizeState(note, false);\n        if (this.onNoteChange) this.onNoteChange(note, 0);\n    }\n\n    public setVisualizeState(note: number, on: boolean) {\n        const key = this.keys.get(note);\n        if (!key) return; // Out of range\n\n        if (on) {\n            key.classList.add('active');\n        } else {\n            key.classList.remove('active');\n        }\n    }\n\n    public setNoteChangeCallback(callback: (note: number, velocity: number) => void) {\n        this.onNoteChange = callback;\n    }\n}\n","\nexport type LFOWaveform = 'sine' | 'square' | 'saw' | 'triangle';\n\nexport class LFO {\n    public waveform: LFOWaveform = 'sine';\n    public frequency: number = 0.5; // Hz\n    public amplitude: number = 1.0; // 0-1 multiplier\n    private phase: number = 0; // 0-1\n\n    constructor(freq: number = 1.0) {\n        this.frequency = freq;\n    }\n\n    public setWaveform(wave: LFOWaveform): void {\n        this.waveform = wave;\n    }\n\n    public setFrequency(freq: number): void {\n        this.frequency = freq;\n    }\n\n    public setAmplitude(amp: number): void {\n        this.amplitude = amp;\n    }\n\n    public update(deltaTime: number): number {\n        // Increment phase (freq * seconds)\n        this.phase += this.frequency * deltaTime;\n        // Wrap 0-1\n        if (this.phase >= 1.0) this.phase -= Math.floor(this.phase);\n\n        let value = 0;\n        switch (this.waveform) {\n            case 'sine':\n                value = Math.sin(this.phase * 2 * Math.PI);\n                break;\n            case 'square':\n                value = this.phase < 0.5 ? 1.0 : -1.0;\n                break;\n            case 'saw':\n                // 1.0 to -1.0\n                value = 1.0 - 2.0 * this.phase;\n                break;\n            case 'triangle':\n                // -1 to 1 to -1\n                // 0.0 -> -1\n                // 0.5 -> 1\n                // 1.0 -> -1\n                // 4 * phase - 1 (0..0.5 maps to -1..1)\n                value = this.phase < 0.5\n                    ? 4.0 * this.phase - 1.0\n                    : 3.0 - 4.0 * this.phase;\n                break;\n        }\n\n        return value * this.amplitude;\n    }\n}\n","import './style.css';\nimport { WebGLContext } from './gpu/context';\nimport { Renderer } from './gpu/renderer';\nimport { ControlPanel } from './ui/controls';\nimport { Spectrogram } from './ui/spectrogram';\nimport { StereoScope } from './ui/scope';\nimport { AudioEngine } from './audio/audio-engine';\nimport { AudioAnalyzer } from './audio/audio-analyzer';\nimport { MidiHandler } from './audio/midi-handler';\nimport { EnvelopeEditor } from './ui/envelope-editor';\nimport { PianoKeyboard } from './ui/piano';\nimport { ReadingPathState, VolumeResolution, SynthMode, CarrierType, VOLUME_DENSITY_X_DEFAULT, VOLUME_DENSITY_Y_DEFAULT, VOLUME_DENSITY_Z_DEFAULT } from './types';\nimport { LFO, LFOWaveform } from './modulators/lfo';\n\n// Main application entry point\n// Initializes WebGL, UI, and wires up event handling\n\nclass SpectralTableApp {\n    private glContext: WebGLContext;\n    private renderer: Renderer;\n    private controls: ControlPanel;\n    private spectrogram: Spectrogram;\n    private scope: StereoScope;\n    private audioEngine: AudioEngine;\n    private audioAnalyzer: AudioAnalyzer;\n    private midiHandler: MidiHandler;\n    private piano: PianoKeyboard;\n    private canvas: HTMLCanvasElement;\n    private currentNote: number | null = null;\n    private animationFrameId: number = 0;\n\n    // Store uploaded spectral volumes\n    private uploadedVolumes: Map<string, Float32Array> = new Map();\n\n    // Animation state\n    private gameOfLifeActive = false;\n    private gameOfLifeSpeed = 0.5; // 0-1 range\n    private gameOfLifeLastUpdate = 0;\n\n    private sinePlasmaActive = false;\n    private sinePlasmaSpeed = 0.5; // 0-1 range\n    private sinePlasmaLastUpdate = 0;\n\n    // Modulation Logic\n    private lfo1: LFO;\n    private lfo2: LFO;\n    private pathYSource: string = 'none'; // 'none', 'lfo1', 'lfo2'\n    private scanPhaseSource: string = 'none';\n\n    constructor() {\n        console.log('Spectra Table Synthesis - Initializing...');\n\n        // Initialize WebGL\n        this.canvas = document.getElementById('gl-canvas') as HTMLCanvasElement;\n        if (!this.canvas) throw new Error('Canvas not found');\n\n        this.glContext = new WebGLContext(this.canvas);\n\n        // Create renderer with default resolution\n        const defaultResolution: VolumeResolution = {\n            x: VOLUME_DENSITY_X_DEFAULT,\n            y: VOLUME_DENSITY_Y_DEFAULT,\n            z: VOLUME_DENSITY_Z_DEFAULT,\n        };\n        this.renderer = new Renderer(this.glContext, defaultResolution);\n\n        // Initialize UI controls\n        this.controls = new ControlPanel('controls');\n\n        // Create Spectrogram and Scope\n        this.spectrogram = new Spectrogram('spectrogram-canvas');\n        this.scope = new StereoScope('scope-canvas');\n\n        // Initialize Audio Engine\n        this.audioEngine = new AudioEngine();\n\n        // Initialize LFOs\n        this.lfo1 = new LFO();\n        this.lfo2 = new LFO();\n\n        // Initialize envelope editor logic\n        new EnvelopeEditor('envelope-canvas', this.audioEngine);\n\n        // Initialize Audio Analyzer\n        this.audioAnalyzer = new AudioAnalyzer();\n\n        // Initialize MIDI Handler\n        this.midiHandler = new MidiHandler();\n        this.midiHandler.setNoteChangeCallback(this.onMidiNote.bind(this));\n        this.midiHandler.setConnectionChangeCallback((isConnected) => {\n            if (isConnected) console.log('✓ MIDI Device Connected');\n            this.controls.updateMidiInputs(this.midiHandler.getInputs());\n        });\n\n        // Initialize Piano\n        this.piano = new PianoKeyboard('piano-container');\n\n        // Piano -> MidiHandler\n        this.piano.setNoteChangeCallback((note, velocity) => {\n            if (velocity > 0) {\n                this.midiHandler.simulateNoteOn(note, velocity);\n            } else {\n                this.midiHandler.simulateNoteOff(note);\n            }\n        });\n\n        // MidiHandler Raw -> Piano Visualization\n        this.midiHandler.setRawNoteCallback((note, velocity) => {\n            this.piano.setVisualizeState(note, velocity > 0);\n        });\n\n        // MIDI Input Selection\n        this.controls.setMidiInputChangeCallback((id) => {\n            this.midiHandler.selectInput(id);\n        });\n\n        this.controls.setOctaveChangeCallback((octave) => {\n            this.piano.setBaseOctave(octave);\n        });\n\n        // Initial input list population (might be empty initially)\n        setTimeout(() => {\n            this.controls.updateMidiInputs(this.midiHandler.getInputs());\n        }, 500);\n\n        // Wire up callbacks\n        this.controls.setPathChangeCallback(this.onPathChange.bind(this));\n        this.controls.setVolumeResolutionChangeCallback(this.onVolumeResolutionChange.bind(this));\n        this.controls.setSpectralDataChangeCallback(this.onSpectralDataChange.bind(this));\n        this.controls.setWavUploadCallback(this.onWavUpload.bind(this));\n        this.controls.setDynamicParamChangeCallback(this.onDynamicParamChange.bind(this));\n        this.controls.setSynthModeChangeCallback(this.onSynthModeChange.bind(this));\n        this.controls.setFrequencyChangeCallback(this.onFrequencyChange.bind(this));\n        this.controls.setCarrierChangeCallback(this.onCarrierChange.bind(this));\n        this.controls.setFeedbackChangeCallback(this.onFeedbackChange.bind(this));\n\n        // LFO Wiring\n        this.controls.setLFOParamChangeCallback((index, param, value) => {\n            const lfo = index === 0 ? this.lfo1 : this.lfo2;\n            if (param === 'waveform') lfo.setWaveform(value as LFOWaveform);\n            if (param === 'frequency') lfo.setFrequency(value);\n            if (param === 'amplitude') lfo.setAmplitude(value);\n        });\n\n        this.controls.setModulationRoutingChangeCallback((target, source) => {\n            if (target === 'pathY') this.pathYSource = source;\n            if (target === 'scanPhase') this.scanPhaseSource = source;\n        });\n\n        // Handle window resize\n        window.addEventListener('resize', this.onResize.bind(this));\n        this.onResize();\n\n        // Initialize audio engine early\n        this.audioEngine.initialize().then(() => {\n            console.log('✓ Audio engine ready (suspended until user interaction)');\n        });\n\n        // Wire up mouse events for 3D rotation\n        this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));\n        this.canvas.addEventListener('mousemove', this.onMouseMove.bind(this));\n        this.canvas.addEventListener('mouseup', this.onMouseUp.bind(this));\n        this.canvas.addEventListener('mouseleave', this.onMouseUp.bind(this));\n\n        // Prevent context menu on right-click\n        this.canvas.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        // Resume audio on any canvas interaction\n        this.canvas.addEventListener('click', () => {\n            this.audioEngine.resume();\n        });\n\n        // Keyboard shortcuts\n        window.addEventListener('keydown', (e) => {\n            if (e.code === 'Space') {\n                e.preventDefault();\n                this.audioEngine.resume();\n                console.log('Audio resumed (Space)');\n            }\n        });\n\n        // Start render loop\n        this.startRenderLoop();\n\n        console.log('✓ Application initialized');\n    }\n\n    private onPathChange(state: ReadingPathState): void {\n        this.renderer.updateReadingPath(state);\n    }\n\n\n\n    private onVolumeResolutionChange(resolution: VolumeResolution): void {\n        console.log('Volume resolution changed:', resolution);\n        this.renderer.updateVolumeResolution(resolution);\n\n        // Re-generate current spectral data with new resolution\n        const currentData = (document.getElementById('spectral-data-type') as HTMLSelectElement)?.value || 'blank';\n\n        // Reinitialize Game of Life if it's active\n        if (currentData === 'game-of-life' && this.gameOfLifeActive) {\n            this.renderer.getSpectralVolume().initGameOfLife();\n            this.gameOfLifeLastUpdate = performance.now();\n            console.log('✓ Game of Life reinitialized with new density');\n        } else if (currentData === 'sine-plasma' && this.sinePlasmaActive) {\n            this.renderer.getSpectralVolume().generateSinePlasma(0);\n            this.sinePlasmaLastUpdate = performance.now();\n            console.log('✓ Sine Plasma reinitialized with new density');\n        } else if (!this.uploadedVolumes.has(currentData)) {\n            // Regenerate other built-in datasets\n            this.renderer.updateSpectralData(currentData);\n        }\n        // Note: Uploaded volumes maintain their data across resolution changes\n    }\n\n    private onSpectralDataChange(dataSet: string): void {\n        console.log('Spectral data changed:', dataSet);\n\n        // Stop any active animations\n        this.gameOfLifeActive = false;\n        this.sinePlasmaActive = false;\n\n        // Check if it's an uploaded volume\n        if (this.uploadedVolumes.has(dataSet)) {\n            const volumeData = this.uploadedVolumes.get(dataSet)!;\n            this.renderer.getSpectralVolume().setData(volumeData);\n            this.controls.hideDynamicParam();\n        } else if (dataSet === 'game-of-life') {\n            // Initialize Game of Life\n            this.renderer.getSpectralVolume().initGameOfLife();\n            this.gameOfLifeActive = true;\n            this.gameOfLifeLastUpdate = performance.now();\n\n            // Show dynamic parameter slider for evolution speed (0-1)\n            this.controls.showDynamicParam('Evolution Speed', 0, 1, 0.5, 0.01);\n            console.log('✓ Game of Life initialized');\n        } else if (dataSet === 'sine-plasma') {\n            // Initialize Sine Plasma\n            this.renderer.getSpectralVolume().generateSinePlasma(0);\n            this.sinePlasmaActive = true;\n            this.sinePlasmaLastUpdate = performance.now();\n\n            // Show dynamic parameter slider for evolution speed (0-1)\n            this.controls.showDynamicParam('Evolution Speed', 0, 1, 0.5, 0.01);\n            console.log('✓ Sine Plasma initialized with evolution');\n        } else {\n            // Built-in data sets\n            this.renderer.updateSpectralData(dataSet);\n            this.controls.hideDynamicParam();\n        }\n\n        // Resume audio when data changes\n        this.audioEngine.resume();\n    }\n\n    private onDynamicParamChange(value: number): void {\n        // Update speed for active animation (0-1 range)\n        if (this.gameOfLifeActive) {\n            this.gameOfLifeSpeed = value;\n            console.log(`Game of Life speed: ${value.toFixed(2)} (0=pause, 1=instant)`);\n        } else if (this.sinePlasmaActive) {\n            this.sinePlasmaSpeed = value;\n            console.log(`Sine plasma speed: ${value.toFixed(2)} (0=static, 1=fast)`);\n        }\n    }\n\n    private onSynthModeChange(mode: SynthMode): void {\n        this.audioEngine.setMode(mode);\n        console.log(`✓ Synth mode: ${mode}`);\n    }\n\n    private onFrequencyChange(freq: number): void {\n        this.audioEngine.setWavetableFrequency(freq);\n    }\n\n    private onCarrierChange(carrier: CarrierType): void {\n        this.audioEngine.setCarrier(carrier);\n    }\n\n    private onFeedbackChange(amount: number): void {\n        this.audioEngine.setFeedback(amount);\n    }\n\n    private onMidiNote(note: number | null): void {\n        // Handle Note Off / All Keys Up\n        if (note === null) {\n            this.currentNote = null;\n            this.audioEngine.triggerRelease();\n            return;\n        }\n\n        // Avoid re-triggering if the highest note hasn't changed (e.g. releasing a lower key)\n        if (note === this.currentNote) {\n            return;\n        }\n\n        this.currentNote = note;\n\n        // Convert MIDI note to frequency\n        // f = 440 * 2^((n - 69) / 12)\n        const freq = 440 * Math.pow(2, (note - 69) / 12);\n\n        const mode = this.audioEngine.getMode();\n\n        if (mode === SynthMode.WAVETABLE) {\n            // Override frequency slider\n            this.audioEngine.setWavetableFrequency(freq);\n\n            // Update UI slider to match\n            // We need to access the controls to update the slider visual\n            // Currently controls doesn't expose a method to set value, so we might need to add one\n            // or just let it diverge. But better to update it.\n            // Let's add setFrequencyValue to ControlPanel in next step if needed.\n            if (this.controls) {\n                this.controls.setFrequency(freq);\n            }\n        } else if (mode === SynthMode.SPECTRAL) {\n            // Spectral Mode Pitch Strategy\n            // Root = 440Hz (A4)\n            // Multiplier = TargetFreq / Root\n            const rootFreq = 440;\n            const multiplier = freq / rootFreq;\n\n            this.audioEngine.setSpectralPitch(multiplier);\n        }\n\n        // Trigger Envelope Attack (Multi-trigger behavior: every new note triggers attack)\n        this.audioEngine.triggerAttack();\n    }\n\n    private async onWavUpload(files: FileList): Promise<void> {\n        const fileArray = Array.from(files);\n        console.log(`Processing ${fileArray.length} audio file(s) for morphing`);\n\n        try {\n            // Show progress\n            this.controls.showProgress();\n            this.controls.updateProgress(0);\n\n            // Get current volume resolution\n            const resolution = this.renderer.getSpectralVolume().getResolution();\n\n            // Set Y density to number of files\n            const numSamples = fileArray.length;\n            const newResolution = {\n                ...resolution,\n                y: numSamples\n            };\n\n            // Update Y density slider\n            this.controls.setVolumeDensity(newResolution);\n            this.renderer.updateVolumeResolution(newResolution);\n\n            // Analyze all files and build the morphing volume\n            const volumeData = await this.audioAnalyzer.analyzeMultipleFiles(\n                fileArray,\n                newResolution,\n                (percent) => this.controls.updateProgress(percent)\n            );\n\n            // Store the volume data\n            const volumeName = fileArray.length === 1\n                ? fileArray[0].name.replace(/\\.[^/.]+$/, '')\n                : `Morph_${fileArray.length}_samples`;\n\n            this.uploadedVolumes.set(volumeName, volumeData);\n\n            // Set volume data directly\n            this.renderer.getSpectralVolume().setData(volumeData);\n\n            // Add to dropdown and select it\n            this.controls.addSpectralDataOption(volumeName, volumeName);\n\n            console.log(`✓ Processed ${fileArray.length} file(s) into morphing volume`);\n        } catch (error) {\n            console.error('Failed to process audio file(s):', error);\n            alert(`Error processing audio file(s): ${error instanceof Error ? error.message : 'Unknown error'}`);\n        } finally {\n            // Hide progress\n            setTimeout(() => this.controls.hideProgress(), 500);\n        }\n    }\n\n    private onResize(): void {\n        const rect = this.canvas.getBoundingClientRect();\n        this.renderer.resize(rect.width, rect.height);\n    }\n\n    private onMouseDown(event: MouseEvent): void {\n        this.renderer.onMouseDown(event.clientX, event.clientY, event.button);\n\n        // Resume audio context on user interaction\n        this.audioEngine.resume();\n    }\n\n    private onMouseMove(event: MouseEvent): void {\n        this.renderer.onMouseMove(event.clientX, event.clientY);\n    }\n\n    private onMouseUp(): void {\n        this.renderer.onMouseUp();\n    }\n\n    private startRenderLoop(): void {\n        let lastTime = performance.now();\n\n        const render = (time: number) => {\n            const deltaTime = (time - lastTime) / 1000; // Seconds\n            lastTime = time;\n\n            // Update Game of Life animation\n            if (this.gameOfLifeActive && this.gameOfLifeSpeed > 0) {\n                // Speed 0 = paused\n                // Speed 1 = instant (no delay)\n                // Map speed to delay: at 1.0 -> 0ms delay, at 0.01 -> 1000ms delay\n                const delay = (1.0 - this.gameOfLifeSpeed) * 1000;\n                const timeSinceLastUpdate = time - this.gameOfLifeLastUpdate;\n\n                if (timeSinceLastUpdate >= delay) {\n                    this.renderer.getSpectralVolume().stepGameOfLife();\n                    this.gameOfLifeLastUpdate = time;\n                }\n            }\n\n            // Update Sine Plasma animation\n            if (this.sinePlasmaActive && this.sinePlasmaSpeed > 0) {\n                // Speed 0 = static\n                // Speed 1 = fast evolution (every frame)\n                // Speed controls frequency of updates\n                const delay = (1.0 - this.sinePlasmaSpeed) * 100; // Max 100ms between updates\n                const timeSinceLastUpdate = time - this.sinePlasmaLastUpdate;\n\n                if (timeSinceLastUpdate >= delay) {\n                    this.renderer.getSpectralVolume().stepSinePlasma();\n                    this.sinePlasmaLastUpdate = time;\n                }\n            }\n\n            // LFO Updates\n            const lfo1Out = this.lfo1.update(deltaTime);\n            const lfo2Out = this.lfo2.update(deltaTime);\n\n            // Modulation\n            if (this.pathYSource !== 'none') {\n                const val = this.pathYSource === 'lfo1' ? lfo1Out : lfo2Out;\n                this.controls.updatePathY(val);\n            }\n\n            if (this.scanPhaseSource !== 'none') {\n                const val = this.scanPhaseSource === 'lfo1' ? lfo1Out : lfo2Out;\n                this.controls.updateScanPosition(val);\n            }\n\n            this.renderer.render(deltaTime);\n\n            // Get spectral data (RGBA)\n            const spectralData = this.renderer.getReadingLineSpectralData();\n\n            // Update Audio\n            this.audioEngine.updateSpectralData(spectralData);\n\n            // Get Audio FFT data\n            const audioSpectralData = this.audioEngine.getAudioSpectralData();\n\n            // Update Visualizations\n            this.spectrogram.update(spectralData, audioSpectralData.left);\n\n            // Update Scope\n            const scopeData = this.audioEngine.getScopeData();\n            this.scope.draw(scopeData.left, scopeData.right);\n\n            this.animationFrameId = requestAnimationFrame(render);\n        };\n        requestAnimationFrame(render);\n    }\n\n    public destroy(): void {\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n        }\n        this.renderer.destroy();\n    }\n}\n\n// Initialize app when DOM is ready\nconst app = new SpectralTableApp();\n\n// Cleanup on page unload\nwindow.addEventListener('beforeunload', () => {\n    app.destroy();\n});\n"],"names":["WebGLContext","canvas","__publicField","gl","required","ext","width","height","r","g","b","wireframeVertexShader","wireframeFragmentShader","pointVertexShader","pointFragmentShader","planeVertexShader","planeFragmentShader","mat4Identity","m","mat4Perspective","fov","aspect","near","far","f","nf","mat4LookAt","eye","center","up","z0","z1","z2","len","zx","zy","zz","x0","x1","x2","xx","xy","xz","yx","yy","yz","mat4RotateX","angle","c","s","mat4RotateY","mat4RotateZ","mat4Translate","x","y","z","mat4Multiply","a","out","i","j","vec3TransformMat4","v","w","iw","SpectralVolume","ctx","resolution","totalVoxels","memoryMB","data","maxIter","power","scale","idx","iz","iy","ix","nx","ny","nz","shiftedX","shiftedY","shiftedZ","cx","cy","cz","iter","theta","phi","zr","mag","smoothIter","freqBoost","phase","custom1","custom2","px","py","pz","dr","dist","inSponge","timeOffset","h","d","u","w_coord","gx","gy","gz","y0","fx","fy","fz","y1","getIdx","c000","c100","c010","c110","c001","c101","c011","c111","result","v000","v100","v010","v110","v001","v101","v011","v111","c00","c10","c01","c11","c0","c1","totalCells","wx","wy","neighbors","dz","dy","dx","nIdx","temp","cellIdx","alive","PlaneType","VOLUME_DENSITY_X_MIN","VOLUME_DENSITY_X_MAX","VOLUME_DENSITY_X_DEFAULT","VOLUME_DENSITY_Y_MIN","VOLUME_DENSITY_Y_MAX","VOLUME_DENSITY_Y_DEFAULT","VOLUME_DENSITY_Z_MIN","VOLUME_DENSITY_Z_MAX","VOLUME_DENSITY_Z_DEFAULT","SynthMode","ReadingPathGeometry","planeType","gridSize","positions","indices","topLeft","topRight","bottomLeft","bottomRight","resolutionX","currentZ","Renderer","initialResolution","wireMVP","wireColor","pointMVP","pointVolume","pointAlpha","pointSize","pointVolumeRes","planeMVP","planeModel","planeVolume","planeAlpha","vertexSrc","fragmentSrc","vertexShader","log","fragmentShader","program","vertices","vao","vertexBuffer","aPositionLoc","indexBuffer","totalPoints","buffer","planeVAO","planeVBO","planePosLoc","planeIBO","linePositions","lineVAO","lineVBO","linePosLoc","deltaTime","projection","view","rotX","rotY","model","viewModel","cameraMVP","res","pRotX","pRotY","pRotZ","pTrans","worldPlaneModel","planeViewModel","state","typeChanged","scanChanged","dataSet","numPoints","worldPos","tx","ty","tz","sample","button","sensitivity","decay","ControlPanel","containerId","el","pathYControl","scanPosControl","title","card","header","element","id","label","min","max","value","step","group","labelEl","valueDisplay","slider","val","labelRow","options","select","option","optEl","targetParam","sourceSelect","opt","valueRow","index","wrapper","waveSelect","freqLabel","freqDisplay","freqSlider","ampLabel","ampDisplay","ampSlider","freq","noteName","defaultOpt","noteNames","midiNote","roundedMidi","octave","noteIndex","accept","multiple","input","currentDataset","container","progressContainer","spinner","progressBar","progressFill","progressText","pathUpdate","volumeUpdate","spectralDataUpdate","files","mode","isWavetable","callback","inputs","currentSelection","pos","display","event","xDisplay","yDisplay","zDisplay","percent","fill","text","Spectrogram","contaiderId","tempCtx","dpr","scanlineData","audioDataLeft","dataToVisualize","isAudioData","row","buf","normalizedX","readIndex","logX","t","StereoScope","left","right","l","scaleY","SPECTRAL_PROCESSOR_CODE","WAVETABLE_PROCESSOR_CODE","AudioEngine","spectralBlob","wavetableBlob","spectralUrl","wavetableUrl","processorName","type","amount","multiplier","params","now","currentGain","AudioAnalyzer","volumeSize","onProgress","xSize","ySize","zSize","numFiles","volumeData","fileIdx","file","arrayBuffer","audioBuffer","channelData","sampleRate","yPosition","yIndex","fftSize","samplesNeeded","processedData","minFreq","maxFreq","startSample","signal","spectrum","binIndex","safeBinIndex","magnitude","fileProgress","sliceProgress","resolve","totalSamples","totalIterations","iterationCount","lastYieldTime","stepSize","numBins","targetLength","output","ratio","srcPos","srcIdx","frac","N","k","real","imag","n","MidiHandler","e","err","message","status","data1","data2","command","note","velocity","highestNote","EnvelopeEditor","engine","aTime","dTime","sLevel","rTime","p0","p1","p2","p3","p4","timeSinceNote","playHeadX","sustainTime","maxSustainX","active","usableHeight","rect","nodes","time","newDecay","startOfRelease","newRelease","PianoKeyboard","whiteKeys","numWhiteKeys","whiteKeyWidth","whiteKeyIndex","noteInOctave","isWhite","key","upHandler","on","LFO","wave","amp","SpectralTableApp","defaultResolution","isConnected","param","lfo","target","source","currentData","carrier","fileArray","numSamples","newResolution","volumeName","error","lastTime","render","delay","lfo1Out","lfo2Out","spectralData","audioSpectralData","scopeData","app"],"mappings":"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"}